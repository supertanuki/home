import{P as e,p as t}from"./vendor.31c5a71a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s=new URLSearchParams(window.location.search);function i(){return s.has("debug")}function a(e){return s.has(e)}function n(e,t){return Number(s.get(e))||t}function r(){return/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(navigator.userAgent)}class o extends e.Scene{constructor(){super("preloader"),this.progressBar=null}preload(){const e=this.cameras.main.width,t=this.cameras.main.height;this.progressBar=this.add.graphics(),this.load.on("progress",(s=>{this.progressBar.clear(),this.progressBar.fillStyle(16777215,1),this.progressBar.fillRect(0,t/2,e*s,30)}),this),this.load.on("complete",(()=>this.progressBar.destroy()),this),this.load.image("tiles","tiles/Asset_Atlas_01.png"),this.load.tilemapTiledJSON("map","tiles/3rivers.json"),this.load.atlas("mai","sprites/mai.png","sprites/mai.json"),this.load.atlas("trees","sprites/trees.png","sprites/trees.json"),this.load.atlas("sprites","sprites/sprites.png","sprites/sprites.json"),r&&this.load.plugin("rexvirtualjoystickplugin","plugins/rexvirtualjoystickplugin.min.js",!0),this.load.font("DefaultFont","fonts/FreePixel.ttf")}create(){this.scene.start("game")}}const d=new e.Events.EventEmitter,h="DiscussionReady",l="DiscussionStarted",c="DiscussionWaiting",m="DiscussionInProgress",p="DiscussionEnded",u="DiscussionContinuing",g="MessageSent",y="EventsUnlocked",f="PreEventsUnlocked",b=70;class k extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a){super(e,t,s,i,a),this.scene=e}resetVelocity(){this.setVelocity(0)}goLeft(){this.setVelocityX(-80),this.scaleX=-1,this.body.offset.x=this.width}goRight(){this.setVelocityX(80),this.scaleX=1,this.body.offset.x=2}goUp(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?b:-70,-70):this.setVelocityY(-80),this.scaleX=1,this.body.offset.x=-2}goDown(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?b:-70,b):this.setVelocityY(80),this.scaleX=1,this.body.offset.x=-2}slowRight(){this.goRight(),this.setVelocity(20,0)}slowLeft(){this.goLeft(),this.setVelocity(-20,0)}slowDown(){this.goDown(),this.setVelocity(0,20)}slowUp(){this.goUp(),this.setVelocity(0,-20)}animateToLeft(){this.anims.play("mai-walk-side",!0)}animateToRight(){this.anims.play("mai-walk-side",!0)}animateToUp(){this.anims.play("mai-walk-up",!0)}animateToDown(){this.anims.play("mai-walk-down",!0)}stopAndWait(){if(null===this.anims.currentAnim)return;const e=this.anims.currentAnim.key.split("-");e[1]="idle",this.anims.play(e.join("-"),!0),this.setVelocity(0,0)}}Phaser.GameObjects.GameObjectFactory.register("hero",(function(e,t,s,i){const a=new k(this.scene,e,t,"mai","idle-down-1");return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(14,22),this.displayList.add(a),this.updateList.add(a),a}));const w={NONE:"NONE",READY:"READY",STARTED:"STARTED",WAITING:"WAITING",INPROGRESS:"INPROGRESS"},v=(e,t)=>e.newUnlockedEvents.includes(t),x=e=>d.emit(f,e),D=function(e){C(e),e.night?O(e,!1):(e.night=!0,e.darkOverlay.setAlpha(0),e.darkOverlay.setVisible(!0),e.tweens.add({targets:e.darkOverlay,alpha:.3,duration:3e3,ease:"Sine.easeInOut"}),e.nightOverlays.forEach((t=>{t.setAlpha(0),t.setVisible(!0),e.tweens.add({targets:t,alpha:1,duration:3e3,ease:"Sine.easeInOut"})})))},O=function(e,t){C(e),e.night=t,e.darkOverlay.setVisible(t),t&&e.darkOverlay.setAlpha(.3),e.maskNightOverlays.forEach((e=>e.setVisible(t))),e.nightOverlays.forEach((e=>e.setVisible(t)))},S=function(e,t){const s=e.add.graphics();s.fillStyle(85,.3),s.fillRect(0,0,2*e.scale.width,2*e.scale.height),s.setVisible(!1),s.setDepth(1e3);const i=e.make.graphics();i.fillStyle(16777215),i.fillCircle(e.scale.width,e.scale.height,t);const a=i.createGeometryMask();a.invertAlpha=!0,s.setMask(a),e.maskNightOverlays.push(i),e.nightOverlays.push(s)},C=function(e){e.darkOverlay||(S(e,50),S(e,80),S(e,100),e.darkOverlay=e.add.rectangle(e.scale.width/4,e.scale.height/4,2*e.scale.width,2*e.scale.height,85).setOrigin(.5,.5).setVisible(!1).setDepth(1e3))};class A extends e.Physics.Arcade.Sprite{constructor(e,t,s,i,a,n,r,o){super(e,t,s,i,a),this.scene=e,this.setDepth(99),this.delta=25,this.spriteId=null,this.heroNearMe=!1,e.anims.create({key:"exclam",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"exclam-"}),repeat:-1,frameRate:6}).addFrame([{key:"sprites",frame:"exclam-2",duration:1}]),this.chatIconDeltaX=n||0,this.chatIconDeltaY=r||0,this.disableChatIcon=o,this.chatImageUi=e.add.sprite(0,0,"sprites","exclam-3").setDepth(1e3).setVisible(!1),this.chatImageUi.anims.play("exclam",!0),d.on(h,this.readyToChat,this)}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-this.delta&&e.x<this.x+this.delta&&e.y>this.y-this.delta&&e.y<this.y+this.delta}preUpdate(e,t){if(super.preUpdate(e,t),!this.visible)return;const s=this.isHeroNearMe();if(this.heroNearMe!==s&&(this.heroNearMe=s,this.spriteId&&d.emit(s?h:p,this.spriteId)),s){const e=this.scene.hero;this.y<e.y?this.setDepth(99):this.setDepth(101)}}stopChatting(){this.chatImageUi.setVisible(!1),this.afterStopChatting&&this.afterStopChatting()}readyToChat(e){this.spriteId===e&&(this.scene.isCinematic||(this.chatImageUi.setPosition(this.x+this.chatIconDeltaX,this.y-13+this.chatIconDeltaY),this.chatImageUi.setVisible(!this.disableChatIcon),this.afterReadyToChat&&this.afterReadyToChat()))}}const P="django";class j extends A{constructor(e,t,s){super(e,t,s,"sprites","django-1",-2,-2),this.spriteId=P,e.anims.create({key:"django-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"django-"}),repeat:-1,frameRate:6}).addFrame(this.anims.generateFrameNames("sprites",{start:3,end:3,prefix:"django-"})).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"django-"})),this.anims.play("django-idle",!0)}afterStopChatting(){this.anims.play("django-idle",!0)}afterReadyToChat(){this.anims.stop()}}e.GameObjects.GameObjectFactory.register(P,(function(t,s){const i=new j(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const I="koko";class L extends A{constructor(e,t,s){super(e,t,s,"sprites","koko",-2,-2),this.spriteId=I,e.anims.create({key:"koko-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"koko-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"koko-"})),this.anims.play("koko-idle",!0)}}e.GameObjects.GameObjectFactory.register(I,(function(t,s){const i=new L(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const R="sleepingGuy";class N extends A{constructor(e,t,s){super(e,t,s,"sprites","sleepingguy-1",0,0,!0),this.spriteId=R,e.anims.create({key:"sleepingguy-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"sleepingguy-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"sleepingguy-"})),this.anims.play("sleepingguy-idle",!0)}}e.GameObjects.GameObjectFactory.register(R,(function(t,s){const i=new N(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const E="twoWomen";class M extends A{constructor(e,t,s){super(e,t,s,"sprites","twowomen-1",-2,-2),this.spriteId=E,e.anims.create({key:"twowomen-idle",frames:[{key:"sprites",frame:"twowomen-1",duration:1e3},{key:"sprites",frame:"twowomen-2",duration:1e3},{key:"sprites",frame:"twowomen-3",duration:300}],repeat:-1,frameRate:1}),this.anims.play("twowomen-idle",!0)}}e.GameObjects.GameObjectFactory.register(E,(function(t,s){const i=new M(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));const F="baby";class B extends A{constructor(e,t,s){super(e,t,s,"sprites","baby-1"),this.spriteId=F,e.anims.create({key:"baby-idle",frames:[{key:"sprites",frame:"baby-1",duration:1e3},{key:"sprites",frame:"baby-2",duration:1e3}],repeat:-1,frameRate:1}),this.anims.play("baby-idle",!0)}}e.GameObjects.GameObjectFactory.register(F,(function(t,s){const i=new B(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const V="bino";class T extends A{constructor(e,t,s){super(e,t,s,"sprites","bino-1"),this.spriteId=V,this.cleaningRoadPosition={x:0,y:0},e.anims.create({key:"bino-idle",frames:[{key:"sprites",frame:"bino-1",duration:600},{key:"sprites",frame:"bino-2",duration:600},{key:"sprites",frame:"bino-3",duration:300},{key:"sprites",frame:"bino-2",duration:600}],repeat:-1,frameRate:6}),this.anims.play("bino-idle",!0)}setCleaningRoadPosition(e,t){this.cleaningRoadPosition={x:e,y:t}}setCleaningRoad(){const{x:e,y:t}=this.cleaningRoadPosition;this.setPosition(e,t),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(V,(function(t,s){const i=new T(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));class _ extends A{constructor(e,t,s){super(e,t,s,"sprites","cat",0,0,!0),this.spriteId="cat",e.anims.create({key:"cat-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cat-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cat-"})),this.anims.play("cat-idle",!0)}}e.GameObjects.GameObjectFactory.register("cat",(function(t,s){const i=new _(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),i.scaleX=-1,i.body.offset.x=i.width,this.displayList.add(i),this.updateList.add(i),i}));class G extends A{constructor(e,t,s){super(e,t,s,"sprites","dog-1",0,0,!0),this.spriteId="dog",e.anims.create({key:"dog-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"dog-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"dog-"})),this.anims.play("dog-idle",!0)}}e.GameObjects.GameObjectFactory.register("dog",(function(t,s){const i=new G(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const Y="escargot";class U extends A{constructor(e,t,s){super(e,t,s,"sprites","escargot",0,0,!0),this.spriteId=Y,e.anims.create({key:"escargot-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"escargot-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"escargot-"})),this.anims.play("escargot-idle",!0)}}e.GameObjects.GameObjectFactory.register(Y,(function(t,s){const i=new U(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));class W extends A{constructor(e,t,s){super(e,t,s,"sprites","cow-1",0,0,!0),this.spriteId="cow",e.anims.create({key:"cow-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cow-"}),repeat:-1,frameRate:2}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cow-"})),this.anims.play("cow-idle",!0)}}e.GameObjects.GameObjectFactory.register("cow",(function(t,s){const i=new W(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const H="veal";class z extends A{constructor(e,t,s){super(e,t,s,"sprites","veal-1",0,0,!0),this.spriteId=H,e.anims.create({key:"veal-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"veal-"}),repeat:-1,frameRate:1}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"veal-"})),this.anims.play("veal-idle",!0)}}e.GameObjects.GameObjectFactory.register(H,(function(t,s){const i=new z(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));const q="fisherman";class K extends A{constructor(e,t,s){super(e,t,s,"sprites","mino-1",-11,-6),this.spriteId=q,e.anims.create({key:"mino-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:3,end:3,prefix:"mino-"})).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"mino-"})),e.anims.create({key:"mino-sad",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-sad-"}),repeat:-1,frameRate:3}),this.anims.play("mino-idle",!0)}setSad(){this.anims.play("mino-sad"),this.body.setSize(this.width,this.height),this.x-=12,this.chatIconDeltaX=0,this.chatIconDeltaY=-2}}e.GameObjects.GameObjectFactory.register(q,(function(t,s){const i=new K(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.setOffset(.5,.5),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const X="miner";class J extends A{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner",0,-5),this.spriteId=X,this.delta=40,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-idle",frames:[{key:"sprites",frame:"miner-1",duration:2e3},{key:"sprites",frame:"miner-2",duration:300}],repeat:-1,frameRate:1}),this.anims.play("miner-idle",!0)}unlockAccessToMine(e,t){this.setPosition(e,t),this.setSize(5,1),this.setOffset(this.width-2,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register(X,(function(e,t,s,i){const a=new J(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width+6,a.height+10),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,-5),this.displayList.add(a),this.updateList.add(a),a}));class $ extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","balloon-1"),this.scene=e,this.anims.create({key:"ball",frames:this.anims.generateFrameNames("sprites",{start:1,end:2,prefix:"balloon-"}),repeat:-1,frameRate:2}),this.anims.play("ball",!0),this.setDepth(100)}}e.GameObjects.GameObjectFactory.register("ball",(function(t,s){const i=new $(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,i.height),this.displayList.add(i),this.updateList.add(i),i}));class Q extends A{constructor(e,t,s){super(e,t,s,"sprites","girl-water-1",0,0,!0),e.anims.create({key:"girl-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"girl-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"girl-water-"})),e.anims.create({key:"girl-sad",frames:[{key:"sprites",frame:"girl-sad-1",duration:1400},{key:"sprites",frame:"girl-sad-2",duration:200}],repeat:-1,frameRate:3}),this.anims.play("girl-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.setPosition(this.sadPosition.x,this.sadPosition.y),this.anims.play("girl-sad")}}e.GameObjects.GameObjectFactory.register("girl",(function(t,s){const i=new Q(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,i.height+10),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));class Z extends A{constructor(e,t,s){super(e,t,s,"sprites","boy-water-1",10),this.spriteId="boy",this.delta=40,this.scene=e,e.anims.create({key:"boy-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"boy-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"boy-water-"})),e.anims.create({key:"boy-sad",frames:[{key:"sprites",frame:"boy-sad-1",duration:1200},{key:"sprites",frame:"boy-sad-2",duration:200}],repeat:-1,frameRate:3}),this.anims.play("boy-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.chatIconDeltaX=0,this.setPosition(this.sadPosition.x,this.sadPosition.y),this.anims.play("boy-sad"),this.body.setSize(this.width+8,this.height+18),this.body.setOffset(-7,0)}}e.GameObjects.GameObjectFactory.register("boy",(function(t,s){const i=new Z(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+18,i.height+20),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const ee="twoGuys";class te extends A{constructor(e,t,s){super(e,t,s,"sprites","twoguys-1"),this.spriteId=ee,e.anims.create({key:"twoguys-idle",frames:[{key:"sprites",frame:"twoguys-1",duration:1e3},{key:"sprites",frame:"twoguys-2",duration:1e3},{key:"sprites",frame:"twoguys-3",duration:300}],repeat:-1,frameRate:1}),this.anims.play("twoguys-idle",!0)}}e.GameObjects.GameObjectFactory.register(ee,(function(t,s){const i=new te(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));class se extends A{constructor(e,t,s){super(e,t,s,"sprites","bike",0,0,!0)}}e.GameObjects.GameObjectFactory.register("bike",(function(t,s){const i=new se(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));const ie=()=>Math.random()<.5?-1:1,ae="waiting",ne="flying",re="outOfScreen",oe=()=>e.Math.Between(1,3);class de extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","bird-idle-1"),this.scene=e,this.idleId=oe(),this.birdDirection=ie(),this.scaleX=this.birdDirection,this.status=ae,this.initialX=t,this.initialY=s}create(){this.reset()}isWaiting(){return this.status===ae}isFlying(){return this.status===ne}isOutOfScreen(){return this.status===re}setOffsetDependingOnDirection(){this.setOffset(-1===this.scaleX?30:-20,-15)}fly(){this.isFlying()||(this.status=ne,this.body.checkCollision.none=!0,this.birdDirection=this.scene.goingRight?1:-1,this.scaleX=-1*this.birdDirection,this.setOffsetDependingOnDirection(),this.anims.play("bird-flying",!0))}reset(){this.status=ae,this.setVisible(!0),this.x=this.initialX,this.y=this.initialY,this.body.checkCollision.none=!1,this.birdDirection=ie(),this.scaleX=this.birdDirection,this.setOffsetDependingOnDirection(),this.idleId=oe(),this.anims.play(`bird-idle-anim-${this.idleId}`,!0)}outOfScreen(){this.anims.stop(),this.status=re,this.setVelocity(0,0),this.setVisible(!1)}preUpdate(e,t){if(super.preUpdate(e,t),this.isOutOfScreen()){const e=this.scene.cameras.main,t=this.scene.hero;(this.initialX<t.x-e.width/2||this.initialX>t.x+e.width/2||this.initialY<t.y-e.height/2||this.initialY>t.y+e.height/2)&&this.reset()}else{if(this.isWaiting())return this.setVelocity(0,0),void this.anims.play(`bird-idle-anim-${this.idleId}`,!0);if(this.isFlying()){this.anims.play("bird-flying",!0),this.setVelocity(120*this.birdDirection,-50);const e=this.scene.cameras.main.worldView;(this.x>e.x+e.width||this.x<e.x||this.y>e.y+e.height||this.y<e.y)&&this.outOfScreen()}else;}}}e.GameObjects.GameObjectFactory.register("bird",(function(t,s){const i=new de(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(50,50),i.setOffsetDependingOnDirection(),this.displayList.add(i),this.updateList.add(i),i}));const he=function(e){const t=e.anims;t.create({key:"bird-idle-anim-1",frames:t.generateFrameNames("sprites",{start:1,end:4,prefix:"bird-idle-"}),repeat:-1,frameRate:1}).addFrame(t.generateFrameNames("sprites",{start:3,end:2,prefix:"bird-idle-"})),t.create({key:"bird-idle-anim-2",frames:[{key:"sprites",frame:"bird-idle-2"},{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-4"},{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-2"}],repeat:-1,frameRate:2}),t.create({key:"bird-idle-anim-3",frames:[{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-4"},{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-2"},{key:"sprites",frame:"bird-idle-1"}],repeat:-1,frameRate:3}),t.create({key:"bird-flying",frames:t.generateFrameNames("sprites",{start:1,end:3,prefix:"bird-flying-"}),repeat:-1,frameRate:10})};class le extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","butterfly-1"),this.scene=e,this.initialPosition={x:t,y:s},this.scaleX=ie();const i=e.anims;i.create({key:"butterfly-anim",frames:i.generateFrameNames("sprites",{start:1,end:3,prefix:"butterfly-"}),repeat:-1,frameRate:4}).addFrame([{key:"sprites",frame:"butterfly-2",duration:2}]),this.anims.play("butterfly-anim")}preUpdate(t,s){super.preUpdate(t,s),this.x-=e.Math.Between(2,5)/10*ie(),this.y-=e.Math.Between(2,5)/10*ie()}}e.GameObjects.GameObjectFactory.register("butterfly",(function(t,s){const i=new le(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),this.displayList.add(i),this.updateList.add(i),i}));const ce=function(e){e.anims},me=function(e){if(!e.isCinematic)return e.currentDiscussionStatus===w.WAITING?(e.currentDiscussionStatus=w.STARTED,void d.emit(u)):e.currentDiscussionStatus===w.READY?(e.currentDiscussionStatus=w.STARTED,void d.emit(l,e.currentDiscussionSprite)):void 0},pe=function(e){e.roads||(e.roadsBottom=e.map.createLayer("roadsBottom",e.tileset).setDepth(95).setVisible(!1),e.roads=e.map.createLayer("roads",e.tileset).setDepth(96).setVisible(!1),e.roadsTop=e.map.createLayer("roadsTop",e.tileset).setDepth(97).setVisible(!1),e.carsBottom=e.map.createLayer("carsBottom",e.tileset).setDepth(98).setVisible(!1),e.carsTop=e.map.createLayer("carsTop",e.tileset).setCollisionByProperty({collide:!0}).setDepth(120).setVisible(!1),e.physics.add.collider(e.hero,e.carsTop),e.carsTop.forEachTile((t=>{!0===t.properties?.bottomCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))})));const t=e.roads.visible;e.roads.setVisible(!t),e.roadsBottom.setVisible(!t),e.roadsTop.setVisible(!t),e.carsTop.setVisible(!t),e.carsBottom.setVisible(!t),e.bridgesShadow.setVisible(t),e.bridges.setVisible(t),e.bridgesTop.setVisible(t)},ue=function(e){if(e.map=e.make.tilemap({key:"map"}),e.tileset=e.map.addTilesetImage("Atlas_01","tiles"),e.map.createLayer("waterUp",e.tileset).setDepth(10),e.land=e.map.createLayer("land",e.tileset).setDepth(20).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.map.createLayer("landUp",e.tileset).setDepth(40),e.bridgesShadow=e.map.createLayer("bridgesShadow",e.tileset).setDepth(50),e.bridges=e.map.createLayer("bridges",e.tileset).setDepth(60),e.bottomObjects=e.map.createLayer("bottom",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.potagerBottom=e.map.createLayer("potagerBottom",e.tileset).setDepth(80),function(e){e.anims.create({key:"sapin",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"sapin-"}),repeat:-1,frameRate:1}),e.anims.create({key:"arbre",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"arbre-"}),repeat:-1,frameRate:1}),e.anims.create({key:"pin",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"pin-"}),repeat:-1,frameRate:1});const t=e.map.getObjectLayer("trees");t.objects.sort(((e,t)=>e.y-t.y)),t.objects.forEach((t=>{e.add.image(t.x,t.y-8,"trees",`${t.name}-base`).setDepth(90).setOrigin(.5,1)})),e.map.createLayer("bottomStaticTrees",e.tileset).setDepth(130),t.objects.forEach((t=>{e.physics.add.sprite(t.x,t.y-24,"trees",`${t.name}-1`).setOrigin(.5,1).setImmovable(!0).setDepth(130).anims.play(t.name),e.pointsCollider.push(e.physics.add.sprite(t.x,t.y-10,null).setSize(16,1).setOrigin(.5,1).setImmovable(!0).setVisible(!1))})),e.map.createLayer("staticTrees",e.tileset).setDepth(150)}(e),e.map.getObjectLayer("hero").objects.forEach((t=>{var s;(e.heroPositions[t.name]={x:t.x,y:t.y},"hero"===t.name)&&(e.tent=e.add.sprite(t.x+2,t.y-2,"sprites","tent-1").setDepth(100),e.hero=e.add.hero(t.x,t.y).setDepth(100),e.hero.stopAndWait(),(s=e.anims).create({key:"mai-walk-down",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"walk-down-"}),repeat:-1,frameRate:10}).addFrame(s.generateFrameNames("mai",{start:2,end:2,prefix:"walk-down-"})),s.create({key:"mai-walk-up",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"walk-up-"}),repeat:-1,frameRate:10}).addFrame(s.generateFrameNames("mai",{start:2,end:2,prefix:"walk-up-"})),s.create({key:"mai-walk-side",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"walk-right-"}),repeat:-1,frameRate:10}).addFrame(s.generateFrameNames("mai",{start:2,end:2,prefix:"walk-right-"})),s.create({key:"mai-idle-down",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"idle-down-"}),repeat:-1,frameRate:4}).addFrame(s.generateFrameNames("mai",{start:2,end:2,prefix:"idle-down-"})),s.create({key:"mai-idle-up",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"idle-up-"}),repeat:-1,frameRate:4}).addFrame(s.generateFrameNames("mai",{start:2,end:2,prefix:"walk-up-"})),s.create({key:"mai-idle-side",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"idle-right-"}),repeat:-1,frameRate:4}).addFrame(s.generateFrameNames("mai",{start:2,end:2,prefix:"idle-right-"})))})),e.map.getObjectLayer("sprites").objects.forEach((t=>{"django"===t.name&&(e.django=e.add.django(t.x,t.y),e.django.on("pointerdown",(()=>me(e)),this)),"koko"===t.name&&(e.koko=e.add.koko(t.x,t.y),e.koko.on("pointerdown",(()=>me(e)),this)),"sleepingGuy"===t.name&&(e.sleepingGuy=e.add.sleepingGuy(t.x,t.y),e.sleepingGuy.on("pointerdown",(()=>me(e)),this)),"twoGuys"===t.name&&(e.twoGuys=e.add.twoGuys(t.x,t.y),e.twoGuys.on("pointerdown",(()=>me(e)),this)),"twoWomen"===t.name&&(e.twoWomen=e.add.twoWomen(t.x,t.y),e.twoWomen.on("pointerdown",(()=>me(e)),this)),"baby"===t.name&&(e.baby=e.add.baby(t.x,t.y),e.baby.on("pointerdown",(()=>me(e)),this)),"bino"===t.name&&(e.bino=e.add.bino(t.x,t.y),e.bino.on("pointerdown",(()=>me(e)),this)),"binoCleaningRoad"===t.name&&e.bino.setCleaningRoadPosition(t.x,t.y),"mino"===t.name&&(e.fisherman=e.add.fisherman(t.x,t.y),e.fisherman.on("pointerdown",(()=>me(e)),this)),"cat"===t.name&&(e.cat=e.add.cat(t.x,t.y),e.cat.on("pointerdown",(()=>me(e)),this)),"dog"===t.name&&(e.dog=e.add.dog(t.x,t.y),e.dog.on("pointerdown",(()=>me(e)),this)),"escargot"===t.name&&(e.escargot=e.add.escargot(t.x,t.y),e.escargot.on("pointerdown",(()=>me(e)),this)),"cow"===t.name&&(e.cow=e.add.cow(t.x,t.y),e.cow.on("pointerdown",(()=>me(e)),this)),"veal"===t.name&&(e.veal=e.add.veal(t.x,t.y)),"miner"===t.name&&(e.miner=e.add.miner(t.x,t.y),e.miner.on("pointerdown",(()=>me(e)),this)),"ball"===t.name&&(e.ball=e.add.ball(t.x,t.y)),"girl"===t.name&&(e.girl=e.add.girl(t.x,t.y)),"boy"===t.name&&(e.boy=e.add.boy(t.x,t.y),e.boy.on("pointerdown",(()=>me(e)),this)),"bike"===t.name&&e.bikes.push(e.add.bike(t.x,t.y)),"boySad"===t.name&&e.boy.setSadPosition(t.x,t.y),"girlSad"===t.name&&e.girl.setSadPosition(t.x,t.y)})),e.bridgesTop=e.map.createLayer("bridgesTop",e.tileset).setDepth(110),e.obstacles=e.map.createLayer("obstacles",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.topObjects=e.map.createLayer("top",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.potagerTop=e.map.createLayer("potagerTop",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.topObjects.forEachTile((t=>{!0===t.properties?.pointCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(10,1).setImmovable(!0).setVisible(!1))})),function(e){he(e),e.map.getObjectLayer("birds").objects.forEach((t=>{e.birds.push(e.add.bird(t.x,t.y).setDepth(160))}))}(e),function(e){ce(e),e.map.getObjectLayer("butterflies").objects.forEach((t=>{e.butterflies.push(e.add.butterfly(t.x,t.y).setDepth(160))}))}(e),e.animatedTiles.init(e.map),e.cameras.main.setBounds(0,400,2144,e.map.heightInPixels-408),e.cameras.main.startFollow(e.hero,!0),function(e){e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F).on("down",(()=>{e.setHeroPosition("hero")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.K).on("down",(()=>{e.setHeroPosition("heroKoko")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B).on("down",(()=>{e.setHeroPosition("heroMiner")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D).on("down",(()=>{e.setHeroPosition("heroDjango")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.N).on("down",(()=>{e.setHeroPosition("heroNono")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S).on("down",(()=>{d.emit(f,["django_met","miner_first_met","first_sleep","mine_nightmare_after"])})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E).on("down",(()=>{d.emit(f,["django_met","pre_first_sleep"])})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C).on("down",(()=>{d.emit(f,["card_for_mine"])})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M).on("down",(()=>{e.cameras.main.zoomTo(2===e.cameras.main.zoom?1:.18,100)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P).on("down",(()=>{e.cameras.main.zoomTo(.18===e.cameras.main.zoom?1:2,100)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T).on("down",(()=>{pe(e)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.O).on("down",(()=>{d.emit(f,["mine_access_validation"]),e.setHeroPosition("heroMine")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A).on("down",(()=>{e.landLessWater||(e.landLessWater=e.map.createLayer("landLessWater",e.tileset).setDepth(30).setCollisionByProperty({collide:!0}).setVisible(!1)),e.landLessWater.setVisible(!e.landLessWater.visible),e.landLessWater.setActive(!e.landLessWater.visible)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.L).on("down",(()=>D(e))),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z).on("down",(()=>{e.screens||(e.screens=e.map.createLayer("screens",e.tileset).setDepth(49).setVisible(!1),e.ads=e.map.createLayer("ads",e.tileset).setDepth(50).setVisible(!1)),e.screens.setVisible(!e.screens.visible),e.ads.setVisible(!e.ads.visible)}))}(e),function(e){e.physics.add.collider(e.miner,e.hero,(()=>{d.emit(h,"miner")})),e.physics.add.collider(e.bino,e.hero,(()=>{d.emit(h,"bino")})),e.physics.add.collider(e.django,e.hero,(()=>{d.emit(h,"django")})),e.physics.add.collider(e.koko,e.hero,(()=>{d.emit(h,"koko")})),e.physics.add.collider(e.sleepingGuy,e.hero,(()=>{d.emit(h,"sleepingGuy")})),e.physics.add.collider(e.twoWomen,e.hero,(()=>{d.emit(h,"twoWomen")})),e.physics.add.collider(e.baby,e.hero,(()=>{d.emit(h,"baby")})),e.physics.add.collider(e.twoGuys,e.hero,(()=>{d.emit(h,"twoGuys")})),e.physics.add.collider(e.fisherman,e.hero,(()=>{d.emit(h,"fisherman")})),e.physics.add.collider(e.cat,e.hero,(()=>{d.emit(h,"cat")})),e.physics.add.collider(e.dog,e.hero,(()=>{d.emit(h,"dog")})),e.physics.add.collider(e.escargot,e.hero,(()=>{d.emit(h,"escargot")})),e.physics.add.collider(e.cow,e.hero,(()=>{d.emit(h,"cow")})),e.physics.add.collider(e.veal,e.hero),e.physics.add.collider(e.boy,e.hero,(()=>{d.emit(h,"boy")})),e.physics.add.collider(e.birds,e.hero,(e=>{e.fly()})),e.physics.add.collider(e.bikes,e.hero),e.physics.add.collider(e.hero,e.water),e.physics.add.collider(e.hero,e.land),e.physics.add.collider(e.hero,e.obstacles),e.physics.add.collider(e.hero,e.topObjects),e.physics.add.collider(e.hero,e.potagerTop),e.physics.add.collider(e.hero,e.bottomObjects),e.physics.add.collider(e.hero,e.pointsCollider)}(e),function(e){e.cursors=e.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),e.input.keyboard.on("keydown",(t=>{"ArrowUp"===t.key?(e.goingUp=!0,e.goingDown=!1):"ArrowDown"===t.key?(e.goingDown=!0,e.goingUp=!1):"ArrowLeft"===t.key?(e.goingLeft=!0,e.goingRight=!1):"ArrowRight"===t.key?(e.goingRight=!0,e.goingLeft=!1):32===t.keyCode&&me(e)}),this),e.input.keyboard.on("keyup",(function(t){"ArrowUp"==t.key?e.goingUp=!1:"ArrowDown"==t.key?e.goingDown=!1:"ArrowLeft"==t.key?e.goingLeft=!1:"ArrowRight"==t.key&&(e.goingRight=!1)}),this)}(e),function(e){r()&&(e.joystick=e.plugins.get("rexvirtualjoystickplugin").add(e,{x:100,y:200,radius:100,base:e.add.circle(0,0,50,16733508,.4).setDepth(1e4),thumb:e.add.circle(0,0,30,13421772,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),e.input.on("pointerdown",(function(t){e.joystick.setPosition(t.x,t.y),e.joystick.setVisible(!0),me(e)}),this),e.joystick.on("update",(function(){e.goingAngle=e.joystick.angle,e.joystick.left?(e.goingLeft=!0,e.goingRight=!1,(177.5<e.goingAngle||-177.5>e.goingAngle)&&(e.goingUp=!1,e.goingDown=!1)):e.joystick.right&&(e.goingRight=!0,e.goingLeft=!1,22.5>e.goingAngle&&-22.5<e.goingAngle&&(e.goingUp=!1,e.goingDown=!1)),e.joystick.up?(e.goingUp=!0,e.goingDown=!1,-67.5>e.goingAngle&&-112.5<e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1)):e.joystick.down&&(e.goingDown=!0,e.goingUp=!1,67.5<e.goingAngle&&112.5>e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1))}),this),e.joystick.on("pointerup",(function(){e.joystick.setVisible(!1),e.stopMoving()}),this))}(e),e.addEventsListeners(),e.cameras.main.fadeIn(1e3,0,0,0),!a("nomusic")){const s=new t.exports.Loader.LoaderPlugin(e);s.audio("village-theme","sounds/village_theme_compressed_v2.mp3"),s.once("complete",(()=>{e.music=e.sound.add("village-theme"),e.music.loop=!0,e.music.play()})),s.start()}e.time.delayedCall(500,(()=>e.scene.run("message"))),a("nostart")||function(e){e.anims.create({key:"tent",frames:e.anims.generateFrameNames("sprites",{start:1,end:5,prefix:"tent-"}),repeat:0,frameRate:10}),e.isIntro=!0,e.isCinematic=!0,e.hero.setVisible(!1),e.time.addEvent({callback:()=>{e.goingDown=!0,e.hero.animateToDown(),e.hero.setVisible(!0)},delay:1e3}),e.events.on("update",(()=>{e.isIntro&&(e.goingDown&&e.hero.slowDown(),e.hero.y>e.heroPositions.hero.y+5&&(e.goingDown=!1,e.tent.anims.play("tent",!0),e.tent.on("animationcomplete",(()=>{e.tent.destroy(),e.isCinematic=!1,e.isIntro=!1}))))}))}(e)},ge=function(e,t,s=!1,i=!1){[e.koko,e.sleepingGuy,e.twoGuys,e.baby,e.twoWomen,e.bino,e.fisherman,e.dog,e.escargot,e.cat,e.boy,e.girl,e.ball,...s?[e.django]:[],...i?[e.miner,e?.minerChief,e?.minerDirty2,e?.minerDirty3,e?.minerDirty4]:[]].forEach((e=>{e&&(e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t)})),e.birds.forEach((e=>{e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t})),e.butterflies.forEach((e=>{e.setVisible(t),e.setActive(t)}))},ye="nono";class fe extends A{constructor(e,t,s){super(e,t,s,"sprites","nono",-2,-2),this.spriteId=ye,e.anims.create({key:"nono-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"nono-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"nono-"})),this.anims.play("nono-idle",!0)}}e.GameObjects.GameObjectFactory.register(ye,(function(t,s){const i=new fe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const be=function(e){e.isCinematic=!0,e.setHeroPosition("heroDjango"),e.hero.slowRight(),e.hero.animateToRight(),D(e),ke(e),d.emit(f,["first_sleep"]),e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(1e3,(()=>{e.isCinematic=!1,d.emit(h,"django"),me(e)}))},ke=function(e){ve(e),ge(e,!0),e.boy.setSad(),e.girl.setSad(),e.fisherman.setSad(),we(e)},we=function(e){for(const t of e.map.getObjectLayer("sprites").objects)if("nono"===t.name){e.nono=e.add.nono(t.x,t.y),e.nono.on("pointerdown",(()=>me(e)),this),e.physics.add.collider(e.nono,e.hero,(()=>{d.emit(h,"nono")}));break}},ve=function(e){e.riverPolluted||(e.riverPolluted=e.map.createLayer("riverPolluted",e.tileset).setDepth(45),e.landUpRiverPolluted=e.map.createLayer("landUpRiverPolluted",e.tileset).setDepth(46),e.bridgesShadowPolluted=e.map.createLayer("bridgesShadowPolluted",e.tileset).setDepth(51))},xe=function(e){e.wakeGame(),e.currentDiscussionStatus=w.NONE,e.hero.stopAndWait(),e.isCinematic=!0,D(e),ke(e),pe(e),function(e){e.bikes.forEach((e=>{e.setVisible(!1),e.body.checkCollision.none=!0}))}(e),function(e){e.potagerBottom.setVisible(!1),e.potagerTop.setVisible(!1),e.potagerTop.forEachTile((e=>{e.setCollision(!1,!1,!1,!1)})),e.potagerNoMore=e.map.createLayer("potagerNoMore",e.tileset).setDepth(80)}(e),e.bino.setCleaningRoad(),e.setHeroPosition("heroDjango"),e.hero.slowRight(),e.hero.animateToRight(),ge(e,!0,!0,!0),function(e){e.birds.forEach(((t,s)=>{Phaser.Math.Between(0,1)&&(e.birds.splice(s,1),t.destroy())}))}(e),function(e){e.butterflies.forEach(((t,s)=>{Phaser.Math.Between(0,1)&&(e.butterflies.splice(s,1),t.destroy())}))}(e),e.time.delayedCall(1200,(()=>{e.isCinematic=!1,d.emit(h,"django"),me(e)}))},De={django:"Django",miner:"Bleurk",bino:"Bino",fisherman:"Mino",cat:"Le chat",dog:"Le chien",cow:"La vache",boy:"Les enfants",koko:"Koko",nono:"Nono",escargot:"L'escargot"},Oe={bino:[{messages:["Hey, salut toi ! Moi je m'appelle Bino !","Fais attention à ne pas marcher sur mes carottes.","Tu es juste de passage ?","Ou bien là pour enquêter sur ce qui se trame ?","Plus au nord d'ici, il y a des personnes louches…","(J'espère que cela n'impactera pas mon potager…)"],repeat:["(Je me demande bien ce que veulent ces gens…)"]},{messages:["Je travaille, mais j'ai pas trop la tête à ça…","Je suis très inquiet à cause de la rivière polluée.","Peut-être qu'en remontant à la source…","on trouverait la cause du problème ?","Mais je suis bien trop occupé là…"],repeat:["(Si seulement quelqu'un pouvait remonter la rivière…)"],dependingOn:["first_sleep"]}],twoGuys:[{messages:["- Le changement climatique, c'est du sérieux, mec.","- Ok, mais tu penses à la biodiversité ?","- Si, si, j'ai même arrêté de tuer les moustiques !"]}],twoWomen:[{messages:["- J'arrête de manger de la viande !","- Pour ta santé ?","- Non, pour réduire mon empreinte carbone !"]}],baby:[{messages:["Papa, je veux mon Papa"]}],sleepingGuy:[{messages:["ZZZzzz, mmmh ?"]}],koko:[{messages:["Oh bah, v’là donc une nouvelle arrivante…","Bienvenue au village de Trois-Rivières !","Ça fait plaisir d’voir une nouvelle tête.","Moi c'est Koko.","J'suis au courant de tout c'qui s'passe dans l'coin !","… Maï ? Un prénom pas banal dis donc !","J’suis sûre que notre patelin va te plaire.","Va donc y faire un tour !","Et si tu cherches un endroit où dormir…","Django t'accueillera sûrement, il est plus au sud."],repeat:["Maï, si t’as fini d’visiter tout le village…","va donc vers le sud pour trouver où dormir."]},{messages:["Tu as rencontré Django ?","C'est la personne la plus gentille que j'connaisse."],dependingOn:["django_met"]},{messages:["Olala, olala… t'as vu ça Maï ?","C'est terrible c'qui arrive à notre rivière !","Un truc louche se trame vers l'est, j'te l'dis !","Nono, qu'habite plus au nord, en revient justement.","Il est mal en point, comme la rivière…","peut-être qu'il pourra t'en dire plus !"],repeat:["Au nord, Nono pourra t'éclairer sur c'qui s'passe !"],dependingOn:["first_sleep"]},{messages:["Je me demande ce qui est arrivé à la rivière, toute marron, beurk."],dependingOn:["nono_first_met"]}],nono:[{messages:["C'est donc toi Maï ?","Ton arrivée ne passe pas inaperçue.","Comme tu peux le constater…","tu ne me vois pas au meilleur de ma forme !","Laisse moi t'expliquer brièvement ma mésaventure.","À l'est, une mine vient de s'installer.","J'ai tenté d'y travailler mais…","il m'est arrivé un accident malencontreux.","Il faut dire qu'on n'est pas très bien protégé.","Et le rythme de travail y est extrêmement soutenu !","Mais je m'en remettrai.","Comme le disait mon grand-père…","« j'suis plus fortiche en parlotte qu'en manuel ! »","Bref. Je te dirais bien d'en prendre garde mais…","je vois dans ton regard que tu es déterminée à y aller.","Si jamais tu rencontres quelconque problème là-bas…","Reviens me voir !"],repeat:["Si tu as un problème à la mine, reviens me voir !"],unlockEvents:["nono_first_met"]},{messages:["Ah, tu t'es faite refoulée à l'entrée ?","J'imagine que suite à mon accident…","l'accès à la mine a été un peu mieux sécurisé.","Comme je te l'ai dit, je suis prêt à t'aider.","Et donc à te prêter mon laissez-passer.","Néanmoins, je le répète…","je veux que tu sois sûre de savoir où tu mets les pieds !","…","Oui… Cette flamme de la curiosité brûle dans tes yeux…","et elle ne sera satisfaite que si tu y vas, je le crains.","Tiens, prends mon badge.","Et surtout fais bien attention à toi !"],repeat:["Fais bon usage de mon badge… et sois prudente."],dependingOn:["nono_first_met","miner_ask_for_card"],unlockEvents:["card_for_mine"]}],django:[{messages:["Ooola, quel bon vent nous amène là !","… Maï ? Quel joli prénom.","Et donc tu cherches un lieu où dormir cette nuit ?","Tu frappes à la bonne porte !","Comme je le dis souvent, il faut qu'une porte…","soit ouverte ou fermée…","et la mienne sera toujours ouverte !","Donc fais un tour du village…","et reviens au coucher du soleil !"],repeat:["Fais un tour du village et reviens ce soir."],unlockEvents:["django_met"]},{messages:["Aah, tu es revenue ! Comme disait ma grand-mère…","un bon arbre peut loger dix mille oiseaux.","Allez, entre !"],dependingOn:["miner_first_met"],unlockEvents:["pre_first_sleep"]},{messages:["Bien dormi, Maï ?","Je suis désolé de te l'apprendre au réveil mais…","quelque chose de terrible est arrivé au village !","Vois par toi-même, je reste ici me calmer l'esprit."],repeat:["Ooh pauvre rivière, laisse moi te jouer une prière."],dependingOn:["first_sleep"]},{messages:["Bien dormi Maï ?","Après toutes ces semaines d'efforts à la mine,","je tenais à te remercier","pour tout ce que tu as fait pour nous.","Grâce à toi, on a la confirmation","que les eaux usées de la mine sont bien responsables","de la pollution de la rivière.","Mais dans le même temps, le village a pu se moderniser.","Je dois avouer être un peu partagé.","Est-ce un mal pour un bien ?","Je n'ai pas la réponse","et je ne voudrais pas t'influencer.","Maintenant que tu as fini ton travail à la mine,","tu as tout le temps de refaire un petit tour."],repeat:["Une chose reste immuable dans tout ce bouleversement","ce sont les 6 cordes de ma guitare."],dependingOn:["mine_nightmare_after"]}],miner:[{messages:["Interdit de passer par ici."],repeat:["J'ai dit qu'on ne passe pas !"]},{messages:["Hop hop hop… il est trop tard pour passer, désolé.","Reviens demain.","(Vivement que mon tour de garde se termine bientôt…)","(j'ai des fourmis dans les jambes)"],repeat:["Il est trop tard pour passer, reviens demain."],unlockEvents:["miner_first_met"],dependingOn:["django_met"]},{messages:["Il faut un laissez-passer pour passer.","Nouvelle directive des chefs !"],repeat:["Il faut un laissez-passer pour accéder à la mine."],dependingOn:["first_sleep"],unlockEvents:["miner_ask_for_card"]},{messages:["Je ne sais pas comment tu as eu ce badge…","mais te voilà donc libre de passer.","D'toute façon, on a besoin de bras pour bosser…"],repeat:["Tu peux passer…"],dependingOn:["card_for_mine"],unlockEvents:["mine_access_validation"]}],minerChief:[{messages:["Bienvenue à Grise Mine, LA mine responsable !","D'ici sortent des tonnes de minerais chaque jour…","extraits avec de l'énergie bas-carbone s'il vous plaît !","Nous utilisons l'eau de façon raisonnée…","traitons nos employés de manière exemplaire, et…","Ça ne t'intéresse pas mon discours ?","…","Tu quoi ? Tu es là pour travailler ???","Hahaha, elle est bien bonne celle-là.","Mes meilleurs hommes sont épuisés très vite…","tu ne tiendras pas une seconde là-dedans !","Mais ok, je veux bien te faire une formation express.","Apprête-toi à te faire miner… le moral HAHAHA"],unlockEvents:["mine_start"]}],minerDirty2:[{messages:["J'suis content d'avoir trouvé ce boulot…","même si c'est pas forcément bien payé."],repeat:["Ce boulot est pas forcément bien payé."]}],minerDirty3:[{messages:["Fiouuu.. ça fait du bien une petite pause…"]}],minerDirty4:[{messages:["Si tu cherches le chef, il est devant l'entrée.","Maintenant laisse moi contempler la vue du progrès."],repeat:["Contemple avec moi, la vue du progrès."]}],fisherman:[{messages:["…chut, tu vas faire fuir les poissons…","Et voilà, raté… Va parler aux autres, je suis concentré là."],repeat:["…"]},{messages:["Par la barbe du %?#%, je ne vais plus pouvoir pêcher.","Qui sont les responsables de ce #?%@ ???"],repeat:["Si j'attrape les responsables de ce #?%@…"],dependingOn:["first_sleep"]}],boy:[{messages:["YOUPIII, on peut se baigner quand on veut !","Faudrait trop qu'on ramène nos potes un jour !"]},{messages:["Oh nooon, on ne peut plus jouer dans l'eau…","Qu'est-ce qu'on va faire maintenant ?"],dependingOn:["first_sleep"]}],cat:[{messages:["Meow…"]}],dog:[{messages:["Wof, wof…"]}],cow:[{messages:["Meuh…"]}],veal:[{messages:["Mmmmh…"]}],escargot:[{messages:["…"]}],mine:[{messages:["Comme tu es nouvelle, je te mets sur un poste simple…","…le nettoyage !","Les roches vont avancer sur le crible…","et tu devras les nettoyer pour éliminer les impuretés !","Pourquoi faire ça tu vas me dire ? Pour le PROGRÈS.","Les métaux et minerais dévoilés servent pour tout.","Smartphones, consoles, plomberie, bijoux…","Nous sommes la première étape d'un grand tout.","Et tu n'en n'es qu'un maillon insignifiant…","Bref. Voici comment procéder.",r?"Bouge le tuyau avec les flèches ← ↑ → ↓":"Bouge le tuyau avec le joystick.",r?"Et pulvérise l'eau avec la barre ESPACE.":"En bougeant le tuyau, l'eau est pulvérisée.","J'espère que t'as bien tout compris !","J'peux pas me permettre que tu ralentisses le train…","de la mine !"],unlockEvents:["mine_tuto_begin"]},{messages:["Tu n'as pas compris comment ça fonctionne ???","Tu dois nettoyer la roche à CENT POUR CENT !","On ne peut pas l'envoyer à moitié nettoyée.",r?"Bouge le tuyau avec les flèches ← ↑ → ↓":"Bouge le tuyau avec le joystick.",r?"Et pulvérise l'eau avec la barre ESPACE. Allez !":"En bougeant le tuyau, l'eau est pulvérisée. Allez !"],dependingOn:["mine_tuto_missed"],unlockEvents:["mine_tuto_rebegin"]},{messages:["Tu as compris comment ça fonctionne…","Passons aux choses sérieuses !","Ça, c'est ce qui va dorénavant contrôler ta vie.","Si tu rates trop souvent, une croix s'allumera.","Au bout de trois croix…","je viendrai moi-même t'accompagner à la sortie !","…","Quoi ?? Pourquoi tu me regardes comme ça ?","Oui… On extrait l'eau de la rivière !","Et on stocke les déchets dans des réservoirs.","Je te rappelle qu'on est une mine responsable.","On ne fait pas n'importe quoi !","Bon, arrête de poser des questions, au boulot !"],dependingOn:["mine_tuto_end"],unlockEvents:["mine_after_tuto"]},{messages:["Tu fais exprès de pas comprendre ?"],dependingOn:["mine_tuto_missed_twice"],unlockEvents:["mine_after_tuto"]},{messages:["C'est bien ce qu'il me semblait…","tu ne peux pas tenir un rythme aussi soutenu !","On arrête les frais pour aujourd'hui.","Allez… ne fais pas grise mine !"],dependingOn:["mine_game_over"],unlockEvents:["mine_end"]}]},Se={"mine.faster":"Plus vite !","mine.fasterAgain":"Encore plus vite, allez !!!","mine.waterEmpty":"Réservoir d'eau vide !","mine.waterFull":"Réservoir d'eau plein !","mine.moreMaterials":"Arrivage de minerais, on augmente la fréquence !","mine.warning":"Ressaisis-toi, on est là pour faire du chiffre !","mine.lastWarning":"Dernier avertissement, concentre-toi !"},Ce=e=>Se[e],Ae="16px",Pe=20;class je extends e.Scene{constructor(){super("message"),this.textObject=null,this.spriteNameObject=null,this.currentText="",this.currentDiscussionStatus=w.NONE}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json")}create(){const e=this.sys.game.config;this.actionBackground=this.add.rectangle(e.width/2,e.height-30,200,30,0).setAlpha(.5).setScrollFactor(0).setOrigin(.5,.5).setDepth(2e3).setVisible(!1),this.actionBackgroundLine=this.add.line(0,0,e.width/2-60,e.height-12,e.width/2+60,e.height-12,0).setLineWidth(4).setAlpha(.5).setScrollFactor(0).setOrigin(0,0).setDepth(2e3).setVisible(!1),this.actionText=this.add.text(e.width/2,e.height-30,r()?"Appuyer pour continuer":"Appuyer sur espace",{fontFamily:"DefaultFont",fontSize:Ae,fill:"#ffffff",resolution:Pe}).setOrigin(.5,.5).setScrollFactor(0).setDepth(2e3).setVisible(!1),this.dialogBackground=this.add.sprite(e.width/2,e.height-30,"ui","dialog-2").setOrigin(.5,.5).setDepth(2e3).setAlpha(.8).setScrollFactor(0).setVisible(!1),this.dialogBackgroundColor=this.add.rectangle(e.width/2,e.height-30,252,44,0).setAlpha(.5).setOrigin(.5,.5).setDepth(2e3).setScrollFactor(0).setVisible(!1),this.textObject=this.add.text(e.width/2,e.height-30,"",{fontFamily:"DefaultFont",fontSize:Ae,fill:"#ffffff"}).setResolution(Pe).setOrigin(.5,.5).setScrollFactor(0).setDepth(3e3).setWordWrapWidth(245).setVisible(!1),this.spriteNameObject=this.add.text(e.width/2-132,e.height-64,"",{fontFamily:"DefaultFont",fontSize:Ae,fill:"#000000",padding:4}).setResolution(Pe).setOrigin(0,.5).setScrollFactor(0).setDepth(3e3).setVisible(!1),d.on(g,this.handleMessage,this),d.on(p,this.handleDiscussionEnd,this),d.on(h,this.readyToAction,this),d.on(l,this.stopAction,this),d.on(y,this.listenEvents,this)}showMineCard(){const e=this.sys.game.config;this.mineCard=this.add.image(e.width/2,e.height/2,"ui","card").setScrollFactor(0).setDepth(3e3).setAlpha(0),this.tweens.add({targets:this.mineCard,x:e.width-30,y:e.height-30,alpha:1,scale:1,ease:"Quad.easeOut",loop:0,duration:1e3})}hideMineCard(){this.mineCard&&this.tweens.add({targets:this.mineCard,alpha:0,scale:.5,ease:"Sine.easeInOut",loop:0,duration:500,onComplete:()=>this.mineCard.destroy()})}listenEvents(e){v(e,"card_for_mine")&&this.showMineCard(),v(e,"mine_access_validation")&&this.hideMineCard()}startDiscussion(){this.scene.isActive()&&(this.currentDiscussionStatus=w.STARTED,this.stopAction())}stopAction(){this.scene.isActive()&&(this.actionText.setVisible(!1),this.actionBackground.setVisible(!1),this.actionBackgroundLine.setVisible(!1))}readyToAction(){this.scene.isActive()&&this.currentDiscussionStatus===w.NONE&&(this.scene.get("game")?.isCinematic||(this.currentDiscussionStatus=w.READY,this.actionText.setVisible(!0),this.actionBackground.setVisible(!0),this.actionBackgroundLine.setVisible(!0)))}handleDiscussionEnd(){this.scene.isActive()&&(this.currentDiscussionStatus=w.NONE,this.stopAction(),this.textObject.text="",this.textObject.setVisible(!1),this.spriteNameObject.text="",this.spriteNameObject.setVisible(!1),this.dialogBackground.setVisible(!1),this.dialogBackgroundColor.setVisible(!1))}handleMessage(e){if(!this.scene.isActive())return;const{message:t,sprite:s}=e;this.textObject.visible&&t===this.currentText||(this.dialogBackground.setVisible(!0),this.dialogBackgroundColor.setVisible(!0),this.spriteNameObject.text=De[s],this.spriteNameObject.setVisible(!0),this.textObject.text=t,this.currentText=t,this.textObject.setVisible(!0),this.time.delayedCall(300,(()=>d.emit(c))))}}const Ie="minerChief";class Le extends A{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner",0,-5),this.spriteId=Ie,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-chief-idle",frames:[{key:"sprites",frame:"miner-chief-1",duration:300},{key:"sprites",frame:"miner-chief-2",duration:300},{key:"sprites",frame:"miner-chief-3",duration:300}],repeat:-1,frameRate:1}),this.anims.play("miner-chief-idle",!0)}}Phaser.GameObjects.GameObjectFactory.register(Ie,(function(e,t,s,i){const a=new Le(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,a.height/2),this.displayList.add(a),this.updateList.add(a),a}));class Re extends A{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner",0,-5),this.delta=20,this.futureMinerPosition=null,this.initialY=s}setSpriteNumber(e){if(this.spriteId=`minerDirty${e}`,this.anims.play("miner-dirty-idle-"+(e-1),!0),e>2)return this.scaleX=-1,void this.setOffset(this.width,this.height/2);this.setOffset(0,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register("minerDirty",(function(e,t,s,i,a){const n=new Re(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n}));const Ne=function(e){e.add.image(0,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.add.image(400,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.add.image(180,100,"mineLand","mine-mount").setOrigin(0,0).setScrollFactor(.1,.25),e.add.image(340,124,"mineLand","mine").setOrigin(0,0).setScrollFactor(.18,.32),e.add.image(1692,240,"mineLand","mine-machine").setOrigin(0,0).setScrollFactor(.7,.7)},Ee=function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,((s,i)=>{if(1===i){e.cameras.main.setBounds(0,0,e.map.widthInPixels,e.map.heightInPixels-8),function(e){e.anims.create({key:"miner-dirty-idle-1",frames:[{key:"sprites",frame:"miner-dirty-1",duration:2e3},{key:"sprites",frame:"miner-dirty-2",duration:300}],repeat:-1,frameRate:1}),e.anims.create({key:"miner-dirty-idle-2",frames:[{key:"sprites",frame:"miner-dirty-1",duration:1800},{key:"sprites",frame:"miner-dirty-2",duration:300}],repeat:-1,frameRate:1}),e.anims.create({key:"miner-dirty-idle-3",frames:[{key:"sprites",frame:"miner-dirty-1",duration:2200},{key:"sprites",frame:"miner-dirty-2",duration:300}],repeat:-1,frameRate:1})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterCard"===t.name&&e.miner.unlockAccessToMine(t.x,t.y),"minerChief"===t.name&&(e.minerChief=e.add.minerChief(t.x,t.y),e.minerChief.on("pointerdown",(()=>me(e)),this),e.physics.add.collider(e.minerChief,e.hero,(()=>{d.emit(h,"minerChief")})));for(let s=2;s<=4;s++)t.name===`miner${s}`&&(e[`minerDirty${s}`]=e.add.minerDirty(t.x,t.y,null,null,s),e[`minerDirty${s}`].on("pointerdown",(()=>me(e)),this),e.physics.add.collider(e[`minerDirty${s}`],e.hero,(()=>{d.emit(h,`minerDirty${s}`)})))}!function(e){const s=new t.exports.Loader.LoaderPlugin(e);s.atlas("mineLand","sprites/mineLand.png","sprites/mineLand.json"),s.once("complete",(()=>Ne(e))),s.start()}(e),e.cameras.main.fadeIn(1e3,0,0,0),e.isCinematic=!1}}))};class Me extends t.exports.Scene{constructor(){super("game"),this.controls=null,this.cursors=null,this.hero=null,this.joystick=null,this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.goingAngle=null,this.water=null,this.land=null,this.topObjects=null,this.currentDiscussionStatus=w.NONE,this.currentDiscussionSprite=null,this.birds=[],this.butterflies=[],this.pointsCollider=[],this.heroPositions={},this.maskNightOverlays=[],this.darkOverlay=null,this.nightOverlays=[],this.bikes=[],this.isCinematic=!1,this.night=!1,this.music=null,this.django=null,this.koko=null,this.sleepingGuy=null,this.twoGuys=null,this.baby=null,this.twoWomen=null,this.bino=null,this.fisherman=null,this.dog=null,this.escargot=null,this.cat=null,this.boy=null,this.girl=null,this.ball=null,this.tent=null,this.map=null,this.tileset=null}preload(){this.load.scenePlugin("AnimatedTiles","plugins/AnimatedTiles.js","animatedTiles","animatedTiles")}create(){a("debug")&&(this.fpsText=this.add.text(10,10,"hello",{fontSize:"10px",fill:"#fff"}).setDepth(1e4).setScrollFactor(0),this.time.addEvent({delay:100,loop:!0,callback:()=>{this.fpsText.setText(`FPS: ${this.game.loop.actualFps.toFixed(2)}`)}})),function(e){if(e.resetGameSize(),a("nostart"))return void e.startGame();const t=e.add.text(225,125,"Démarrer",{fontFamily:"DefaultFont",fontSize:Ae,fill:"#ffffff"}).setOrigin(.5,.5).setResolution(Pe);t.setInteractive({useHandCursor:!0}),t.on("pointerdown",(()=>{t.disableInteractive(!0),t.setText("Dans une forêt paisible,\nloin du fracas des villes.");const s=e.add.text(225,220,"Chargement du jeu...",{fontFamily:"DefaultFont",fontSize:Ae,fill:"#aaaaaa"}).setOrigin(.5,.5).setResolution(Pe);e.time.delayedCall(500,(()=>{t.destroy(),s.destroy(),e.startGame()}))}))}(this)}startGame(){a("dreamMine")?this.gotoScene("mine-nightmare"):a("factory")?this.debugFactory():a("mine")?this.debugMine():ue(this)}gotoScene(e){this.scene.pause("game"),this.scene.launch(e)}debugFactory(){this.scene.pause("game"),this.scene.launch("factory")}debugMine(){this.scene.pause("game"),this.scene.launch("mine")}resetGameSize(){this.scale.setGameSize(450,250)}setHeroPosition(e){const t=this.heroPositions[e];this.hero.setPosition(t.x,t.y)}stopMoving(){this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.hero.stopAndWait()}sleepGame(){this.scene.sleep("game"),this.scene.sleep("message")}wakeGame(){this.scene.wake("game"),this.scene.wake("message"),this.resetGameSize(),this.cameras.main.fadeIn(1e3,0,0,0)}addEventsListeners(){d.on(h,this.handleDiscussionReady,this),d.on(l,this.handleDiscussionStarted,this),d.on(c,this.handleDiscussionWaiting,this),d.on(p,this.handleDiscussionEnded,this),d.on(m,this.handleDiscussionInProgress,this),d.on(y,this.listenEvents,this)}listenEvents(e){var t;v(e,"miner_first_met")&&(ge(t=this,!1),D(t)),v(e,"pre_first_sleep")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&be(e)}))}(this),v(e,"mine_access_validation")&&Ee(this),v(e,"mine_start")&&function(e){e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(e.scene.launch("mine"),e.sleepGame())}))}(this),v(e,"mine_after")&&function(e){e.wakeGame(),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=w.NONE,O(e,!0),e.setHeroPosition("heroMine"),e.hero.slowLeft(),e.hero.animateToLeft(),ge(e,!1,!0,!0),e.time.delayedCall(2e3,(()=>{e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(e.setHeroPosition("heroAfterMine"),e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(2200,(()=>{e.hero.slowUp(),e.hero.animateToUp(),e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&e.time.delayedCall(2e3,(()=>{e.scene.launch("mine-nightmare"),e.sleepGame()}))}))})))}))}))}(this),v(e,"mine_nightmare_after")&&xe(this)}handleDiscussionReady(e){if(this.scene.isActive()){if(this.currentDiscussionStatus===w.READY&&this.currentDiscussionSprite!==e)this.handleDiscussionEnded(this.currentDiscussionSprite);else if(this.currentDiscussionStatus!==w.NONE)return;this.currentDiscussionStatus=w.READY,this.currentDiscussionSprite=e}}handleDiscussionInProgress(){this.scene.isActive()&&(this.currentDiscussionStatus=w.INPROGRESS)}handleDiscussionStarted(){this.scene.isActive()&&(this.currentDiscussionStatus=w.STARTED)}handleDiscussionWaiting(e){this.scene.isActive()&&(this.currentDiscussionStatus=w.WAITING)}handleDiscussionEnded(e){this.scene.isActive()&&e&&this[e]&&(this.currentDiscussionStatus=w.NONE,this[e]?.stopChatting())}update(e,t){this.night&&this.darkOverlay&&function(e){const t=e.hero.x-e.scale.width,s=e.hero.y-e.scale.height;e.nightOverlays.forEach((e=>e.setPosition(t,s))),e.maskNightOverlays.forEach((e=>e.setPosition(t,s))),e.darkOverlay.setPosition(e.hero.x,e.hero.y)}(this),this.cursors&&this.hero&&!this.isCinematic&&this.hero.body&&(this.hero.resetVelocity(),[w.STARTED,w.WAITING,w.INPROGRESS].includes(this.currentDiscussionStatus)?this.hero.stopAndWait():(this.goingLeft?this.hero.goLeft():this.goingRight&&this.hero.goRight(),this.goingUp?this.hero.goUp():this.goingDown&&this.hero.goDown(),this.goingUp?(this.hero.animateToUp(),this.hero.x>1139&&this.hero.x<1151&&this.hero.y>1291&&this.hero.y<1295&&(this.hero.stopAndWait(),d.emit(h,"django"),me(this))):this.goingDown?this.hero.animateToDown():this.goingRight?this.hero.animateToRight():this.goingLeft&&this.hero.animateToLeft(),this.goingDown||this.goingUp||this.goingRight||this.goingLeft||this.stopMoving()))}}class Fe extends e.Scene{preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json")}create(){this.currentDiscussionStatus=w.NONE,this.anims.create({key:"speaker-off-anim",frames:[{key:"ui",frame:"speaker-off"}],repeat:-1,frameRate:1}),this.anims.create({key:"speaker-on-anim",frames:[{key:"ui",frame:"speaker-off"},{key:"ui",frame:"speaker-on"}],repeat:-1,frameRate:8}),this.anims.create({key:"dialog-shout-anim",frames:[{key:"ui",frame:"dialog-shout-1"},{key:"ui",frame:"dialog-shout-2"}],repeat:-1,frameRate:8}),this.add.sprite(4,0,"ui","scoreboard").setOrigin(0,0).setDepth(2e3),this.scores=[];for(let e=0;e<=2;e++)this.scores.push(this.add.sprite(12+24*e,22,"ui","scoreok").setOrigin(0,0).setDepth(2e3));this.speaker=this.add.sprite(470,0,"ui","speaker-off").setOrigin(0,0).setDepth(2e3),this.dialogBackground=this.add.sprite(345,50,"ui","dialog-shout-1").setOrigin(.5,.5).setDepth(2e3).setAlpha(.8).setVisible(!1),this.dialogBackground.anims.play("dialog-shout-anim",!0),this.textObject=this.add.text(345,50,"",{fontFamily:"DefaultFont",fontSize:Ae,fill:"#ffffff"}).setResolution(Pe).setOrigin(.5,.5).setScrollFactor(0).setDepth(2e3).setWordWrapWidth(240).setVisible(!1),d.on(l,this.handleDiscussionStarted,this),d.on(c,this.handleDiscussionWaiting,this),d.on(p,this.handleDiscussionEnded,this),d.on(g,this.handleMessage,this)}startDiscussion(e){d.emit(l,e)}handleMessage(e){const{message:t,sprite:s}=e;this.updateMessage(t,!0)}updateMessage(e,t=!1){this.scene.isActive()&&(this.dialogBackground.setVisible(!0),this.speaker.anims.play("speaker-on-anim"),this.textObject.text=e,this.textObject.setVisible(!0),t?this.time.delayedCall(200,(()=>d.emit(c))):this.time.delayedCall(2500,(()=>{this.currentDiscussionStatus===w.NONE&&this.handleDiscussionEnded()})))}updateWarnings(e){e>3&&(e=3);for(let t=0;t<e;t++)this.scores[t].setTexture("ui","scoreko")}handleAction(){if(this.scene.isActive())return this.currentDiscussionStatus===w.WAITING?(this.currentDiscussionStatus=w.STARTED,void d.emit(u)):void 0}handleDiscussionStarted(){this.scene.isActive()&&(this.currentDiscussionStatus=w.STARTED)}handleDiscussionWaiting(){this.scene.isActive()&&(this.currentDiscussionStatus=w.WAITING)}handleDiscussionEnded(){this.scene.isActive()&&(this.currentDiscussionStatus=w.NONE,this.textObject.setVisible(!1),this.speaker.anims.play("speaker-off-anim"),this.dialogBackground.setVisible(!1))}}const Be={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},Ve=265,Te=10,_e=10,Ge=255,Ye=340;class Ue extends e.Scene{constructor(){super({key:"mine-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.stopWater=!0}preload(){this.load.atlas("mine","sprites/mine.png","sprites/mine.json")}create(){this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.hero(275,150,"mai","idle-down-1"),this.hero.setAlpha(0),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.createRock(500,250,50,50,"rock-1"),this.createRock(50,250,500,50,"rock-2"),this.createRock(50,50,500,250,"rock-3"),this.createRock(100,200,300,20,"rock-4"),this.tube=this.add.container(),this.tube.add(this.add.tileSprite(0,-33,22,1e3,"mine","tube").setOrigin(.5,1)),this.tube.add(this.add.image(0,0,"mine","tube-end").setOrigin(.43,1)),this.tube.setDepth(1e3).setAlpha(0),this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:2e3,quantity:100,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.tweens.add({targets:this.tube,angle:180,alpha:1,x:500,y:216,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress<.2,e.progress>.8&&this.water.updateConfig({frame:["water-maroon"]})},onComplete:()=>{this.tweens.add({targets:this.tube,angle:180,alpha:0,x:400,y:20,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress>.9}})}})}endScene(){this.cameras.main.fadeOut(1e3,0,0,0,((e,t)=>{1===t&&(this.scene.stop(),x(["mine_nightmare_after"]))}))}createRock(e,t,s,i,a){const n=this.add.image(e,t,"mine",a);return n.setAlpha(0),this.tweens.add({targets:n,alpha:.8,ease:"Sine.linear",duration:5e3,onComplete:()=>{this.tweens.add({targets:n,x:s,y:i,alpha:0,ease:"Sine.linear",duration:5e3})}}),this.tweens.add({targets:n,angle:360,x:s,y:i,alpha:.8,ease:"Sine.linear",duration:1e4}),n}update(){this.stopWater||(this.water.emitParticleAt(this.tube.x,this.tube.y),this.water.updateConfig({angle:{min:this.tube.angle+100,max:this.tube.angle+80}}))}}const We=[110,175,237],He=[60,125,187],ze=[.8,1,1.2],qe=n("numberRockValidatedBeforeSpeedIncrement",5),Ke=n("numberRocksValidatedBeforeSpeedIncrementAgain",30),Xe=n("waterReductionFactor",.2),Je=n("waterRefillFactor",.5),$e=n("numberRockValidatedToHaveMoreMaterials",12),Qe=n("timeBetweenRocks",2e3),Ze=n("moreMaterialsTimeBetweenRocks",1e3),et=n("numberIsRefined",60),tt=n("tubeSpeed",5),st=n("tubeDeltaEffect",40);const it={type:t.exports.AUTO,parent:"game",pixelArt:!0,render:{pixelArt:!0},width:450,height:250,backgroundColor:"#000000",physics:{default:"arcade",arcade:{debug:i(),gravity:{y:0}}},scene:[o,Me,Ue,class extends Fe{constructor(){super({key:"mine",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.rocks=[],this.movingCable=!1,this.rockValidated=0,this.rockNotValidated=0,this.speed=ze,this.control="none",this.waterStockPercentage=100,this.rechargeWater=!1,this.conveyor=[],this.conveyorPosition=[0,0,0],this.tubeRollings=[],this.tubeCurrentY=0,this.goingDown=!0,this.isCinematic=!0,this.firstStep=!0,this.faster=!1,this.fasterAgain=!1,this.moreMaterials=!1,this.tutoMissedCount=0,this.warnings=0}preload(){super.preload(),this.load.atlas("mine","sprites/mine.png","sprites/mine.json")}create(){super.create(),this.cameras.main.setBackgroundColor(3154462),this.scale.setGameSize(550,300),this.add.image(275,0,"mine","background").setOrigin(.5,0).setScale(-1,1),this.add.image(180,46,"mine","water-tank");const t=this.add.bitmapMask(null,197,35,"mine","water-tank-mask");this.waterStock=this.add.image(197,46,"mine","water"),this.waterStock.setMask(t),this.add.image(197,46,"mine","water-glass"),this.add.image(197,18,"mine","water-tank-top"),this.conveyor.push(this.add.tileSprite(0,92,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(0,140,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,156,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(10,204,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,220,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(5,268,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.add.image(509,169,"mine","right-block").setOrigin(.5,.5).setDepth(1e3),this.add.image(474,69,"mine","block-bottom").setOrigin(.5,.5).setDepth(1),this.add.image(474,133,"mine","block-bottom").setOrigin(.5,.5).setDepth(10),this.add.image(474,197,"mine","block-bottom").setOrigin(.5,.5).setDepth(20),this.add.image(515,257,"mine","right-glass").setOrigin(.5,.5).setDepth(1e3),this.add.image(40,169,"mine","right-block").setOrigin(.5,.5).setScale(-1,1).setDepth(1e3),this.add.image(75,69,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(1),this.add.image(75,133,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(10),this.add.image(75,197,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(20),this.add.image(35,257,"mine","left-glass").setOrigin(.5,.5).setDepth(1e3),this.anims.create({key:"particules",frames:this.anims.generateFrameNames("mine",{start:1,end:4,prefix:"particules-"}),repeat:-1,frameRate:10}),this.rockParticles=this.add.sprite(275,202,"mine","particules-1").setOrigin(.5,.5).setVisible(!1),this.rockParticles.anims.play("particules",!0),this.tube=this.add.tileSprite(0,0,22,1e3,"mine","tube").setOrigin(.5,1).setDepth(1e3),this.tubeEnd=this.add.image(275,50,"mine","tube-end").setOrigin(.43,1).setDepth(1e3),this.add.image(64,0,"mine","tube-top").setOrigin(0,0).setDepth(1e3);for(let e=0;e<3;e++)this.tubeRollings.push(this.add.sprite(80+13*e,2,"mine","tube-rolling-1").setOrigin(0,0).setDepth(1e3));this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:320,quantity:50,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.events.on("update",(()=>{this.isCinematic||(!this.rechargeWater&&this.action&&this.waterStockPercentage>0?(this.water.emitParticleAt(this.tubeEnd.x,this.tubeEnd.y),this.water.forEachAlive((t=>{const s=We[this.tubeCurrentY]+e.Math.Between(0,30);t.y>=s&&(t.y=s,t.velocityY*=-e.Math.Between(1,100)/100,t.velocityX*=e.Math.Between(1,20)/10)})),this.waterStockPercentage-=Xe,this.waterStockPercentage<=0&&(this.waterStockPercentage=0,this.rechargeWater=!0,this.updateMessage(Ce("mine.waterEmpty")))):(this.waterStockPercentage+=Je,this.waterStockPercentage>=100&&(this.waterStockPercentage=100),this.rechargeWater&&100===this.waterStockPercentage&&(this.rechargeWater=!1,this.updateMessage(Ce("mine.waterFull")))),this.waterStock.y=46+54*(100-this.waterStockPercentage)/100,this.waterStock.setVisible(this.waterStockPercentage>5))})),d.on(y,this.listenEvents,this),this.createControls(),this.startGame()}createControls(){this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",(e=>{"ArrowUp"===e.key?(this.goingUp=!0,this.goingDown=!1):"ArrowDown"===e.key?(this.goingDown=!0,this.goingUp=!1):"ArrowLeft"===e.key?(this.goingLeft=!0,this.goingRight=!1):"ArrowRight"===e.key?(this.goingRight=!0,this.goingLeft=!1):32===e.keyCode&&(this.action=!0,this.handleAction())}),this),this.input.keyboard.on("keyup",(e=>{"ArrowUp"==e.key?this.goingUp=!1:"ArrowDown"==e.key?this.goingDown=!1:"ArrowLeft"==e.key?this.goingLeft=!1:"ArrowRight"==e.key?this.goingRight=!1:32===e.keyCode&&(this.action=!1)}),this),r()&&(this.joystick=this.plugins.get("rexvirtualjoystickplugin").add(this,{x:100,y:200,radius:100,base:this.add.circle(0,0,50,16733508,.4).setDepth(1e4),thumb:this.add.circle(0,0,30,13421772,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),this.input.on("pointerdown",(e=>{this.joystick.setPosition(e.x,e.y),this.joystick.setVisible(!0),this.action=!0,this.handleAction()}),this),this.joystick.on("update",(function(){this.goingAngle=this.joystick.angle,this.joystick.left?(this.goingLeft=!0,this.goingRight=!1,(177.5<this.goingAngle||-177.5>this.goingAngle)&&(this.goingUp=!1,this.goingDown=!1)):this.joystick.right&&(this.goingRight=!0,this.goingLeft=!1,22.5>this.goingAngle&&-22.5<this.goingAngle&&(this.goingUp=!1,this.goingDown=!1)),this.joystick.up?(this.goingUp=!0,this.goingDown=!1,-67.5>this.goingAngle&&-112.5<this.goingAngle&&(this.goingRight=!1,this.goingLeft=!1)):this.joystick.down&&(this.goingDown=!0,this.goingUp=!1,67.5<this.goingAngle&&112.5>this.goingAngle&&(this.goingRight=!1,this.goingLeft=!1))}),this),this.joystick.on("pointerup",(()=>{this.joystick.setVisible(!1),this.action=!1,this.goingUp=!1,this.goingDown=!1,this.goingRight=!1,this.goingLeft=!1}),this))}listenEvents(e){v(e,"mine_tuto_begin")&&this.tutoBegin(),v(e,"mine_tuto_rebegin")&&this.tutoBegin(),v(e,"mine_after_tuto")&&this.afterTuto(),v(e,"mine_end")&&this.endGame()}tutoBegin(){this.isCinematic=!1,this.firstStep=!0,this.createRock()}tutoEnd(){this.isCinematic=!0,x(["mine_tuto_end"]),this.startDiscussion("mine")}tutoMissed(){this.tutoMissedCount++,x(this.tutoMissedCount>1?["mine_tuto_missed_twice"]:["mine_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("mine")}afterTuto(){this.isCinematic=!1,this.firstStep=!1,this.createRock()}startGame(){this.cameras.main.fadeOut(0,0,0,0),this.cameras.main.fadeIn(2e3,0,0,0),this.time.addEvent({callback:()=>this.startDiscussion("mine"),delay:1e3})}endGame(){this.cameras.main.fadeOut(1e3,0,0,0,((e,t)=>{1===t&&(this.scene.stop(),x(["mine_after"]))}))}createRock(){const t=e.Math.Between(0,2),s=We[t],i=this.add.sprite(600,s,"mine","rock-1");i.setDepth(1+10*t);const a=this.rocks.length?e.Math.Between(0,Math.round(.9*et)):0;this.setRockTexture(i,a),this.rocks.push({rock:i,index:t,refined:a}),this.firstStep||this.time.addEvent({callback:()=>{this.createRock(),this.moreMaterials||this.rockValidated!==$e||(this.moreMaterials=!0,this.updateMessage(Ce("mine.moreMaterials")))},delay:this.rockValidated>$e?Ze:Qe})}gameOver(){this.isCinematic=!0,this.isGameOver=!0,this.rockParticles.setVisible(!1),x(["mine_game_over"]),this.startDiscussion("mine")}updateStep(){this.firstStep&&(this.rockValidated?this.tutoEnd():this.tutoMissed()),this.faster||this.rockValidated!==qe||(this.faster=!0,this.speed.forEach(((e,t)=>this.speed[t]+=.6)),this.updateMessage(Ce("mine.faster"))),this.fasterAgain||this.rockValidated!==Ke||(this.fasterAgain=!0,this.speed.forEach(((e,t)=>this.speed[t]+=.6)),this.updateMessage(Ce("mine.fasterAgain")));const e=this.rockValidated+this.rockNotValidated;Math.round(100*this.rockValidated/(e||1));if((this.rockNotValidated>15&&1)+(this.rockNotValidated>25&&1)+(this.rockNotValidated>30&&1)+(this.rockNotValidated>35&&1)>this.warnings){if(this.warnings++,this.warnings>3)return void this.gameOver();this.updateMessage(Ce(3===this.warnings?"mine.lastWarning":"mine.warning")),this.updateWarnings(this.warnings)}}updateWaterDepth(){this.water.setDepth(10*this.tubeCurrentY+11)}up(){this.movingCable||this.tubeCurrentY>0&&(this.tubeCurrentY--,this.moveCable(),this.updateWaterDepth())}down(){this.movingCable||this.tubeCurrentY<2&&(this.tubeCurrentY++,this.moveCable(),this.updateWaterDepth())}moveCable(){this.movingCable=!0,this.tweens.add({targets:this.tubeEnd,y:He[this.tubeCurrentY],ease:"Sine.easeInOut",duration:300,onComplete:()=>{this.movingCable=!1}})}setRockTexture(e,t){const s=Math.round(6*t/et);e.setTexture("mine","rock-"+(s||1))}update(e,t){if(!this.isGameOver){this.rockParticles.setVisible(!1),this.tubeRollings.forEach(((e,t)=>e.x=this.tubeEnd.x-22+16*t)),this.goingUp&&this.tubeEnd.y>50?this.up():this.goingDown&&this.tubeEnd.y<200&&this.down(),this.goingLeft&&this.tubeEnd.x>100?this.tubeEnd.x-=tt:this.goingRight&&this.tubeEnd.x<450&&(this.tubeEnd.x+=tt),this.tube.x=this.tubeEnd.x,this.tube.y=this.tubeEnd.y-34,this.conveyor.forEach(((e,t)=>{this.conveyorPosition[t]+=this.speed[t],e.setTilePosition(this.conveyorPosition[t],0)}));for(const e in this.rocks){const t=this.rocks[e],s=t.rock;s.x-=this.speed[t.index],s.x<-20&&(this.rocks.splice(e,1),s.destroy(),t.refined<=et&&(this.rockNotValidated++,this.updateStep())),t.refined>et||s.y<this.tubeEnd.y+50+25&&s.y>this.tubeEnd.y+50-25&&this.action&&!this.rechargeWater&&s.x>this.tubeEnd.x-st&&s.x<this.tubeEnd.x+st&&(t.refined++,this.setRockTexture(s,t.refined),this.rockParticles.setVisible(!0),this.rockParticles.setDepth(s.depth),this.rockParticles.setPosition(s.x,s.y-25),t.refined>et&&(this.rockValidated++,this.updateStep()))}}}},class extends Fe{constructor(){super({key:"factory"}),this.componentsLine=[],this.motherBoard=[],this.componentsLinePosition=0,this.componentValidated=0,this.isMotherboardValidated=!1,this.motherboardSpeed=.75,this.numberValidated=0,this.enableComponentsControl=!0,this.conveyorPosition=0,this.conveyorRollings=[],this.conveyorBackPosition=0,this.warnings=0}preload(){super.preload(),this.load.atlas("factory","sprites/factory.png","sprites/factory.json")}create(){super.create(),this.cameras.main.setBackgroundColor(0),this.scale.setGameSize(550,300),this.anims.create({key:"select-component-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:3,prefix:"select-"}),repeat:-1,frameRate:10}).addFrame(this.anims.generateFrameNames("factory",{start:2,end:2,prefix:"select-"})),this.anims.create({key:"water-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:2,prefix:"water-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling-fast",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:20}),this.add.image(0,234,"factory","ground").setOrigin(0,0),this.add.tileSprite(-4,-36,554,135,"factory","sol").setOrigin(0,0),this.conveyorInBack=this.add.tileSprite(0,-10,550,96,"factory","tapis").setOrigin(0,0),this.initBackMotherboard(),this.addBackHands(),this.add.tileSprite(0,0,150,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(150,0,67,99,"factory","vitre").setOrigin(0,0),this.add.tileSprite(217,0,350,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(0,99,550,135,"factory","sol").setOrigin(0,0);this.add.image(474,97,"factory","block-back"),this.conveyor=this.add.tileSprite(0,105,550,96,"factory","tapis").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0),this.add.tileSprite(45,201,550,11,"factory","rouleaubas").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0).setScale(-1,1),this.add.tileSprite(0,201,14,11,"factory","rouleaubas").setOrigin(0,0),this.tube=this.add.rectangle(510,100,1,1,0).setOrigin(.5,1);for(let e=0;e<3;e++)this.conveyorRollings.push(this.add.sprite(8*e-3,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));for(let e=0;e<54;e++)this.conveyorRollings.push(this.add.sprite(40+8*e,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));this.add.image(510,140,"factory","block").setDepth(10),this.add.image(476,97,"factory","tube-water").setDepth(10),this.add.image(476,117,"factory","tube-water").setDepth(10),this.add.image(476,137,"factory","tube-water").setDepth(10),this.waterCleaningAnims=[];for(let e=0;e<=2;e++){const t=this.add.sprite(457,124+20*e,"factory","water-1").setDepth(10).setVisible(!1);t.anims.play("water-anim"),this.waterCleaningAnims.push(t)}this.initMotherboard(),this.initComponents(),this.initSelectedComponent(),this.userLeftHand=this.add.image(Ge,Ye,"factory","gant").setOrigin(0,0),this.userLeftHand.scaleY=-1,this.userLeftHand.setDepth(10).setVisible(!1),this.cameras.main.fadeIn(1e3,0,0,0),this.createControls()}addBackHands(){this.leftHand=this.add.image(420,-10,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand,x:300,y:-100,angle:40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:200,duration:1e3}),this.rightHand=this.add.image(330,-10,"factory","gant").setOrigin(0,0),this.rightHand.scaleX=-1,this.tweens.add({targets:this.rightHand,x:350,y:-100,angle:-40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:800}),this.leftHand2=this.add.image(200,-12,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand2,x:200,y:-80,angle:30,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:250,duration:800}),this.rightHand2=this.add.image(100,-12,"factory","gant").setOrigin(0,0),this.rightHand2.scaleX=-1,this.tweens.add({targets:this.rightHand2,x:150,y:-90,angle:-25,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:900})}initComponents(){let e=0;for(const t in Be)this.componentsLine.push({name:t,tray:this.add.image(275+90*e,Ve,"factory",`tray-${t}`),image:this.add.image(275+90*e,Ve,"factory",Be[t])}),e++}getComponentsNumber(){return this.numberValidated>5?3:2}initBackMotherboard(){this.backMotherboards=[];for(let e=0;e<=5;e++)this.backMotherboards.push(this.add.image(600+100*e,30,"factory","motherboard"))}initMotherboard(){const t=-150,s=this.getComponentsNumber(),i=70/s;this.componentValidated=0,this.isMotherboardValidated=!1,this.motherBoardComponents=[],this.motherBoard=[],this.motherBoard.push(this.add.image(t,150,"factory","motherboard"));const a=[],n=Object.keys(Be);for(let l=0;l<s;l++){const t=e.Math.RND.pick(n);a.push(t),n.splice(n.indexOf(t),1)}let r=[2,1];if(s>2)if("green"===a[0])r=[1,2];else if("green"===a[1]){const e=a[2];a[2]="green",a[1]=e}let o=0,d=0;const h=[...r];a.forEach(((e,t)=>{let a;2===s?a=this.add.image(i*t-168,150,"factory",`component-position-${e}`):(0===h[o]&&(o++,d=0),r[o],a=this.add.image((i+9)*o-165,1===r[o]?150:135+(i+5)*d,"factory",`component-position-${e}`),h[o]--,d++),this.motherBoardComponents.push({name:e,component:a,validated:!1}),this.motherBoard.push(a)})),this.enableComponentsControl=!0}initSelectedComponent(){this.add.sprite(275,263,"factory","select-1").anims.play("select-component-anim")}createControls(){if(this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",(e=>{"ArrowUp"===e.key?this.setComponent():"ArrowDown"===e.key||("ArrowLeft"===e.key?this.left():"ArrowRight"===e.key?this.right():32===e.keyCode&&this.setComponent())}),this),r()){const e=Number(this.sys.game.config.width),t=100;this.input.on("pointerdown",(s=>{s.x<e/2-t?this.left():s.x>e/2+t?this.right():this.setComponent()}),this)}}refreshComponentsLine(){let e=0;this.componentsLine.forEach((t=>{const s=275+90*this.componentsLinePosition+90*e;t.image.x=s,t.tray.x=s,t.image.y=Ve,e++}))}right(){!this.enableComponentsControl||this.componentsLinePosition-1<-1*this.componentsLine.length+1||(this.componentsLinePosition--,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=1,this.movingHand=!0,this.userLeftHand.setX(350).setAlpha(.1).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:330,angle:-30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}left(){!this.enableComponentsControl||this.componentsLinePosition+1>0||(this.componentsLinePosition++,this.refreshComponentsLine(),this.movingHand,this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=-1,this.movingHand=!0,this.userLeftHand.setX(200).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:220,angle:30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}getSelectedComponent(){return this.componentsLine[-1*this.componentsLinePosition]}getValidatedComponent(){const e=this.getSelectedComponent();for(const t of this.motherBoardComponents)if(t.name===e.name&&!t.validated)return this.componentValidated++,t.validated=!0,t;return null}resetUserHand(){this.movingHand=!1,this.userLeftHand.scaleX=1,this.userLeftHand.setAlpha(.1),this.userLeftHand.setVisible(!1),this.userLeftHand.setRotation(0),this.userLeftHand.setPosition(Ge,Ye)}setComponent(){if(!this.enableComponentsControl)return;this.enableComponentsControl=!1;const e=this.getSelectedComponent().image;e.setDepth(1);const t={x:e.x,y:e.y},s=this.getValidatedComponent();this.resetUserHand(),this.userLeftHand.setVisible(!0);const i=200;if(this.handAnimation&&this.handAnimation.destroy(),s){const{component:a,name:n}=s;this.tweens.add({targets:e,x:a.x+10,y:a.y,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=Ve,this.enableComponentsControl=!0;try{a.setTexture("factory",`component-${n}`)}catch(s){}}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:a.x,y:230,alpha:1,angle:(a.x-275)/10,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!0,this.resetUserHand()}})}else this.tweens.add({targets:e,y:150,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=Ve,this.enableComponentsControl=!0}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,y:230,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!0,this.resetUserHand()}});this.componentValidated===this.getComponentsNumber()&&this.time.delayedCall(200,(()=>{this.motherBoard.length&&this.validateMotherboard()}))}validateMotherboard(){this.isMotherboardValidated=!0,this.numberValidated++,this.waterCleaningAnims.forEach((e=>e.setVisible(!0))),this.time.delayedCall(1e3,(()=>this.waterCleaningAnims.forEach((e=>e.setVisible(!1)))));0==this.numberValidated%5&&(this.motherboardSpeed+=.5,this.updateMessage("Validé ! Plus vite maintenant !!!")),1==this.numberValidated%6&&this.updateMessage("C'est bien, tu es productive !")}destroyMotherboard(){for(const e of this.motherBoard)e.destroy();this.motherBoard=[]}endMotherboard(){if(this.enableComponentsControl=!1,!this.isMotherboardValidated)return this.warnings++,this.updateWarnings(this.warnings),this.updateMessage("C'est quoi ce boulot ? Ressaisis-toi la nouvelle !"),this.destroyMotherboard(),void this.time.delayedCall(1e3,(()=>{this.initMotherboard()}));this.destroyMotherboard(),this.initMotherboard()}update(){if(this.conveyorBackPosition+=1,this.conveyorInBack.setTilePosition(this.conveyorBackPosition,0),this.backMotherboards.forEach((e=>{e.x--,e.x<-100&&(e.x=600)})),!this.motherBoard.length)return void this.conveyorRollings.forEach((e=>e.anims.stop()));const e=this.isMotherboardValidated?_e:this.motherBoard[0].x<30||this.motherBoard[0].x>500?Te:this.motherboardSpeed;this.conveyorRollings.forEach((t=>t.anims.play([_e,Te].includes(e)?"rolling-fast":"rolling",!0))),this.conveyorPosition-=e,this.conveyor.setTilePosition(this.conveyorPosition,0);for(const t of this.motherBoard)t.x+=e;this.motherBoard.length&&this.motherBoard[0].x>590&&this.endMotherboard()}},je,class{constructor(){this.currentSprite=null,this.unlockedEvents=[],this.spritePosition={},d.on(l,this.startDiscussion,this),d.on(u,this.continueDiscussion,this),d.on(y,this.unlockMessages,this),d.on(f,this.saveUnlockedEvent,this)}initSpriteThreadIfNeeded(e){this.spritePosition?.[e]||(this.spritePosition[e]={currentThread:0,currentMessagePosition:0,threadRead:[]})}setCurrentThread(e,t){this.initSpriteThreadIfNeeded(e),this.spritePosition[e].currentThread=t}getCurrentThread(e){const t=e||this.currentSprite;return this.initSpriteThreadIfNeeded(t),this.spritePosition[t].currentThread}getCurrentMessage(){const e=this.getCurrentThread(),t=this.spritePosition?.[this.currentSprite]?.currentMessagePosition;if(null==e||null==t)return;const s=Oe[this.currentSprite][e]?.dependingOn;if(this.isValidDependingOn(this.currentSprite,s)){if(this.spritePosition[this.currentSprite].threadRead.includes(e)){const s=Oe[this.currentSprite][e]?.repeat;if(s)return s?.[t]}return Oe[this.currentSprite][e]?.messages?.[t]}}startDiscussion(e){this.initSpriteThreadIfNeeded(e),this.currentSprite=e;const t=this.getNextAvailableThread(e,this.getCurrentThread());void 0!==t&&(this.setCurrentThread(e,t),this.resetMessagePosition(e)),this.resetMessagePosition(e),this.sendMessage()}resetMessagePosition(e){this.spritePosition[e].currentMessagePosition=0}getNextAvailableThread(e,t){if(!Oe[e][t])return;const s=Oe[e][t]?.dependingOn;return s&&this.isValidDependingOn(e,s)&&!this.spritePosition[e].threadRead.includes(t)?t:this.getNextAvailableThread(e,t+1)}continueDiscussion(){this.spritePosition[this.currentSprite].currentMessagePosition++,this.sendMessage()}sendMessage(){let e=this.getCurrentMessage();if(!e){this.endThread();const t=this.getNextAvailableThread(this.currentSprite,this.getCurrentThread());if(void 0===t)return void this.endDiscussion();this.setCurrentThread(this.currentSprite,t),this.resetMessagePosition(this.currentSprite),e=this.getCurrentMessage()}d.emit(m),d.emit(g,{sprite:this.currentSprite,message:e})}endThread(){this.spritePosition[this.currentSprite].threadRead.push(this.getCurrentThread()),this.preSaveUnlockedEvent()}endDiscussion(){d.emit(p,this.currentSprite)}preSaveUnlockedEvent(){const e=this.getCurrentThread(),t=Oe[this.currentSprite][e]?.unlockEvents;this.saveUnlockedEvent(t)}saveUnlockedEvent(e){e&&e.filter((e=>!this.unlockedEvents.includes(e))).length&&d.emit(y,{newUnlockedEvents:e,unlockedEvents:[...e,...this.unlockedEvents]})}isValidDependingOn(e,t){return!t||t.every((e=>"!"!==e[0]===this.unlockedEvents.includes(e)))}unlockMessages(e){for(const t in Oe){this.initSpriteThreadIfNeeded(t);for(const s in Oe[t]){const i=Oe[t][s]?.dependingOn;if(!i)continue;const a=i.filter((e=>!this.unlockedEvents.includes(e)));a.length>0&&a.every((t=>e.newUnlockedEvents.includes(t)))&&(this.spritePosition[t].currentThread=Number(s),this.spritePosition[t].currentMessagePosition=0)}}this.unlockedEvents.push(...e.newUnlockedEvents)}}],scale:{mode:t.exports.Scale.FIT,autoCenter:t.exports.Scale.CENTER_BOTH}};new t.exports.Game(it);
