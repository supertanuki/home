import{P as e,p as t}from"./vendor-B0E1IonP.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s=new URLSearchParams(window.location.search);function i(){return s.has("debug")}function a(e){return s.has(e)}function n(e,t){return Number(s.get(e))||t}function r(e,t){const s=Math.round((Date.now()-t)/1e3);console.log("*** Game duration for: "+e,s)}function o(){return/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(navigator.userAgent)}class d extends e.Scene{constructor(){super("preloader"),this.progressBar=null}preload(){const e=this.cameras.main.width,t=this.cameras.main.height;this.progressBar=this.add.graphics(),this.load.on("progress",(s=>{this.progressBar.clear(),this.progressBar.fillStyle(16777215,1),this.progressBar.fillRect(0,t/2,e*s,30)}),this),this.load.on("complete",(()=>this.progressBar.destroy()),this),this.load.image("tiles","tiles/Asset_Atlas_01.png"),this.load.tilemapTiledJSON("map","tiles/3rivers.json"),this.load.image("splash","img/Splash_Art.webp"),this.load.atlas("mai","sprites/mai.png","sprites/mai.json"),this.load.atlas("trees","sprites/trees.png","sprites/trees.json"),this.load.atlas("sprites","sprites/sprites.png","sprites/sprites.json"),o&&this.load.plugin("rexvirtualjoystickplugin","plugins/rexvirtualjoystickplugin.min.js",!0),this.load.font("DefaultFont","fonts/FreePixel.ttf")}create(){this.scene.start("game")}}const h=new e.Events.EventEmitter,c="DiscussionReady",l="DiscussionAbort",u="DiscussionStarted",m="DiscussionWaiting",p="DiscussionInProgress",g="DiscussionEnded",y="DiscussionContinuing",f="HasUnreadMessage",b="MessageSent",v="EventsUnlocked",k="EventsDispatched",w="PreEventsUnlocked",C="ScreenShutdown";let x=!1,O=!1,D=!1,_=!1;const j=function(e){if(a("nomusic")||x||e.villageTheme&&e.villageTheme.isPlaying)return;if(A(e,e.industryTheme),A(e,e.miniGameTheme),A(e,e.djangoTheme),e.villageTheme&&e.sound.get("village-theme"))return console.log("fadeIn villageTheme"),void L(e,e.villageTheme);x=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-theme","sounds/village_theme_compressed.mp3"),s.once("complete",(()=>{e.villageTheme=e.sound.add("village-theme"),L(e,e.villageTheme),x=!1})),s.start()},S=function(e){if(a("nomusic")||O||e.industryTheme&&e.industryTheme.isPlaying)return;if(A(e,e.villageTheme),A(e,e.miniGameTheme),A(e,e.djangoTheme),e.industryTheme&&e.sound.get("industry-theme"))return void L(e,e.industryTheme);O=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("industry-theme","sounds/industry_theme_compressed.mp3"),s.once("complete",(()=>{e.industryTheme=e.sound.add("industry-theme"),L(e,e.industryTheme),O=!1})),s.start()},P=function(e){if(a("nomusic")||D||e.miniGameTheme&&e.miniGameTheme.isPlaying)return;if(A(e,e.industryTheme),A(e,e.villageTheme),A(e,e.djangoTheme),e.miniGameTheme&&e.sound.get("minigame-theme"))return void L(e,e.miniGameTheme);D=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("minigame-theme","sounds/minigame_theme_compressed.mp3"),s.once("complete",(()=>{e.miniGameTheme=e.sound.add("minigame-theme"),L(e,e.miniGameTheme),D=!1})),s.start()},I=function(e){if(a("nomusic")||_||!e.djangoThemeEnabled||e.djangoTheme&&e.djangoTheme.isPlaying)return;if(A(e,e.villageTheme),A(e,e.miniGameTheme),A(e,e.industryTheme),e.djangoTheme&&e.sound.get("django-theme"))return console.log("play dango theme"),void L(e,e.djangoTheme);_=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("django-theme","sounds/zik_django.mp3"),s.once("complete",(()=>{e.djangoTheme=e.sound.add("django-theme"),L(e,e.djangoTheme),_=!1})),s.start()},A=function(e,t){t&&t.isPlaying&&e.tweens.add({targets:t,volume:0,duration:2e3,ease:"Linear",onComplete:()=>{t.stop()}})},L=function(e,t){t.isPlaying||(t.volume=0,t.loop=!0,t.play(),e.tweens.add({targets:t,volume:1,duration:2e3,ease:"Linear"}))},T=function(e,s){if(!s?.sounds||s?.sounds[e])return;const i=new t.Loader.LoaderPlugin(s);i.audio(e,`sounds/sfx/${e}.mp3`),i.once("complete",(()=>{s.sounds[e]=s.sound.add(e)})),i.start()},M=function(e,t,s=!1,i=1,a=!1){t?.sounds&&t.sounds[e]&&(s?t.sound.play(e,{volume:i,loop:a}):t.sounds[e].isPlaying||(console.log(e,t.sounds[e].isPlaying),t.sounds[e].play({volume:i,loop:a})))},B=function(e,t){t?.sounds&&t.sounds[e]&&t.sounds[e].isPlaying&&t.sounds[e].stop()};class R extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a){super(e,t,s,i,a),this.scene=e,this.shadow=e.add.ellipse(t,s+10,12,8,0,.1),T("sfx_bruits_de_pas",e)}playMoveSound(){M("sfx_bruits_de_pas",this.scene,!1,.3,!0)}stopMoveSound(){B("sfx_bruits_de_pas",this.scene)}resetVelocity(){this.setVelocity(0)}goLeft(){this.setVelocityX(-80),this.scaleX=-1,this.body.offset.x=this.width}goRight(){this.setVelocityX(80),this.scaleX=1,this.body.offset.x=2}goUp(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?70:-70,-70):this.setVelocityY(-80),this.scaleX=1,this.body.offset.x=-2}goDown(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?70:-70,70):this.setVelocityY(80),this.scaleX=1,this.body.offset.x=-2}slowRight(){this.goRight(),this.setVelocity(20,0)}slowLeft(){this.goLeft(),this.setVelocity(-20,0)}slowDown(){this.goDown(),this.setVelocity(0,20)}slowUp(){this.goUp(),this.setVelocity(0,-20)}animateToLeft(){this.anims.play("mai-walk-side",!0)}animateToRight(){this.anims.play("mai-walk-side",!0)}animateToUp(){this.anims.play("mai-walk-up",!0)}animateToDown(){this.anims.play("mai-walk-down",!0)}stopAndWait(){if(this.stopMoveSound(),null===this.anims.currentAnim)return;const e=this.anims.currentAnim.key.split("-");e[1]="idle",this.anims.play(e.join("-"),!0),this.setVelocity(0,0)}updateShadow(){this.shadow&&(this.shadow.setDepth(this.depth-1),this.shadow.x=this.x,this.shadow.y=this.y+8)}}Phaser.GameObjects.GameObjectFactory.register("hero",(function(e,t,s,i){const a=new R(this.scene,e,t,"mai","idle-down-1");return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(14,22),this.displayList.add(a),this.updateList.add(a),a}));const E={NONE:"NONE",READY:"READY",STARTED:"STARTED",WAITING:"WAITING",INPROGRESS:"INPROGRESS"},V=(e,t)=>e.newUnlockedEvents.includes(t),F=e=>h.emit(w,e),N=function(e){U(e),e.night?G(e,!1):(e.night=!0,e.darkOverlay.setAlpha(0),e.darkOverlay.setVisible(!0),e.tweens.add({targets:e.darkOverlay,alpha:.3,duration:3e3,ease:"Sine.easeInOut"}),e.nightOverlays.forEach((t=>{t.setAlpha(0),t.setVisible(!0),e.tweens.add({targets:t,alpha:1,duration:3e3,ease:"Sine.easeInOut"})})))},G=function(e,t){U(e),e.night=t,e.darkOverlay.setVisible(t),t&&e.darkOverlay.setAlpha(.3),e.maskNightOverlays.forEach((e=>e.setVisible(t))),e.nightOverlays.forEach((e=>e.setVisible(t)))},W=function(e,t){const s=e.add.graphics();s.fillStyle(85,.3),s.fillRect(0,0,2*e.scale.width,2*e.scale.height),s.setVisible(!1),s.setDepth(1e3);const i=e.make.graphics();i.fillStyle(16777215),i.fillCircle(e.scale.width,e.scale.height,t);const a=i.createGeometryMask();a.invertAlpha=!0,s.setMask(a),e.maskNightOverlays.push(i),e.nightOverlays.push(s)},U=function(e){e.darkOverlay||(W(e,50),W(e,80),W(e,100),e.darkOverlay=e.add.rectangle(e.scale.width/4,e.scale.height/4,2*e.scale.width,2*e.scale.height,85).setOrigin(.5,.5).setVisible(!1).setDepth(1e3))};class q extends e.Physics.Arcade.Sprite{constructor(e,t,s,i,a,n,r,o){super(e,t,s,i,a),this.scene=e,this.setDepth(99),this.delta=25,this.spriteId=null,this.heroNearMe=!1,this.chatIconDeltaX=n||0,this.chatIconDeltaY=r||0,this.disabledChatIcon=o||!1,this.previousChatImageUiVisibility=!1,this.disabledChatIcon||(this.chatImageUi=e.add.sprite(t+this.chatIconDeltaX,s-13+this.chatIconDeltaY,"sprites","exclam-3").setDepth(1e3).setVisible(!0),this.chatImageUi.anims.play("exclam",!0)),h.on(c,this.readyToChat,this),h.on(f,this.hasUnreadMessage,this)}setPosition(e,t){return super.setPosition(e,t),this.updateChatIconPosition(),this}setVisible(e){if(super.setVisible(e),this.chatImageUi)return e?void(this.previousChatImageUiVisibility&&this.chatImageUi.setVisible(!0)):(this.previousChatImageUiVisibility=this.chatImageUi.visible,void this.chatImageUi.setVisible(!1))}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-this.delta&&e.x<this.x+this.delta&&e.y>this.y-this.delta&&e.y<this.y+this.delta}preUpdate(e,t){if(super.preUpdate(e,t),!this.visible)return;const s=this.isHeroNearMe();if(this.heroNearMe!==s&&(this.heroNearMe=s,this.spriteId&&h.emit(s?c:l,this.spriteId)),s){const e=this.scene.hero;this.y<e.y?this.setDepth(99):this.setDepth(101)}}stopChatting(){console.log("stopChatting",this.spriteId),this.chatImageUi&&this.chatImageUi.setVisible(!1),this.afterStopChatting&&this.afterStopChatting()}abortChatting(){console.log("abortChatting",this.spriteId),this.afterStopChatting&&this.afterStopChatting()}disableChatIcon(){this.disabledChatIcon=!0,this.chatImageUi?.setVisible(!1)}enableChatIcon(){console.log(this.spriteId,this.chatImageUi.x,this.chatImageUi.visible,this.disabledChatIcon),this.disabledChatIcon=!1,this.chatImageUi.setVisible(!0)}hasUnreadMessage(e){!this.disabledChatIcon&&this.spriteId===e&&this.chatImageUi&&(this.updateChatIconPosition(),this.chatImageUi.setVisible(!0))}updateChatIconPosition(){!this.disabledChatIcon&&this.chatImageUi&&this.chatImageUi.setPosition(this.x+this.chatIconDeltaX,this.y-13+this.chatIconDeltaY)}readyToChat(e){this.spriteId===e&&(this.scene.isCinematic||this.afterReadyToChat&&this.afterReadyToChat())}}const z="django";class Y extends q{constructor(e,t,s){super(e,t,s,"sprites","django-1",-2,-2),this.spriteId=z,e.anims.create({key:"django-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"django-"}),repeat:-1,frameRate:6}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"django-"})),this.anims.play("django-idle",!0),this.hasUnreadMessage(this.spriteId)}afterStopChatting(){this.anims.play("django-idle",!0)}afterReadyToChat(){this.anims.stop()}}e.GameObjects.GameObjectFactory.register(z,(function(t,s){const i=new Y(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const H="koko";class K extends q{constructor(e,t,s){super(e,t,s,"sprites","koko-1",-2,-2),this.spriteId=H,e.anims.create({key:"koko-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"koko-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"koko-"})),this.anims.play("koko-idle",!0),this.hasUnreadMessage(this.spriteId)}}e.GameObjects.GameObjectFactory.register(H,(function(t,s){const i=new K(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const X="sleepingGuy";class J extends q{constructor(e,t,s){super(e,t,s,"sprites","sleepingguy-1",0,0,!0),this.spriteId=X,e.anims.create({key:"sleepingguy-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"sleepingguy-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"sleepingguy-"})),this.anims.play("sleepingguy-idle",!0)}}e.GameObjects.GameObjectFactory.register(X,(function(t,s){const i=new J(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const $="twoWomen";class Q extends q{constructor(e,t,s){super(e,t,s,"sprites","twowomen-1",-2,-2),this.spriteId=$,e.anims.create({key:"twowomen-idle",frames:[{key:"sprites",frame:"twowomen-1"},{key:"sprites",frame:"twowomen-2"},{key:"sprites",frame:"twowomen-3"}],repeat:-1,frameRate:2}),this.anims.play("twowomen-idle",!0)}}e.GameObjects.GameObjectFactory.register($,(function(t,s){const i=new Q(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));const Z="baby";class ee extends q{constructor(e,t,s){super(e,t,s,"sprites","baby-1",0,0,!0),this.spriteId=Z,e.anims.create({key:"baby-idle",frames:[{key:"sprites",frame:"baby-1"},{key:"sprites",frame:"baby-2"}],repeat:-1,frameRate:2}),this.anims.play("baby-idle",!0)}}e.GameObjects.GameObjectFactory.register(Z,(function(t,s){const i=new ee(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const te="bino";class se extends q{constructor(e,t,s){super(e,t,s,"sprites","bino-1"),this.spriteId=te,this.cleaningRoadPosition={x:0,y:0},e.anims.create({key:"bino-idle",frames:[{key:"sprites",frame:"bino-1"},{key:"sprites",frame:"bino-2"},{key:"sprites",frame:"bino-3"},{key:"sprites",frame:"bino-2"}],repeat:-1,frameRate:2}),this.anims.play("bino-idle",!0),this.hasUnreadMessage(this.spriteId)}setCleaningRoadPosition(e,t){this.cleaningRoadPosition={x:e,y:t}}setCleaningRoad(){const{x:e,y:t}=this.cleaningRoadPosition;this.setPosition(e,t),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(te,(function(t,s){const i=new se(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));class ie extends q{constructor(e,t,s){super(e,t,s,"sprites","cat-1",0,0,!0),this.spriteId="cat",e.anims.create({key:"cat-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cat-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cat-"})),this.anims.play("cat-idle",!0)}}e.GameObjects.GameObjectFactory.register("cat",(function(t,s){const i=new ie(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),i.scaleX=-1,i.body.offset.x=i.width,this.displayList.add(i),this.updateList.add(i),i}));class ae extends q{constructor(e,t,s){super(e,t,s,"sprites","dog-1",0,0,!0),this.spriteId="dog",e.anims.create({key:"dog-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"dog-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"dog-"})),this.anims.play("dog-idle",!0)}}e.GameObjects.GameObjectFactory.register("dog",(function(t,s){const i=new ae(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const ne="escargot";class re extends q{constructor(e,t,s){super(e,t,s,"sprites","escargot-1",0,0,!0),this.spriteId=ne,e.anims.create({key:"escargot-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"escargot-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"escargot-"})),this.anims.play("escargot-idle",!0)}}e.GameObjects.GameObjectFactory.register(ne,(function(t,s){const i=new re(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));class oe extends q{constructor(e,t,s){super(e,t,s,"sprites","cow-1",0,0,!0),this.spriteId="cow",e.anims.create({key:"cow-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cow-"}),repeat:-1,frameRate:2}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cow-"})),this.anims.play("cow-idle",!0)}}e.GameObjects.GameObjectFactory.register("cow",(function(t,s){const i=new oe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const de="veal";class he extends q{constructor(e,t,s){super(e,t,s,"sprites","veal-1",0,0,!0),this.spriteId=de,e.anims.create({key:"veal-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"veal-"}),repeat:-1,frameRate:1}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"veal-"})),this.anims.play("veal-idle",!0)}}e.GameObjects.GameObjectFactory.register(de,(function(t,s){const i=new he(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));const ce="fisherman";class le extends q{constructor(e,t,s){super(e,t,s,"sprites","mino-1",-11,-6),this.spriteId=ce,e.anims.create({key:"mino-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:3,end:3,prefix:"mino-"})).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"mino-"})),e.anims.create({key:"mino-sad",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-sad-"}),repeat:-1,frameRate:3}),this.anims.play("mino-idle",!0)}setSad(){this.anims.play("mino-sad"),this.body.setSize(this.width,1),this.x-=12,this.chatIconDeltaX=0,this.chatIconDeltaY=-2}setOnStrike(e,t){this.setPosition(e,t),this.body.setSize(this.width,1),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(ce,(function(t,s){const i=new le(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.setOffset(.5,.5),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const ue="miner";class me extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-1",0,-5),this.spriteId=ue,this.delta=40,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-idle",defaultTextureKey:"sprites",duration:2100,repeat:-1,frames:[{frame:"miner-1",duration:2e3},{frame:"miner-2",duration:100}]}),this.anims.play("miner-idle",!0),this.hasUnreadMessage(this.spriteId)}toRight(){this.scaleX=1,this.setOffset(0,0)}unlockAccessToMine(e,t){this.setPosition(e,t),this.setSize(5,1),this.setOffset(this.width-2,this.height/2)}setPositionAfterMine(e,t){this.setPosition(e,t),this.scaleX=1,this.body.setSize(this.width+6,this.height+10)}}Phaser.GameObjects.GameObjectFactory.register(ue,(function(e,t,s,i){const a=new me(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width+6,a.height+10),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,-5),this.displayList.add(a),this.updateList.add(a),a}));class pe extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","balloon-1"),this.scene=e,this.anims.create({key:"ball",frames:this.anims.generateFrameNames("sprites",{start:1,end:2,prefix:"balloon-"}),repeat:-1,frameRate:2}),this.anims.play("ball",!0),this.setDepth(100)}}e.GameObjects.GameObjectFactory.register("ball",(function(t,s){const i=new pe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,i.height),this.displayList.add(i),this.updateList.add(i),i}));const ge="girl";class ye extends q{constructor(e,t,s){super(e,t,s,"sprites","girl-water-1",0,0,!0),this.spriteId=ge,e.anims.create({key:"girl-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"girl-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"girl-water-"})),e.anims.create({key:"girl-sad",frames:[{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-2"}],repeat:-1,frameRate:3}),this.anims.play("girl-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.setPosition(this.sadPosition.x,this.sadPosition.y),this.anims.play("girl-sad")}setThirdAct(e,t){this.disabledChatIcon=!1,this.setPosition(e,t),this.body.setSize(this.width,1),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(ge,(function(t,s){const i=new ye(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,i.height+10),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));class fe extends q{constructor(e,t,s){super(e,t,s,"sprites","boy-water-1",10,0,!0),this.spriteId="boy",this.delta=40,this.scene=e,e.anims.create({key:"boy-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"boy-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"boy-water-"})),e.anims.create({key:"boy-sad",frames:[{key:"sprites",frame:"boy-sad-1"},{key:"sprites",frame:"boy-sad-1"},{key:"sprites",frame:"boy-sad-2"}],repeat:-1,frameRate:3}),this.anims.play("boy-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.chatIconDeltaX=0,this.setPosition(this.sadPosition.x,this.sadPosition.y),this.anims.play("boy-sad"),this.body.setSize(this.width+8,this.height+18),this.body.setOffset(-7,0)}setThirdAct(e,t){this.setPosition(e,t),this.body.setSize(this.width,1)}}e.GameObjects.GameObjectFactory.register("boy",(function(t,s){const i=new fe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+18,i.height+20),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const be="twoGuys";class ve extends q{constructor(e,t,s){super(e,t,s,"sprites","twoguys-1"),this.spriteId=be,e.anims.create({key:"twoguys-idle",frames:[{key:"sprites",frame:"twoguys-1",duration:1e3},{key:"sprites",frame:"twoguys-2",duration:1e3},{key:"sprites",frame:"twoguys-3",duration:10}],repeat:-1,duration:2010}),this.anims.play("twoguys-idle",!0)}}e.GameObjects.GameObjectFactory.register(be,(function(t,s){const i=new ve(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));class ke extends q{constructor(e,t,s){super(e,t,s,"sprites","bike",0,0,!0)}}e.GameObjects.GameObjectFactory.register("bike",(function(t,s){const i=new ke(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));class we extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","deer-1"),e.anims.create({key:"deer",frames:[{key:"sprites",frame:"deer-3",duration:1e3},{key:"sprites",frame:"deer-2",duration:500},{key:"sprites",frame:"deer-1",duration:1e3},{key:"sprites",frame:"deer-2",duration:200},{key:"sprites",frame:"deer-3",duration:200},{key:"sprites",frame:"deer-4",duration:200},{key:"sprites",frame:"deer-5",duration:2e3}],repeat:-1,yoyo:!0}),this.anims.play("deer"),this.depth=99}}e.GameObjects.GameObjectFactory.register("deer",(function(e,t){const s=new we(this.scene,e,t);return this.displayList.add(s),this.updateList.add(s),s}));const Ce=()=>Math.random()<.5?-1:1,xe="waiting",Oe="flying",De="outOfScreen",_e=()=>e.Math.Between(1,3);class je extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","bird-idle-1"),this.scene=e,this.idleId=_e(),this.birdDirection=Ce(),this.scaleX=this.birdDirection,this.status=xe,this.initialX=t,this.initialY=s}create(){this.reset()}isWaiting(){return this.status===xe}isFlying(){return this.status===Oe}isOutOfScreen(){return this.status===De}setOffsetDependingOnDirection(){this.setOffset(-1===this.scaleX?30:-20,-15)}fly(){this.isFlying()||(this.status=Oe,this.body.checkCollision.none=!0,this.birdDirection=this.scene.goingRight?1:-1,this.scaleX=-1*this.birdDirection,this.setOffsetDependingOnDirection(),this.anims.play("bird-flying",!0))}reset(){this.status=xe,this.setVisible(!0),this.x=this.initialX,this.y=this.initialY,this.body.checkCollision.none=!1,this.birdDirection=Ce(),this.scaleX=this.birdDirection,this.setOffsetDependingOnDirection(),this.idleId=_e(),this.anims.play(`bird-idle-anim-${this.idleId}`,!0)}hide(){this.setVisible(!1),this.setActive(!1)}show(){this.setVisible(!0),this.setActive(!0)}outOfScreen(){this.anims.stop(),this.status=De,this.setVelocity(0,0),this.setVisible(!1)}preUpdate(e,t){if(super.preUpdate(e,t),this.visible)if(this.isOutOfScreen()){const e=this.scene.cameras.main,t=this.scene.hero;(this.initialX<t.x-e.width/2||this.initialX>t.x+e.width/2||this.initialY<t.y-e.height/2||this.initialY>t.y+e.height/2)&&this.reset()}else{if(this.isWaiting())return this.setVelocity(0,0),void this.anims.play(`bird-idle-anim-${this.idleId}`,!0);if(this.isFlying()){this.anims.play("bird-flying",!0),this.setVelocity(120*this.birdDirection,-50);const e=this.scene.cameras.main.worldView;(this.x>e.x+e.width||this.x<e.x||this.y>e.y+e.height||this.y<e.y)&&this.outOfScreen()}else;}}}e.GameObjects.GameObjectFactory.register("bird",(function(t,s){const i=new je(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(50,50),i.setOffsetDependingOnDirection(),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i}));const Se=function(e){const t=e.anims;t.create({key:"bird-idle-anim-1",frames:t.generateFrameNames("sprites",{start:1,end:4,prefix:"bird-idle-"}),repeat:-1,frameRate:1}).addFrame(t.generateFrameNames("sprites",{start:3,end:2,prefix:"bird-idle-"})),t.create({key:"bird-idle-anim-2",frames:[{key:"sprites",frame:"bird-idle-2"},{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-4"},{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-2"}],repeat:-1,frameRate:2}),t.create({key:"bird-idle-anim-3",frames:[{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-4"},{key:"sprites",frame:"bird-idle-3"},{key:"sprites",frame:"bird-idle-2"},{key:"sprites",frame:"bird-idle-1"}],repeat:-1,frameRate:3}),t.create({key:"bird-flying",frames:t.generateFrameNames("sprites",{start:1,end:3,prefix:"bird-flying-"}),repeat:-1,frameRate:10})};class Pe extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","butterfly-1"),this.scene=e,this.initialPosition={x:t,y:s},this.scaleX=Ce(),this.anims.play("butterfly-anim")}preUpdate(t,s){super.preUpdate(t,s),this.x-=e.Math.Between(2,5)/10*Ce(),this.y-=e.Math.Between(2,5)/10*Ce()}}e.GameObjects.GameObjectFactory.register("butterfly",(function(t,s){const i=new Pe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),this.displayList.add(i),this.updateList.add(i),i}));const Ie=function(e){e.anims.create({key:"butterfly-anim",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"butterfly-"}),repeat:-1,frameRate:4}).addFrame([{key:"sprites",frame:"butterfly-2",duration:2}])},Ae=function(e){if(!e.isCinematic)return e.currentDiscussionStatus===E.WAITING?(e.currentDiscussionStatus=E.STARTED,void h.emit(y)):e.currentDiscussionStatus===E.READY?(e.currentDiscussionStatus=E.STARTED,void h.emit(u,e.currentDiscussionSprite)):void 0},Le=function(e,t,s=!1,i=!1){[e.koko,e.sleepingGuy,e.twoGuys,e.baby,e.twoWomen,e.bino,e.fisherman,e.dog,e.escargot,e.cat,e.boy,e.girl,e.ball,...s?[e.django]:[],...i?[e.miner,e?.minerChief,e?.minerDirty2,e?.minerDirty3,e?.minerDirty4]:[]].forEach((e=>{e&&(e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t)})),e.birds.forEach((e=>{e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t})),e.butterflies.forEach((e=>{e.setVisible(t),e.setActive(t)}))},Te="blueWorkerChief";class Me extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","blue-worker-chief-1",0,-5),this.spriteId=Te,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"blue-worker-chief-idle",frames:[{key:"sprites",frame:"blue-worker-chief-1",duration:300},{key:"sprites",frame:"blue-worker-chief-2",duration:300},{key:"sprites",frame:"blue-worker-chief-3",duration:100}],repeat:-1,duration:2e3}),this.anims.play("blue-worker-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(Te,(function(e,t,s,i){const a=new Me(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.setOffset(0,a.height/2),this.displayList.add(a),this.updateList.add(a),a}));class Be extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","blue-worker-1",0,0,!0)}setSpriteNumber(e){this.spriteId=`blueWorker${e}`,this.anims.play(`blue-worker-idle-${e}`,!0)}}Phaser.GameObjects.GameObjectFactory.register("blueWorker",(function(e,t,s,i,a){const n=new Be(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n}));const Re=function(e){console.log("setVillageForThirdAct"),G(e,!1),Le(e,!0,!0),Ee(e),e.ball.setVisible(!1),e.time.delayedCall(1,(()=>function(e){e.birds.forEach((e=>e.hide()))}(e))),function(e){e.butterflies.forEach((e=>e.destroy())),e.butterflies=[]}(e),e.cameras.main.setBounds(470,0,1674,e.map.heightInPixels-8),e.landRecyclingLayer=e.map.createLayer("landRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.bottomRecyclingLayer=e.map.createLayer("bottomRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.riverLessWaterRecyclingLayer=e.map.createLayer("riverLessWaterRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.topRecyclingLayer=e.map.createLayer("topRecycling",e.tileset).setDepth(119).setCollisionByProperty({collide:!0}),e.topRecyclingCollider=e.physics.add.collider(e.hero,e.topRecyclingLayer),e.topRecyclingObjectsLayer=e.map.createLayer("topRecyclingObjects",e.tileset).setDepth(119).setCollisionByProperty({collide:!0}),e.obstacleRecyclingLayer.setCollisionByProperty({collide:!1}),e.obstacleRecyclingLayer.destroy(),e.obstacleRecyclingCollider.destroy(),function(e){e.anims.create({key:"blue-worker-idle-1",frames:[{key:"sprites",frame:"blue-worker-1"},{key:"sprites",frame:"blue-worker-2"}],repeat:-1,frameRate:2}),e.anims.create({key:"blue-worker-idle-2",frames:[{key:"sprites",frame:"blue-worker-2"},{key:"sprites",frame:"blue-worker-1"}],repeat:-1,frameRate:3})}(e);for(const t of e.map.getObjectLayer("sprites").objects)"boyThirdAct"===t.name&&e.boy.setThirdAct(t.x,t.y),"girlThirdAct"===t.name&&e.girl.setThirdAct(t.x,t.y),"babyThirdAct"===t.name&&e.baby.setPosition(t.x,t.y),"afterFactoryWhiteWorker1"===t.name&&(e.whiteWorker1.setPosition(t.x,t.y),e.whiteWorker1.scaleX=1,e.whiteWorker1.setOffset(0,e.whiteWorker1.height/2),e.whiteWorker1.setVisible(!0),e.whiteWorker1.disableChatIcon()),"afterFactoryWhiteWorker2"===t.name&&(e.whiteWorker2.setPosition(t.x,t.y),e.whiteWorker2.setVisible(!0),e.whiteWorker2.disableChatIcon()),"twoGuysRecycling"===t.name&&e.twoGuys.setPosition(t.x,t.y),"blueWorkerChief"===t.name&&(e.blueWorkerChief=e.add.blueWorkerChief(t.x,t.y),e.blueWorkerChief.on("pointerdown",(()=>Ae(e)),e),e.physics.add.collider(e.blueWorkerChief,e.hero,(()=>{h.emit(c,"blueWorkerChief")}))),"blueWorker1"===t.name&&(e.blueWorker1=e.add.blueWorker(t.x,t.y,null,null,1),e.blueWorker1.on("pointerdown",(()=>Ae(e)),e),e.physics.add.collider(e.blueWorker1,e.hero,(()=>{h.emit(c,"blueWorker1")}))),"blueWorker2"===t.name&&(e.blueWorker2=e.add.blueWorker(t.x,t.y,null,null,2),e.blueWorker2.on("pointerdown",(()=>Ae(e)),e),e.physics.add.collider(e.blueWorker2,e.hero,(()=>{h.emit(c,"blueWorker2")})))},Ee=function(e){e.screens||(e.screens=e.map.createLayer("screens",e.tileset).setCollisionByProperty({collide:!0}).setDepth(49).setVisible(!1),e.screensCollider=e.physics.add.collider(e.hero,e.screens),e.screensTop=e.map.createLayer("screensTop",e.tileset).setDepth(149).setVisible(!1),e.ads=e.map.createLayer("ads",e.tileset).setDepth(50).setVisible(!1),e.adsTop=e.map.createLayer("adsTop",e.tileset).setDepth(150).setVisible(!1));const t=!e.screens.visible;e.screensTop.setVisible(t),e.screens.setVisible(t),e.adsTop.setVisible(t),e.ads.setVisible(t),e.obstacleBridgeLayer.setCollisionByProperty({collide:!1}),e.obstacleBridgeLayer.destroy(),e.obstacleBridgeLayerCollider.destroy()};class Ve extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","white-worker-1",0,-5,!0)}setSpriteNumber(e){this.spriteId=`whiteWorker${e}`,this.anims.play(`white-worker-idle-${e}`,!0),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register("whiteWorker",(function(e,t,s,i,a){const n=new Ve(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n}));const Fe="whiteWorkerChief";class Ne extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","white-worker-chief-1",0,-5),this.spriteId=Fe,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"white-worker-chief-idle",frames:[{key:"sprites",frame:"white-worker-chief-1",duration:300},{key:"sprites",frame:"white-worker-chief-2",duration:300},{key:"sprites",frame:"white-worker-chief-3",duration:100}],repeat:-1,duration:2e3}),this.anims.play("white-worker-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(Fe,(function(e,t,s,i){const a=new Ne(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.setOffset(0,a.height/2),this.displayList.add(a),this.updateList.add(a),a}));const Ge=function(e){e.mineBackgground1=e.add.image(0,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.mineBackgground2=e.add.image(400,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.mineMount=e.add.image(180,100,"mineLand","mine-mount").setOrigin(0,0).setScrollFactor(.1,.25),e.mineMine=e.add.image(340,124,"mineLand","mine").setOrigin(0,0).setScrollFactor(.18,.32),e.mineMachine=e.add.image(1692,240,"mineLand","mine-machine").setOrigin(0,0).setScrollFactor(.7,.7)},We=function(e){e.roads||(e.roadsBottom=e.map.createLayer("roadsBottom",e.tileset).setDepth(69).setVisible(!1),e.roads=e.map.createLayer("roads",e.tileset).setDepth(70).setVisible(!1),e.roadsTop=e.map.createLayer("roadsTop",e.tileset).setDepth(97).setVisible(!1),e.carsBottom=e.map.createLayer("carsBottom",e.tileset).setDepth(98).setVisible(!1),e.carsTop=e.map.createLayer("carsTop",e.tileset).setDepth(120).setVisible(!1),e.carsBottomCollides=[],e.carsTop.forEachTile((t=>{!0===t.properties?.bottomCollide&&e.carsBottomCollides.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))})),e.carsBottomCollider=e.physics.add.collider(e.hero,e.carsBottomCollides));const t=e.roads.visible;e.roads.setVisible(!t),e.roadsBottom.setVisible(!t),e.roadsTop.setVisible(!t),e.carsTop.setVisible(!t),e.carsBottom.setVisible(!t),e.bridgesShadow.setVisible(t),e.bridges.setVisible(t),e.bridgesTop.setVisible(t)},Ue="nono";class qe extends q{constructor(e,t,s){super(e,t,s,"sprites","nono-1",-2,-2),this.spriteId=Ue,e.anims.create({key:"nono-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"nono-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"nono-"})),this.anims.play("nono-idle",!0),this.hasUnreadMessage(this.spriteId)}}e.GameObjects.GameObjectFactory.register(Ue,(function(t,s){const i=new qe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i}));const ze=function(e){e.isCinematic=!0,e.setHeroPosition("heroDjango"),e.hero.slowRight(),e.hero.animateToRight(),N(e),Ye(e),h.emit(w,["first_sleep"]),e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(1e3,(()=>{e.isCinematic=!1,h.emit(c,"django"),Ae(e)}))},Ye=function(e){Ke(e),Le(e,!0),e.boy.setSad(),e.girl.setSad(),e.fisherman.setSad(),He(e),T("sfx_objet_inventaire",e)},He=function(e){for(const t of e.map.getObjectLayer("sprites").objects)if("nono"===t.name){e.nono=e.add.nono(t.x,t.y),e.nono.on("pointerdown",(()=>Ae(e)),this),e.physics.add.collider(e.nono,e.hero,(()=>{h.emit(c,"nono")}));break}},Ke=function(e){e.riverPolluted||(e.riverPolluted=e.map.createLayer("riverPolluted",e.tileset).setDepth(45),e.landUpRiverPolluted=e.map.createLayer("landUpRiverPolluted",e.tileset).setDepth(46),e.bridgesShadowPolluted=e.map.createLayer("bridgesShadowPolluted",e.tileset).setDepth(51))},Xe=function(e,t){const s=t.map.getObjectLayer(e);s.objects.sort(((e,t)=>e.y-t.y)),s.objects.forEach((e=>{const s=t.add.image(e.x,e.y-8,"trees",`${e.name}-base`).setDepth(90).setOrigin(.5,1),i=t.physics.add.sprite(e.x,e.y-24,"trees",`${e.name}-1`).setOrigin(.5,1).setImmovable(!0).setDepth(130);i.anims.play(e.name);const a=t.physics.add.sprite(e.x,e.y-10,null).setSize(8,1).setOrigin(.5,1).setImmovable(!0).setVisible(!1);t.pointsCollider.push(a),t.treesOfDcCollider.push(a),e.x>1097&&e.x<1336&&e.y>1e3&&e.y<1220&&t.treesOfDc.push({treeBase:s,treeTop:i})}))},Je=function(e){e.cameras.main.setBounds(0,0,2144,e.map.heightInPixels-8),e.hero.stopAndWait(),e.isCinematic=!0,N(e),function(e){e.mineBackgground1&&(e.mineBackgground1.destroy(),e.mineBackgground2.destroy(),e.mineMount.destroy(),e.mineMine.destroy(),e.mineMachine.destroy())}(e),Ye(e),We(e),function(e){e.riverLessWater||(e.riverLessWater=e.map.createLayer("riverLessWater",e.tileset).setDepth(40).setVisible(!1));const t=!e.riverLessWater.visible;e.riverLessWater.setVisible(t)}(e),function(e){e.bikes.forEach((e=>{e.setVisible(!1),e.body.checkCollision.none=!0}))}(e),function(e){e.potagerBottom.setVisible(!1),e.potagerTop.setVisible(!1),e.potagerCollider.destroy(),e.cow.setVisible(!1),e.cow.setActive(!1),e.cow.body.checkCollision.none=!0,e.veal.setVisible(!1),e.veal.setActive(!1),e.veal.body.checkCollision.none=!0}(e),e.bino.setCleaningRoad(),Le(e,!0,!0,!0),function(e){e.birds.forEach(((t,s)=>{Phaser.Math.Between(0,1)&&(e.birds.splice(s,1),t.destroy())}))}(e),function(e){e.butterflies.forEach(((t,s)=>{Phaser.Math.Between(0,1)&&(e.butterflies.splice(s,1),t.destroy())}))}(e),e.obstacleBridgeLayer=e.map.createLayer("obstacleBridge",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleBridgeLayerCollider=e.physics.add.collider(e.hero,e.obstacleBridgeLayer),e.obstaclesFactoryLayer.setCollisionByProperty({collide:!1}),e.obstaclesFactoryLayer.destroy(),e.obstaclesFactoryCollider.destroy(),Xe("treesLimitForest",e),e.obstaclesForestLayer=e.map.createLayer("obstaclesForest",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.physics.add.collider(e.hero,e.obstaclesForestLayer),function(e){e.anims.create({key:"white-worker-idle-1",frames:[{key:"sprites",frame:"white-worker-1"},{key:"sprites",frame:"white-worker-2"}],repeat:-1,frameRate:2}),e.anims.create({key:"white-worker-idle-2",frames:[{key:"sprites",frame:"white-worker-2"},{key:"sprites",frame:"white-worker-1"}],repeat:-1,frameRate:3}),e.anims.create({key:"white-worker-idle-3",frames:[{key:"sprites",frame:"white-worker-1"},{key:"sprites",frame:"white-worker-1"},{key:"sprites",frame:"white-worker-2"}],repeat:-1,frameRate:4})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterMine"===t.name&&(e.miner.setPositionAfterMine(t.x,t.y),e.miner.disableChatIcon()),"minoAfterMine"===t.name&&e.fisherman.setPosition(t.x,t.y);for(let s=2;s<=4;s++)if(t.name===`afterMineMiner${s}`){const i=e[`minerDirty${s}`];i.setPosition(t.x,t.y),i.disableChatIcon(),i.scaleX=1}"whiteWorkerChief"===t.name&&(e.whiteWorkerChief=e.add.whiteWorkerChief(t.x,t.y),e.whiteWorkerChief.on("pointerdown",(()=>Ae(e)),e),e.physics.add.collider(e.whiteWorkerChief,e.hero,(()=>{h.emit(c,"whiteWorkerChief")})));for(let s=1;s<=2;s++)t.name===`whiteWorker${s}`&&(e[`whiteWorker${s}`]=e.add.whiteWorker(t.x,t.y,null,null,s),e[`whiteWorker${s}`].on("pointerdown",(()=>Ae(e)),e),e.physics.add.collider(e[`whiteWorker${s}`],e.hero,(()=>{h.emit(c,`whiteWorker${s}`)})))}};class $e extends e.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,"sprites","screen-off-1"),this.scene=e,this.setDepth(250),this.spriteId="screen"+i,this.heroNearMe=!1,this.previousChatImageUiVisibility=!1,this.isShutDown=!1,h.on(C,this.screenShutdown,this)}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-10&&e.x<this.x+10&&e.y>this.y-20&&e.y<this.y-15}preUpdate(e,t){if(super.preUpdate(e,t),this.isShutDown)return;const s=this.isHeroNearMe();this.heroNearMe!==s&&(this.heroNearMe=s,this.spriteId&&h.emit(s?c:l,this.spriteId))}screenShutdown(e){this.spriteId===e.sprite&&(this.scene.time.delayedCall(200,(()=>h.emit(g,e.sprite))),this.isShutDown=!0,this.setVisible(!0),this.anims.play("screen-off",!0))}shutdown(){this.isShutDown=!0,this.setVisible(!0),this.setTexture("sprites","screen-off-3")}}e.GameObjects.GameObjectFactory.register("screen",(function(t,s,i){const a=new $e(this.scene,t,s,i);return this.scene.physics.world.enableBody(a,e.Physics.Arcade.DYNAMIC_BODY),a.setImmovable(!0).setVisible(!1),this.displayList.add(a),this.updateList.add(a),a}));const Qe=function(e){console.log("setVillageForFourthAct"),G(e,!1),Le(e,!0,!0),e.dcBottomLayer=e.map.createLayer("dcBottom",e.tileset).setDepth(120).setCullPadding(2,2),e.dcBarriersFrontLayer=e.map.createLayer("dcBarriersFront",e.tileset).setDepth(120).setCullPadding(2,2),e.dcBarriersSideLayer=e.map.createLayer("dcBarriersSide",e.tileset).setDepth(120).setCullPadding(2,2),e.obstacleDcLayer=e.map.createLayer("obstacleDc",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleDcLayerCollider=e.physics.add.collider(e.hero,e.obstacleDcLayer);for(const s of e.map.getObjectLayer("sprites").objects)for(let t=1;t<=4;t++){const i=`dcWorker${t}`;if(s.name===i){1===t?(e[i]=e.add.miner(s.x,s.y,null,null,t),e[i].toRight()):e[i]=e.add.minerDirty(s.x,s.y,null,null,t);const a=e[i];if(1===t){a.spriteId=i,a.enableChatIcon(),a.on("pointerdown",(()=>Ae(e)),this),e.physics.add.collider(a,e.hero,(()=>{h.emit(c,i)}));continue}a.disableChatIcon(),a.setDepth(1e3)}}e.treesOfDc.forEach((e=>{e.treeBase.destroy(),e.treeTop.destroy()})),e.treesOfDcCollider.forEach((e=>e.destroy())),e.anims.create({key:"screen-off",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"screen-off-"}),repeat:0,frameRate:10});let t=1;e.screens.forEachTile((s=>{!0===s.properties?.screen&&(e.screenOffSprites.push(e.add.screen(s.getCenterX()+1,s.getCenterY()-3,t)),t++)}))},Ze=function(e){e.cameras.main.setBounds(470,400,1674,e.map.heightInPixels-408),e.checkDjangoDoor=!1,e.datacentreThemeEnabled=!1,e.ball.setVisible(!1),function(e){e.bikes.forEach((e=>{e.setVisible(!0),e.body.checkCollision.none=!1}))}(e),function(e){e.birds.forEach((e=>e.show()))}(e),e.obstacleDcLayer.destroy(),e.obstacleDcLayerCollider.destroy(),e.roads.destroy(),e.roadsTop.destroy(),e.carsTop.destroy(),e.carsBottom.destroy(),e.carsBottomCollides.forEach((e=>e.destroy())),e.carsBottomCollider.destroy(),e.dcBottomLayer.destroy(),e.dcBarriersFrontLayer.destroy(),e.dcBarriersSideLayer.destroy(),e.obstacleDcLayer.destroy(),e.potagerBottom.setVisible(!0),e.potagerTop.setVisible(!0),e.physics.add.collider(e.hero,e.potagerTop),e.riverPolluted.destroy(),e.landUpRiverPolluted.destroy(),e.bridgesShadowPolluted.destroy();const t=e.map.createLayer("riverFinal",e.tileset).setCollisionByProperty({collide:!0}).setDepth(45);e.physics.add.collider(e.hero,t),e.map.createLayer("riverFinalTop",e.tileset).setDepth(45),e.topRecyclingCollider.destroy(),e.topRecyclingLayer.destroy(),e.topRecyclingObjectsLayer.destroy(),e.landRecyclingLayer.destroy(),e.bottomRecyclingLayer.destroy(),e.screensCollider.destroy(),e.ads.destroy(),e.adsTop.destroy(),e.screens.destroy(),e.screensTop.destroy(),e.screenOffSprites.forEach((e=>e.destroy()));const s=e.map.createLayer("screensDamaged",e.tileset).setCollisionByProperty({collide:!0}).setDepth(49);e.physics.add.collider(e.hero,s),e.map.createLayer("screensDamagedTop",e.tileset).setDepth(149),e.map.createLayer("carsDamagedBottom",e.tileset).setDepth(98);e.map.createLayer("carsDamagedTop",e.tileset).setDepth(120).forEachTile((t=>{!0===t.properties?.bottomCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))})),e.map.createLayer("roadsDamaged",e.tileset).setDepth(96);for(let a=1;a<=4;a++){const t=`dcWorker${a}`;e[t].disableChatIcon(),e[t].destroy()}e.miner.destroy();for(let a=2;a<=4;a++)e[`minerDirty${a}`].destroy();e.whiteWorker1.destroy(),e.whiteWorker2.destroy(),e.whiteWorkerChief.destroy(),e.baby.disableChatIcon(),e.baby.destroy(),e.map.getObjectLayer("sprites").objects.forEach((t=>{"binoFinal"===t.name&&e.bino.setPosition(t.x,t.y).disableChatIcon(),"minoFinal"===t.name&&e.fisherman.setPosition(t.x,t.y).disableChatIcon(),"kokoFinal"===t.name&&e.koko.setPosition(t.x,t.y).disableChatIcon(),"nonoFinal"===t.name&&e.nono.setPosition(t.x,t.y).disableChatIcon(),"djangoFinal"===t.name&&e.django.setPosition(t.x,t.y).disableChatIcon(),"girlFinal"===t.name&&e.girl.setPosition(t.x,t.y).disableChatIcon(),"boyFinal"===t.name&&e.boy.setPosition(t.x,t.y).disableChatIcon(),"dogFinal"===t.name&&e.dog.setPosition(t.x,t.y),"catFinal"===t.name&&e.cat.setPosition(t.x,t.y),"twoGuysFinal"===t.name&&e.twoGuys.setPosition(t.x,t.y),"twoWomenFinal"===t.name&&e.twoWomen.setPosition(t.x,t.y)})),h.on(v,(t=>{console.log(t),V(t,"django_final_end")&&e.time.delayedCall(200,(()=>{h.emit(c,"bino"),Ae(e)}))}));const i=()=>{e.heroPositions.heroDjangoDoor;e.hero.x>e.django.x-130&&e.hero.y>e.django.y-130&&e.hero.y<e.django.y+130&&(F(["django_final"]),e.events.off("update",i),e.isCinematic=!0,e.cameras.main.fadeOut(500,0,0,0,((t,s)=>{1===s&&(e.setHeroPosition("heroDjangoFinal"),e.hero.slowUp(),e.hero.animateToUp(),e.cameras.main.fadeIn(500,0,0,0,((t,s)=>{1===s&&(e.isCinematic=!1,h.emit(c,"django"),Ae(e))})))})))};e.events.on("update",i)},et="minerChief";class tt extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-chief-1",0,-5),this.spriteId=et,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-chief-idle",frames:[{key:"sprites",frame:"miner-chief-1",duration:300},{key:"sprites",frame:"miner-chief-2",duration:300},{key:"sprites",frame:"miner-chief-3",duration:300}],repeat:-1,frameRate:1}),this.anims.play("miner-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(et,(function(e,t,s,i){const a=new tt(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,a.height/2),this.displayList.add(a),this.updateList.add(a),a}));class st extends q{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-dirty-1",0,-5,!0),this.delta=20,this.futureMinerPosition=null,this.initialY=s}setSpriteNumber(e){if(this.spriteId=`minerDirty${e}`,this.anims.play("miner-dirty-idle-"+(e-1),!0),e>2)return this.scaleX=-1,void this.setOffset(this.width,this.height/2);this.setOffset(0,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register("minerDirty",(function(e,t,s,i,a){const n=new st(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n}));const it=function(e){e.cameras.main.setBounds(0,0,e.map.widthInPixels,e.map.heightInPixels-8),function(e){e.anims.create({key:"miner-dirty-idle-1",frames:[{key:"sprites",frame:"miner-dirty-1"},{key:"sprites",frame:"miner-dirty-2"}],repeat:-1,frameRate:2}),e.anims.create({key:"miner-dirty-idle-2",frames:[{key:"sprites",frame:"miner-dirty-2"},{key:"sprites",frame:"miner-dirty-1"}],repeat:-1,frameRate:3}),e.anims.create({key:"miner-dirty-idle-3",frames:[{key:"sprites",frame:"miner-dirty-1"},{key:"sprites",frame:"miner-dirty-1"},{key:"sprites",frame:"miner-dirty-2"}],repeat:-1,frameRate:4})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterCard"===t.name&&e.miner.unlockAccessToMine(t.x,t.y),"minerChief"===t.name&&(e.minerChief=e.add.minerChief(t.x,t.y),e.minerChief.on("pointerdown",(()=>Ae(e)),this),e.physics.add.collider(e.minerChief,e.hero,(()=>{h.emit(c,"minerChief")})));for(let s=2;s<=4;s++)t.name===`miner${s}`&&(e[`minerDirty${s}`]=e.add.minerDirty(t.x,t.y,null,null,s),e[`minerDirty${s}`].on("pointerdown",(()=>Ae(e)),this),e.physics.add.collider(e[`minerDirty${s}`],e.hero,(()=>{h.emit(c,`minerDirty${s}`)})))}!function(e){const s=new t.Loader.LoaderPlugin(e);s.atlas("mineLand","sprites/mineLand.png","sprites/mineLand.json"),s.once("complete",(()=>Ge(e))),s.start()}(e)},at=function(e){console.time("Init"),e.map=e.make.tilemap({key:"map"}),e.tileset=e.map.addTilesetImage("Atlas_01","tiles"),e.land=e.map.createLayer("land",e.tileset).setDepth(20).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.map.createLayer("landUp",e.tileset).setDepth(40),e.bridgesShadow=e.map.createLayer("bridgesShadow",e.tileset).setDepth(50),e.bridges=e.map.createLayer("bridges",e.tileset).setDepth(60),e.bottomObjects=e.map.createLayer("bottom",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.potagerBottom=e.map.createLayer("potagerBottom",e.tileset).setDepth(70),function(e){e.anims.create({key:"sapin",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"sapin-"}),repeat:-1,frameRate:1}),e.anims.create({key:"arbre",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"arbre-"}),repeat:-1,frameRate:1}),e.anims.create({key:"pin",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"pin-"}),repeat:-1,frameRate:1}),e.map.createLayer("bottomStaticTrees",e.tileset).setDepth(130),e.map.createLayer("staticTrees",e.tileset).setDepth(150),Xe("trees",e)}(e),e.map.getObjectLayer("hero").objects.forEach((t=>{var s;(e.heroPositions[t.name]={x:t.x,y:t.y},"hero"===t.name)&&(e.tent=e.add.sprite(t.x+2,t.y-2,"sprites","tent-1").setDepth(100),e.hero=e.add.hero(t.x,t.y).setDepth(100),e.hero.stopAndWait(),(s=e.anims).create({key:"mai-walk-down",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"walk-down-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-walk-up",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"walk-up-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-walk-side",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"walk-right-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-idle-down",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"idle-down-"}),repeat:-1,yoyo:!0,frameRate:4}),s.create({key:"mai-idle-up",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"idle-up-"}),repeat:-1,yoyo:!0,frameRate:4}),s.create({key:"mai-idle-side",frames:s.generateFrameNames("mai",{start:1,end:3,prefix:"idle-right-"}),repeat:-1,yoyo:!0,frameRate:4}))})),function(e){Se(e),T("sfx_oiseaux_volent",e),e.map.getObjectLayer("birds").objects.forEach((t=>{e.birds.push(e.add.bird(t.x,t.y).setDepth(160))})),e.physics.add.collider(e.birds,e.hero,(t=>{M("sfx_oiseaux_volent",e,!0,Phaser.Math.Between(4,8)/10),t.fly()}))}(e),function(e){Ie(e),e.map.getObjectLayer("butterflies").objects.forEach((t=>{e.butterflies.push(e.add.butterfly(t.x,t.y).setDepth(160))}))}(e),a("noanims")||(console.time("animatedTiles"),e.animatedTiles.init(e.map),console.timeEnd("animatedTiles")),e.cameras.main.setBounds(0,400,2144,e.map.heightInPixels-408),e.cameras.main.startFollow(e.hero,!0),function(e){a("debugcontrols")&&(e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M).on("down",(()=>{e.cameras.main.zoomTo(2===e.cameras.main.zoom?1:.18,100)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P).on("down",(()=>{e.cameras.main.zoomTo(.18===e.cameras.main.zoom?1:2,100)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F).on("down",(()=>{e.setHeroPosition("heroFactory")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.K).on("down",(()=>{e.setHeroPosition("heroKoko")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B).on("down",(()=>{e.setHeroPosition("heroMiner")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D).on("down",(()=>{e.setHeroPosition("heroDjango")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.N).on("down",(()=>{e.setHeroPosition("heroNono")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E).on("down",(()=>{it(e),Je(e),e.setHeroPosition("heroRecycling"),e.isCinematic=!1,h.emit(w,["third_act_begin"])})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S).on("down",(()=>{e.isCinematic=!0,e.time.delayedCall(2e3,(()=>{e.setHeroPosition("heroKoko"),it(e),Je(e),Re(e),e.isCinematic=!1,h.emit(w,["fourth_act_begin"])}))})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).on("down",(()=>{e.isCinematic=!0,e.time.delayedCall(2e3,(()=>{e.setHeroPosition("heroKoko"),it(e),Je(e),Re(e),Qe(e),e.isCinematic=!1,h.emit(w,["strike_end"])}))})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Y).on("down",(()=>{h.emit(w,["django_met","pre_first_sleep"])})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C).on("down",(()=>{h.emit(w,["card_for_mine"])})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T).on("down",(()=>{We(e)})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.O).on("down",(()=>{h.emit(w,["mine_access_validation"]),e.setHeroPosition("heroMine")})),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A).on("down",(()=>We(e))),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.L).on("down",(()=>N(e))),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E).on("down",(()=>Ee(e))),e.input.on("pointerdown",(t=>console.log({pointer:[t.x,t.y],hero:[e.hero.x,e.hero.y]}))))}(e),function(e){e.cursors=e.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),e.input.keyboard.on("keydown",(t=>{"ArrowUp"===t.key?(e.goingUp=!0,e.goingDown=!1):"ArrowDown"===t.key?(e.goingDown=!0,e.goingUp=!1):"ArrowLeft"===t.key?(e.goingLeft=!0,e.goingRight=!1):"ArrowRight"===t.key?(e.goingRight=!0,e.goingLeft=!1):32===t.keyCode&&Ae(e)}),this),e.input.keyboard.on("keyup",(function(t){"ArrowUp"==t.key?e.goingUp=!1:"ArrowDown"==t.key?e.goingDown=!1:"ArrowLeft"==t.key?e.goingLeft=!1:"ArrowRight"==t.key&&(e.goingRight=!1)}),this)}(e),function(e){o()&&(e.joystick=e.plugins.get("rexvirtualjoystickplugin").add(e,{x:100,y:200,radius:100,base:e.add.circle(0,0,50,16733508,.4).setDepth(1e4),thumb:e.add.circle(0,0,30,13421772,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),e.input.on("pointerdown",(function(t){e.joystick.setPosition(t.x,t.y),e.joystick.setVisible(!0),Ae(e)}),this),e.joystick.on("update",(function(){e.goingAngle=e.joystick.angle,e.joystick.left?(e.goingLeft=!0,e.goingRight=!1,(177.5<e.goingAngle||-177.5>e.goingAngle)&&(e.goingUp=!1,e.goingDown=!1)):e.joystick.right&&(e.goingRight=!0,e.goingLeft=!1,22.5>e.goingAngle&&-22.5<e.goingAngle&&(e.goingUp=!1,e.goingDown=!1)),e.joystick.up?(e.goingUp=!0,e.goingDown=!1,-67.5>e.goingAngle&&-112.5<e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1)):e.joystick.down&&(e.goingDown=!0,e.goingUp=!1,67.5<e.goingAngle&&112.5>e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1))}),this),e.joystick.on("pointerup",(function(){e.joystick.setVisible(!1),e.stopMoving()}),this))}(e),e.addEventsListeners(),e.obstacles=e.map.createLayer("obstacles",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleRecyclingLayer=e.map.createLayer("obstacleRecycling",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.cameras.main.fadeIn(1e3,0,0,0),j(e),e.time.delayedCall(2e3,(()=>nt(e))),e.time.delayedCall(3e3,(()=>e.scene.run("message"))),console.timeEnd("Init"),a("nostart")||function(e){e.anims.create({key:"tent",frames:e.anims.generateFrameNames("sprites",{start:1,end:5,prefix:"tent-"}),repeat:0,frameRate:10}),e.isIntro=!0,e.isCinematic=!0,e.hero.setVisible(!1),e.time.addEvent({callback:()=>{e.goingDown=!0,e.hero.animateToDown(),e.hero.setVisible(!0)},delay:1e3}),T("sfx_tente",e),e.events.on("update",(()=>{e.isIntro&&(e.goingDown&&e.hero.slowDown(),e.hero.y>e.heroPositions.hero.y+5&&(e.isIntro=!1,e.goingDown=!1,e.tent.anims.play("tent",!0),M("sfx_tente",e),e.tent.on("animationcomplete",(()=>{e.tent.destroy(),e.isCinematic=!1}))))}))}(e)},nt=function(e){e.anims.create({key:"exclam",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"exclam-"}),repeat:-1,frameRate:6}).addFrame([{key:"sprites",frame:"exclam-2",duration:1}]),e.map.getObjectLayer("sprites").objects.forEach((t=>{"django"===t.name&&(e.django=e.add.django(t.x,t.y),e.django.on("pointerdown",(()=>Ae(e)),this)),"koko"===t.name&&(e.koko=e.add.koko(t.x,t.y),e.koko.on("pointerdown",(()=>Ae(e)),this)),"sleepingGuy"===t.name&&(e.sleepingGuy=e.add.sleepingGuy(t.x,t.y),e.sleepingGuy.on("pointerdown",(()=>Ae(e)),this)),"twoGuys"===t.name&&(e.twoGuys=e.add.twoGuys(t.x,t.y),e.twoGuys.on("pointerdown",(()=>Ae(e)),this)),"twoWomen"===t.name&&(e.twoWomen=e.add.twoWomen(t.x,t.y),e.twoWomen.on("pointerdown",(()=>Ae(e)),this)),"baby"===t.name&&(e.baby=e.add.baby(t.x,t.y),e.baby.on("pointerdown",(()=>Ae(e)),this)),"bino"===t.name&&(e.bino=e.add.bino(t.x,t.y),e.bino.on("pointerdown",(()=>Ae(e)),this)),"binoCleaningRoad"===t.name&&e.bino.setCleaningRoadPosition(t.x,t.y),"mino"===t.name&&(e.fisherman=e.add.fisherman(t.x,t.y),e.fisherman.on("pointerdown",(()=>Ae(e)),this)),"cat"===t.name&&(e.cat=e.add.cat(t.x,t.y),e.cat.on("pointerdown",(()=>Ae(e)),this)),"dog"===t.name&&(e.dog=e.add.dog(t.x,t.y),e.dog.on("pointerdown",(()=>Ae(e)),this)),"escargot"===t.name&&(e.escargot=e.add.escargot(t.x,t.y),e.escargot.on("pointerdown",(()=>Ae(e)),this)),"cow"===t.name&&(e.cow=e.add.cow(t.x,t.y),e.cow.on("pointerdown",(()=>Ae(e)),this)),"veal"===t.name&&(e.veal=e.add.veal(t.x,t.y)),"miner"===t.name&&(e.miner=e.add.miner(t.x,t.y),e.miner.on("pointerdown",(()=>Ae(e)),this)),"ball"===t.name&&(e.ball=e.add.ball(t.x,t.y)),"girl"===t.name&&(e.girl=e.add.girl(t.x,t.y)),"boy"===t.name&&(e.boy=e.add.boy(t.x,t.y),e.boy.on("pointerdown",(()=>Ae(e)),this)),"bike"===t.name&&e.bikes.push(e.add.bike(t.x,t.y)),"boySad"===t.name&&e.boy.setSadPosition(t.x,t.y),"girlSad"===t.name&&e.girl.setSadPosition(t.x,t.y),"deer"===t.name&&(e.deer=e.add.deer(t.x,t.y))})),e.bridgesTop=e.map.createLayer("bridgesTop",e.tileset).setDepth(110),e.topObjects=e.map.createLayer("top",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.potagerTop=e.map.createLayer("potagerTop",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.topObjects.forEachTile((t=>{!0===t.properties?.pointCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(10,1).setImmovable(!0).setVisible(!1))})),e.land.forEachTile((t=>{!0===t.properties?.topCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()-8,null).setSize(16,1).setImmovable(!0).setVisible(!1))})),e.obstaclesFactoryLayer=e.map.createLayer("obstaclesFactory",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),function(e){e.physics.add.collider(e.miner,e.hero,(()=>{h.emit(c,"miner")})),e.physics.add.collider(e.bino,e.hero,(()=>{h.emit(c,"bino")})),e.physics.add.collider(e.django,e.hero,(()=>{h.emit(c,"django")})),e.physics.add.collider(e.koko,e.hero,(()=>{h.emit(c,"koko")})),e.physics.add.collider(e.sleepingGuy,e.hero,(()=>{h.emit(c,"sleepingGuy")})),e.physics.add.collider(e.twoWomen,e.hero,(()=>{h.emit(c,"twoWomen")})),e.physics.add.collider(e.baby,e.hero,(()=>{h.emit(c,"baby")})),e.physics.add.collider(e.twoGuys,e.hero,(()=>{h.emit(c,"twoGuys")})),e.physics.add.collider(e.fisherman,e.hero,(()=>{h.emit(c,"fisherman")})),e.physics.add.collider(e.cat,e.hero,(()=>{h.emit(c,"cat")})),e.physics.add.collider(e.dog,e.hero,(()=>{h.emit(c,"dog")})),e.physics.add.collider(e.escargot,e.hero,(()=>{h.emit(c,"escargot")})),e.physics.add.collider(e.cow,e.hero,(()=>{h.emit(c,"cow")})),e.physics.add.collider(e.veal,e.hero),e.physics.add.collider(e.boy,e.hero,(()=>{h.emit(c,"boy")})),e.physics.add.collider(e.girl,e.hero,(()=>{h.emit(c,"girl")})),e.physics.add.collider(e.bikes,e.hero),e.physics.add.collider(e.hero,e.water),e.physics.add.collider(e.hero,e.land),e.physics.add.collider(e.hero,e.obstacles),e.obstacleRecyclingCollider=e.physics.add.collider(e.hero,e.obstacleRecyclingLayer),e.physics.add.collider(e.hero,e.topObjects),e.potagerCollider=e.physics.add.collider(e.hero,e.potagerTop),e.physics.add.collider(e.hero,e.bottomObjects),e.physics.add.collider(e.hero,e.pointsCollider),e.obstaclesFactoryCollider=e.physics.add.collider(e.hero,e.obstaclesFactoryLayer)}(e);for(const t of["hommes","femmes","enfants","ouvriers"])for(let s=1;s<=4;s++)T(`sfx_voix_${t}_${s}`,e);T("sfx_chat_1",e),T("sfx_chat_2",e),T("sfx_chien_1",e),T("sfx_chien_2",e),T("sfx_vache_1",e),T("sfx_vache_2",e)},rt=2e3;class ot extends e.Scene{constructor(e){super(e),this.sounds=[]}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json"),this.load.image("vignette","img/vignette.png")}create(){this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.currentDiscussionStatus=E.NONE,this.anims.create({key:"speaker-off-anim",frames:[{key:"ui",frame:"speaker-off"}],repeat:-1,frameRate:1}),this.anims.create({key:"speaker-on-anim",frames:[{key:"ui",frame:"speaker-off"},{key:"ui",frame:"speaker-on"}],repeat:-1,frameRate:8}),this.anims.create({key:"dialog-shout-anim",frames:[{key:"ui",frame:"dialog-shout-1"},{key:"ui",frame:"dialog-shout-2"}],repeat:-1,frameRate:8});const t=this.add.sprite(4,0,"ui","scoreboard").setOrigin(0,0);this.scores=[];for(let e=0;e<=2;e++)this.scores.push(this.add.sprite(12+24*e,22,"ui","scoreok").setOrigin(0,0));this.scoreBoardContainer=this.add.container(0,-50,[t,this.scores[0],this.scores[1],this.scores[2]]),this.scoreBoardContainer.setDepth(rt),this.speaker=this.add.sprite(470,0,"ui","speaker-off").setOrigin(0,0).setDepth(rt),this.dialogBackground=this.add.sprite(345,50,"ui","dialog-shout-1").setOrigin(.5,.5).setDepth(rt).setAlpha(.8).setVisible(!1),this.dialogBackground.anims.play("dialog-shout-anim",!0),this.textObject=this.add.text(345,50,"",{fontFamily:"DefaultFont",fontSize:yt,fill:"#ffffff"}).setResolution(ft).setOrigin(.5,.5).setScrollFactor(0).setDepth(rt).setWordWrapWidth(240).setVisible(!1),h.on(u,this.handleDiscussionStarted,this),h.on(m,this.handleDiscussionWaiting,this),h.on(g,this.handleDiscussionEnded,this),h.on(v,this.listenUnlockedEvents,this),h.on(b,this.handleMessage,this),T("sfx_mini-jeu_haut-parleur",this),T("sfx_mini-jeu_erreur_2",this),T("sfx_mini-jeu_erreur_3",this),T("sfx_mini-jeu_apparition_panneau_erreurs_2",this),this.input.keyboard.addKey(e.Input.Keyboard.KeyCodes.V).on("down",(()=>{this.vignette.setVisible(!this.vignette.visible)}))}listenUnlockedEvents(e){V(e,"show_score_board")&&this.showScoreBoard()}showScoreBoard(){M("sfx_mini-jeu_apparition_panneau_erreurs_2",this),this.tweens.add({targets:this.scoreBoardContainer,y:0,ease:"Sine.easeInOut",duration:1500})}startDiscussion(e){h.emit(u,e)}handleMessage(e){const{message:t,sprite:s}=e;this.updateMessage(t,!0)}updateMessage(e,t=!1){this.scene.isActive()&&(M("sfx_mini-jeu_haut-parleur",this,!0,.5),this.dialogBackground.setVisible(!0),this.speaker.anims.play("speaker-on-anim"),this.textObject.text=e,this.textObject.setVisible(!0),t?this.time.delayedCall(200,(()=>h.emit(m))):this.time.delayedCall(2500,(()=>{this.currentDiscussionStatus===E.NONE&&this.handleDiscussionEnded()})))}updateWarnings(e){M(e<=2?"sfx_mini-jeu_erreur_3":"sfx_mini-jeu_erreur_2",this,!0,1),e>3&&(e=3);for(let t=0;t<e;t++)this.scores[t].setTexture("ui","scoreko")}handleAction(){if(this.scene.isActive())return this.currentDiscussionStatus===E.WAITING?(this.currentDiscussionStatus=E.STARTED,void h.emit(y)):void 0}handleDiscussionStarted(){this.scene.isActive()&&(this.currentDiscussionStatus=E.STARTED)}handleDiscussionWaiting(){this.scene.isActive()&&(this.currentDiscussionStatus=E.WAITING)}handleDiscussionEnded(){this.scene.isActive()&&(this.currentDiscussionStatus=E.NONE,this.textObject.setVisible(!1),this.speaker.anims.play("speaker-off-anim"),this.dialogBackground.setVisible(!1))}}const dt=["console","laptop","phone"],ht={console:12469059,laptop:7260614,phone:12623450};class ct extends Phaser.GameObjects.Rectangle{constructor(e,t,s,i){const a=Phaser.Math.RND.pick([13421772,i]);super(e,t,s,Phaser.Math.Between(2,6),Phaser.Math.Between(2,6),a),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!0),this.body.setVelocityX(Phaser.Math.Between(-200,200)),this.body.setVelocityY(Phaser.Math.Between(-100,100)),this.init()}init(){this.scene.tweens.add({targets:this,duration:800,scale:{from:1,to:0},onComplete:()=>{this.destroy()}})}}const lt={django:"Django",miner:"Bleurk",bino:"Bino",fisherman:"Mino",cat:"Le chat",dog:"Le chien",cow:"La vache",boy:"Les enfants",girl:"La petite fille",koko:"Koko",nono:"Nono",escargot:"L'escargot",dcWorker1:"L'ouvrier"},ut={django:{sound:"sfx_voix_hommes",versions:4},miner:{sound:"sfx_voix_ouvriers",versions:4},boy:{sound:"sfx_voix_enfants",versions:4},girl:{sound:"sfx_voix_enfants",versions:4},koko:{sound:"sfx_voix_femmes",versions:4},nono:{sound:"sfx_voix_hommes",versions:4},cat:{sound:"sfx_chat",versions:2},dog:{sound:"sfx_chien",versions:2},cow:{sound:"sfx_vache",versions:1},veal:{sound:"sfx_vache",versions:2}},mt={bino:[{messages:["Hey, salut toi! Moi je m'appelle Bino!","Fais attention  ne pas marcher sur mes carottes."],repeat:["Fais attention  ne pas marcher sur mes carottes."]},{messages:["Hey! Tu es juste de passage?","Ou bien l pour enquter sur ce qui se trame?","Plus au nord d'ici, il y a une personne louche","(J'espre que cela n'impactera pas mon potager)"],repeat:["(Je me demande bien ce que veulent ces gens)"],dependingOn:["django_met"]},{messages:["Je travaille, mais j'ai pas trop la tte  a","Je suis trs inquiet  cause de la rivire pollue.","Peut-tre qu'en remontant  la source","on trouverait la cause du problme ?","Mais je suis bien trop occup l"],repeat:["(Si seulement quelqu'un pouvait remonter la rivire)"],dependingOn:["first_sleep"]},{messages:["Hey Ma, tout roule pour toi?","Comme tu peux le voir, mon potager a disparu."," la place je dsherbe le bord des routes.","Mais ne crois pas que je sois triste!","On peut accder  tellement plus de denres alimentaires","grce  nos voitures et  ces nouvelles routes!","C'est un gros changement"],repeat:["(Allez, a ne va pas se dsherber tout seul)"],dependingOn:["second_act_begin"]},{messages:["Hey Ma, a roule ?","Moi, ras-le-bol de dsherber le bord des routes !","J'ai vu sur FaceBouc que Django partait en voyage","J'aimerais bien partir avec lui !"],repeat:["(Il faut que j'aille voir Django pour ce voyage)"],dependingOn:["third_act_begin"]},{messages:["Je n'arrive plus  faire pousser de lgumes"],dependingOn:["fourth_act_begin"]},{messages:["J'ai rpondu  l'appel de Koko et Django","Mais il faut dsherber le panneau du village!"],repeat:["(Allez, a ne va pas se dsherber tout seul)"],dependingOn:["strike_begin"]},{messages:["Attendez Je prends les tomates !"],dependingOn:["django_final_end"],unlockEvents:["game_over"]}],twoGuys:[{messages:["- Le changement climatique, c'est du srieux, mec.","- Ok, mais tu penses  la biodiversit?","- Si, si, j'ai mme arrt de tuer les moustiques!"]},{messages:["- Que c'est pratique ces nouvelles routes!","- Tu l'as dit, j'ai rang mon vieux vlo.","- Le hic, c'est l'ternit qu'il faut","pour payer ma nouvelle automobile."],dependingOn:["second_act_begin"]},{messages:["- Il parait que a cherche du monde  l'ouest.","- Ah oui, pourquoi faire ?","- Une histoire de dchets"],repeat:["Il parait que a cherche du monde  l'ouest"],dependingOn:["third_act_begin"]},{messages:["- Avoue, c'est ta premire manif'?","- Mais pas du tout j'ai fait les marches pour le climat!"],dependingOn:["strike_begin"]},{messages:["Salut Ma, tu es attendue prs de chez Bino."],dependingOn:["strike_end"]}],twoWomen:[{messages:["- J'arrte de manger de la viande!","- Pour ta sant ?","- Non, pour rduire mon empreinte carbone!"]},{messages:["- Tu as vu le nouveau smartphone?","- Il a quoi de nouveau?","- Il se transforme en drone","pour nous filmer ou nous photographier","sous tous les angles!","Plus besoin de perche  selfie!"],dependingOn:["third_act_begin"]},{messages:["- Il faut dsarmer ces industries polluantes","- Je te sens rebelle, c'est Ma qui t'inspire?"],dependingOn:["strike_begin"]},{messages:["- Salut Ma, a fait un bail !","- Tu es attendue  l'est du village !"],dependingOn:["strike_end"]}],baby:[{messages:["Papa, je veux mon Papa"]},{messages:["tl-phone, tl-phone"],dependingOn:["third_act_begin"]}],sleepingGuy:[{messages:["ZZZzzz, mmmh?"]},{messages:["Je suis venu depuis longtemps","Il est temps de faire une","petite sieste ZZZzzz"],dependingOn:["strike_begin"]}],koko:[{messages:["Oh bah, vl donc une nouvelle arrivante","Bienvenue au village de Trois-Rivires!","a fait plaisir dvoir une nouvelle tte.","Moi c'est Koko.","J'suis au courant de tout c'qui s'passe dans l'coin!"," Ma ? Un prnom pas banal dis donc!","Jsuis sre que notre patelin va te plaire.","Va donc y faire un tour!","Et si tu cherches un endroit o dormir","Django t'accueillera srement, il est plus au sud."],repeat:["Ma, si tas fini dvisiter tout le village","va donc vers le sud pour trouver o dormir."]},{messages:["Tu as rencontr Django ?","C'est la personne la plus gentille que j'connaisse.","Tu devrais aller voir ce qui se trame  l'est","Il parait qu'une personne louche bloque un pont"],repeat:["Tu devrais aller voir ce qui se trame  l'est","Il parait qu'une personne louche bloque un pont"],dependingOn:["django_met"]},{messages:["Olala, olala t'as vu a Ma?","C'est terrible c'qui arrive  notre rivire!","Un truc louche se trame vers l'est, j'te l'dis!","Nono, qu'habite plus au nord, en revient justement.","Il est mal en point, comme la rivire","peut-tre qu'il pourra t'en dire plus!"],repeat:["Au nord, Nono pourra t'clairer sur c'qui s'passe!"],dependingOn:["first_sleep"]},{messages:["Je vois que tu as le badge de Nono","Fais attention  toi, Ma!"],dependingOn:["card_for_mine"]},{messages:["Ma, c'est incroyable tu trouves pas?","Le gnie humain j'veux dire.","Pour trois fois moins de temps,","j'peux aller voir ma famille, mes amies!","Moi qui ADORE tre au courant de tout,","a va grandement faciliter les potins hh.","D'ailleurs t'sais pas la dernire ?","Une autre usine s'est installe au nord.","a pousse comme des champignons ces choses l!"],repeat:["Tu d'vrais aller voir cette usine au nord","p'ttre que t'y trouveras encore du travail!"],dependingOn:["second_act_begin"]},{messages:["B'jour Ma ! Dis-moi","Tu peux m'aider  choisir un nouveau smartphone ?","Le mien est dj trop lent","C'est vraiment pratique pour tre au courant de tout !","D'ailleurs une nouvelle usine a ouvert  l'ouest."],repeat:["Tu vas aller voir cette nouvelle usine  l'ouest ?"],dependingOn:["third_act_begin"]},{messages:[" Ma","J'avais tellement la tte plonge dans les crans","que je n'ai pas remarqu l'tat de nos rivires!","que les oiseaux et les papillons ont disparu!","QUOI? Tu dis qu'il faut se mobiliser?","C'est une bonne ide!","Autre bonne ide, les enfants m'ont dit","(qu'il est possible d'teindre les crans pub)","(en passant par derrire)","C'est risqu, mais a ferrait du bien de s'en dbarrasser !"],repeat:["On peut teindre les crans pub par derrire"],dependingOn:["fourth_act_begin"]},{messages:["Merci Ma pour tout ce que tu as fait.","Grce  toi, tous les villageois","se retrouvent pour une cause commune","l'avenir de notre village."],repeat:["Merci encore, Ma."],dependingOn:["strike_begin"]}],nono:[{messages:["C'est donc toi Ma?","Ton arrive ne passe pas inaperue.","Comme tu peux le constater","tu ne me vois pas au meilleur de ma forme!","Laisse moi t'expliquer brivement ma msaventure."," l'est, une mine vient de s'installer.","J'ai tent d'y travailler mais","il m'est arriv un accident malencontreux.","Il faut dire qu'on n'est pas trs bien protg.","Et le rythme de travail y est extrmement soutenu!","Mais je m'en remettrai.","Je vois dans ton regard que tu es dtermine  y aller.","Je suis prt  t'aider et te prter mon laissez-passer.","Nanmoins","Je veux que tu sois sre de savoir o tu mets les pieds!","Tiens, prends mon laissez-passer.","Et surtout fais bien attention  toi!"],repeat:["Fais bon usage de mon badge et sois prudente."],unlockEvents:["card_for_mine"]},{messages:["La situation de nos rivires est perturbante,","mais je dois bien avouer que ces nouvelles routes","facilitent normment mes dplacements!","Mon handicap ne fait pas bon mnage avec le vlo","ou rouler sur la terre, la gadoue et les pavs!","D'ailleurs, savais-tu que ce sont les dchets de la mine","les rsidus miniers, qui ont t recycls","dans le bitume des routes? Impressionnant non?","Peu tonnant qu'il y ait foule pour aller  la mine,","c'est devenu l'attraction des alentours."],repeat:["La situation de nos rivires est perturbante"],dependingOn:["second_act_begin"]},{messages:["C'est assez formidable n'est-ce pas ?","Ce confort, et l'accs  tout le savoir je veux dire.","Il faut bien sr russir  bien s'informer","Heureusement, je sais dmler le vrai du faux !","(Alors comme a, la Terre serait plate !?)"],repeat:["J'apprends tellement grce  l'internet !"],dependingOn:["third_act_begin"]},{messages:["C'est terrible, le village est mconnaissable"],dependingOn:["fourth_act_begin"]},{messages:["Ma, je trouve que toutes ces expriences","t'ont fait grandir! Je le vois dans tes yeux."],repeat:["Tu as gagn en assurance, Ma."],dependingOn:["strike_begin"]}],django:[{messages:["Ooola, quel bon vent nous amne l!"," Ma ? Quel joli prnom.","Et donc tu cherches un lieu o dormir cette nuit?","Tu frappes  la bonne porte!","Comme je le dis souvent, il faut qu'une porte","soit ouverte ou ferme","et la mienne sera toujours ouverte!","Donc fais un tour du village","et reviens au coucher du soleil!"],repeat:["Fais un tour du village et reviens ce soir."],unlockEvents:["django_met"]},{messages:["Aah, tu es revenue! Comme disait ma grand-mre","un bon arbre peut loger dix mille oiseaux.","Allez, entre!"],dependingOn:["miner_first_met"],unlockEvents:["pre_first_sleep"]},{messages:["Bien dormi, Ma ?","Je suis dsol de te l'apprendre au rveil mais","quelque chose de terrible est arriv au village!","Vois par toi-mme, je reste ici me calmer l'esprit."],repeat:["Ooh pauvre rivire, laisse moi te jouer une prire."],dependingOn:["first_sleep"]},{messages:["Bien dormi Ma ?","Aprs toutes ces semaines d'efforts  la mine,","je tenais  te remercier","pour tout ce que tu as fait pour nous.","Grce  toi, on a la confirmation","que les eaux uses de la mine sont bien responsables","de la pollution de la rivire.","Mais dans le mme temps, le village a pu se moderniser.","Je dois avouer tre un peu partag.","Est-ce un mal pour un bien ?","Je n'ai pas la rponse","et je ne voudrais pas t'influencer.","Maintenant que tu as fini ton travail  la mine,","tu as tout le temps de refaire un petit tour."],repeat:["Une chose reste immuable dans tout ce bouleversement","ce sont les 6 cordes de ma guitare."],dependingOn:["second_act_begin"]},{messages:["Tu as encore bien travaill  l'usine !","Ceci dit, le niveau de la rivire a encore baiss.","C'est bien de savoir que c'est de leur faute","mais en attendant le mal est fait.","On ne ralentit pas un train en marche !","De mon ct, je partirais bien loin du village","Loin de ces problmes","Un voyage, c'est a qu'il me faut !"],repeat:["J'ai envie de voyager, partir loin"],dependingOn:["third_act_begin"]},{messages:["Salut Ma !","L'usine de recyclage pompe l'eau de la rivire ?","J'aimerais dire jamais deux sans trois.","Mais a continue, vois le chantier prs de chez moi.","Je ne sais pas ce qui se passe encore"],repeat:["Un chantier au milieu de notre village"],dependingOn:["fourth_act_begin"]},{messages:["Tu as raison, Ma","On ne peut plus laisser toutes ces industries","dtruire notre village","pomper et polluer nos rivires","Quand on l'attaque, le village contre-attaque.","Je suis partant pour une mobilisation gnrale!","J'amne ma guitare et j'arrive."],dependingOn:["screens_shutdown"],unlockEvents:["django_ready_for_strike"]},{messages:["Camarades de Trois-Rivires !","Vous savez ce qui se passe dans notre village.","Nos ressources et nos rivires ont t accapars","Par des industries cupides et polluantes.","Aujourd'hui nous leur disons stop !","Comme le disait ma grand-mre","On peut couper nos branches mais pas nos racines.","La lutte ne fait que commencer !"],dependingOn:["strike_begin"],unlockEvents:["strike_end"]},{messages:["Salut Ma ! a fait plaisir de te revoir !","T'as vu le village ?","La nature a repris ses droits, et nous nos esprits.","Il faut dire qu'il n'y avait plus rien  exploiter ici.","Les industriels sont ainsi partis voir ailleurs","Et les oiseaux sont revenus.","Presque tous c'est toujours mieux qu'aucun.","Allez, viens. On t'attendais pour pique-niquer !"],dependingOn:["django_final"],unlockEvents:["django_final_end"]}],fisherman:[{messages:["chut, tu vas faire fuir les poissons","Et voil, rat Va parler aux autres, je suis concentr l."],repeat:[""]},{messages:["Par la barbe du %?#%, je ne vais plus pouvoir pcher.","Qui sont les responsables de ce #?%@ ???"],repeat:["Si j'attrape les responsables de ce #?%@"],dependingOn:["first_sleep"]},{messages:[" Tout le monde est devenu fan","de ces routes, de ces voitures","C'est vite oublier d'o on vient.","Une mine s'installe, puis une usine","La rivire qui a baiss de niveau,","juste en quelques semaines.","Je me sens un peu dmuni face  tout a","Mais a me rconforte que tu continues","de mener ta petite enqute, Ma."],repeat:["Continue ton enqute, moi je surveille la rivire."],dependingOn:["second_act_begin"]},{messages:["Ce que je craignais est arriv.","Trois-Rivires a compltement chang","et nos habitudes avec.","Heureusement moi, je tiens bon la barre !","(Attendre ici me donne faim par contre)","(Je mangerais bien un bon burger tiens !)"],repeat:["(Burger burger) hmmmmm, je disais quoi dj ?"],dependingOn:["third_act_begin"]},{messages:["Tout part  la drive, comme mon vieux rafiot"],dependingOn:["fourth_act_begin"]},{messages:["J'me demande bien comment on va se dbarrasser","de ces #?%@ qui polluent nos rivires!"],dependingOn:["strike_begin"]}],boy:[{messages:["YOUPIII, on peut se baigner quand on veut!","Faudrait trop qu'on ramne nos potes un jour!"]},{messages:["Oh nooon, on ne peut plus jouer dans l'eau","Qu'est-ce qu'on va faire maintenant?"],dependingOn:["first_sleep"]},{messages:["on ne peut plus attraper notre ballon!"],dependingOn:["second_act_begin"]},{messages:[" Mmmmh, j'ai envie d'un gros burger"],dependingOn:["third_act_begin"]},{messages:["C'est ma premire manif, trop chouette!"],dependingOn:["strike_begin"]}],girl:[{messages:[""]},{messages:["a serait tellement bien si j'avais","un smartphone pour jouer aux jeux vidos","comme FortNight ou BroStar"],dependingOn:["third_act_begin"]},{messages:["Tante Koko et oncle Django sont trop forts!"],dependingOn:["strike_begin"]}],cat:[{messages:["Meow"]},{messages:["rrrr rrrr"],dependingOn:["strike_begin"]}],dog:[{messages:["Wof, wof"]}],cow:[{messages:["Meuh"]}],veal:[{messages:["Mmmmh"]}],escargot:[{messages:[""]}],miner:[{messages:["Interdit de passer par ici."],repeat:["J'ai dit qu'on ne passe pas!"]},{messages:["Hop hop hop il est trop tard pour passer, dsol.","Reviens demain.","(Vivement que mon tour de garde se termine bientt)","(j'ai des fourmis dans les jambes)"],repeat:["Il est trop tard pour passer, reviens demain."],unlockEvents:["miner_first_met"],dependingOn:["django_met"]},{messages:["Il faut un laissez-passer pour passer.","Nouvelle directive des chefs !"],repeat:["Je t'ai dit qu'il faut un laissez-passer"],dependingOn:["first_sleep"]},{messages:["Je ne sais pas comment tu as eu ce badge","mais te voil donc libre de passer.","D'toute faon, on a besoin de bras pour bosser"],repeat:["Tu peux passer"],dependingOn:["card_for_mine"],unlockEvents:["mine_access_validation"]},{messages:["Apparemment, ils n'ont plus besoin de nous","Pas autant en tout cas.","Les machines que nous avons cres nous remplacent."],dependingOn:["second_act_begin"]}],minerChief:[{messages:["Bienvenue  Grise Mine, LA mine responsable!","D'ici sortent des tonnes de minerais chaque jour","extraits avec de l'nergie bas-carbone s'il vous plat!","Nous utilisons l'eau de faon raisonne","traitons nos employs de manire exemplaire, et","a ne t'intresse pas mon discours?","","Tu quoi ? Tu es l pour travailler???","Hahaha, elle est bien bonne celle-l.","Mes meilleurs hommes sont puiss trs vite","tu ne tiendras pas une seconde l-dedans!","Mais ok, je veux bien te faire une formation express.","Apprte-toi  te faire miner le moral HAHAHA"],unlockEvents:["mine_start"]}],minerDirty2:[{messages:["J'suis content d'avoir trouv ce boulot","mme si c'est pas forcment bien pay."],repeat:["Ce boulot est pas forcment bien pay."]}],minerDirty3:[{messages:["Fiouuu.. a fait du bien une petite pause"]}],minerDirty4:[{messages:["Si tu cherches le chef, il est devant l'entre.","Maintenant laisse moi contempler la vue du progrs."],repeat:["Contemple avec moi, la vue du progrs."]}],mine:[{messages:[o()?"Installe-toi\n[touche pour continuer]":"Installe-toi\n[espace pour continuer]","Comme tu es nouvelle, je te mets sur un poste simple","le nettoyage !","Les roches vont avancer sur le crible","et tu devras les nettoyer pour liminer les impurets !","Pourquoi faire a tu vas me dire ? Pour le PROGRS.","Les mtaux et minerais dvoils servent pour tout.","Smartphones, consoles, plomberie, bijoux","Nous sommes la premire tape d'un grand tout.","Et tu n'en n'es qu'un maillon insignifiant","Bref. Voici comment procder.",o()?"Bouge le tuyau avec le joystick.":"Bouge le tuyau avec les flches    ",o()?"En bougeant le tuyau, l'eau est pulvrise.":"Et pulvrise l'eau avec la barre ESPACE.","J'espre que t'as bien tout compris !","J'peux pas me permettre que tu ralentisses le train","de la mine !"],unlockEvents:["mine_tuto_begin"]},{messages:["Tu n'as pas compris comment a fonctionne???","Tu dois nettoyer la roche  CENT POUR CENT !","On ne peut pas l'envoyer  moiti nettoye.",o()?"Bouge le tuyau avec le joystick.":"Bouge le tuyau avec les flches    ",o()?"En bougeant le tuyau, l'eau est pulvrise. Allez!":"Et pulvrise l'eau avec la barre ESPACE. Allez!"],dependingOn:["mine_tuto_missed"],unlockEvents:["mine_tuto_begin"]},{messages:["Tu as compris comment a fonctionne","Passons aux choses srieuses!"],dependingOn:["mine_tuto_end"],unlockEvents:["show_score_board"]},{messages:["a, c'est ce qui va dornavant contrler ta vie.","Si tu rates trop souvent, une croix s'allumera.","Au bout de trois croix","je viendrai moi-mme t'accompagner  la sortie!","","Quoi ?? Pourquoi tu me regardes comme a?","Oui On extrait l'eau de la rivire!","Et on stocke les dchets dans des rservoirs.","Je te rappelle qu'on est une mine responsable.","On ne fait pas n'importe quoi!","Bon, arrte de poser des questions, au boulot!"],dependingOn:["show_score_board"],unlockEvents:["mine_after_tuto"]},{messages:["C'est bien ce qu'il me semblait","tu ne peux pas tenir un rythme aussi soutenu!","On arrte les frais pour aujourd'hui.","Allez ne fais pas grise mine!"],dependingOn:["mine_game_over"],unlockEvents:["mine_end"]}],whiteWorker1:[{messages:["Il y a trop de monde  la mine","alors j'ai tent ma chance  l'usine."],repeat:["Je tente ma chance  l'usine."]},{messages:["Vu la qualit de ton travail","ou la non qualit de ton travail ?","Tu n'es plus la bienvenue  l'usine. Ordre du chef !"],repeat:["Tu n'es plus la bienvenue ici."],dependingOn:["third_act_begin"]}],whiteWorker2:[{messages:["Je m'y connais pas trop en lectronique","mais faut bien mettre du beurre dans les pinards!"],repeat:["Il faut bien mettre du beurre dans les pinards!"]},{messages:["Tu ne passes plus Ordre des chefs!"],dependingOn:["third_act_begin"]}],whiteWorkerChief:[{messages:["(Pourquoi j'ai accept ce job dans ce trou paum.)","(Je ne supporte pas ces gens, ni ce village, je)","Oui ?  Tu t'appelles Ma et tu veux travailler?","Bien sr, comme tout le monde ici.","Une usine dernier cri attire forcment","des ploucs euh des gens comme vous.","Pour t'expliquer en langage simple","Ici chez Nano World Company"," on assemble des circuits lectroniques","Qui finissent ensuite dans des crans ou tlphones.","Sois contente, tu peux faire une priode d'essai.","Est-ce que tu penses en tre capable ?","Voyons voir ce que tu vaux!"],unlockEvents:["factory_start"]}],blueWorker1:[{messages:["C'est l'dernier endroit qui recrute dans la rgion."]}],blueWorker2:[{messages:["J'ai cru entendre que le chef ici est un bel orateur."]}],blueWorkerChief:[{messages:["Ici euh chez Tri-Force, on recycle les dchets.","Et on en fait euh d'autres quipements.","Alors oui, on utilise l'eau de la rivire.","Mais tout a est euh contrl et raisonn  100%.","Alors a vous dit de tester une journe de travail ?","a nous arrange d'avoir des femmes.","Vu qu'on vous paie moins euh oubliez a.","Suivez-moi !"],unlockEvents:["recycling_start"]}],factory:[{messages:[o()?"Installe-toi\n[touche pour continuer]":"Installe-toi\n[espace pour continuer]","Comme tu es nouvelle, je te mets sur un poste simple","Tu dois monter les composants sur les cartes","Puis les nettoyer  l'eau pour liminer les impurets","Et faire a le plus vite possible","Les clients n'attendent pas!",o()?"Bouge les composants en appuyant  gauche ou  droite.":"Bouge les composants avec les flches  ",o()?"Et valide le composant en appuyant au centre.":"Et valide le composant avec la barre ESPACE","C'est parti!"],unlockEvents:["factory_tuto_begin"]},{messages:["Tte de linotte!","Tu n'as pas compris comment a fonctionne?","Tu dois monter les composants sur les cartes",o()?"Bouge les composants en appuyant  gauche ou  droite.":"Bouge les composants avec les flches  ",o()?"Et valide le composant en appuyant au centre.":"Et valide le composant avec la barre ESPACE","C'est  la porte du premier venu!"],dependingOn:["factory_tuto_missed"],unlockEvents:["factory_tuto_begin"]},{messages:["Tu sembles avoir compris comment a fonctionne","Passons aux choses srieuses!"],dependingOn:["factory_tuto_end"],unlockEvents:["show_score_board"]},{messages:["Si tu rates l'assemblage, une croix s'allumera.","Au bout de trois croix","je viendrai moi-mme t'accompagner  la sortie!","As-tu d'autres questions???","Tu dis que l'eau utilis asseche la rivire?","Et qu'est-ce que a peut me faire?","Tout le monde sera bien content","d'avoir des tlphones derniers cris!","Arrte de te poser des questions et au boulot."],dependingOn:["show_score_board"],unlockEvents:["factory_after_tuto"]},{messages:["C'est bien ce qu'il me semblait","tu ne peux pas tenir un rythme aussi soutenu!","On arrte les frais pour aujourd'hui.","Allez Rentre chez toi!"],dependingOn:["factory_game_over"],unlockEvents:["factory_end"]}],recyclingCentre:[{messages:[o()?"Voil votre poste\n[touche pour continuer]":"Voil votre poste\n[espace pour continuer]","Des dchets tombent de la trappe en haut.","Vous devez les rceptionner avec le chariot en bas.",o()?"Bougez le chariot en appuyant  gauche ou  droite.":"Bougez le chariot avec les flches  ",o()?"Et changez son mode en appuyant en haut ou en bas.":"Et changez son mode avec les flches  ","Il faut dtruire le dchet avec euh le bon mode.","Faisons un test."],unlockEvents:["recycling_tuto_begin"]},{messages:["Euh je vais vous faire un petit rappel, pas le choix.",o()?"Bougez le chariot en appuyant  gauche ou  droite.":"Bougez le chariot avec les flches  ",o()?"Et changez son mode en appuyant en haut ou en bas.":"Et changez son mode avec les flches  ","Le mode doit correspondre au dchet qui tombe !","Allez, c'est euh reparti."],dependingOn:["recycling_tuto_missed"],unlockEvents:["recycling_tuto_begin"]},{messages:["Bon euh a suffira. Ne perdons pas plus de temps.","On va vous tester pour de vrai."],dependingOn:["recycling_tuto_end"],unlockEvents:["show_score_board"]},{messages:["a, c'est le panneau d'erreurs.","Si vous ratez plusieurs dchets une croix s'allume.","Au bout de trois croix euh j'arrte votre journe.","Je le rpte, c'est trs important ce qu'on fait ici.","On dmantle et on recycle les quipements.","On est pour ainsi dire euh super colo.","Toute l'eau qu'on pollue et gaspille","C'est pour un bien encore plus grand.","Allez euh au boulot !"],dependingOn:["show_score_board"],unlockEvents:["recycling_after_tuto"]},{messages:["Bon euh c'est fini pour aujourd'hui.","Il faudra tre plus performante pour","sauver la plante !"],dependingOn:["recycling_game_over"],unlockEvents:["recycling_end"]}],dcWorker1:[{messages:["Pour dvelopper l'IA","On construit un datacenter prs de la rivire","Son eau refroidira les serveurs, c'pas super !?","Si a te gne, dgage ! Et laisse nous bosser."],repeat:["On construit un datacenter, a te gne?"]}],gameOver:[{messages:["Fin de la dmo.\nMerci d'avoir test!"]}]},pt={"mine.faster":"Plus vite!","mine.fasterAgain":"Encore plus vite, allez!!!","mine.waterEmpty":"Rservoir d'eau vide!","mine.waterFull":"Rservoir d'eau plein!","mine.moreMaterials":"Arrivage de minerais, on augmente la frquence!","mine.warning":"Ressaisis-toi, on est l pour faire du chiffre!","mine.lastWarning":"Dernier avertissement, concentre-toi!","factory.faster":"Valid! Plus vite maintenant!!!","factory.welldone":"C'est bien, tu es productive!","factory.error":"C'est quoi ce boulot? Ressaisis-toi la nouvelle!","recycling.faster":"Allez, on augmente le rythme!","recycling.error":"Euh il va falloir faire mieux que a!"},gt=e=>pt[e],yt="16px",ft=20;class bt extends e.Scene{constructor(){super("message"),this.textObject=null,this.spriteNameObject=null,this.currentText="",this.currentDiscussionStatus=E.NONE}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json")}create(){const e=this.sys.game.config;this.actionBackground=this.add.rectangle(e.width/2,e.height-30,200,30,0).setAlpha(.5).setScrollFactor(0).setOrigin(.5,.5).setDepth(2e3).setVisible(!1),this.actionBackgroundLine=this.add.line(0,0,e.width/2-60,e.height-12,e.width/2+60,e.height-12,0).setLineWidth(4).setAlpha(.5).setScrollFactor(0).setOrigin(0,0).setDepth(2e3).setVisible(!1),this.actionText=this.add.text(e.width/2,e.height-30,o()?"Appuyer pour continuer":"Appuyer sur espace",{fontFamily:"DefaultFont",fontSize:yt,fill:"#ffffff",resolution:ft}).setOrigin(.5,.5).setScrollFactor(0).setDepth(2e3).setVisible(!1),this.dialogBackground=this.add.sprite(e.width/2,e.height-30,"ui","dialog-2").setOrigin(.5,.5).setDepth(2e3).setAlpha(.8).setScrollFactor(0).setVisible(!1),this.dialogBackgroundColor=this.add.rectangle(e.width/2,e.height-30,252,44,0).setAlpha(.5).setOrigin(.5,.5).setDepth(2e3).setScrollFactor(0).setVisible(!1),this.textObject=this.add.text(e.width/2,e.height-30,"",{fontFamily:"DefaultFont",fontSize:yt,fill:"#ffffff"}).setResolution(ft).setOrigin(.5,.5).setScrollFactor(0).setDepth(3e3).setWordWrapWidth(245).setVisible(!1),this.spriteNameObject=this.add.text(e.width/2-128,e.height-68,"",{fontFamily:"DefaultFont",fontSize:yt,fill:"#000000",backgroundColor:"#ffffff",padding:4}).setAlpha(.8).setResolution(ft).setOrigin(0,.5).setScrollFactor(0).setDepth(3e3).setVisible(!1),h.on(b,this.handleMessage,this),h.on(g,this.handleDiscussionEnd,this),h.on(l,this.handleDiscussionEnd,this),h.on(c,this.readyToAction,this),h.on(u,this.stopAction,this),h.on(v,this.listenEvents,this)}showMineCard(){M("sfx_objet_inventaire",this.scene.get("game"),!1,1),this.mineCard=this.add.image(225,125,"ui","card").setScrollFactor(0).setDepth(3e3).setAlpha(0),this.tweens.add({targets:this.mineCard,x:420,y:220,alpha:1,scale:1,ease:"Quad.easeOut",loop:0,duration:1e3})}hideMineCard(){this.mineCard&&this.tweens.add({targets:this.mineCard,alpha:0,scale:.5,ease:"Sine.easeInOut",loop:0,duration:500,onComplete:()=>this.mineCard.destroy()})}listenEvents(e){V(e,"card_for_mine")&&this.showMineCard(),V(e,"mine_access_validation")&&this.hideMineCard()}startDiscussion(){this.scene.isActive()&&(this.currentDiscussionStatus=E.STARTED,this.stopAction())}stopAction(){this.scene.isActive()&&(this.actionText.setVisible(!1),this.actionBackground.setVisible(!1),this.actionBackgroundLine.setVisible(!1))}readyToAction(){this.scene.isActive()&&this.currentDiscussionStatus===E.NONE&&(this.scene.get("game")?.isCinematic||(this.currentDiscussionStatus=E.READY,this.actionText.setVisible(!0),this.actionBackground.setVisible(!0),this.actionBackgroundLine.setVisible(!0)))}handleDiscussionEnd(){this.scene.isActive()&&(this.currentDiscussionStatus=E.NONE,this.stopAction(),this.textObject.text="",this.textObject.setVisible(!1),this.spriteNameObject.text="",this.spriteNameObject.setVisible(!1),this.dialogBackground.setVisible(!1),this.dialogBackgroundColor.setVisible(!1))}handleMessage(t){if(!this.scene.isActive())return;const{message:s,sprite:i}=t;if(this.textObject.visible&&s===this.currentText)return;const a=this.scene.get("game");ut[i]&&M(`${ut[i].sound}_${e.Math.Between(1,ut[i]?.versions)}`,a,!1,.3),this.dialogBackground.setVisible(!0),this.dialogBackgroundColor.setVisible(!0),this.spriteNameObject.text=lt[i],this.spriteNameObject.setVisible(!!this.spriteNameObject.text),this.textObject.text=s,this.currentText=s,this.textObject.setVisible(!0),this.time.delayedCall(300,(()=>h.emit(m)))}}const vt=function(e){e.checkDjangoDoor=!1,e.setHeroPosition("heroStrike"),e.hero.slowUp(),e.hero.animateToUp(),e.dcWorker3.scaleX=1,e.map.getObjectLayer("sprites").objects.forEach((t=>{"strikeDcWorker1"===t.name&&(e.dcWorker1.setPosition(t.x,t.y),e.dcWorker1.disableChatIcon(),e.dcWorker1.setDepth(1e3)),"strikeDcWorker4"===t.name&&(e.dcWorker4.setPosition(t.x,t.y),e.dcWorker4.scaleX=1),"djangoStrike"===t.name&&(e.django.setPosition(t.x,t.y),e.djangoThemeEnabled=!1),"girlStrike"===t.name&&(e.girl.setPosition(t.x,t.y),e.girl.disableChatIcon()),"boyStrike"===t.name&&(e.boy.setPosition(t.x,t.y),e.boy.disableChatIcon(),e.boy.scaleX=-1),"binoStrike"===t.name&&(e.bino.setPosition(t.x,t.y),e.bino.disableChatIcon()),"minoStrike"===t.name&&(e.fisherman.setOnStrike(t.x,t.y),e.fisherman.disableChatIcon()),"babyStrike"===t.name&&(e.baby.setPosition(t.x,t.y),e.baby.disableChatIcon()),"dogStrike"===t.name&&e.dog.setPosition(t.x,t.y),"catStrike"===t.name&&(e.cat.setPosition(t.x,t.y),e.cat.scaleX=1),"nonoStrike"===t.name&&(e.nono.setPosition(t.x,t.y),e.nono.disableChatIcon()),"twoGuysStrike"===t.name&&(e.twoGuys.setPosition(t.x,t.y),e.twoGuys.disableChatIcon()),"twoWomenStrike"===t.name&&(e.twoWomen.setPosition(t.x,t.y),e.twoWomen.disableChatIcon()),"sleepingGuyStrike"===t.name&&e.sleepingGuy.setPosition(t.x,t.y),"kokoStrike"===t.name&&e.koko.setPosition(t.x,t.y)}))};class kt extends t.Scene{constructor(){super("game"),this.controls=null,this.cursors=null,this.hero=null,this.joystick=null,this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.goingAngle=null,this.water=null,this.land=null,this.topObjects=null,this.currentDiscussionStatus=E.NONE,this.currentDiscussionSprite=null,this.treesOfDc=[],this.treesOfDcCollider=[],this.birds=[],this.butterflies=[],this.pointsCollider=[],this.heroPositions={},this.maskNightOverlays=[],this.darkOverlay=null,this.nightOverlays=[],this.bikes=[],this.isCinematic=!1,this.night=!1,this.villageTheme=null,this.industryTheme=null,this.miniGameTheme=null,this.djangoTheme=null,this.djangoThemeEnabled=!0,this.datacentreThemeEnabled=!1,this.sounds=[],this.django=null,this.koko=null,this.sleepingGuy=null,this.twoGuys=null,this.baby=null,this.twoWomen=null,this.bino=null,this.fisherman=null,this.dog=null,this.escargot=null,this.cat=null,this.boy=null,this.girl=null,this.miner=null,this.ball=null,this.tent=null,this.checkDjangoDoor=!0,this.screens=null,this.screenOffSprites=[],this.screenShutDownCount=0,this.map=null,this.tileset=null}preload(){a("noanims")||this.load.scenePlugin("AnimatedTiles","plugins/AnimatedTiles.js","animatedTiles","animatedTiles")}create(){this.timeStart=Date.now(),a("debug")&&(this.fpsText=this.add.text(10,10,"hello",{fontSize:"10px",fill:"#fff"}).setDepth(1e4).setScrollFactor(0),this.time.addEvent({delay:100,loop:!0,callback:()=>{this.fpsText.setText(`FPS: ${this.game.loop.actualFps.toFixed(2)}`)}})),function(e){if(a("nostart"))return e.resetGameSize(),void e.startGame();e.scale.setGameSize(550,300),e.add.image(0,0,"splash").setOrigin(0,0),e.add.text(275,130,"Trois-Rivires",{fontFamily:"DefaultFont",fontSize:"32px",fill:"#307f6d"}).setOrigin(.5,.5).setResolution(ft).setInteractive({useHandCursor:!0});const t=e.add.text(275,164,"Dmarrer",{fontFamily:"DefaultFont",fontSize:yt,fill:"#ffffff"}).setOrigin(.5,.5).setResolution(ft).setInteractive({useHandCursor:!0}),s=()=>{e.input.off("pointerdown",s),t.disableInteractive(!0),t.setText("Chargement..."),e.time.delayedCall(100,(()=>{e.resetGameSize(),e.startGame(),t.destroy()}))};e.input.on("pointerdown",s)}(this)}startGame(){a("dreamMine")?this.gotoScene("mine-nightmare"):a("dreamFactory")?this.gotoScene("factory-nightmare"):a("factory")?this.debugFactory():a("mine")?this.debugMine():a("recyclingCentre")?this.debugRecyclingCentre():at(this)}gotoScene(e){this.scene.pause("game"),this.scene.launch(e)}debugFactory(){this.scene.pause("game"),this.scene.launch("factory")}debugMine(){this.scene.pause("game"),this.scene.launch("mine")}debugRecyclingCentre(){this.scene.pause("game"),this.scene.launch("recyclingCentre")}resetGameSize(){this.scale.setGameSize(450,250)}setHeroPosition(e){const t=this.heroPositions[e];this.hero.setPosition(t.x,t.y)}stopMoving(){this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.hero.stopAndWait()}sleepGame(){this.scene.sleep("game"),this.scene.sleep("message")}wakeGame(e=!1){this.scene.wake("game"),this.scene.wake("message"),this.resetGameSize();const t=e?255:0;this.cameras.main.fadeIn(1e3,t,t,t)}addEventsListeners(){h.on(c,this.handleDiscussionReady,this),h.on(u,this.handleDiscussionStarted,this),h.on(m,this.handleDiscussionWaiting,this),h.on(g,this.handleDiscussionEnded,this),h.on(l,this.handleDiscussionAbort,this),h.on(p,this.handleDiscussionInProgress,this),h.on(C,this.handleScreenShutdown,this),h.on(v,this.listenEvents,this)}listenEvents(e){var t;V(e,"miner_first_met")&&(Le(t=this,!1),N(t)),V(e,"pre_first_sleep")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&e.time.delayedCall(2e3,(()=>ze(e)))}))}(this),V(e,"mine_access_validation")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(it(e),e.cameras.main.fadeIn(1e3,0,0,0),e.isCinematic=!1)}))}(this),V(e,"mine_start")&&function(e){e.isCinematic=!0,P(e),e.cameras.main.fadeOut(3e3,0,0,0,((t,s)=>{1===s&&(e.scene.launch("mine"),e.sleepGame())}))}(this),V(e,"mine_after")&&function(e){e.wakeGame(),S(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=E.NONE,G(e,!0),e.setHeroPosition("heroMine"),e.hero.slowLeft(),e.hero.animateToLeft(),Le(e,!1,!0,!0),e.time.delayedCall(2e3,(()=>{e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())}))}));const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,(()=>{e.scene.launch("mine-nightmare"),e.sleepGame()})),e.events.off("update",t))};e.events.on("update",t)}(this),V(e,"second_act_begin")&&function(e){e.wakeGame(!0),I(e),e.currentDiscussionStatus=E.NONE,Je(e),e.setHeroPosition("heroDjango"),e.hero.slowRight(),e.hero.animateToRight(),e.time.delayedCall(1200,(()=>{e.isCinematic=!1,h.emit(c,"django"),Ae(e)}))}(this),V(e,"factory_start")&&function(e){e.isCinematic=!0,P(e),e.cameras.main.fadeOut(3e3,0,0,0,((t,s)=>{1===s&&(e.scene.launch("factory"),e.sleepGame())}))}(this),V(e,"factory_after")&&function(e){e.wakeGame(),S(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=E.NONE,G(e,!0),Le(e,!1,!0),e.whiteWorker1.setVisible(!1),e.whiteWorker2.setVisible(!1),e.whiteWorkerChief.setVisible(!1),e.setHeroPosition("heroFactory"),e.hero.slowDown(),e.hero.animateToDown(),e.time.delayedCall(2e3,(()=>{e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())}))}));const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,(()=>{e.scene.launch("factory-nightmare"),e.sleepGame()})),e.events.off("update",t))};e.events.on("update",t)}(this),V(e,"third_act_begin")&&function(e){e.wakeGame(!0),I(e),Re(e),e.cameras.main.fadeIn(1e3,0,0,0),e.setHeroPosition("heroDjango"),e.hero.slowRight(),e.hero.animateToRight(),e.time.delayedCall(1200,(()=>{e.isCinematic=!1,h.emit(c,"django"),Ae(e)}))}(this),V(e,"recycling_start")&&function(e){e.isCinematic=!0,P(e),e.cameras.main.fadeOut(3e3,0,0,0,((t,s)=>{1===s&&(e.scene.launch("recyclingCentre"),e.sleepGame())}))}(this),V(e,"recycling_after")&&function(e){e.wakeGame(),S(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=E.NONE,G(e,!0),Le(e,!1,!0),e.blueWorkerChief.setVisible(!1),e.setHeroPosition("heroRecycling"),e.hero.slowDown(),e.hero.animateToDown(),e.time.delayedCall(1500,(()=>{e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())}))}));const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,(()=>{e.scene.launch("recycling-nightmare"),e.sleepGame()})),e.events.off("update",t))};e.events.on("update",t)}(this),V(e,"fourth_act_begin")&&function(e){e.wakeGame(!0),e.isCinematic=!0,I(e),Qe(e),e.cameras.main.fadeIn(1e3,0,0,0),e.datacentreThemeEnabled=!0,e.setHeroPosition("heroDjango"),e.hero.slowRight(),e.hero.animateToRight(),e.time.delayedCall(1200,(()=>{e.isCinematic=!1,h.emit(c,"django"),Ae(e)}))}(this),V(e,"django_ready_for_strike")&&function(e){e.isCinematic=!0,e.hero.stopAndWait(),e.cameras.main.fadeOut(1e3,0,0,0,((t,s)=>{1===s&&(vt(e),e.cameras.main.fadeIn(1e3,0,0,0,((t,s)=>{1===s&&(F(["strike_begin"]),e.isCinematic=!1)})))}))}(this),V(e,"strike_end")&&function(e){j(e),e.isCinematic=!0,e.cameras.main.fadeOut(2e3,0,0,0,((t,s)=>{1===s&&(e.sleepGame(),e.scene.launch("final-message"))}))}(this),V(e,"after_final_message")&&function(e){e.wakeGame(),Ze(e),e.setHeroPosition("heroFinal"),e.hero.slowRight(),e.hero.animateToRight(),e.cameras.main.fadeIn(2e3,0,0,0,((t,s)=>{1===s&&(e.isCinematic=!1)}))}(this),V(e,"game_over")&&(!function(e){N(e),e.time.delayedCall(1e3,(()=>{h.emit(c,"gameOver"),Ae(e),e.isCinematic=!0,e.hero.stopAndWait()}))}(this),r("Game",this.timeStart))}handleDiscussionReady(e){if(this.scene.isActive()){if(this.currentDiscussionStatus===E.READY&&this.currentDiscussionSprite!==e)this.handleDiscussionEnded(this.currentDiscussionSprite);else if(this.currentDiscussionStatus!==E.NONE)return;this.currentDiscussionStatus=E.READY,this.currentDiscussionSprite=e}}handleDiscussionInProgress(){this.scene.isActive()&&(this.currentDiscussionStatus=E.INPROGRESS)}handleDiscussionStarted(){this.scene.isActive()&&(console.log("handleDiscussionStarted"),this.currentDiscussionStatus=E.STARTED)}handleDiscussionWaiting(e){this.scene.isActive()&&(this.currentDiscussionStatus=E.WAITING)}handleDiscussionEnded(e){this.scene.isActive()&&(e&&this[e]||"screen"===e.substring(0,6))&&(console.log("handleDiscussionEnded",e),this.currentDiscussionStatus=E.NONE,this[e]?.stopChatting())}handleDiscussionAbort(e){this.scene.isActive()&&e&&this[e]&&(this.currentDiscussionStatus=E.NONE,this[e]?.abortChatting())}handleScreenShutdown(e){var t;this.screenShutDownCount++,3===this.screenShutDownCount&&(F(["screens_shutdown"]),(t=this).isCinematic=!0,t.hero.stopAndWait(),t.cameras.main.fadeOut(1e3,0,0,0,((e,s)=>{1===s&&(S(t),t.screenOffSprites.forEach((e=>e.shutdown())),t.setHeroPosition("heroDjangoRight"),t.hero.slowLeft(),t.hero.animateToLeft(),t.cameras.main.fadeIn(1e3,0,0,0,((e,s)=>{1===s&&(t.isCinematic=!1,h.emit(c,"django"),Ae(t))})))})))}update(e,t){if(this.night&&this.darkOverlay&&function(e){const t=e.hero.x-e.scale.width,s=e.hero.y-e.scale.height;e.nightOverlays.forEach((e=>e.setPosition(t,s))),e.maskNightOverlays.forEach((e=>e.setPosition(t,s))),e.darkOverlay.setPosition(e.hero.x,e.hero.y)}(this),this.cursors&&this.hero&&!this.isCinematic&&this.hero.body){if(this.hero.resetVelocity(),[E.STARTED,E.WAITING,E.INPROGRESS].includes(this.currentDiscussionStatus))return console.log("stopAndWait",this.currentDiscussionStatus),void this.hero.stopAndWait();if(this.goingLeft?this.hero.goLeft():this.goingRight&&this.hero.goRight(),this.goingUp?this.hero.goUp():this.goingDown&&this.hero.goDown(),this.goingLeft||this.goingUp||this.goingDown||this.goingRight?this.hero.playMoveSound():this.hero.stopMoveSound(),this.goingUp){this.hero.animateToUp();const e=this.heroPositions.heroDjangoDoor;this.checkDjangoDoor&&this.hero.x>e.x-8&&this.hero.x<e.x+8&&this.hero.y>e.y-5&&this.hero.y<e.y+5&&(this.hero.stopAndWait(),h.emit(c,"django"),Ae(this))}else this.goingDown?this.hero.animateToDown():this.goingRight?this.hero.animateToRight():this.goingLeft&&this.hero.animateToLeft();a("nomusic")||(this.hero.y<445||this.miner&&this.hero.x>this.miner.x+25||this.hero.x<880&&this.hero.y<615||this.datacentreThemeEnabled&&this.hero.x>1110&&this.hero.x<1500&&this.hero.y>984&&this.hero.y<1210?S(this):this.hero.x>1160&&this.hero.y>1244?I(this):j(this)),this.goingDown||this.goingUp||this.goingRight||this.goingLeft||this.stopMoving(),this.hero.updateShadow()}}}const wt={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},Ct=265,xt=10,Ot=10,Dt=255,_t=340;class jt extends e.Scene{constructor(){super({key:"mine-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.stopWater=!0}preload(){this.load.atlas("mine","sprites/mine.png","sprites/mine.json")}create(){this.timeStart=Date.now(),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.createRock(500,250,50,50,"rock-1"),this.createRock(50,250,500,50,"rock-2"),this.createRock(50,50,500,250,"rock-3"),this.createRock(100,200,300,20,"rock-4"),this.tube=this.add.container(),this.tube.add(this.add.tileSprite(0,-33,22,1e3,"mine","tube").setOrigin(.5,1)),this.tube.add(this.add.image(0,0,"mine","tube-end").setOrigin(.43,1)),this.tube.setDepth(1e3).setAlpha(0),this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:2e3,quantity:100,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.tweens.add({targets:this.tube,angle:180,alpha:1,x:500,y:216,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress<.2,e.progress>.8&&this.water.updateConfig({frame:["water-maroon"]})},onComplete:()=>{this.tweens.add({targets:this.tube,angle:180,alpha:0,x:400,y:20,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress>.9}})}})}endScene(){this.cameras.main.fadeOut(1e3,255,255,255,((e,t)=>{1===t&&(r("Dream mine",this.timeStart),this.scene.stop(),F(["second_act_begin"]))}))}createRock(e,t,s,i,a){const n=this.add.image(e,t,"mine",a);return n.setAlpha(0),this.tweens.add({targets:n,alpha:.8,ease:"Sine.linear",duration:5e3,onComplete:()=>{this.tweens.add({targets:n,x:s,y:i,alpha:0,ease:"Sine.linear",duration:5e3})}}),this.tweens.add({targets:n,angle:360,x:s,y:i,alpha:.8,ease:"Sine.linear",duration:1e4}),n}update(){this.stopWater||(this.water.emitParticleAt(this.tube.x,this.tube.y),this.water.updateConfig({angle:{min:this.tube.angle+100,max:this.tube.angle+80}}))}}const St=[110,175,237],Pt=[60,125,187],It=[.8,1,1.2],At=n("numberRockValidatedBeforeSpeedIncrement",5),Lt=n("numberRocksValidatedBeforeSpeedIncrementAgain",30),Tt=n("waterReductionFactor",.2),Mt=n("waterRefillFactor",.5),Bt=n("numberRockValidatedToHaveMoreMaterials",12),Rt=n("timeBetweenRocks",2e3),Et=n("moreMaterialsTimeBetweenRocks",1e3),Vt=n("numberIsRefined",60),Ft=n("tubeSpeed",5),Nt=n("tubeDeltaEffect",40);const Gt={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},Wt=[{x:275,y:10},{x:400,y:50},{x:475,y:150},{x:400,y:250},{x:275,y:290},{x:150,y:250},{x:75,y:150},{x:150,y:50}];class Ut extends e.Scene{constructor(){super({key:"factory-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.conveyorPosition=0}preload(){this.load.atlas("factory","sprites/factory.png","sprites/factory.json")}create(){this.timeStart=Date.now(),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0).setDepth(1),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.conveyor=this.add.tileSprite(275,150,700,96,"factory","tapis").setAlpha(0),this.tweens.add({targets:this.conveyor,alpha:.5,ease:"Sine.linear",duration:5e3}),this.tweens.add({targets:this.conveyor,angle:360,ease:"Sine.linear",duration:15e3});for(const t of Wt){const e=this.add.image(t.x,t.y,"factory","motherboard").setAlpha(0);this.tweens.add({targets:e,alpha:.5,duration:5e3}),this.tweens.add({targets:e,angle:360,scale:4,ease:"Sine.linear",duration:15e3})}let e=0;for(const t of Object.values(Gt)){e++;const s=this.add.image(850-50*e,10+50*e,"factory",t).setAlpha(.7).setDepth(1);this.tweens.add({targets:s,scale:4,angle:360,x:-80*e,ease:"Sine.linear",duration:15e3})}}endScene(){this.cameras.main.fadeOut(1e3,255,255,255,((e,t)=>{1===t&&(r("Dream factory",this.timeStart),this.scene.stop(),F(["third_act_begin"]))}))}update(){this.conveyorPosition-=1,this.conveyor.setTilePosition(this.conveyorPosition,0)}}class qt extends e.Scene{constructor(){super({key:"recycling-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}})}preload(){this.load.atlas("factory","sprites/factory.png","sprites/factory.json")}create(){this.timeStart=Date.now(),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0).setDepth(1),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}})}endScene(){this.cameras.main.fadeOut(2e3,255,255,255,((e,t)=>{1===t&&(r("Dream factory",this.timeStart),this.scene.stop(),F(["fourth_act_begin"]))}))}update(){}}class zt extends e.Scene{constructor(){super("final-message")}create(){console.log("final message"),this.cameras.main.fadeIn(2e3,0,0,0);const e=this.add.text(225,100,"Quelques temps plus tard",{fontFamily:"DefaultFont",fontSize:yt,fill:"#ffffff"}).setScrollFactor(0).setOrigin(.5,.5).setResolution(ft).setDepth(1e4);this.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",delay:2e3,duration:2e3,onComplete:()=>this.endScene()})}endScene(){this.scene.stop(),F(["after_final_message"])}}const Yt={type:t.AUTO,parent:"game",pixelArt:!0,render:{pixelArt:!0},width:450,height:250,backgroundColor:"#000000",physics:{default:"arcade",arcade:{debug:i(),gravity:{y:0}}},scene:[d,kt,jt,class extends ot{constructor(){super("mine"),this.rocks=[],this.movingCable=!1,this.rockValidated=0,this.rockNotValidated=0,this.speed=It,this.control="none",this.waterStockPercentage=100,this.rechargeWater=!1,this.conveyor=[],this.conveyorPosition=[0,0,0],this.tubeRollings=[],this.tubeCurrentY=0,this.goingDown=!0,this.isCinematic=!0,this.firstStep=!0,this.faster=!1,this.fasterAgain=!1,this.moreMaterials=!1,this.warnings=0}preload(){super.preload(),this.load.atlas("mine","sprites/mine.png","sprites/mine.json")}create(){super.create(),this.cameras.main.setBackgroundColor(3154462),this.scale.setGameSize(550,300),this.add.image(275,0,"mine","background").setOrigin(.5,0).setScale(-1,1),this.add.image(180,46,"mine","water-tank");const t=this.add.bitmapMask(null,197,35,"mine","water-tank-mask");this.waterStock=this.add.image(197,46,"mine","water"),this.waterStock.setMask(t),this.add.image(197,46,"mine","water-glass"),this.add.image(197,18,"mine","water-tank-top"),this.conveyor.push(this.add.tileSprite(0,92,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(0,140,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,156,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(10,204,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,220,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(5,268,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.add.image(509,169,"mine","right-block").setOrigin(.5,.5).setDepth(1e3),this.add.image(474,69,"mine","block-bottom").setOrigin(.5,.5).setDepth(1),this.add.image(474,133,"mine","block-bottom").setOrigin(.5,.5).setDepth(10),this.add.image(474,197,"mine","block-bottom").setOrigin(.5,.5).setDepth(20),this.add.image(515,257,"mine","right-glass").setOrigin(.5,.5).setDepth(1e3),this.add.image(40,169,"mine","right-block").setOrigin(.5,.5).setScale(-1,1).setDepth(1e3),this.add.image(75,69,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(1),this.add.image(75,133,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(10),this.add.image(75,197,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(20),this.add.image(35,257,"mine","left-glass").setOrigin(.5,.5).setDepth(1e3),this.anims.create({key:"particules",frames:this.anims.generateFrameNames("mine",{start:1,end:4,prefix:"particules-"}),repeat:-1,frameRate:10}),this.rockParticles=this.add.sprite(275,202,"mine","particules-1").setOrigin(.5,.5).setVisible(!1),this.rockParticles.anims.play("particules",!0),this.tube=this.add.tileSprite(0,0,22,1e3,"mine","tube").setOrigin(.5,1).setDepth(1e3),this.tubeEnd=this.add.image(275,50,"mine","tube-end").setOrigin(.43,1).setDepth(1e3),this.add.image(64,0,"mine","tube-top").setOrigin(0,0).setDepth(1e3);for(let e=0;e<3;e++)this.tubeRollings.push(this.add.sprite(80+13*e,2,"mine","tube-rolling-1").setOrigin(0,0).setDepth(1e3));this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:320,quantity:50,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.events.on("update",(()=>{this.isCinematic||(!this.rechargeWater&&this.action&&this.waterStockPercentage>0?(M("sfx_mini-jeu_jet-eau",this,!1,.5,!0),this.water.emitParticleAt(this.tubeEnd.x,this.tubeEnd.y),this.water.forEachAlive((t=>{const s=St[this.tubeCurrentY]+e.Math.Between(0,30);t.y>=s&&(t.y=s,t.velocityY*=-e.Math.Between(1,100)/100,t.velocityX*=e.Math.Between(1,20)/10)})),this.waterStockPercentage-=Tt,this.waterStockPercentage<=0&&(this.waterStockPercentage=0,this.rechargeWater=!0,this.updateMessage(gt("mine.waterEmpty")))):(B("sfx_mini-jeu_jet-eau",this),this.waterStockPercentage+=Mt,this.waterStockPercentage>=100&&(this.waterStockPercentage=100),this.rechargeWater&&100===this.waterStockPercentage&&(this.rechargeWater=!1,this.updateMessage(gt("mine.waterFull")))),this.waterStock.y=46+54*(100-this.waterStockPercentage)/100,this.waterStock.setVisible(this.waterStockPercentage>5))})),h.on(k,this.listenDispatchedEvents,this),this.cameras.main.fadeIn(2e3,0,0,0),a("bypassminigame")?this.endGame():(this.createControls(),this.startGame(),T("sfx_mini-jeu_jet-eau",this),T("sfx_mini-jeu_caillou_desagrege",this),T("sfx_mini-jeu_deplacement_tuyau",this),T("sfx_mini-jeu_reussite_3",this))}createControls(){this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",(e=>{"ArrowUp"===e.key?(this.goingUp=!0,this.goingDown=!1):"ArrowDown"===e.key?(this.goingDown=!0,this.goingUp=!1):"ArrowLeft"===e.key?(this.goingLeft=!0,this.goingRight=!1):"ArrowRight"===e.key?(this.goingRight=!0,this.goingLeft=!1):32===e.keyCode&&(this.action=!0,this.handleAction())}),this),this.input.keyboard.on("keyup",(e=>{"ArrowUp"==e.key?this.goingUp=!1:"ArrowDown"==e.key?this.goingDown=!1:"ArrowLeft"==e.key?this.goingLeft=!1:"ArrowRight"==e.key?this.goingRight=!1:32===e.keyCode&&(this.action=!1)}),this),o()&&(this.joystick=this.plugins.get("rexvirtualjoystickplugin").add(this,{x:100,y:200,radius:100,base:this.add.circle(0,0,50,16733508,.4).setDepth(1e4),thumb:this.add.circle(0,0,30,13421772,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),this.input.on("pointerdown",(e=>{this.joystick.setPosition(e.x,e.y),this.joystick.setVisible(!0),this.action=!0,this.handleAction()}),this),this.joystick.on("update",(function(){this.goingAngle=this.joystick.angle,this.joystick.left?(this.goingLeft=!0,this.goingRight=!1,(177.5<this.goingAngle||-177.5>this.goingAngle)&&(this.goingUp=!1,this.goingDown=!1)):this.joystick.right&&(this.goingRight=!0,this.goingLeft=!1,22.5>this.goingAngle&&-22.5<this.goingAngle&&(this.goingUp=!1,this.goingDown=!1)),this.joystick.up?(this.goingUp=!0,this.goingDown=!1,-67.5>this.goingAngle&&-112.5<this.goingAngle&&(this.goingRight=!1,this.goingLeft=!1)):this.joystick.down&&(this.goingDown=!0,this.goingUp=!1,67.5<this.goingAngle&&112.5>this.goingAngle&&(this.goingRight=!1,this.goingLeft=!1))}),this),this.joystick.on("pointerup",(()=>{this.joystick.setVisible(!1),this.action=!1,this.goingUp=!1,this.goingDown=!1,this.goingRight=!1,this.goingLeft=!1}),this))}listenUnlockedEvents(e){super.listenUnlockedEvents(e),V(e,"mine_after_tuto")&&this.afterTuto(),V(e,"mine_end")&&this.endGame()}listenDispatchedEvents(e){V(e,"mine_tuto_begin")&&this.tutoBegin()}tutoBegin(){this.isCinematic=!1,this.firstStep=!0,this.createRock()}tutoEnd(){B("sfx_mini-jeu_jet-eau",this),this.isCinematic=!0,F(["mine_tuto_end"]),this.startDiscussion("mine")}tutoMissed(){B("sfx_mini-jeu_jet-eau",this),F(["mine_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("mine")}afterTuto(){this.isCinematic=!1,this.firstStep=!1,this.createRock()}startGame(){this.timeStart=Date.now(),a("mine")&&P(this),this.time.addEvent({callback:()=>this.startDiscussion("mine"),delay:1e3})}endGame(){r("Mine",this.timeStart),this.cameras.main.fadeOut(1e3,0,0,0,((e,t)=>{1===t&&(this.scene.stop(),F(["mine_after"]))}))}createRock(){const t=e.Math.Between(0,2),s=St[t],i=this.add.sprite(600,s,"mine","rock-1");i.setDepth(1+10*t);const a=this.rocks.length?e.Math.Between(0,Math.round(.9*Vt)):0;this.setRockTexture(i,a),this.rocks.push({rock:i,index:t,refined:a}),this.firstStep||this.time.addEvent({callback:()=>{this.createRock(),this.moreMaterials||this.rockValidated!==Bt||(this.moreMaterials=!0,this.updateMessage(gt("mine.moreMaterials")))},delay:this.rockValidated>Bt?Et:Rt})}gameOver(){this.isCinematic=!0,this.isGameOver=!0,B("sfx_mini-jeu_jet-eau",this),B("sfx_mini-jeu_deplacement_tuyau",this),this.rockParticles.setVisible(!1),F(["mine_game_over"]),this.startDiscussion("mine")}updateStep(){this.firstStep&&(this.rockValidated?this.tutoEnd():this.tutoMissed()),this.faster||this.rockValidated!==At||(this.faster=!0,this.speed.forEach(((e,t)=>this.speed[t]+=.6)),this.updateMessage(gt("mine.faster"))),this.fasterAgain||this.rockValidated!==Lt||(this.fasterAgain=!0,this.speed.forEach(((e,t)=>this.speed[t]+=.6)),this.updateMessage(gt("mine.fasterAgain")));const e=this.rockValidated+this.rockNotValidated,t=Math.round(100*this.rockValidated/(e||1));console.log(t+" % ("+this.rockValidated+" / "+e+")");(this.rockNotValidated>15&&1)+(this.rockNotValidated>25&&1)+(this.rockNotValidated>30&&1)+(this.rockNotValidated>35&&1)>this.warnings&&(this.warnings++,this.updateMessage(gt(2===this.warnings?"mine.lastWarning":"mine.warning")),this.updateWarnings(this.warnings),3===this.warnings)&&this.gameOver()}updateWaterDepth(){this.water.setDepth(10*this.tubeCurrentY+11)}up(){this.movingCable?this.tubeMoving=!0:this.tubeCurrentY>0&&(this.tubeCurrentY--,this.moveCable(),this.updateWaterDepth(),this.tubeMoving=!0)}down(){this.movingCable?this.tubeMoving=!0:this.tubeCurrentY<2&&(this.tubeCurrentY++,this.moveCable(),this.updateWaterDepth(),this.tubeMoving=!0)}moveCable(){this.movingCable=!0,this.tweens.add({targets:this.tubeEnd,y:Pt[this.tubeCurrentY],ease:"Sine.easeInOut",duration:300,onComplete:()=>{this.movingCable=!1}})}setRockTexture(e,t){const s=Math.floor(6*t/Vt);e.setTexture("mine","rock-"+(s||1))}whenTubeMoving(){M("sfx_mini-jeu_deplacement_tuyau",this,!1,1,!0)}stopTubeMoving(){B("sfx_mini-jeu_deplacement_tuyau",this)}update(e,t){if(!this.isGameOver){this.rockParticles.setVisible(!1),this.tubeRollings.forEach(((e,t)=>e.x=this.tubeEnd.x-22+16*t)),this.tubeMoving=!1,this.goingUp&&this.tubeEnd.y>50?this.up():this.goingDown&&this.tubeEnd.y<200&&this.down(),this.goingLeft&&this.tubeEnd.x>100?(this.tubeEnd.x-=Ft,this.tubeMoving=!0):this.goingRight&&this.tubeEnd.x<450&&(this.tubeEnd.x+=Ft,this.tubeMoving=!0),this.tubeMoving?this.whenTubeMoving():this.stopTubeMoving(),this.tube.x=this.tubeEnd.x,this.tube.y=this.tubeEnd.y-34,this.conveyor.forEach(((e,t)=>{this.conveyorPosition[t]+=this.speed[t],e.setTilePosition(this.conveyorPosition[t],0)}));for(const e in this.rocks){const t=this.rocks[e],s=t.rock;s.x-=this.speed[t.index],s.x<-20&&(this.rocks.splice(e,1),s.destroy(),t.refined<Vt&&(this.rockNotValidated++,this.updateStep())),t.refined>=Vt||s.y<this.tubeEnd.y+50+25&&s.y>this.tubeEnd.y+50-25&&this.action&&!this.rechargeWater&&s.x>this.tubeEnd.x-Nt&&s.x<this.tubeEnd.x+Nt&&(M("sfx_mini-jeu_caillou_desagrege",this,!1,1),t.refined++,this.setRockTexture(s,t.refined),this.rockParticles.setVisible(!0),this.rockParticles.setDepth(s.depth),this.rockParticles.setPosition(s.x,s.y-25),t.refined>=Vt&&(M("sfx_mini-jeu_reussite_3",this,!0),this.rockValidated++,this.updateStep()))}}}},Ut,class extends ot{constructor(){super({key:"factory"}),this.componentsLine=[],this.motherBoard=[],this.componentsLinePosition=0,this.componentValidated=0,this.isMotherboardValidated=!1,this.motherboardSpeed=.75,this.numberValidated=0,this.enableComponentsControl=!0,this.conveyorPosition=0,this.conveyorRollings=[],this.conveyorBackPosition=0,this.warnings=0,this.motherBoardComponents=[],this.firstStep=!1,this.indexSoundComponentValidated=1}preload(){super.preload(),this.load.atlas("factory","sprites/factory.png","sprites/factory.json")}create(){this.timeStart=Date.now(),super.create(),this.cameras.main.setBackgroundColor(0),this.scale.setGameSize(550,300),this.anims.create({key:"select-component-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:3,prefix:"select-"}),repeat:-1,frameRate:10}).addFrame(this.anims.generateFrameNames("factory",{start:2,end:2,prefix:"select-"})),this.anims.create({key:"water-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:2,prefix:"water-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling-fast",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:20}),this.add.image(0,234,"factory","ground").setOrigin(0,0),this.add.tileSprite(-4,-36,554,135,"factory","sol").setOrigin(0,0),this.conveyorInBack=this.add.tileSprite(0,-10,550,96,"factory","tapis").setOrigin(0,0),this.initBackMotherboard(),this.addBackHands(),this.add.tileSprite(0,0,150,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(150,0,67,99,"factory","vitre").setOrigin(0,0),this.add.tileSprite(217,0,350,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(0,99,550,135,"factory","sol").setOrigin(0,0);this.add.image(474,97,"factory","block-back"),this.conveyor=this.add.tileSprite(0,105,550,96,"factory","tapis").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0),this.add.tileSprite(45,201,550,11,"factory","rouleaubas").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0).setScale(-1,1),this.add.tileSprite(0,201,14,11,"factory","rouleaubas").setOrigin(0,0);for(let e=0;e<3;e++)this.conveyorRollings.push(this.add.sprite(8*e-3,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));for(let e=0;e<54;e++)this.conveyorRollings.push(this.add.sprite(40+8*e,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));this.add.image(510,140,"factory","block").setDepth(10),this.add.image(476,97,"factory","tube-water").setDepth(10),this.add.image(476,117,"factory","tube-water").setDepth(10),this.add.image(476,137,"factory","tube-water").setDepth(10),this.waterCleaningAnims=[];for(let e=0;e<=2;e++){const t=this.add.sprite(457,124+20*e,"factory","water-1").setDepth(10).setVisible(!1);t.anims.play("water-anim"),this.waterCleaningAnims.push(t)}this.initComponents(),this.initSelectedComponent(),this.userLeftHand=this.add.image(Dt,_t,"factory","gant").setOrigin(0,0),this.userLeftHand.scaleY=-1,this.userLeftHand.setDepth(10).setVisible(!1),this.cameras.main.fadeIn(1e3,0,0,0),h.on(k,this.listenDispatchedEvents,this),a("bypassminigame")?this.endGame():(this.createControls(),this.startGame(),T("sfx_mini-jeu_roulement_puces",this),T("sfx_mini-jeu_puce-bonne_1",this),T("sfx_mini-jeu_puce-bonne_2",this),T("sfx_mini-jeu_puce-bonne_3",this),T("sfx_mini-jeu_puce-mauvaise_2",this),T("sfx_mini-jeu_reussite_3",this),T("sfx_mini-jeu_jet-eau",this))}startGame(){a("factory")&&P(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.addEvent({callback:()=>this.startDiscussion("factory"),delay:1e3})}gameOver(){this.isCinematic=!0,this.isGameOver=!0,F(["factory_game_over"]),this.startDiscussion("factory")}endGame(){console.log("Validated",this.numberValidated),r("Factory",this.timeStart),this.cameras.main.fadeOut(1e3,0,0,0,((e,t)=>{1===t&&(this.scene.stop(),F(["factory_after"]))}))}listenDispatchedEvents(e){V(e,"factory_tuto_begin")&&this.tutoBegin()}listenUnlockedEvents(e){super.listenUnlockedEvents(e),V(e,"factory_after_tuto")&&this.afterTuto(),V(e,"factory_end")&&this.endGame()}tutoBegin(){this.isCinematic=!1,this.firstStep=!0,this.initMotherboard()}tutoMissed(){F(["factory_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("factory")}tutoEnd(){this.isCinematic=!0,F(["factory_tuto_end"]),this.startDiscussion("factory")}afterTuto(){this.isCinematic=!1,this.firstStep=!1,this.initMotherboard()}addBackHands(){this.leftHand=this.add.image(420,-10,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand,x:300,y:-100,angle:40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:200,duration:1e3}),this.rightHand=this.add.image(330,-10,"factory","gant").setOrigin(0,0),this.rightHand.scaleX=-1,this.tweens.add({targets:this.rightHand,x:350,y:-100,angle:-40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:800}),this.leftHand2=this.add.image(200,-12,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand2,x:200,y:-80,angle:30,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:250,duration:800}),this.rightHand2=this.add.image(100,-12,"factory","gant").setOrigin(0,0),this.rightHand2.scaleX=-1,this.tweens.add({targets:this.rightHand2,x:150,y:-90,angle:-25,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:900})}initComponents(){let e=0;for(const t in wt)this.componentsLine.push({name:t,tray:this.add.image(275+90*e,Ct,"factory",`tray-${t}`),image:this.add.image(275+90*e,Ct,"factory",wt[t])}),e++}getComponentsNumber(){return this.numberValidated>5?3:2}initBackMotherboard(){this.backMotherboards=[];for(let e=0;e<=5;e++)this.backMotherboards.push(this.add.image(600+100*e,30,"factory","motherboard"))}initMotherboard(){const t=-150,s=this.getComponentsNumber(),i=70/s;this.componentValidated=0,this.isMotherboardValidated=!1,this.motherBoardComponents=[],this.motherBoard=[],this.motherBoard.push(this.add.image(t,150,"factory","motherboard"));const a=[],n=Object.keys(wt);for(let c=0;c<s;c++){const t=e.Math.RND.pick(n);a.push(t),n.splice(n.indexOf(t),1)}let r=[2,1];if(s>2)if("green"===a[0])r=[1,2];else if("green"===a[1]){const e=a[2];a[2]="green",a[1]=e}let o=0,d=0;const h=[...r];a.forEach(((e,t)=>{let a;2===s?a=this.add.image(i*t-168,150,"factory",`component-position-${e}`):(0===h[o]&&(o++,d=0),r[o],a=this.add.image((i+9)*o-165,1===r[o]?150:135+(i+5)*d,"factory",`component-position-${e}`),h[o]--,d++),this.motherBoardComponents.push({name:e,component:a,validated:!1}),this.motherBoard.push(a)})),this.enableComponentsControl=!0}initSelectedComponent(){this.add.sprite(275,263,"factory","select-1").anims.play("select-component-anim")}createControls(){if(this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",(e=>{"ArrowUp"===e.key?this.handleAction():"ArrowDown"===e.key||("ArrowLeft"===e.key?this.left():"ArrowRight"===e.key?this.right():32===e.keyCode&&this.handleAction())}),this),o()){const e=80,t=225,s={fontFamily:"DefaultFont",fontSize:"32px",fill:"#ffffff"};this.add.text(70,t,"",s).setResolution(ft).setOrigin(.5,.5).setDepth(1e4),this.add.circle(70,t,30,16733508,.3).setDepth(1e4),this.add.text(275,t,"",s).setResolution(ft).setOrigin(.5,.5).setDepth(1e4),this.add.circle(275,t,30,16733508,.3).setDepth(1e4),this.add.text(480,t,"",s).setResolution(ft).setOrigin(.5,.5).setDepth(1e4),this.add.circle(480,t,30,16733508,.3).setDepth(1e4),this.input.on("pointerdown",(t=>{t.x<275-e?this.left():t.x>275+e?this.right():this.handleAction()}),this)}}handleAction(){super.handleAction(),this.currentDiscussionStatus===E.NONE&&this.setComponent()}refreshComponentsLine(){let e=0;this.componentsLine.forEach((t=>{const s=275+90*this.componentsLinePosition+90*e;t.image.x=s,t.tray.x=s,t.image.y=Ct,e++}))}right(){super.handleAction(),!this.enableComponentsControl||this.componentsLinePosition-1<-1*this.componentsLine.length+1||(M("sfx_mini-jeu_roulement_puces",this,!1,.5),this.componentsLinePosition--,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=1,this.movingHand=!0,this.userLeftHand.setX(350).setAlpha(.1).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:330,angle:-30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}left(){super.handleAction(),!this.enableComponentsControl||this.componentsLinePosition+1>0||(M("sfx_mini-jeu_roulement_puces",this,!1,.5),this.componentsLinePosition++,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=-1,this.movingHand=!0,this.userLeftHand.setX(200).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:220,angle:30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}getSelectedComponent(){return this.componentsLine[-1*this.componentsLinePosition]}getValidatedComponent(){if(!this.motherBoardComponents.length)return null;const e=this.getSelectedComponent();for(const t of this.motherBoardComponents)if(t.name===e.name&&!t.validated)return this.componentValidated++,t.validated=!0,t;return null}resetUserHand(){this.movingHand=!1,this.userLeftHand.scaleX=1,this.userLeftHand.setAlpha(.1),this.userLeftHand.setVisible(!1),this.userLeftHand.setRotation(0),this.userLeftHand.setPosition(Dt,_t)}setComponent(){if(!this.enableComponentsControl)return;this.enableComponentsControl=!1;const e=this.getSelectedComponent().image;e.setDepth(1);const t={x:e.x,y:e.y},s=this.getValidatedComponent();this.resetUserHand(),this.userLeftHand.setVisible(!0);const i=200;if(this.handAnimation&&this.handAnimation.destroy(),s){const{component:a,name:n}=s;M(`sfx_mini-jeu_puce-bonne_${this.indexSoundComponentValidated}`,this,!0,1),this.indexSoundComponentValidated++,this.indexSoundComponentValidated>3&&(this.indexSoundComponentValidated=1),this.tweens.add({targets:e,x:a.x+10,y:a.y,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=Ct,this.enableComponentsControl=!0;try{a.setTexture("factory",`component-${n}`)}catch(s){}}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:a.x,y:230,alpha:1,angle:(a.x-275)/10,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!0,this.resetUserHand()}})}else M("sfx_mini-jeu_puce-mauvaise_2",this,!0,1),this.tweens.add({targets:e,y:150,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=Ct,this.enableComponentsControl=!0}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,y:230,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!0,this.resetUserHand()}});this.componentValidated===this.getComponentsNumber()&&this.time.delayedCall(200,(()=>{this.motherBoard.length&&this.validateMotherboard()}))}validateMotherboard(){M("sfx_mini-jeu_reussite_3",this,!0,1),this.isMotherboardValidated=!0,this.numberValidated++,this.waterCleaningAnims.forEach((e=>e.setVisible(!0))),M("sfx_mini-jeu_jet-eau",this,!1,.5),A(this,this.sounds["sfx_mini-jeu_jet-eau"]),this.time.delayedCall(1e3,(()=>this.waterCleaningAnims.forEach((e=>e.setVisible(!1)))));0==this.numberValidated%4&&(this.motherboardSpeed+=.5,this.updateMessage(gt("factory.faster"))),this.firstStep||1!=this.numberValidated%5||this.updateMessage(gt("factory.welldone"))}destroyMotherboard(){for(const e of this.motherBoard)e.destroy();this.motherBoard=[]}endMotherboard(){if(this.enableComponentsControl=!1,!this.isMotherboardValidated)return this.firstStep?(this.destroyMotherboard(),void this.tutoMissed()):(this.warnings++,this.updateWarnings(this.warnings),this.updateMessage(gt("factory.error")),this.destroyMotherboard(),3===this.warnings?void this.gameOver():void this.time.delayedCall(2e3,(()=>{this.initMotherboard()})));this.firstStep?this.tutoEnd():(this.destroyMotherboard(),this.initMotherboard())}update(){if(this.conveyorBackPosition+=1,this.conveyorInBack.setTilePosition(this.conveyorBackPosition,0),this.backMotherboards.forEach((e=>{e.x--,e.x<-100&&(e.x=600)})),this.isCinematic)return;if(!this.motherBoard.length)return void this.conveyorRollings.forEach((e=>e.anims.stop()));const e=this.isMotherboardValidated?Ot:this.motherBoard[0].x<30||this.motherBoard[0].x>500?xt:this.motherboardSpeed;this.conveyorRollings.forEach((t=>t.anims.play([Ot,xt].includes(e)?"rolling-fast":"rolling",!0))),this.conveyorPosition-=e,this.conveyor.setTilePosition(this.conveyorPosition,0);for(const t of this.motherBoard)t.x+=e;this.motherBoard.length&&this.motherBoard[0].x>590&&this.endMotherboard()}},qt,class extends ot{constructor(){super({key:"recyclingCentre",physics:{matter:{debug:i(),gravity:{y:.04}}}}),this.delayBetweenObjects=1500,this.objects=[],this.containers=[],this.containersObject=null,this.validatedObjects=0,this.notValidatedObjects=0,this.conveyorPosition=0,this.selectedObject="console",this.warnings=0}preload(){super.preload(),this.load.atlas("recyclingCentre","sprites/recyclingCentre.png","sprites/recyclingCentre.json")}create(){this.timeStart=Date.now(),super.create(),this.anims.create({key:"trap-open",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:4,prefix:"trap"}),repeat:0,frameRate:10}),this.anims.create({key:"trap-close",frames:this.anims.generateFrameNames("recyclingCentre",{start:4,end:1,prefix:"trap"}),repeat:0,frameRate:10}),this.anims.create({key:"shredder-console",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-console-"}),repeat:-1,frameRate:10}),this.anims.create({key:"shredder-phone",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-phone-"}),repeat:-1,frameRate:10}),this.anims.create({key:"shredder-laptop",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-laptop-"}),repeat:-1,frameRate:10}),this.scale.setGameSize(550,300),this.matter.world.setBounds(0,-100,550,400),this.add.image(275,150,"recyclingCentre","background"),this.add.image(275,0,"recyclingCentre","track").setOrigin(.5,0),this.add.image(26,300,"recyclingCentre","water-level").setDepth(1),this.add.image(27,192,"recyclingCentre","water-tank").setDepth(1),this.add.image(524,250,"recyclingCentre","water-level").setScale(-1,1).setDepth(1),this.add.image(522,192,"recyclingCentre","water-tank").setScale(-1,1).setDepth(1),this.objectSource=this.add.sprite(275,0,"recyclingCentre","trap1").setOrigin(.5,0).setDepth(1),this.leftCable=this.add.graphics().setDepth(1),this.rightCable=this.add.graphics().setDepth(1),this.shredder=this.add.sprite(0,-65,"recyclingCentre","shredder-console-1").setOrigin(.5,0).setDepth(1),this.shredder.anims.play("shredder-console");const e=this.add.image(0,0,"recyclingCentre","shredder").setDepth(2),t=this.add.image(-50,45,"recyclingCentre","wheel").setDepth(2),s=this.add.image(50,45,"recyclingCentre","wheel").setDepth(2);this.buttonLeftTop=this.add.image(-37,0,"recyclingCentre","button-blue").setDepth(1),this.buttonLeftBottom=this.add.image(-37,22,"recyclingCentre","button-blue").setDepth(1),this.buttonRightTop=this.add.image(37,0,"recyclingCentre","button-blue").setDepth(1),this.buttonRightBottom=this.add.image(37,22,"recyclingCentre","button-blue").setDepth(1),this.currentObject=this.add.image(0,2,"recyclingCentre",this.selectedObject).setDepth(1),this.previousObject=this.add.image(0,-23,"recyclingCentre","phone-little").setAlpha(.4),this.nextObject=this.add.image(0,27,"recyclingCentre","laptop-little").setAlpha(.4),this.containersObject=this.add.container(200,252,[t,s,this.shredder,this.buttonLeftTop,this.buttonLeftBottom,this.buttonRightTop,this.buttonRightBottom,e,this.currentObject,this.previousObject,this.nextObject]),this.physics.add.existing(this.containersObject),this.containersObject.setDepth(1);const i=this.containersObject.body;i.setAllowGravity(!1),i.setMaxVelocity(200),i.setDamping(!0),i.setDrag(.01),a("bypassminigame")?this.endGame():(h.on(k,this.listenDispatchedEvents,this),this.createControls(),this.startGame(),T("sfx_mini-jeu_broyeur",this),T("sfx_mini-jeu_roulement_broyeur",this),T("sfx_mini-jeu_trappe_dechet",this),T("sfx_mini-jeu_reussite",this))}startGame(){a("recyclingCentre")&&P(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.addEvent({callback:()=>this.startDiscussion("recyclingCentre"),delay:1e3})}gameOver(){this.isCinematic=!0,this.isGameOver=!0,this.shredder.anims.stop(),F(["recycling_game_over"]),this.startDiscussion("recyclingCentre")}endGame(){r("recyclingCentre",this.timeStart),this.cameras.main.fadeOut(1e3,0,0,0,((e,t)=>{1===t&&(this.scene.stop(),F(["recycling_after"]))}))}listenDispatchedEvents(e){V(e,"recycling_tuto_begin")&&this.tutoBegin()}listenUnlockedEvents(e){super.listenUnlockedEvents(e),V(e,"recycling_after_tuto")&&this.afterTuto(),V(e,"recycling_end")&&this.endGame()}tutoBegin(){for(const e of this.objects)this.tweens.add({targets:e,alpha:0,duration:1e3,onComplete:()=>{e.destroy()}});this.objects=[],this.isCinematic=!1,this.firstStep=!0,this.time.delayedCall(1500,(()=>this.initObject()))}tutoMissed(){F(["recycling_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("recyclingCentre")}tutoEnd(){this.isCinematic=!0,F(["recycling_tuto_end"]),this.startDiscussion("recyclingCentre")}afterTuto(){this.isCinematic=!1,this.firstStep=!1,this.time.delayedCall(1500,(()=>this.initObject()))}handleAction(){super.handleAction()}getObjectNameByDirection(e){let t=dt.indexOf(this.selectedObject)+e;return t=t>dt.length-1?0:t,t=t<0?dt.length-1:t,dt[t]}setSelectedObject(e){this.selectedObject=this.getObjectNameByDirection(e),this.currentObject.setFrame(this.selectedObject),this.previousObject.setFrame(this.getObjectNameByDirection(-1)+"-little"),this.nextObject.setFrame(this.getObjectNameByDirection(1)+"-little"),M("sfx_mini-jeu_reussite",this,!0,.05),this.tweens.add({targets:this.shredder,y:-30,duration:100,onComplete:()=>{this.shredder.anims.play("shredder-"+this.selectedObject),this.tweens.add({targets:this.shredder,y:-65,duration:100})}})}right(){this.goingRight=!0}left(){this.goingLeft=!0}up(){this.isCinematic||(this.setSelectedObject(-1),this.feedbackButton(this.buttonLeftTop),this.feedbackButton(this.buttonRightTop))}down(){this.isCinematic||(this.setSelectedObject(1),this.feedbackButton(this.buttonLeftBottom),this.feedbackButton(this.buttonRightBottom))}feedbackButton(e){e.setTexture("recyclingCentre","button-red"),this.time.delayedCall(300,(()=>{e.setTexture("recyclingCentre","button-blue")}))}createDebris(e,t,s){const i=ht[s];Array(Phaser.Math.Between(20,40)).fill(0).forEach((s=>new ct(this,e,t,i)))}initObject(){if(this.isCinematic)return;const e=(this.notValidatedObjects>2&&1)+(this.objects.length>10&&1)+(this.objects.length>60&&1);if(e>this.warnings&&(this.warnings=e,this.updateWarnings(this.warnings),this.updateMessage(gt("recycling.error"))),3===e)return void this.gameOver();const t=this.firstStep?"laptop":Phaser.Math.RND.pick(dt),s=Phaser.Math.Between(150,400);if(M("sfx_mini-jeu_trappe_dechet",this,!0,1),this.isTrapAnimating||(this.isTrapAnimating=!0,this.objectSource.anims.play("trap-open",!0),this.time.delayedCall(1200,(()=>{this.objectSource.anims.play("trap-close",!0),this.isTrapAnimating=!1}))),this.tweens.add({ease:"Sine.easeInOut",targets:this.objectSource,x:s,duration:200,onComplete:()=>{const e=this.matter.add.gameObject(this.add.image(s,30,"recyclingCentre",t+"-broken"));this.objects.push(e)}}),this.firstStep)return;this.delayBetweenObjects-=10,this.delayBetweenObjects<100&&(this.delayBetweenObjects=100);const i=this.validatedObjects>10?this.delayBetweenObjects:Phaser.Math.Between(1500,2500);this.time.delayedCall(i,(()=>this.initObject())),11!==this.validatedObjects&&25!==this.validatedObjects||this.updateMessage(gt("recycling.faster"))}updateCable(){const e=this.containersObject.x;this.leftCable.clear(),this.leftCable.lineStyle(10,395793);const t=new Phaser.Math.Vector2(70,250),s=new Phaser.Math.Vector2(e-45,250),i=new Phaser.Math.Vector2((e+20)/2,300);new Phaser.Curves.QuadraticBezier(t,i,s).draw(this.leftCable);const a=this.make.graphics();a.fillRect(70,0,500,300);const n=a.createGeometryMask();this.leftCable.setMask(n),this.rightCable.clear(),this.rightCable.lineStyle(10,395793);const r=new Phaser.Math.Vector2(480,250),o=new Phaser.Math.Vector2(e+45,250),d=new Phaser.Math.Vector2((500+e)/2,300);new Phaser.Curves.QuadraticBezier(r,d,o).draw(this.rightCable);const h=this.make.graphics();h.fillRect(0,0,480,300);const c=h.createGeometryMask();this.rightCable.setMask(c)}moveContainers(e){this.containersObject.body.setAccelerationX(100*e),M("sfx_mini-jeu_roulement_broyeur",this,!1,.5)}updateContainers(){const e=this.containersObject.x;if(this.goingRight){const t=e>350?0:5;this.moveContainers(t)}else if(this.goingLeft){const t=e<200?0:5;this.moveContainers(-t)}else this.containersObject.body.setAccelerationX(0)}updateObjects(){if(!this.isCinematic)for(const e of this.objects)e.y>220?(e.setTint(7829367),this.notValidatedObjects++,this.firstStep&&this.tutoMissed()):e.y<190||e.frame.name!==this.selectedObject+"-broken"||e.x<this.containersObject.x-45||e.x>this.containersObject.x+45||(this.validatedObjects++,this.destroyObject(e),this.firstStep&&this.tutoEnd(),1===this.currentObject.scale&&this.tweens.add({targets:this.currentObject,scale:1.4,yoyo:1,duration:100}))}destroyObject(e){this.objects=this.objects.filter((t=>t!==e)),M("sfx_mini-jeu_broyeur",this,!1,1),this.createDebris(e.x,e.y,this.selectedObject),e.destroy()}update(){this.containersObject.body.setAccelerationX(0),this.updateCable(),this.isCinematic||(this.updateContainers(),this.updateObjects())}createControls(){if(this.cursors=this.input.keyboard.addKeys({space:"space",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",(e=>{"ArrowDown"===e.key?this.down():"ArrowUp"===e.key?this.up():"ArrowLeft"===e.key?this.left():"ArrowRight"===e.key?this.right():32===e.keyCode&&this.handleAction()}),this),this.input.keyboard.on("keyup",(e=>{"ArrowLeft"===e.key?this.goingLeft=!1:"ArrowRight"===e.key&&(this.goingRight=!1)}),this),o()){const e=80,t=225,s={fontFamily:"DefaultFont",fontSize:"32px",fill:"#ffffff"};this.add.text(70,t,"",s).setResolution(ft).setOrigin(.5,.5).setDepth(1e4),this.add.circle(70,t,30,16733508,.3).setDepth(1e4),this.add.text(275,t,"",s).setResolution(ft).setOrigin(.5,.5).setDepth(1e4),this.add.circle(275,t,30,16733508,.3).setDepth(1e4),this.add.text(480,t,"",s).setResolution(ft).setOrigin(.5,.5).setDepth(1e4),this.add.circle(480,t,30,16733508,.3).setDepth(1e4),this.input.on("pointerdown",(t=>{t.x<275-e?this.left():t.x>275+e?this.right():this.handleAction()}),this)}}},bt,class{constructor(){this.currentSprite=null,this.unlockedEvents=[],this.spritePosition={},h.on(u,this.startDiscussion,this),h.on(y,this.continueDiscussion,this),h.on(v,this.unlockMessages,this),h.on(w,this.saveUnlockedEvent,this)}initSpriteThreadIfNeeded(e){this.spritePosition?.[e]||(this.spritePosition[e]={currentThread:0,currentMessagePosition:0,threadRead:[]})}setCurrentThread(e,t){this.initSpriteThreadIfNeeded(e),this.spritePosition[e].currentThread=t}getCurrentThread(e){const t=e||this.currentSprite;return this.initSpriteThreadIfNeeded(t),this.spritePosition[t].currentThread}getCurrentMessage(){const e=this.getCurrentThread(),t=this.spritePosition?.[this.currentSprite]?.currentMessagePosition;if(null==e||null==t)return;const s=mt[this.currentSprite][e]?.dependingOn;if(this.isValidDependingOn(this.currentSprite,s)){if(this.spritePosition[this.currentSprite].threadRead.includes(e)){const s=mt[this.currentSprite][e]?.repeat;if(s)return s?.[t]}return mt[this.currentSprite][e]?.messages?.[t]}}startDiscussion(e){if("screen"===e.substring(0,6))return void h.emit(C,{sprite:e});this.initSpriteThreadIfNeeded(e),this.currentSprite=e;const t=this.getNextAvailableThread(e,this.getCurrentThread());console.log("startDiscussion",t),void 0!==t&&(this.setCurrentThread(e,t),this.resetMessagePosition(e)),this.resetMessagePosition(e),this.sendMessage()}resetMessagePosition(e){this.spritePosition[e].currentMessagePosition=0}getNextAvailableThread(e,t){if(!mt[e][t])return;const s=mt[e][t]?.dependingOn;return s&&this.isValidDependingOn(e,s)&&!this.spritePosition[e].threadRead.includes(t)?t:this.getNextAvailableThread(e,t+1)}continueDiscussion(){this.spritePosition[this.currentSprite].currentMessagePosition++,this.sendMessage()}sendMessage(){let e=this.getCurrentMessage();if(!e){this.endThread();const t=this.getNextAvailableThread(this.currentSprite,this.getCurrentThread());if(void 0===t)return void this.endDiscussion();this.setCurrentThread(this.currentSprite,t),this.resetMessagePosition(this.currentSprite),e=this.getCurrentMessage()}h.emit(p),h.emit(b,{sprite:this.currentSprite,message:e})}endThread(){this.spritePosition[this.currentSprite].threadRead.push(this.getCurrentThread()),this.preSaveUnlockedEvent()}endDiscussion(){h.emit(g,this.currentSprite)}preSaveUnlockedEvent(){const e=this.getCurrentThread(),t=mt[this.currentSprite][e]?.unlockEvents;this.saveUnlockedEvent(t)}saveUnlockedEvent(e){e&&(h.emit(k,{newUnlockedEvents:e}),e.filter((e=>!this.unlockedEvents.includes(e))).length&&h.emit(v,{newUnlockedEvents:e,unlockedEvents:[...e,...this.unlockedEvents]}))}isValidDependingOn(e,t){return!t||t.every((e=>"!"!==e[0]===this.unlockedEvents.includes(e)))}unlockMessages(e){for(const t in mt){this.initSpriteThreadIfNeeded(t);for(const s in mt[t]){const i=mt[t][s]?.dependingOn;if(!i)continue;const a=i.filter((e=>!this.unlockedEvents.includes(e)));a.length>0&&a.every((t=>e.newUnlockedEvents.includes(t)))&&(this.spritePosition[t].currentThread=Number(s),this.spritePosition[t].currentMessagePosition=0,this.spritePosition[this.currentSprite]?.threadRead?.includes(s)||h.emit(f,t))}}this.unlockedEvents.push(...e.newUnlockedEvents)}},zt],scale:{mode:t.Scale.FIT,autoCenter:t.Scale.CENTER_BOTH}};new t.Game(Yt);
