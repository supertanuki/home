import{P as e,p as t}from"./vendor-DdHtZxH2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s=new URLSearchParams(window.location.search);function i(){return s.has("debug")}function a(e){return s.has(e)}function n(e,t){return Number(s.get(e))||t}function r(e,t){const s=Math.round((Date.now()-t)/1e3);console.log("*** Game duration for: "+e,s)}function o(){return/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(navigator.userAgent)}class d extends e.Scene{constructor(){super("preloader"),this.progressBar=null}preload(){const e=this.cameras.main.width,t=this.cameras.main.height;this.progressBar=this.add.graphics(),this.load.on("progress",s=>{this.progressBar.clear(),this.progressBar.fillStyle(16777215,1),this.progressBar.fillRect(0,t/2,e*s,30)},this),this.load.on("complete",()=>this.progressBar.destroy(),this),this.load.image("tiles","tiles/Asset_Atlas_01.png"),this.load.tilemapTiledJSON("map","tiles/3rivers.json"),this.load.atlas("splash","sprites/splash.png","sprites/splash.json"),this.load.atlas("mai","sprites/mai.png","sprites/mai.json"),this.load.atlas("trees","sprites/trees.png","sprites/trees.json"),this.load.atlas("sprites","sprites/sprites.png","sprites/sprites.json"),o&&this.load.plugin("rexvirtualjoystickplugin","plugins/rexvirtualjoystickplugin.min.js",!0),this.load.font("DefaultFont","fonts/FreePixel.ttf")}create(){this.scene.start("game")}}const h=new e.Events.EventEmitter,l="DiscussionReady",c="DiscussionAbort",m="DiscussionStarted",u="DiscussionWaiting",p="DiscussionInProgress",g="DiscussionEnded",y="DiscussionContinuing",f="HasUnreadMessage",b="MessageSent",v="EventsUnlocked",w="EventsDispatched",k="PreEventsUnlocked",C="ScreenShutdown";let x=!1,O=!1,D=!1,_=!1,S=!1,j=!1,P=!1,A=!1;const I=function(e){if(a("nomusic")||x||e.villageTheme&&e.villageTheme.isPlaying)return;if(V(e,e.industryTheme),V(e,e.miniGameTheme),V(e,e.djangoTheme),V(e,e.nightAmbiance),V(e,e.nightmareTheme),e.villageTheme&&e.sound.get("village-theme"))return void N(e,e.villageTheme);x=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-theme","sounds/village_theme_compressed.mp3"),s.once("complete",()=>{e.villageTheme=e.sound.add("village-theme"),N(e,e.villageTheme),x=!1}),s.start()},L=function(e){if(a("nomusic")||O||e.industryTheme&&e.industryTheme.isPlaying)return;if(V(e,e.villageTheme),V(e,e.miniGameTheme),V(e,e.villageAmbianceV1),V(e,e.villageAmbianceV2),e.industryTheme&&e.sound.get("industry-theme"))return void N(e,e.industryTheme);O=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("industry-theme","sounds/industry_theme_compressed.mp3"),s.once("complete",()=>{e.industryTheme=e.sound.add("industry-theme"),O=!1,N(e,e.industryTheme)}),s.start()},T=function(e){if(a("nomusic")||D||e.miniGameTheme&&e.miniGameTheme.isPlaying)return;if(V(e,e.industryTheme),e.miniGameTheme&&e.sound.get("minigame-theme"))return void N(e,e.miniGameTheme);D=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("minigame-theme","sounds/minigame_theme_compressed.mp3"),s.once("complete",()=>{e.miniGameTheme=e.sound.add("minigame-theme"),N(e,e.miniGameTheme),D=!1}),s.start()},B=function(e){if(a("nomusic")||S||e.nightmareTheme&&e.nightmareTheme.isPlaying)return;if(V(e,e.nightAmbiance),V(e,e.industryTheme),e.nightmareTheme&&e.sound.get("nightmare-theme"))return void N(e,e.nightmareTheme);S=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("nightmare-theme","sounds/reve_theme_compressed.mp3"),s.once("complete",()=>{e.nightmareTheme=e.sound.add("nightmare-theme"),N(e,e.nightmareTheme),S=!1}),s.start()},M=function(e){e.isNoMoreBirds?F(e):R(e)},R=function(e){if(a("nomusic")||j||e.villageAmbianceV1&&e.villageAmbianceV1.isPlaying)return;if(V(e,e.industryTheme),V(e,e.villageAmbianceV2),e.villageAmbianceV1&&e.sound.get("village-ambiance-v1"))return void N(e,e.villageAmbianceV1,.3);j=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-ambiance-v1","sounds/sfx/sfx_ambiance_jour_v1.mp3"),s.once("complete",()=>{e.villageAmbianceV1=e.sound.add("village-ambiance-v1"),N(e,e.villageAmbianceV1,.3),j=!1}),s.start()},F=function(e){if(a("nomusic")||P||e.villageAmbianceV2&&e.villageAmbianceV2.isPlaying)return;if(V(e,e.villageAmbianceV1),e.villageAmbianceV2&&e.sound.get("village-ambiance-v2"))return void N(e,e.villageAmbianceV2,.6);P=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-ambiance-v2","sounds/sfx/sfx_ambiance_jour_v2.mp3"),s.once("complete",()=>{e.villageAmbianceV2=e.sound.add("village-ambiance-v2"),N(e,e.villageAmbianceV2,.6),P=!1}),s.start()},E=function(e){if(a("nomusic")||A||e.nightAmbiance&&e.nightAmbiance.isPlaying)return;if(V(e,e.industryTheme),V(e,e.miniGameTheme),V(e,e.villageTheme),V(e,e.villageAmbianceV1),V(e,e.villageAmbianceV2),e.nightAmbiance&&e.sound.get("night-ambiance"))return void N(e,e.nightAmbiance,.3);A=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("night-ambiance","sounds/sfx/sfx_ambiance_nuit_raccourci.mp3"),s.once("complete",()=>{e.nightAmbiance=e.sound.add("night-ambiance"),N(e,e.nightAmbiance,.3),A=!1}),s.start()},V=function(e,t,s=2e3){t&&t.isPlaying&&e.tweens.add({targets:t,volume:0,duration:s,ease:"Linear",onComplete:()=>{t.stop()}})},N=function(e,t,s=1){t.isPlaying||(t.volume=0,t.loop=!0,t.play(),e.tweens.add({targets:t,volume:s,duration:2e3,ease:"Linear"}))},W=function(e,s){if(!s?.sounds||s?.sounds[e])return;const i=new t.Loader.LoaderPlugin(s);i.audio(e,`sounds/sfx/${e}.mp3`),i.once("complete",()=>{s.sounds[e]=s.sound.add(e)}),i.start()},G=function(e,t,s=!1,i=1,a=!1){t?.sounds&&t.sounds[e]&&(s?t.sound.play(e,{volume:i,loop:a}):t.sounds[e].isPlaying||t.sounds[e].play({volume:i,loop:a}))},U=function(e,t){t?.sounds&&t.sounds[e]&&t.sounds[e].isPlaying&&t.sounds[e].stop()},q=20,z=70;class Y extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a){super(e,t,s,i,a),this.scene=e,this.shadow=e.add.ellipse(t,s+10,10,6,0,.1),W("sfx_bruits_de_pas",e)}setVisible(e){super.setVisible(e),this.shadow.setVisible(e)}preUpdate(e,t){super.preUpdate(e,t),this.updateShadow()}playMoveSound(){G("sfx_bruits_de_pas",this.scene,!1,.7,!0)}stopMoveSound(){U("sfx_bruits_de_pas",this.scene)}resetVelocity(){this.setVelocity(0)}goLeft(){this.setVelocityX(-80),this.scaleX=-1,this.body.offset.x=this.width}resetScaleAndOffset(){this.scaleX=1,this.body.offset.x=0}goRight(){this.setVelocityX(80),this.resetScaleAndOffset()}goUp(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?z:-70,-70):this.setVelocityY(-80),this.resetScaleAndOffset()}goDown(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?z:-70,z):this.setVelocityY(80),this.resetScaleAndOffset()}slowRight(){this.goRight(),this.setVelocity(q,0)}slowRightDown(){this.goRight(),this.setVelocity(q,q/1.5)}slowLeft(){this.goLeft(),this.setVelocity(-20,0)}slowDown(){this.goDown(),this.setVelocity(0,q)}slowUp(){this.goUp(),this.setVelocity(0,-20)}animateToLeft(){this.anims.play("mai-walk-side",!0)}animateToRight(){this.anims.play("mai-walk-side",!0)}animateToUp(){this.anims.play("mai-walk-up",!0)}animateToDown(){this.anims.play("mai-walk-down",!0)}stopAndWait(){if(this.stopMoveSound(),null===this.anims.currentAnim)return;const e=this.anims.currentAnim.key.split("-");e[1]="idle",this.anims.play(e.join("-"),!0),this.setVelocity(0,0)}updateShadow(){this.shadow&&(this.shadow.setDepth(this.depth-1),this.shadow.x=this.x,this.shadow.y=this.y+8)}}Phaser.GameObjects.GameObjectFactory.register("hero",function(e,t,s,i){const a=new Y(this.scene,e,t,"mai","idle-down-1");return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),this.displayList.add(a),this.updateList.add(a),a});const H={NONE:"NONE",READY:"READY",STARTED:"STARTED",WAITING:"WAITING",INPROGRESS:"INPROGRESS"},K=(e,t)=>e.newUnlockedEvents.includes(t),X=e=>h.emit(k,e),$=function(e){Z(e),e.night?J(e,!1):(e.night=!0,e.darkOverlay.setAlpha(0),e.darkOverlay.setVisible(!0),e.tweens.add({targets:e.darkOverlay,alpha:.3,duration:3e3,ease:"Sine.easeInOut"}),e.nightOverlays.forEach(t=>{t.setAlpha(0),t.setVisible(!0),e.tweens.add({targets:t,alpha:1,duration:3e3,ease:"Sine.easeInOut"})}))},J=function(e,t){Z(e),e.night=t,e.darkOverlay.setVisible(t),t&&e.darkOverlay.setAlpha(.3),e.maskNightOverlays.forEach(e=>e.setVisible(t)),e.nightOverlays.forEach(e=>e.setVisible(t))},Q=function(e,t){const s=e.add.graphics();s.fillStyle(85,.3),s.fillRect(0,0,2*e.scale.width,2*e.scale.height),s.setVisible(!1),s.setDepth(1e3);const i=e.make.graphics();i.fillStyle(16777215),i.fillCircle(e.scale.width,e.scale.height,t);const a=i.createGeometryMask();a.invertAlpha=!0,s.setMask(a),e.maskNightOverlays.push(i),e.nightOverlays.push(s)},Z=function(e){e.darkOverlay||(Q(e,50),Q(e,80),Q(e,100),e.darkOverlay=e.add.rectangle(e.scale.width/4,e.scale.height/4,2*e.scale.width,2*e.scale.height,85).setOrigin(.5,.5).setVisible(!1).setDepth(1e3))};class ee extends e.Physics.Arcade.Sprite{constructor(e,t,s,i,a,n,r,o){super(e,t,s,i,a),this.scene=e,this.setDepth(99),this.delta=25,this.spriteId=null,this.heroNearMe=!1,this.chatIconDeltaX=n||0,this.chatIconDeltaY=r||0,this.disabledChatIcon=o||!1,this.previousChatImageUiVisibility=!1,this.disabledChatIcon||(this.chatImageUi=e.add.sprite(t+this.chatIconDeltaX,s-13+this.chatIconDeltaY,"sprites","exclam-3").setDepth(1e3).setVisible(!0),this.chatImageUi.anims.play("exclam",!0)),h.on(l,this.readyToChat,this),h.on(f,this.hasUnreadMessage,this)}setPosition(e,t){return super.setPosition(e,t),this.updateChatIconPosition(),this}setVisible(e){if(super.setVisible(e),this.chatImageUi)return e?void(this.previousChatImageUiVisibility&&this.chatImageUi.setVisible(!0)):(this.previousChatImageUiVisibility=this.chatImageUi.visible,void this.chatImageUi.setVisible(!1))}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-this.delta&&e.x<this.x+this.delta&&e.y>this.y-this.delta&&e.y<this.y+this.delta}preUpdate(e,t){if(super.preUpdate(e,t),!this.visible)return;const s=this.isHeroNearMe();if(this.heroNearMe!==s&&(this.heroNearMe=s,this.spriteId&&h.emit(s?l:c,this.spriteId)),s){const e=this.scene.hero;this.y<e.y?this.setDepth(99):this.setDepth(101)}}stopChatting(){console.log("stopChatting",this.spriteId),this.chatImageUi&&this.chatImageUi.setVisible(!1),this.afterStopChatting&&this.afterStopChatting()}abortChatting(){console.log("abortChatting",this.spriteId),this.afterStopChatting&&this.afterStopChatting()}disableChatIcon(){this.disabledChatIcon=!0,this.chatImageUi?.setVisible(!1)}enableChatIcon(){console.log(this.spriteId,this.chatImageUi.x,this.chatImageUi.visible,this.disabledChatIcon),this.disabledChatIcon=!1,this.chatImageUi.setVisible(!0)}hasUnreadMessage(e){!this.disabledChatIcon&&this.spriteId===e&&this.chatImageUi&&(this.updateChatIconPosition(),this.chatImageUi.setVisible(!0))}updateChatIconPosition(){this.chatImageUi&&this.chatImageUi.setPosition(this.x+this.chatIconDeltaX,this.y-13+this.chatIconDeltaY)}readyToChat(e){this.spriteId===e&&(this.scene.isCinematic||this.afterReadyToChat&&this.afterReadyToChat())}setDelta(e){this.delta=0}}const te="django";class se extends ee{constructor(e,t,s){super(e,t,s,"sprites","django-1",-2,-2),this.spriteId=te,this.status="idle",e.anims.create({key:"django-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"django-"}),repeat:-1,yoyo:!0,frameRate:6}),e.anims.create({key:"django-before-strike",frames:[{key:"sprites",frame:"django-before-strike-1",duration:1200},{key:"sprites",frame:"django-before-strike-2",duration:200}],repeat:-1}),e.anims.create({key:"django-strike",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"django-strike-"}),repeat:-1,yoyo:!0,frameRate:6}),this.anims.play("django-idle",!0),this.hasUnreadMessage(this.spriteId),h.on(m,this.discussionStarted,this)}discussionStarted(e){this.spriteId===e&&"before-strike"===this.status&&this.onStrike()}afterStopChatting(){"idle"===this.status&&this.anims.play("django-idle",!0)}afterReadyToChat(){"idle"===this.status&&this.anims.stop()}beforeStrike(){this.status="before-strike",this.anims.play("django-before-strike",!0)}onStrike(){this.status="strike",this.anims.play("django-strike",!0)}setFinal(e,t){this.setPosition(e,t),this.disableChatIcon(),this.idle()}idle(){this.status="idle",this.anims.play("django-idle",!0)}}e.GameObjects.GameObjectFactory.register(te,function(t,s){const i=new se(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ie="koko";class ae extends ee{constructor(e,t,s){super(e,t,s,"sprites","koko-1",-2,-2),this.spriteId=ie,e.anims.create({key:"koko-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"koko-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"koko-"})),this.anims.play("koko-idle",!0),this.hasUnreadMessage(this.spriteId)}}e.GameObjects.GameObjectFactory.register(ie,function(t,s){const i=new ae(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ne="sleepingGuy";class re extends ee{constructor(e,t,s){super(e,t,s,"sprites","sleepingguy-1",0,0,!0),this.spriteId=ne,e.anims.create({key:"sleepingguy-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"sleepingguy-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"sleepingguy-"})),this.anims.play("sleepingguy-idle",!0)}}e.GameObjects.GameObjectFactory.register(ne,function(t,s){const i=new re(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const oe="twoWomen";class de extends ee{constructor(e,t,s){super(e,t,s,"sprites","twowomen-1",-2,-2),this.spriteId=oe,e.anims.create({key:"twowomen-idle",frames:[{key:"sprites",frame:"twowomen-1"},{key:"sprites",frame:"twowomen-2"},{key:"sprites",frame:"twowomen-3"}],repeat:-1,frameRate:2}),this.anims.play("twowomen-idle",!0)}}e.GameObjects.GameObjectFactory.register(oe,function(t,s){const i=new de(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});const he="baby";class le extends ee{constructor(e,t,s){super(e,t,s,"sprites","baby-1",0,0,!0),this.spriteId=he,e.anims.create({key:"baby-idle",frames:[{key:"sprites",frame:"baby-1"},{key:"sprites",frame:"baby-2"}],repeat:-1,frameRate:2}),this.anims.play("baby-idle",!0)}}e.GameObjects.GameObjectFactory.register(he,function(t,s){const i=new le(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ce="bino";class me extends ee{constructor(e,t,s){super(e,t,s,"sprites","bino-1"),this.spriteId=ce,this.cleaningRoadPosition={x:0,y:0},e.anims.create({key:"bino-idle",frames:[{key:"sprites",frame:"bino-1"},{key:"sprites",frame:"bino-2"},{key:"sprites",frame:"bino-3"},{key:"sprites",frame:"bino-2"}],repeat:-1,frameRate:2}),this.anims.play("bino-idle",!0),this.hasUnreadMessage(this.spriteId)}setCleaningRoadPosition(e,t){this.cleaningRoadPosition={x:e,y:t}}setCleaningRoad(){const{x:e,y:t}=this.cleaningRoadPosition;this.setPosition(e,t),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(ce,function(t,s){const i=new me(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});class ue extends ee{constructor(e,t,s){super(e,t,s,"sprites","cat-1",0,0,!0),this.spriteId="cat",this.delta=20,e.anims.create({key:"cat-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cat-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cat-"})),this.anims.play("cat-idle",!0)}}e.GameObjects.GameObjectFactory.register("cat",function(t,s){const i=new ue(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),i.scaleX=-1,i.body.offset.x=i.width,this.displayList.add(i),this.updateList.add(i),i});class pe extends ee{constructor(e,t,s){super(e,t,s,"sprites","dog-1",0,0,!0),this.spriteId="dog",this.delta=20,e.anims.create({key:"dog-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"dog-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"dog-"})),this.anims.play("dog-idle",!0)}}e.GameObjects.GameObjectFactory.register("dog",function(t,s){const i=new pe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ge="escargot";class ye extends ee{constructor(e,t,s){super(e,t,s,"sprites","escargot-1",0,0,!0),this.spriteId=ge,this.delta=15,e.anims.create({key:"escargot-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"escargot-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"escargot-"})),this.anims.play("escargot-idle",!0)}}e.GameObjects.GameObjectFactory.register(ge,function(t,s){const i=new ye(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});class fe extends ee{constructor(e,t,s){super(e,t,s,"sprites","cow-1",0,0,!0),this.spriteId="cow",this.delta=30,e.anims.create({key:"cow-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cow-"}),repeat:-1,frameRate:2}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cow-"})),this.anims.play("cow-idle",!0)}toRight(){this.scaleX=-1,this.setOffset(this.width-2,this.height/2)}}e.GameObjects.GameObjectFactory.register("cow",function(t,s){const i=new fe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const be="veal";class ve extends ee{constructor(e,t,s){super(e,t,s,"sprites","veal-1",0,0,!0),this.spriteId=be,e.anims.create({key:"veal-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"veal-"}),repeat:-1,frameRate:1}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"veal-"})),this.anims.play("veal-idle",!0)}}e.GameObjects.GameObjectFactory.register(be,function(t,s){const i=new ve(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});const we="fisherman";class ke extends ee{constructor(e,t,s){super(e,t,s,"sprites","mino-1",-11,-6),this.spriteId=we,e.anims.create({key:"mino-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:3,end:3,prefix:"mino-"})).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"mino-"})),e.anims.create({key:"mino-sad",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-sad-"}),repeat:-1,frameRate:3}),this.anims.play("mino-idle",!0)}setSad(){this.anims.play("mino-sad"),this.body.setSize(this.width,1),this.x-=12,this.chatIconDeltaX=0,this.chatIconDeltaY=-2}setOnStrike(e,t){this.setPosition(e,t),this.body.setSize(this.width,1),this.scaleX=-1,this.setOffset(this.width,this.height/2)}setFinal(e,t){this.scaleX=1,this.setOffset(0,0),this.setPosition(e,t),this.disableChatIcon(),this.anims.play("mino-idle",!0)}}e.GameObjects.GameObjectFactory.register(we,function(t,s){const i=new ke(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.setOffset(.5,.5),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const Ce="miner";class xe extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-1",0,-5),this.spriteId=Ce,this.delta=40,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-idle",defaultTextureKey:"sprites",duration:2100,repeat:-1,frames:[{frame:"miner-1",duration:2e3},{frame:"miner-2",duration:100}]}),this.anims.play("miner-idle",!0),this.hasUnreadMessage(this.spriteId)}toRight(){this.scaleX=1,this.setOffset(0,0)}unlockAccessToMine(e,t){this.setPosition(e,t),this.setSize(5,1),this.setOffset(this.width-2,this.height/2)}setPositionAfterMine(e,t){this.setPosition(e,t),this.scaleX=1,this.body.setSize(this.width+6,this.height+10)}}Phaser.GameObjects.GameObjectFactory.register(Ce,function(e,t,s,i){const a=new xe(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width+6,a.height+10),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,-5),this.displayList.add(a),this.updateList.add(a),a});class Oe extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","balloon-1"),this.scene=e,this.anims.create({key:"ball",frames:this.anims.generateFrameNames("sprites",{start:1,end:2,prefix:"balloon-"}),repeat:-1,frameRate:2}),this.anims.play("ball",!0),this.setDepth(100)}}e.GameObjects.GameObjectFactory.register("ball",function(t,s){const i=new Oe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,i.height),this.displayList.add(i),this.updateList.add(i),i});const De="girl";class _e extends ee{constructor(e,t,s){super(e,t,s,"sprites","girl-water-1",0,0,!0),this.spriteId=De,e.anims.create({key:"girl-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"girl-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"girl-water-"})),e.anims.create({key:"girl-sad",frames:[{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-2"}],repeat:-1,frameRate:3}),this.anims.play("girl-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.setPosition(this.sadPosition.x,this.sadPosition.y),this.anims.play("girl-sad")}setThirdAct(e,t){this.disabledChatIcon=!1,this.setPosition(e,t),this.body.setSize(this.width,1),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(De,function(t,s){const i=new _e(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,i.height+10),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});class Se extends ee{constructor(e,t,s){super(e,t,s,"sprites","boy-water-1",10,0,!0),this.spriteId="boy",this.delta=40,this.scene=e,e.anims.create({key:"boy-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"boy-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"boy-water-"})),e.anims.create({key:"boy-sad",frames:[{key:"sprites",frame:"boy-sad-1"},{key:"sprites",frame:"boy-sad-1"},{key:"sprites",frame:"boy-sad-2"}],repeat:-1,frameRate:3}),this.anims.play("boy-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.chatIconDeltaX=0,this.setPosition(this.sadPosition.x,this.sadPosition.y),this.anims.play("boy-sad"),this.body.setSize(this.width+8,this.height+18),this.body.setOffset(-7,0)}setThirdAct(e,t){this.setPosition(e,t),this.body.setSize(this.width,1)}}e.GameObjects.GameObjectFactory.register("boy",function(t,s){const i=new Se(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+18,i.height+20),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const je="twoGuys";class Pe extends ee{constructor(e,t,s){super(e,t,s,"sprites","twoguys-1"),this.spriteId=je,e.anims.create({key:"twoguys-idle",frames:[{key:"sprites",frame:"twoguys-1",duration:1e3},{key:"sprites",frame:"twoguys-2",duration:1e3},{key:"sprites",frame:"twoguys-3",duration:10}],repeat:-1,duration:2010}),this.anims.play("twoguys-idle",!0)}}e.GameObjects.GameObjectFactory.register(je,function(t,s){const i=new Pe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});class Ae extends ee{constructor(e,t,s){super(e,t,s,"sprites","bike",0,0,!0)}}e.GameObjects.GameObjectFactory.register("bike",function(t,s){const i=new Ae(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});class Ie extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","deer-1"),e.anims.create({key:"deer",frames:[{key:"sprites",frame:"deer-3",duration:1e3},{key:"sprites",frame:"deer-2",duration:500},{key:"sprites",frame:"deer-1",duration:1e3},{key:"sprites",frame:"deer-2",duration:200},{key:"sprites",frame:"deer-3",duration:200},{key:"sprites",frame:"deer-4",duration:200},{key:"sprites",frame:"deer-5",duration:2e3}],repeat:-1,yoyo:!0}),this.anims.play("deer"),this.depth=99}}e.GameObjects.GameObjectFactory.register("deer",function(e,t){const s=new Ie(this.scene,e,t);return this.displayList.add(s),this.updateList.add(s),s});class Le extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","owl-1"),e.anims.create({key:"owl",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"owl-"}),repeat:-1,yoyo:!0,frameRate:1}),this.anims.play("owl"),this.depth=1e3}}e.GameObjects.GameObjectFactory.register("owl",function(e,t){const s=new Le(this.scene,e,t);return this.displayList.add(s),this.updateList.add(s),s});const Te=()=>Math.random()<.5?-1:1,Be=["blue","purple","yellow"],Me="waiting",Re="flying",Fe="outOfScreen",Ee=()=>e.Math.Between(1,3);class Ve extends e.Physics.Arcade.Sprite{constructor(t,s,i){super(t,s,i,null,null),this.color=e.Math.RND.pick(Be),this.scene=t,this.idleId=Ee(),this.birdDirection=Te(),this.scaleX=this.birdDirection,this.status=Me,this.initialX=s,this.initialY=i}create(){this.reset()}isWaiting(){return this.status===Me}isFlying(){return this.status===Re}isOutOfScreen(){return this.status===Fe}setOffsetDependingOnDirection(){this.setOffset(-1===this.scaleX?30:-20,-15)}fly(){this.isFlying()||(G("sfx_oiseaux_volent",this.scene,!0,e.Math.Between(8,10)/10),this.status=Re,this.body.checkCollision.none=!0,this.birdDirection=this.scene.goingRight?1:-1,this.scaleX=-1*this.birdDirection,this.setOffsetDependingOnDirection(),this.anims.play(`bird-${this.color}-flying`,!0))}reset(){this.status=Me,this.setVisible(!0),this.x=this.initialX,this.y=this.initialY,this.body.checkCollision.none=!1,this.birdDirection=Te(),this.scaleX=this.birdDirection,this.setOffsetDependingOnDirection(),this.idleId=Ee(),this.anims.play(`bird-${this.color}-idle-anim-${this.idleId}`,!0)}hide(){this.setVisible(!1),this.setActive(!1)}show(){this.setVisible(!0),this.setActive(!0)}outOfScreen(){this.anims.stop(),this.status=Fe,this.setVelocity(0,0),this.setVisible(!1)}preUpdate(e,t){if(super.preUpdate(e,t),this.active){if(this.isOutOfScreen()){const e=this.scene.cameras.main,t=this.scene.hero;return void((this.initialX<t.x-e.width/2||this.initialX>t.x+e.width/2||this.initialY<t.y-e.height/2||this.initialY>t.y+e.height/2)&&this.reset())}if(this.isWaiting())return this.setVelocity(0,0),void this.anims.play(`bird-${this.color}-idle-anim-${this.idleId}`,!0);if(this.isFlying()){this.anims.play(`bird-${this.color}-flying`,!0),this.setVelocity(120*this.birdDirection,-50);const e=this.scene.cameras.main.worldView;return void((this.x>e.x+e.width||this.x<e.x||this.y>e.y+e.height||this.y<e.y)&&this.outOfScreen())}}}}e.GameObjects.GameObjectFactory.register("bird",function(t,s){const i=new Ve(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(50,50),i.setOffsetDependingOnDirection(),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});const Ne=function(e){const t=e.anims;Be.forEach(e=>{t.create({key:`bird-${e}-idle-anim-1`,frames:t.generateFrameNames("sprites",{start:1,end:4,prefix:`bird-${e}-idle-`}),repeat:-1,frameRate:1}).addFrame(t.generateFrameNames("sprites",{start:3,end:2,prefix:`bird-${e}-idle-`})),t.create({key:`bird-${e}-idle-anim-2`,frames:[{key:"sprites",frame:`bird-${e}-idle-2`},{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-4`},{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-2`}],repeat:-1,frameRate:2}),t.create({key:`bird-${e}-idle-anim-3`,frames:[{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-4`},{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-2`},{key:"sprites",frame:`bird-${e}-idle-1`}],repeat:-1,frameRate:3}),t.create({key:`bird-${e}-flying`,frames:t.generateFrameNames("sprites",{start:1,end:3,prefix:`bird-${e}-flying-`}),repeat:-1,frameRate:10})})};class We extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","butterfly-1"),this.scene=e,this.initialPosition={x:t,y:s},this.scaleX=Te(),this.anims.play("butterfly-anim"),this.stepX=0,this.stepY=0}preUpdate(t,s){super.preUpdate(t,s),1===e.Math.Between(1,10)&&(this.stepX=e.Math.Between(0,2)/10*Te(),this.stepY=e.Math.Between(0,2)/10*Te()),(this.x-this.stepX>this.initialPosition.x+20||this.x-this.stepX<this.initialPosition.x-20)&&(this.stepX=0),(this.y-this.stepY>this.initialPosition.y+20||this.y-this.stepY<this.initialPosition.y-20)&&(this.stepY=0),this.x-=this.stepX,this.y-=this.stepY}}e.GameObjects.GameObjectFactory.register("butterfly",function(t,s){const i=new We(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),this.displayList.add(i),this.updateList.add(i),i});const Ge=function(e){if(!e.isCinematic)return e.currentDiscussionStatus===H.WAITING?(e.currentDiscussionStatus=H.STARTED,void h.emit(y)):e.currentDiscussionStatus===H.READY?(e.currentDiscussionStatus=H.STARTED,void h.emit(m,e.currentDiscussionSprite)):void 0},Ue=function(e,t,s=!1,i=!1){[e.koko,e.sleepingGuy,e.twoGuys,e.baby,e.twoWomen,e.bino,e.fisherman,e.dog,e.escargot,e.cat,e.boy,e.girl,e.ball,...s?[e.django]:[],...i?[e.miner,e?.minerChief,e?.minerDirty2,e?.minerDirty3,e?.minerDirty4]:[]].forEach(e=>{e&&(e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t)}),e.isNoMoreBirds||(e.birds.forEach(e=>{e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t}),e.butterflies.forEach(e=>{e.setVisible(t),e.setActive(t)}))},qe="blueWorkerChief";class ze extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","blue-worker-chief-1",0,-5),this.spriteId=qe,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"blue-worker-chief-idle",frames:[{key:"sprites",frame:"blue-worker-chief-1",duration:300},{key:"sprites",frame:"blue-worker-chief-2",duration:300},{key:"sprites",frame:"blue-worker-chief-3",duration:100}],repeat:-1,duration:2e3}),this.anims.play("blue-worker-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(qe,function(e,t,s,i){const a=new ze(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.setOffset(0,a.height/2),this.displayList.add(a),this.updateList.add(a),a});class Ye extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","blue-worker-1",0,0,!0)}setSpriteNumber(e){this.spriteId=`blueWorker${e}`,this.anims.play(`blue-worker-idle-${e}`,!0)}}Phaser.GameObjects.GameObjectFactory.register("blueWorker",function(e,t,s,i,a){const n=new Ye(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n});class He extends e.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,"sprites","screen-off-1"),this.scene=e,this.setDepth(99),this.delta=20,this.spriteId="screen"+i,this.heroBehindMe=!1,this.previousChatImageUiVisibility=!1,this.isShutDown=!1,this.isShutDownable=!1,h.on(C,this.screenShutdown,this),this.anims.play("ads",!0),W("sfx_extinction_ecrans",e)}isHeroBehindMe(){const e=this.scene.hero;return e.x>this.x-10&&e.x<this.x+10&&e.y>this.y-20&&e.y<this.y-15}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-this.delta&&e.x<this.x+this.delta&&e.y>this.y-this.delta&&e.y<this.y+this.delta}preUpdate(e,t){if(super.preUpdate(e,t),this.isShutDownable){const e=this.isHeroBehindMe();this.heroBehindMe!==e&&(this.heroBehindMe=e,this.spriteId&&!this.isShutDown&&h.emit(e?l:c,this.spriteId))}this.isHeroNearMe()&&this.setDepth(this.y<this.scene.hero.y?99:this.scene.hero.depth+1)}enableShutdown(){this.isShutDownable=!0}screenShutdown(e){this.spriteId===e.sprite&&(this.scene.time.delayedCall(200,()=>h.emit(g,e.sprite)),this.isShutDown=!0,this.setVisible(!0),this.anims.play("screen-off",!0),G("sfx_extinction_ecrans",this.scene,!0,.5))}shutdown(){this.isShutDown=!0,this.setVisible(!0),this.anims.stop(),this.setTexture("sprites","screen-off-3")}}e.GameObjects.GameObjectFactory.register("screen",function(t,s,i){const a=new He(this.scene,t,s,i);return this.scene.physics.world.enableBody(a,e.Physics.Arcade.DYNAMIC_BODY),a.setImmovable(!0),this.displayList.add(a),this.updateList.add(a),a});const Ke=function(e){console.log("setVillageForThirdAct"),J(e,!1),Ue(e,!0,!0),Xe(e),e.ball.destroy(),e.ball=null,e.time.delayedCall(1,()=>{!function(e){e.isNoMoreBirds=!0,e.birds.forEach(e=>e.hide())}(e),function(e){e.butterflies.forEach(e=>e.destroy()),e.butterflies=[]}(e),I(e),M(e)}),e.cameras.main.setBounds(470,0,1674,e.map.heightInPixels-8),e.obstacleBridgeLayer.setCollisionByProperty({collide:!1}),e.obstacleBridgeLayer.destroy(),e.obstacleBridgeLayerCollider.destroy(),e.landRecyclingLayer=e.map.createLayer("landRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.bottomRecyclingLayer=e.map.createLayer("bottomRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.riverLessWaterRecyclingLayer=e.map.createLayer("riverLessWaterRecycling",e.tileset).setDepth(69).setCollisionByProperty({collide:!0}),e.riverRecyclingPollutedLayer=e.map.createLayer("riverRecyclingPolluted",e.tileset).setDepth(70),e.topRecyclingLayer=e.map.createLayer("topRecycling",e.tileset).setDepth(119).setCollisionByProperty({collide:!0}),e.topRecyclingCollider=e.physics.add.collider(e.hero,e.topRecyclingLayer),e.topRecyclingObjectsLayer=e.map.createLayer("topRecyclingObjects",e.tileset).setDepth(119).setCollisionByProperty({collide:!0}),e.obstacleRecyclingLayer.setCollisionByProperty({collide:!1}),e.obstacleRecyclingCollider.destroy(),function(e){e.anims.create({key:"blue-worker-idle-1",frames:[{key:"sprites",frame:"blue-worker-1"},{key:"sprites",frame:"blue-worker-2"}],repeat:-1,frameRate:2}),e.anims.create({key:"blue-worker-idle-2",frames:[{key:"sprites",frame:"blue-worker-2"},{key:"sprites",frame:"blue-worker-1"}],repeat:-1,frameRate:3})}(e);for(const t of e.map.getObjectLayer("sprites").objects)"boyThirdAct"===t.name&&e.boy.setThirdAct(t.x,t.y),"girlThirdAct"===t.name&&e.girl.setThirdAct(t.x,t.y),"babyThirdAct"===t.name&&e.baby.setPosition(t.x,t.y),"afterFactoryWhiteWorker1"===t.name&&(e.whiteWorker1.setPosition(t.x,t.y),e.whiteWorker1.scaleX=1,e.whiteWorker1.setOffset(0,e.whiteWorker1.height/2),e.whiteWorker1.setVisible(!0),e.whiteWorker1.disableChatIcon()),"afterFactoryWhiteWorker2"===t.name&&(e.whiteWorker2.setPosition(t.x,t.y),e.whiteWorker2.setVisible(!0),e.whiteWorker2.disableChatIcon()),"twoGuysRecycling"===t.name&&e.twoGuys.setPosition(t.x,t.y),"blueWorkerChief"===t.name&&(e.blueWorkerChief=e.add.blueWorkerChief(t.x,t.y),e.blueWorkerChief.on("pointerdown",()=>Ge(e),e),e.physics.add.collider(e.blueWorkerChief,e.hero,()=>{h.emit(l,"blueWorkerChief")})),"blueWorker1"===t.name&&(e.blueWorker1=e.add.blueWorker(t.x,t.y,null,null,1),e.blueWorker1.on("pointerdown",()=>Ge(e),e),e.physics.add.collider(e.blueWorker1,e.hero,()=>{h.emit(l,"blueWorker1")})),"blueWorker2"===t.name&&(e.blueWorker2=e.add.blueWorker(t.x,t.y,null,null,2),e.blueWorker2.on("pointerdown",()=>Ge(e),e),e.physics.add.collider(e.blueWorker2,e.hero,()=>{h.emit(l,"blueWorker2")}))},Xe=function(e){if(e.anims.create({key:"screen-off",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"screen-off-"}),repeat:0,frameRate:10}),e.anims.create({key:"ads",frames:e.anims.generateFrameNames("sprites",{start:1,end:13,prefix:"ads-"}),repeat:-1,frameRate:2}),!e.screens){e.screens=e.map.createLayer("screens",e.tileset).setDepth(49).setVisible(!1);let t=1;e.screens.forEachTile(s=>{!0===s.properties?.screen&&(e.pointsCollider.push(e.physics.add.sprite(s.getCenterX()+1,s.getCenterY()-8,null).setSize(18,1).setImmovable(!0).setVisible(!1)),e.screenOffSprites.push(e.add.screen(s.getCenterX()+1,s.getCenterY()-3,t)),t++)}),e.screensTop=e.map.createLayer("screensTop",e.tileset).setDepth(149).setVisible(!1)}const t=!e.screens.visible;e.screensTop.setVisible(t),e.screens.setVisible(t)};class $e extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","white-worker-1",0,-5,!0)}setSpriteNumber(e){this.spriteId=`whiteWorker${e}`,this.anims.play(`white-worker-idle-${e}`,!0),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register("whiteWorker",function(e,t,s,i,a){const n=new $e(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n});const Je="whiteWorkerChief";class Qe extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","white-worker-chief-1",0,-5),this.spriteId=Je,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"white-worker-chief-idle",frames:[{key:"sprites",frame:"white-worker-chief-1",duration:300},{key:"sprites",frame:"white-worker-chief-2",duration:300},{key:"sprites",frame:"white-worker-chief-3",duration:100}],repeat:-1,duration:2e3}),this.anims.play("white-worker-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(Je,function(e,t,s,i){const a=new Qe(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.setOffset(0,a.height/2),this.displayList.add(a),this.updateList.add(a),a});const Ze=function(e){e.mineBackgground1=e.add.image(0,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.mineBackgground2=e.add.image(400,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.mineMount=e.add.image(180,100,"mineLand","mine-mount").setOrigin(0,0).setScrollFactor(.1,.25),e.mineMine=e.add.image(340,124,"mineLand","mine").setOrigin(0,0).setScrollFactor(.18,.32),e.mineMachine=e.add.image(1692,240,"mineLand","mine-machine").setOrigin(0,0).setScrollFactor(.7,.7)},et=function(e){e.roads||(e.roadsBottom=e.map.createLayer("roadsBottom",e.tileset).setDepth(69).setVisible(!1),e.roads=e.map.createLayer("roads",e.tileset).setDepth(70).setVisible(!1),e.roadsTop=e.map.createLayer("roadsTop",e.tileset).setDepth(97).setVisible(!1),e.carsBottom=e.map.createLayer("carsBottom",e.tileset).setDepth(98).setVisible(!1),e.carsTop=e.map.createLayer("carsTop",e.tileset).setCollisionByProperty({collide:!0}).setDepth(120).setVisible(!1),e.carsTop.forEachTile(t=>{!0===t.properties?.pointCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(10,1).setImmovable(!0).setVisible(!1))}),e.carsTopCollider=e.physics.add.collider(e.hero,e.carsTop),e.carsBottomCollides=[],e.carsTop.forEachTile(t=>{!0===t.properties?.bottomCollide&&e.carsBottomCollides.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.carsBottomCollider=e.physics.add.collider(e.hero,e.carsBottomCollides));const t=e.roads.visible;e.roads.setVisible(!t),e.roadsBottom.setVisible(!t),e.roadsTop.setVisible(!t),e.carsTop.setVisible(!t),e.carsBottom.setVisible(!t),e.bridgesShadow.setVisible(t),e.bridges.setVisible(t),e.bridgesTop.setVisible(t)},tt=function(e,t){const s=t.map.getObjectLayer(e);s.objects.sort((e,t)=>e.y-t.y),s.objects.forEach(e=>{const s=t.add.image(e.x,e.y-8,"trees",`${e.name}-base`).setDepth(90).setOrigin(.5,1),i=t.physics.add.sprite(e.x,e.y-24,"trees",`${e.name}-1`).setOrigin(.5,1).setImmovable(!0).setDepth(130);i.anims.play(e.name);const a=t.physics.add.sprite(e.x,e.y-10,null).setSize(8,1).setOrigin(.5,1).setImmovable(!0).setVisible(!1);e.x>1097&&e.x<1336&&e.y>1e3&&e.y<1220?(t.treesOfDc.push({treeBase:s,treeTop:i}),t.treesOfDcCollider.push(a)):t.pointsCollider.push(a)})},st=function(e){e.cameras.main.setBounds(0,0,2144,e.map.heightInPixels-8),e.hero.stopAndWait(),e.isCinematic=!0,$(e),function(e){e.mineBackgground1&&(e.mineBackgground1.destroy(),e.mineBackgground2.destroy(),e.mineMount.destroy(),e.mineMine.destroy(),e.mineMachine.destroy())}(e),et(e),function(e){e.riverLessWater||(e.riverLessWater=e.map.createLayer("riverLessWater",e.tileset).setDepth(40).setVisible(!1));const t=!e.riverLessWater.visible;e.riverLessWater.setVisible(t)}(e),function(e){e.bikes.forEach(e=>{e.setVisible(!1),e.body.checkCollision.none=!0})}(e),function(e){e.potagerBottom.setVisible(!1),e.potagerTop.setVisible(!1),e.potagerCollider.destroy(),e.cow.setVisible(!1),e.cow.setActive(!1),e.cow.body.checkCollision.none=!0,e.cowHidden.setVisible(!1),e.cowHidden.setActive(!1),e.cowHidden.body.checkCollision.none=!0,e.veal.setVisible(!1),e.veal.setActive(!1),e.veal.body.checkCollision.none=!0}(e),e.bino.setCleaningRoad(),Ue(e,!0,!0,!0),function(e){e.birds.forEach((t,s)=>{Phaser.Math.Between(0,1)&&(e.birds.splice(s,1),t.destroy())})}(e),function(e){e.butterflies.forEach((t,s)=>{Phaser.Math.Between(0,1)&&(e.butterflies.splice(s,1),t.destroy())})}(e),e.deer.setVisible(!1),e.owl.destroy(),e.obstacleBridgeLayer=e.map.createLayer("obstacleBridge",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleBridgeLayerCollider=e.physics.add.collider(e.hero,e.obstacleBridgeLayer),e.obstaclesFactoryLayer.setCollisionByProperty({collide:!1}),e.obstaclesFactoryCollider.destroy(),tt("treesLimitForest",e),e.obstaclesForestLayer=e.map.createLayer("obstaclesForest",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.physics.add.collider(e.hero,e.obstaclesForestLayer),function(e){e.anims.create({key:"white-worker-idle-1",frames:[{key:"sprites",frame:"white-worker-1"},{key:"sprites",frame:"white-worker-2"}],repeat:-1,frameRate:2}),e.anims.create({key:"white-worker-idle-2",frames:[{key:"sprites",frame:"white-worker-2"},{key:"sprites",frame:"white-worker-1"}],repeat:-1,frameRate:3}),e.anims.create({key:"white-worker-idle-3",frames:[{key:"sprites",frame:"white-worker-1"},{key:"sprites",frame:"white-worker-1"},{key:"sprites",frame:"white-worker-2"}],repeat:-1,frameRate:4})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterMine"===t.name&&(e.miner.setPositionAfterMine(t.x,t.y),e.miner.disableChatIcon()),"minoAfterMine"===t.name&&e.fisherman.setPosition(t.x,t.y);for(let s=2;s<=4;s++)if(t.name===`afterMineMiner${s}`){const i=e[`minerDirty${s}`];i.setPosition(t.x,t.y),i.disableChatIcon(),i.scaleX=1}"whiteWorkerChief"===t.name&&(e.whiteWorkerChief=e.add.whiteWorkerChief(t.x,t.y),e.whiteWorkerChief.on("pointerdown",()=>Ge(e),e),e.physics.add.collider(e.whiteWorkerChief,e.hero,()=>{h.emit(l,"whiteWorkerChief")})),"boyFactory"===t.name&&e.boy.setPosition(t.x,t.y),"girlFactory"===t.name&&e.girl.setPosition(t.x,t.y);for(let s=1;s<=2;s++)t.name===`whiteWorker${s}`&&(e[`whiteWorker${s}`]=e.add.whiteWorker(t.x,t.y,null,null,s),e[`whiteWorker${s}`].on("pointerdown",()=>Ge(e),e),e.physics.add.collider(e[`whiteWorker${s}`],e.hero,()=>{h.emit(l,`whiteWorker${s}`)}))}},it="dcWorkerChief";class at extends ee{constructor(e,t,s){super(e,t,s,"sprites","miner-1",0,-5),this.spriteId=it,this.delta=40,this.anims.play("miner-idle",!0),this.hasUnreadMessage(it)}}Phaser.GameObjects.GameObjectFactory.register(it,function(e,t){const s=new at(this.scene,e,t);return this.scene.physics.world.enableBody(s,Phaser.Physics.Arcade.DYNAMIC_BODY),s.body.setSize(s.width+2,1),s.setImmovable(!0),s.setInteractive(),this.displayList.add(s),this.updateList.add(s),s});const nt=function(e){e.cameras.main.setBounds(660,400,1484,e.map.heightInPixels-408),console.log("setVillageForFourthAct"),J(e,!1),Ue(e,!0,!0),e.screenOffSprites.forEach(e=>e.enableShutdown()),e.dcBottomLayer=e.map.createLayer("dcBottom",e.tileset).setDepth(120).setCullPadding(2,2),e.dcBarriersFrontLayer=e.map.createLayer("dcBarriersFront",e.tileset).setDepth(120).setCullPadding(2,2),e.dcBarriersSideLayer=e.map.createLayer("dcBarriersSide",e.tileset).setDepth(120).setCullPadding(2,2),e.obstacleDcLayer=e.map.createLayer("obstacleDc",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleDcLayerCollider=e.physics.add.collider(e.hero,e.obstacleDcLayer);for(const t of e.map.getObjectLayer("sprites").objects)if("afterRecyclingBlueWorker1"===t.name&&(e.blueWorker1.setPosition(t.x,t.y),e.blueWorker1.setVisible(!0)),"afterRecyclingBlueWorker2"===t.name&&(e.blueWorker2.setPosition(t.x,t.y),e.blueWorker2.setVisible(!0)),"twoGuysAfterRecycling"===t.name&&e.twoGuys.setPosition(t.x,t.y),"dcWorker"===t.name.substring(0,8))for(let s=1;s<=4;s++){const i=`dcWorker${s}`;t.name===i&&(1!==s?(e[i]=e.add.minerDirty(t.x,t.y,null,null,s),e[i].disableChatIcon(),e[i].setDepth(1e3)):(e.dcWorkerChief=e.add.dcWorkerChief(t.x,t.y),e.dcWorkerChief.on("pointerdown",()=>Ge(e),this),e.dcWorkerChiefCollider=e.physics.add.collider(e.dcWorkerChief,e.hero,()=>{h.emit(l,"dcWorkerChief")})))}e.treesOfDc.forEach(e=>{e.treeBase.destroy(),e.treeTop.destroy()}),e.treesOfDcCollider.forEach(e=>e.destroy())},rt=function(e,s=!1){e.cameras.main.setBounds(470,400,1674,e.map.heightInPixels-408),e.checkDjangoDoor=!1,e.datacentreThemeEnabled=!1,function(e){e.bikes.forEach(e=>{e.setVisible(!0),e.body.checkCollision.none=!1})}(e),function(e){e.isNoMoreBirds=!1,e.birds.forEach(e=>e.show())}(e),e.obstacleDcLayer.destroy(),e.obstacleDcLayerCollider.destroy(),e.carsTopCollider.destroy(),e.roads.destroy(),e.roadsTop.destroy(),e.carsTop.destroy(),e.carsBottom.destroy(),e.carsBottomCollides.forEach(e=>e.destroy()),e.carsBottomCollider.destroy(),e.dcBottomLayer.destroy(),e.dcBarriersFrontLayer.destroy(),e.dcBarriersSideLayer.destroy(),e.obstacleDcLayer.destroy(),e.potagerBottom.setVisible(!0),e.potagerTop.setVisible(!0),e.physics.add.collider(e.hero,e.potagerTop),e.riverPolluted.destroy(),e.landUpRiverPolluted.destroy(),e.bridgesShadowPolluted.destroy();const i=e.map.createLayer("riverFinal",e.tileset).setCollisionByProperty({collide:!0}).setDepth(45);e.physics.add.collider(e.hero,i),e.map.createLayer("riverFinalTop",e.tileset).setDepth(45),e.topRecyclingCollider.destroy(),e.topRecyclingLayer.destroy(),e.topRecyclingObjectsLayer.destroy(),e.landRecyclingLayer.destroy(),e.bottomRecyclingLayer.destroy(),e.riverRecyclingPollutedLayer.destroy(),e.screens.destroy(),e.screensTop.destroy(),e.screenOffSprites.forEach(e=>e.destroy()),e.map.createLayer("screensDamaged",e.tileset).setDepth(49),e.map.createLayer("screensDamagedTop",e.tileset).setDepth(149),e.map.createLayer("carsDamagedBottom",e.tileset).setDepth(98),e.obstacleRecyclingLayer.setCollisionByProperty({collide:!0}),e.obstacleRecyclingCollider=e.physics.add.collider(e.hero,e.obstacleRecyclingLayer),e.obstaclesFactoryLayer.setCollisionByProperty({collide:!0}),e.obstaclesFactoryCollider=e.physics.add.collider(e.hero,e.obstaclesFactoryLayer);e.map.createLayer("carsDamagedTop",e.tileset).setDepth(120).forEachTile(t=>{!0===t.properties?.bottomCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.map.createLayer("roadsDamaged",e.tileset).setDepth(96),e.dcWorkerChief.disableChatIcon(),e.dcWorkerChief.destroy();for(let t=2;t<=4;t++){const s=`dcWorker${t}`;e[s].disableChatIcon(),e[s].destroy()}e.miner.destroy();for(let t=2;t<=4;t++)e[`minerDirty${t}`].destroy();if(e.whiteWorker1.destroy(),e.whiteWorker2.destroy(),e.whiteWorkerChief.destroy(),e.blueWorker1.destroy(),e.blueWorker2.destroy(),e.baby.disableChatIcon(),e.baby.destroy(),e.map.getObjectLayer("sprites").objects.forEach(t=>{"binoFinal"===t.name&&e.bino.setPosition(t.x,t.y).disableChatIcon(),"minoFinal"===t.name&&e.fisherman.setFinal(t.x,t.y),"kokoFinal"===t.name&&e.koko.setPosition(t.x,t.y).disableChatIcon(),"nonoFinal"===t.name&&e.nono.setPosition(t.x,t.y).disableChatIcon(),"djangoFinal"===t.name&&e.django.setFinal(t.x,t.y),"girlFinal"===t.name&&e.girl.setPosition(t.x,t.y).disableChatIcon(),"boyFinal"===t.name&&e.boy.setPosition(t.x,t.y).disableChatIcon(),"dogFinal"===t.name&&e.dog.setPosition(t.x,t.y),"catFinal"===t.name&&e.cat.setPosition(t.x,t.y),"twoGuysFinal"===t.name&&(e.twoGuys.setPosition(t.x,t.y),e.twoGuys.enableChatIcon()),"twoWomenFinal"===t.name&&(e.twoWomen.setPosition(t.x,t.y),e.twoWomen.enableChatIcon()),"deerFinal"===t.name&&e.deer.setPosition(t.x,t.y).setVisible(!0),"cowFinal"===t.name&&(e.cow.setPosition(t.x,t.y),e.cow.setVisible(!0),e.cow.setActive(!0),e.cow.toRight(),e.cow.body.checkCollision.none=!1),"cowHiddenFinal"===t.name&&(e.cowHidden.setPosition(t.x,t.y),e.cowHidden.setVisible(!0),e.cowHidden.setActive(!0),e.cowHidden.body.checkCollision.none=!1),"vealFinal"===t.name&&(e.veal.setPosition(t.x,t.y),e.veal.setVisible(!0),e.veal.setActive(!0),e.veal.body.checkCollision.none=!1),"sleepingGuyFinal"===t.name&&e.sleepingGuy.setPosition(t.x,t.y)}),h.on(v,t=>{K(t,"django_final_end")&&e.time.delayedCall(200,()=>{h.emit(l,"bino"),Ge(e)})}),s)return;const n=()=>{e.heroPositions.heroDjangoDoor;e.hero.x>e.django.x-130&&e.hero.y>e.django.y-130&&e.hero.y<e.django.y+130&&(e.events.off("update",n),X(["django_final"]),e.isFinal=!0,function(e){if(a("nomusic")||_||e.djangoTheme&&e.djangoTheme.isPlaying)return;if(V(e,e.villageTheme),e.djangoTheme&&e.sound.get("django-theme"))return void N(e,e.djangoTheme);_=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("django-theme","sounds/django_theme.mp3"),s.once("complete",()=>{e.djangoTheme=e.sound.add("django-theme"),N(e,e.djangoTheme),_=!1}),s.start()}(e),e.isCinematic=!0,e.cameras.main.fadeOut(500,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroDjangoFinal"),e.hero.slowUp(),e.hero.animateToUp(),e.cameras.main.fadeIn(500,0,0,0,(t,s)=>{1===s&&(e.isCinematic=!1,h.emit(l,"django"),Ge(e))}))}))};e.events.on("update",n)},ot="nono";class dt extends ee{constructor(e,t,s){super(e,t,s,"sprites","nono-1",-2,-2),this.spriteId=ot,e.anims.create({key:"nono-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"nono-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"nono-"})),this.anims.play("nono-idle",!0),this.hasUnreadMessage(this.spriteId),h.on(v,this.listenEvents,this)}listenEvents(e){K(e,"pre_card_for_mine")&&(this.anims.stop(),this.setTexture("sprites","nono-card")),K(e,"card_for_mine")&&this.anims.play("nono-idle",!0)}}e.GameObjects.GameObjectFactory.register(ot,function(t,s){const i=new dt(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ht=function(e){e.isCinematic=!0,I(e),M(e),e.setHeroPosition("heroDjangoDoor"),e.hero.slowRightDown(),e.hero.animateToRight(),$(e),lt(e),h.emit(k,["first_sleep"]),e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(1e3,()=>{e.isCinematic=!1,h.emit(l,"django"),Ge(e)})},lt=function(e){ct(e),Ue(e,!0),e.boy.setSad(),e.girl.setSad(),e.fisherman.setSad();for(const t of e.map.getObjectLayer("sprites").objects)"nono"===t.name&&(e.nono=e.add.nono(t.x,t.y),e.nono.on("pointerdown",()=>Ge(e),this),e.physics.add.collider(e.nono,e.hero,()=>{h.emit(l,"nono")})),"cowForest"===t.name&&(e.cow.setPosition(t.x,t.y),e.cow.body.setSize(20,10),e.cow.toRight());W("sfx_objet_inventaire",e)},ct=function(e){e.riverPolluted||(e.riverPolluted=e.map.createLayer("riverPolluted",e.tileset).setDepth(45),e.landUpRiverPolluted=e.map.createLayer("landUpRiverPolluted",e.tileset).setDepth(46),e.bridgesShadowPolluted=e.map.createLayer("bridgesShadowPolluted",e.tileset).setDepth(51))},mt="minerChief";class ut extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-chief-1",0,-5),this.spriteId=mt,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-chief-idle",frames:[{key:"sprites",frame:"miner-chief-1",duration:300},{key:"sprites",frame:"miner-chief-2",duration:300},{key:"sprites",frame:"miner-chief-3",duration:300}],repeat:-1,frameRate:1}),this.anims.play("miner-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(mt,function(e,t,s,i){const a=new ut(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,a.height/2),this.displayList.add(a),this.updateList.add(a),a});class pt extends ee{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-dirty-1",0,-5,!0),this.delta=20,this.futureMinerPosition=null,this.initialY=s}setSpriteNumber(e){if(this.spriteId=`minerDirty${e}`,this.anims.play("miner-dirty-idle-"+(e-1),!0),e>2)return this.scaleX=-1,void this.setOffset(this.width,this.height/2);this.setOffset(0,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register("minerDirty",function(e,t,s,i,a){const n=new pt(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n});const gt=function(e){e.cameras.main.setBounds(0,0,e.map.widthInPixels,e.map.heightInPixels-8),function(e){e.anims.create({key:"miner-dirty-idle-1",frames:[{key:"sprites",frame:"miner-dirty-1"},{key:"sprites",frame:"miner-dirty-2"}],repeat:-1,frameRate:2}),e.anims.create({key:"miner-dirty-idle-2",frames:[{key:"sprites",frame:"miner-dirty-2"},{key:"sprites",frame:"miner-dirty-1"}],repeat:-1,frameRate:3}),e.anims.create({key:"miner-dirty-idle-3",frames:[{key:"sprites",frame:"miner-dirty-1"},{key:"sprites",frame:"miner-dirty-1"},{key:"sprites",frame:"miner-dirty-2"}],repeat:-1,frameRate:4})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterCard"===t.name&&e.miner.unlockAccessToMine(t.x,t.y),"minerChief"===t.name&&(e.minerChief=e.add.minerChief(t.x,t.y),e.minerChief.on("pointerdown",()=>Ge(e),this),e.physics.add.collider(e.minerChief,e.hero,()=>{h.emit(l,"minerChief")}));for(let s=2;s<=4;s++)t.name===`miner${s}`&&(e[`minerDirty${s}`]=e.add.minerDirty(t.x,t.y,null,null,s),e[`minerDirty${s}`].on("pointerdown",()=>Ge(e),this),e.physics.add.collider(e[`minerDirty${s}`],e.hero,()=>{h.emit(l,`minerDirty${s}`)}))}!function(e){const s=new t.Loader.LoaderPlugin(e);s.atlas("mineLand","sprites/mineLand.png","sprites/mineLand.json"),s.once("complete",()=>Ze(e)),s.start()}(e)},yt={django:"Django",bino:"Bino",fisherman:"Mino",cat:"Le chat",dog:"Le chien",cow:"La vache",boy:"Les enfants",girl:"La petite fille",koko:"Koko",nono:"Nono",escargot:"L'escargot",baby:"Le bébé",miner:"L'ouvrier",dcWorkerChief:"L'ouvrier",whiteWorkerChief:"L'ouvrier",minerChief:"L'ouvrier",blueWorkerChief:"L'ouvrier"},ft={django:{sound:"sfx_voix_hommes",versions:4},miner:{sound:"sfx_voix_ouvriers",versions:4},boy:{sound:"sfx_voix_enfants",versions:4},girl:{sound:"sfx_voix_enfants",versions:4},baby:{sound:"sfx_voix_enfants",versions:4},koko:{sound:"sfx_voix_femmes",versions:4},nono:{sound:"sfx_voix_hommes",versions:4},fisherman:{sound:"sfx_voix_hommes",versions:4},twoWomen:{sound:"sfx_voix_femmes",versions:4},twoGuys:{sound:"sfx_voix_hommes",versions:4},bino:{sound:"sfx_voix_hommes",versions:4},whiteWorkerChief:{sound:"sfx_voix_ouvriers",versions:4},dcWorkerChief:{sound:"sfx_voix_ouvriers",versions:4},minerChief:{sound:"sfx_voix_ouvriers",versions:4},blueWorkerChief:{sound:"sfx_voix_ouvriers",versions:4},blueWorker1:{sound:"sfx_voix_hommes",versions:4},blueWorker2:{sound:"sfx_voix_hommes",versions:4},minerDirty2:{sound:"sfx_voix_hommes",versions:4},minerDirty3:{sound:"sfx_voix_hommes",versions:4},minerDirty4:{sound:"sfx_voix_hommes",versions:4},whiteWorker1:{sound:"sfx_voix_hommes",versions:4},whiteWorker2:{sound:"sfx_voix_hommes",versions:4},cat:{sound:"sfx_chat",versions:2},dog:{sound:"sfx_chien",versions:2},cow:{sound:"sfx_vache",versions:1},veal:{sound:"sfx_vache",versions:2}},bt={bino:[{messages:["Hey, salut toi ! Moi je m'appelle Bino !","Fais attention à ne pas marcher sur mes carottes."],repeat:["Fais attention à ne pas marcher sur mes carottes."]},{messages:["Hey ! Tu es juste de passage ?","Ou bien là pour enquêter sur ce qui se trame ?","Plus au nord d'ici, il y a une personne louche…","(J'espère que cela n'impactera pas mon potager…)"],repeat:["(Je me demande bien ce que veulent ces gens…)"],dependingOn:["django_met"]},{messages:["Je travaille, mais j'ai pas trop la tête à ça…","Je suis très inquiet à cause de la rivière polluée.","Peut-être qu'en remontant à la source…","on trouverait la cause du problème ?","Mais je suis bien trop occupé là…"],repeat:["(Si seulement quelqu'un pouvait remonter la rivière…)"],dependingOn:["first_sleep"]},{messages:["Hey Maï, tout roule pour toi ?","Comme tu peux le voir, mon potager a disparu.","À la place je désherbe le bord des routes.","Mais ne crois pas que je sois triste !","On peut accéder à tellement plus de denrées alimentaires","grâce à nos voitures et à ces nouvelles routes !","C'est un gros changement…"],repeat:["(Allez, ça ne va pas se désherber tout seul…)"],dependingOn:["second_act_begin"]},{messages:["Hey Maï, ça roule ?","Moi, ras-le-bol de désherber le bord des routes !","J'ai vu sur FaceBouc que Django partait en voyage…","J'aimerais bien partir avec lui !"],repeat:["(Il faut que j'aille voir Django pour ce voyage…)"],dependingOn:["third_act_begin"]},{messages:["Je n'arrive plus à faire pousser de légumes…"],dependingOn:["fourth_act_begin"]},{messages:["J'ai répondu à l'appel de Koko et Django…","Mais peux pas m'empêcher de désherber partout…"],repeat:["(Allez, ça ne va pas se désherber tout seul…)"],dependingOn:["strike_begin"]},{messages:["Attendez… Je prends les tomates !"],dependingOn:["django_final_end"],unlockEvents:["game_over"]}],twoGuys:[{messages:["- Le changement climatique, c'est du sérieux, mec.","- Ok, mais tu penses à la biodiversité ?","- Si, si, j'ai même arrêté de tuer les moustiques !"]},{messages:["- Que c'est pratique ces nouvelles routes !","- Tu l'as dit, j'ai rangé mon vieux vélo.","- Le hic, c'est l'éternité qu'il faut…","pour payer ma nouvelle automobile."],dependingOn:["second_act_begin"]},{messages:["- J'ai écrit un poème, écoute :","Plus d'usines que de maisons","Plus de mines que de raison","- La nouvelle usine à l'ouest t'inspire ?","- Elle m'inspire ce poème oui, de la confiance non."],repeat:["L'usine à l'ouest n'inspire pas confiance."],dependingOn:["third_act_begin"]},{messages:["- (Il parait qu'on peut arrêter les publicités).","- (Les écrans de publicité ? Mais comment ?)","- (Moins fort ! Il faudrait demander à Koko)"],repeat:["- (Koko a un secret au sujet des écrans…)"],dependingOn:["fourth_act_begin"]},{messages:["- Avoue, c'est ta première manif' ?","- Mais pas du tout… j'ai fait les marches pour le climat !"],dependingOn:["strike_begin"]},{messages:["Salut Maï, tu es attendue près de chez Bino."],dependingOn:["strike_end"]}],twoWomen:[{messages:["- J'arrête de manger de la viande !","- Pour ta santé ?","- Non, pour réduire mon empreinte carbone !"]},{messages:["- Tu as vu le nouveau smartphone ?","- Il a quoi de nouveau ?","- Il se transforme en drone","pour nous filmer ou nous photographier…","sous tous les angles !","Plus besoin de perche à selfie !"],dependingOn:["third_act_begin"]},{messages:["- Il faut désarmer ces industries polluantes…","- Je te sens rebelle, c'est Maï qui t'inspire ?"],dependingOn:["strike_begin"]},{messages:["- Salut Maï, ça fait un bail !","- Tu es attendue à l'est du village !"],dependingOn:["strike_end"]}],baby:[{messages:["Ta-ta Ta-ta"]},{messages:["télé-phone, télé-phone…"],dependingOn:["third_act_begin"]}],sleepingGuy:[{messages:["ZZZzzz, mmmh ?"]},{messages:["Je… suis venu… depuis longtemps…","Il… est temps de faire une…","…petite sieste… ZZZzzz…"],dependingOn:["strike_begin"]}],koko:[{messages:["Oh bah, v’là donc une nouvelle arrivante…","Bienvenue au village de Trois-Rivières !","Ça fait plaisir d’voir une nouvelle tête.","Moi c'est Koko.","J'suis au courant de tout c'qui s'passe dans l'coin !","… Maï ? Un prénom pas banal dis donc !","J’suis sûre que notre patelin va te plaire.","Va donc y faire un tour !","Et si tu cherches un endroit où dormir…","Django t'accueillera sûrement, il est plus au sud."],repeat:["Maï, si t’as fini d’visiter tout le village…","va donc vers le sud pour trouver où dormir."]},{messages:["Tu as rencontré Django ?","C'est la personne la plus gentille que j'connaisse.","Tu devrais aller voir ce qui se trame à l'est…","Il parait qu'une personne louche bloque un pont…"],repeat:["Tu devrais aller voir ce qui se trame à l'est…","Il parait qu'une personne louche bloque un pont…"],dependingOn:["django_met"]},{messages:["Olala, olala… t'as vu ça Maï ?","C'est terrible c'qui arrive à notre rivière !","Un truc louche se trame vers l'est, j'te l'dis !","Nono, qu'habite plus au nord, en revient justement.","Il est mal-en-point, comme la rivière…","peut-être qu'il pourra t'en dire plus !"],repeat:["Au nord, Nono pourra t'éclairer sur c'qui s'passe !"],dependingOn:["first_sleep"]},{messages:["Je vois que tu as le badge de Nono…","Fais attention à toi, Maï !"],dependingOn:["card_for_mine"]},{messages:["Maï, c'est incroyable tu trouves pas ?","Le génie humain j'veux dire.","Pour trois fois moins de temps,","j'peux aller voir ma famille, mes amies !","Moi qui ADORE être au courant de tout,","ça va grandement faciliter les potins héhé.","D'ailleurs t'sais pas la dernière ?","Une autre usine s'est installée au nord.","Ça pousse comme des champignons ces choses là !"],repeat:["Tu d'vrais aller voir cette usine au nord","p'têtre que t'y trouveras encore du travail !"],dependingOn:["second_act_begin"]},{messages:["B'jour Maï ! Dis-moi…","Tu peux m'aider à choisir un nouveau smartphone ?","Le mien est déjà trop lent…","C'est vraiment pratique pour être au courant de tout !","D'ailleurs une nouvelle usine a ouvert à l'ouest."],repeat:["Tu vas aller voir cette nouvelle usine à l'ouest ?"],dependingOn:["third_act_begin"]},{messages:["Maï…","J'avais tellement la tête plongée dans les écrans…","Que j'n'ai pas remarqué l'état de nos rivières !","Qu'les oiseaux et les papillons ont disparu !","QUOI ? Tu dis qu'il faut se mobiliser ?","C'est une bonne idée !",'J\'vais réunir les "troupes".',"En attendant, t'pourrais faire une action d'éclat.","Oh, je sais : éteindre les panneaux de pub !","Les enfants m'ont dit qu'on pouvait les éteindre…","en passant par derrière !"],repeat:["(il parait que…)","(on peut éteindre les écrans pub par derrière…)","(mais chut !)"],dependingOn:["fourth_act_begin"]},{messages:["Merci Maï pour tout c'que t'as fait.","Grâce à toi, tous les villageois…","S'retrouvent pour une cause commune…","L'avenir de notre village !"],repeat:["Merci encore, Maï."],dependingOn:["strike_begin"]}],nono:[{messages:["C'est donc toi Maï ?","Ton arrivée dans le village ne passe pas inaperçue.","Comme tu peux le constater…","tu ne me vois pas au meilleur de ma forme !","À l'est, une mine vient de s'installer.","J'ai tenté d'y travailler mais…","il m'est arrivé un accident malencontreux.","Il faut dire qu'on n'est pas très bien protégé.","Et le rythme de travail y est extrêmement soutenu !","Bref. Je te dirais bien d'en prendre garde mais…","Je vois dans ton regard que tu es déterminée à y aller."],unlockEvents:["pre_card_for_mine"]},{messages:["Prends mon laissez-passer, je n'en ai plus besoin.","Mais promets moi de faire bien attention à toi !"],repeat:["Fais bon usage de mon badge… et sois prudente."],dependingOn:["pre_card_for_mine"],unlockEvents:["card_for_mine"]},{messages:["La situation de nos rivières est perturbante,","mais je dois bien avouer que ces nouvelles routes…","facilitent énormément mes déplacements !","Mon handicap ne fait pas bon ménage avec le vélo…","ou rouler sur la terre, la gadoue et les pavés !","D'ailleurs, savais-tu que ce sont les déchets de la mine…","les résidus miniers, qui ont été recyclés…","…dans le bitume des routes ? Impressionnant non ?","Peu étonnant qu'il y ait foule pour aller à la mine,","c'est devenu l'attraction des alentours."],repeat:["La situation de nos rivières est perturbante…"],dependingOn:["second_act_begin"]},{messages:["C'est assez formidable n'est-ce pas ?","Ce confort, et l'accès à tout le savoir je veux dire.","Il faut bien sûr réussir à bien s'informer…","Heureusement, je sais démêler le vrai du faux !","(Alors comme ça, la Terre serait plate !?)"],repeat:["J'apprends tellement grâce à l'internet !"],dependingOn:["third_act_begin"]},{messages:["C'est terrible, le village est méconnaissable…"],dependingOn:["fourth_act_begin"]},{messages:["Maï, je trouve que toutes ces expériences…","t'ont fait grandir ! Je le vois dans tes yeux."],repeat:["Tu as gagné en assurance, Maï."],dependingOn:["strike_begin"]}],django:[{messages:["Ooola, quel bon vent nous amène là !","… Maï ? Quel joli prénom.","Et donc tu cherches un lieu où dormir cette nuit ?","Tu frappes à la bonne porte !","Comme je le dis souvent, il faut qu'une porte…","soit ouverte ou fermée…","et la mienne sera toujours ouverte !","Donc reviens au coucher du soleil !"],repeat:["Fais un tour du village et reviens ce soir."],unlockEvents:["django_met"]},{messages:["Aah, tu es revenue ! Comme disait ma grand-mère…","un bon arbre peut loger dix mille oiseaux.","Allez, entre !"],dependingOn:["miner_first_met"],unlockEvents:["pre_first_sleep"]},{messages:["Bien dormi, Maï ?","Je suis désolé de te l'apprendre au réveil mais…","quelque chose de terrible est arrivé au village !","Vois par toi-même, je reste ici me calmer l'esprit."],repeat:["Ooh pauvre rivière, laisse moi te jouer une prière."],dependingOn:["first_sleep"]},{messages:["Bien dormi Maï ?","Après toutes ces semaines d'efforts à la mine,","je tenais à te remercier","pour tout ce que tu as fait pour nous.","Grâce à toi, on a la confirmation","que les eaux usées de la mine sont bien responsables","de la pollution de la rivière.","Mais dans le même temps, le village a pu se moderniser.","Je dois avouer être un peu partagé.","Est-ce un mal pour un bien ?","Je n'ai pas la réponse","et je ne voudrais pas t'influencer.","Maintenant que tu as fini ton travail à la mine,","tu as tout le temps de te balader dans le village."],repeat:["Une chose reste immuable dans tout ce bouleversement","ce sont les 6 cordes de ma guitare."],dependingOn:["second_act_begin"]},{messages:["Tu as encore bien travaillé à l'usine !","Ceci dit, le niveau de la rivière a encore baissé.","C'est bien de savoir que c'est de leur faute…","mais en attendant… le mal est fait.","On n'arrête pas le progrès…","De mon côté, je partirais bien loin du village…","Loin de ces problèmes…","Un voyage, c'est ça qu'il me faut !"],repeat:["J'ai envie de voyager, partir loin…"],dependingOn:["third_act_begin"]},{messages:["Salut Maï !","L'usine de recyclage pompe l'eau de la rivière ?","J'aimerais dire jamais deux sans trois.","Mais ça continue, vois le chantier près de chez moi.","Je ne sais pas ce qui se passe encore…"],repeat:["Un chantier au milieu de notre village…"],dependingOn:["fourth_act_begin"]},{messages:["Tu as raison, Maï…","On ne peut plus laisser toutes ces industries…","détruire notre village…","pomper et polluer nos rivières…","Quand on l'attaque, le village contre-attaque.","Je suis partant pour une mobilisation générale !","J'amène ma guitare et j'arrive."],dependingOn:["screens_shutdown"],unlockEvents:["django_ready_for_strike"]},{messages:["Camarades de Trois-Rivières !","Vous savez ce qui se passe dans notre village.","Nos ressources et nos rivières ont été accaparés…","Par des industries cupides et polluantes.","Aujourd'hui nous leur disons stop !","Comme le disait ma grand-mère…","On peut couper nos branches mais pas nos racines.","La lutte ne fait que commencer !"],dependingOn:["strike_begin"],unlockEvents:["strike_end"]},{messages:["Salut Maï ! Ça fait plaisir de te revoir !","T'as vu le village ?","La nature a repris ses droits, et nous nos esprits.","Il faut dire qu'il n'y avait plus rien à exploiter ici.","Les industriels sont ainsi partis voir ailleurs…","Et les oiseaux sont revenus.","Presque tous… c'est toujours mieux qu'aucun.","Allez, viens. On t'attendais pour pique-niquer !"],dependingOn:["django_final"],unlockEvents:["django_final_end"]}],fisherman:[{messages:["…chut, tu vas faire fuir les poissons…","Et voilà, raté… Va parler aux autres, je suis concentré là."],repeat:["…"]},{messages:["Par la barbe du %?#%, je ne vais plus pouvoir pêcher.","Qui sont les responsables de ce #?%@ ???"],repeat:["Si j'attrape les responsables de ce #?%@…"],dependingOn:["first_sleep"]},{messages:["… Tout le monde est devenu fan","de ces routes, de ces voitures…","C'est vite oublier d'où on vient.","Une mine s'installe, puis une usine…","La rivière qui a baissé de niveau,","juste en quelques semaines.","Je me sens un peu démuni face à tout ça…","Mais ça me réconforte que tu continues…","de mener ta petite enquête, Maï."],repeat:["Continue ton enquête, moi je surveille la rivière."],dependingOn:["second_act_begin"]},{messages:["Ce que je craignais est arrivé.","Trois-Rivières a complètement changé…","et nos habitudes avec.","Heureusement moi, je tiens bon la barre !","(Attendre ici me donne faim par contre…)","(Je mangerais bien un bon burger tiens !)"],repeat:["(Burger… burger……) hmmmmm, je disais quoi déjà ?"],dependingOn:["third_act_begin"]},{messages:["Tout part à la dérive, comme mon vieux rafiot…"],dependingOn:["fourth_act_begin"]},{messages:["J'me demande bien comment on va se débarrasser…","…de ces #?%@ qui polluent nos rivières !"],dependingOn:["strike_begin"]}],boy:[{messages:["YOUPIII, on peut se baigner quand on veut !","Faudrait trop qu'on ramène nos potes un jour !"]},{messages:["Oh nooon, on ne peut plus jouer dans l'eau…","Qu'est-ce qu'on va faire maintenant ?"],dependingOn:["first_sleep"]},{messages:["Quand nous pourrons rejouer dans la rivière ?"],dependingOn:["second_act_begin"]},{messages:["… Mmmmh, j'ai envie d'un gros burger…"],dependingOn:["third_act_begin"]},{messages:["C'est ma première manif, trop chouette !"],dependingOn:["strike_begin"]}],girl:[{messages:["…"]},{messages:["La rivière est toute petite maintenant…"],dependingOn:["second_act_begin"]},{messages:["Ça serait tellement bien si j'avais…","un smartphone pour jouer aux jeux vidéos…","comme FortNight ou BroStar…"],dependingOn:["third_act_begin"]},{messages:["Tante Koko et oncle Django sont trop forts !"],dependingOn:["strike_begin"]}],cat:[{messages:["Meow…"]},{messages:["rrrr… rrrr…"],dependingOn:["strike_begin"]}],dog:[{messages:["Wof, wof…"]}],cow:[{messages:["Meuh…"]}],veal:[{messages:["Mmmmh…"]}],escargot:[{messages:["…"]}],miner:[{messages:["Interdit de passer par ici."],repeat:["J'ai dit qu'on ne passe pas !"]},{messages:["Hop hop hop… il est trop tard pour passer, désolé.","Reviens demain.","(Vivement que mon tour de garde se termine bientôt…)","(j'ai des fourmis dans les jambes)"],repeat:["Il est trop tard pour passer, reviens demain."],unlockEvents:["miner_first_met"],dependingOn:["django_met"]},{messages:["Il faut un laissez-passer pour passer.","Nouvelle directive des chefs !"],repeat:["Je t'ai dit qu'il faut un laissez-passer…"],dependingOn:["first_sleep"]},{messages:["Je ne sais pas comment tu as eu ce badge…","mais te voilà donc libre de passer.","D'toute façon, on a besoin de bras pour bosser…"],repeat:["Tu peux passer…"],dependingOn:["card_for_mine"],unlockEvents:["mine_access_validation"]},{messages:["Apparemment, ils n'ont plus besoin de nous…","Pas autant en tout cas.","Les machines que nous avons créées nous remplacent."],dependingOn:["second_act_begin"]}],minerChief:[{messages:["Bienvenue à Grise Mine, LA mine responsable !","D'ici sortent des tonnes de minerais chaque jour…","extraits avec de l'énergie bas-carbone s'il vous plaît !","Nous utilisons l'eau de façon raisonnée…","traitons nos employés de manière exemplaire, et…","Ça ne t'intéresse pas mon discours ?","…","Tu quoi ? Tu es là pour travailler ???","Hahaha, elle est bien bonne celle-là.","Mes meilleurs hommes sont épuisés très vite…","tu ne tiendras pas une seconde là-dedans !","Mais ok, je veux bien te faire une formation express.","Apprête-toi à te faire miner… le moral HAHAHA"],unlockEvents:["mine_start"]}],minerDirty2:[{messages:["J'suis content d'avoir trouvé ce boulot…","même si c'est pas forcément bien payé."],repeat:["Ce boulot est pas forcément bien payé."]}],minerDirty3:[{messages:["Fiouuu… ça fait du bien une petite pause…","Je plains celui qui devra dépolluer ces bassins d'eau.","Enfin… si on le fait un jour…"]}],minerDirty4:[{messages:["Si tu cherches le chef, il est devant l'entrée.","Maintenant laisse moi contempler la vue du progrès."],repeat:["Contemple avec moi, la vue du progrès."]}],mine:[{messages:[o()?"Installe-toi…\n[touche pour continuer]":"Installe-toi…\n[espace pour continuer]","Comme tu es nouvelle, je te mets sur un poste simple…","…le nettoyage !","Les roches vont avancer sur le tapis roulant…","et tu devras les nettoyer pour éliminer les impuretés !","Pourquoi faire ça tu vas me dire ? Pour le PROGRÈS.","Les métaux et minerais dévoilés servent pour tout.","Smartphones, consoles, plomberie, bijoux…","Nous sommes la première étape d'un grand tout.","Et tu n'en es qu'un maillon insignifiant…","Bref. Voici comment procéder.",o()?"Bouge le tuyau avec le joystick.":"Bouge le tuyau avec les flèches ← ↑ → ↓",o()?"En bougeant le tuyau, l'eau est pulvérisée.":"Et pulvérise l'eau avec la barre ESPACE.","J'espère que t'as bien tout compris !","J'peux pas me permettre que tu ralentisses le train…","de la mine !"],unlockEvents:["mine_tuto_begin"]},{messages:["Tu n'as pas compris comment ça fonctionne ???","Tu dois nettoyer la roche à CENT POUR CENT !","On ne peut pas l'envoyer à moitié nettoyée.",o()?"Bouge le tuyau avec le joystick.":"Bouge le tuyau avec les flèches ← ↑ → ↓",o()?"En bougeant le tuyau, l'eau est pulvérisée. Allez !":"Et pulvérise l'eau avec la barre ESPACE. Allez !"],dependingOn:["mine_tuto_missed"],unlockEvents:["mine_tuto_begin"]},{messages:["Tu as compris comment ça fonctionne…","Passons aux choses sérieuses !"],dependingOn:["mine_tuto_end"],unlockEvents:["mine_show_score_board"]},{messages:["Ça, c'est ce qui va contrôler ton travail.","Si tu rates trop souvent, une croix s'allumera.","Au bout de trois croix…","je viendrai moi-même t'accompagner à la sortie !","…","Quoi ?? Pourquoi tu me regardes comme ça ?","Oui… On extrait l'eau de la rivière !","Et on stocke les déchets dans des réservoirs.","Je te rappelle qu'on est une mine responsable.","On ne fait pas n'importe quoi !","Bon, arrête de poser des questions, au boulot !"],dependingOn:["mine_show_score_board"],unlockEvents:["mine_after_tuto"]},{messages:["C'est bien ce qu'il me semblait…","tu ne peux pas tenir un rythme aussi soutenu !","On arrête les frais pour aujourd'hui.","Allez… ne fais pas grise mine !"],dependingOn:["mine_game_over"],unlockEvents:["mine_end"]}],whiteWorker1:[{messages:["Il y a trop de monde à la mine…","alors j'ai tenté ma chance à l'usine."],repeat:["Je tente ma chance à l'usine."]},{messages:["Vu la qualité de ton travail…","ou la non qualité de ton travail ?","Tu n'es plus la bienvenue à l'usine. Ordre du chef !"],repeat:["Tu n'es plus la bienvenue ici."],dependingOn:["third_act_begin"]}],whiteWorker2:[{messages:["Je m'y connais pas trop en électronique…","mais faut bien mettre du beurre dans les épinards !"],repeat:["Il faut bien mettre du beurre dans les épinards !"]},{messages:["Tu ne passes plus… Ordre des chefs !"],dependingOn:["third_act_begin"]}],whiteWorkerChief:[{messages:["(Pourquoi j'ai accepté ce job dans ce trou paumé.)","(Je ne supporte pas ces gens, ni ce village, je…)","Oui ? … Tu t'appelles Maï et tu veux travailler ?","Bien sûr, comme tout le monde ici.","Une usine dernier cri attire forcément…","des ploucs euh… des gens comme vous.","Pour t'expliquer en langage simple…","Ici chez Nano World Company…","… on assemble des circuits électroniques…","Qui finissent ensuite dans des écrans ou téléphones.","Sois contente, tu peux faire une période d'essai.","Est-ce que tu penses en être capable ?","Voyons voir ce que tu vaux !"],unlockEvents:["factory_start"]}],blueWorker1:[{messages:["C'est l'dernier endroit qui recrute dans la région."]},{messages:["Ne reviens pas… euh… ordre du chef."],dependingOn:["fourth_act_begin"]}],blueWorker2:[{messages:["J'ai cru entendre que le chef ici est un bel orateur."]},{messages:["T'as pas laissé un bon souvenir à l'usine."],dependingOn:["fourth_act_begin"]}],blueWorkerChief:[{messages:["Ici euh… chez Tri-Force, on recycle les déchets.","Et on en fait euh… d'autres équipements.","Alors oui, on utilise… l'eau de la rivière.","Mais tout ça est euh… contrôlé et raisonné à 100%.","Alors… ça vous dit de… tester une journée de travail ?","Ça nous arrange d'avoir… des femmes.","Vu qu'on vous paie moins… euh… oubliez ça.","Suivez-moi !"],unlockEvents:["recycling_start"]}],factory:[{messages:[o()?"Installe-toi…\n[touche pour continuer]":"Installe-toi…\n[espace pour continuer]","Comme tu es nouvelle, je te mets sur un poste simple…","Tu dois monter les composants sur les cartes…","Puis les nettoyer à l'eau pour éliminer les impuretés…","Et faire ça le plus vite possible…","Les clients n'attendent pas !",o()?"Bouge les composants en appuyant à gauche ou à droite.":"Bouge les composants avec les flèches ← →",o()?"Et valide le composant en appuyant au centre.":"Et valide le composant avec la barre ESPACE","C'est parti !"],unlockEvents:["factory_tuto_begin"]},{messages:["Tête de linotte !","Tu n'as pas compris comment ça fonctionne ?","Tu dois monter les composants sur les cartes…",o()?"Bouge les composants en appuyant à gauche ou à droite.":"Bouge les composants avec les flèches ← →",o()?"Et valide le composant en appuyant au centre.":"Et valide le composant avec la barre ESPACE","C'est à la portée du premier venu !"],dependingOn:["factory_tuto_missed"],unlockEvents:["factory_tuto_begin"]},{messages:["Tu sembles avoir compris comment ça fonctionne…","Passons aux choses sérieuses !"],dependingOn:["factory_tuto_end"],unlockEvents:["factory_show_score_board"]},{messages:["Si tu rates l'assemblage, une croix s'allumera.","Au bout de trois croix…","je viendrai moi-même t'accompagner à la sortie !","As-tu d'autres questions ???","Tu dis que l'eau utilisé assèche la rivière ?","Et qu'est-ce que ça peut me faire ?","Tout le monde sera bien content…","d'avoir des téléphones derniers cris !","Arrête de te poser des questions et au boulot."],dependingOn:["factory_show_score_board"],unlockEvents:["factory_after_tuto"]},{messages:["C'est bien ce qu'il me semblait…","tu ne peux pas tenir un rythme aussi soutenu !","On arrête les frais pour aujourd'hui.","Allez… Rentre chez toi !"],dependingOn:["factory_game_over"],unlockEvents:["factory_end"]}],recyclingCentre:[{messages:[o()?"Voilà votre poste…\n[touche pour continuer]":"Voilà votre poste…\n[espace pour continuer]","Des déchets tombent… de la trappe en haut.","Vous devez les réceptionner… avec le chariot en bas.",o()?"Bougez le chariot en appuyant à gauche ou à droite.":"Bougez le chariot avec les flèches ← →",o()?"Et changez son mode en appuyant en haut ou en bas.":"Et changez son mode avec les flèches 🠕 🠗","Il faut détruire le déchet avec euh… le bon mode.","Faisons un test."],unlockEvents:["recycling_tuto_begin"]},{messages:["Euh… je vais vous faire un petit rappel, pas le choix.",o()?"Bougez le chariot en appuyant à gauche ou à droite.":"Bougez le chariot avec les flèches ← →",o()?"Et changez son mode en appuyant en haut ou en bas.":"Et changez son mode avec les flèches 🠕 🠗","Le mode doit correspondre au déchet qui tombe !","Allez, c'est euh… reparti."],dependingOn:["recycling_tuto_missed"],unlockEvents:["recycling_tuto_begin"]},{messages:["Bon euh… ça suffira. Ne perdons pas plus de temps.","On va vous tester pour de vrai."],dependingOn:["recycling_tuto_end"],unlockEvents:["recycling_show_score_board"]},{messages:["Ça, c'est le panneau d'erreurs.","Si vous ratez plusieurs déchets… une croix s'allume.","Au bout de trois croix euh… j'arrête votre journée.","Je le répète, c'est très important ce qu'on fait ici.","On démantèle et on recycle les équipements.","On est pour ainsi dire euh… super écolo.","Toute l'eau qu'on pollue et gaspille…","C'est pour un bien encore plus grand.","Allez euh… au boulot !"],dependingOn:["recycling_show_score_board"],unlockEvents:["recycling_after_tuto"]},{messages:["Bon euh… c'est fini pour aujourd'hui.","Il faudra être plus performante pour…","sauver la planète !"],dependingOn:["recycling_game_over"],unlockEvents:["recycling_end"]}],dcWorkerChief:[{messages:["Pour développer l'IA…","On construit un datacenter près de la rivière…","Son eau refroidira les serveurs, c'pas super !?","Si ça te gêne, dégage ! Et laisse nous bosser."],repeat:["On construit un datacenter, ça te gène ?"]}],gameOver:[{messages:["Fin de la démo.\nMerci d'avoir testé !"]}]},vt={"game.howToPlay":"Déplace-toi avec les touches ← 🠕 → 🠗 ou ZQSD","mine.faster":"Plus vite !","mine.fasterAgain":"Encore plus vite, allez !!!","mine.waterEmpty":"Réservoir d'eau vide !","mine.waterFull":"Réservoir d'eau plein !","mine.moreMaterials":"Arrivage de minerais, on augmente la fréquence !","mine.warning":"Ressaisis-toi, on est là pour faire du chiffre !","mine.lastWarning":"Dernier avertissement, concentre-toi !","factory.faster":"Validé ! Plus vite maintenant !!!","factory.welldone":"C'est bien, tu es productive !","factory.error":"C'est quoi ce boulot ? Ressaisis-toi la nouvelle !","recycling.faster":"Allez, on augmente le rythme !","recycling.error":"Euh… il va falloir faire mieux que ça !"},wt=e=>vt[e],kt="16px",Ct=20;class xt extends e.Scene{constructor(){super("message"),this.textObject=null,this.spriteNameObject=null,this.currentText="",this.currentDiscussionStatus=H.NONE}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json")}create(){const e=this.sys.game.config;this.actionBackground=this.add.rectangle(e.width/2,e.height-30,200,30,0).setAlpha(.5).setScrollFactor(0).setOrigin(.5,.5).setDepth(2e3).setVisible(!1),this.actionBackgroundLine=this.add.line(0,0,e.width/2-60,e.height-12,e.width/2+60,e.height-12,0).setLineWidth(4).setAlpha(.5).setScrollFactor(0).setOrigin(0,0).setDepth(2e3).setVisible(!1),this.actionText=this.add.text(e.width/2,e.height-30,o()?"Appuyer pour continuer":"Appuyer sur espace",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff",resolution:Ct}).setOrigin(.5,.5).setScrollFactor(0).setDepth(2e3).setVisible(!1),this.dialogBackground=this.add.sprite(e.width/2,e.height-30,"ui","dialog-2").setOrigin(.5,.5).setDepth(2e3).setAlpha(.8).setScrollFactor(0).setVisible(!1),this.dialogBackgroundColor=this.add.rectangle(e.width/2,e.height-30,252,44,0).setAlpha(.5).setOrigin(.5,.5).setDepth(2e3).setScrollFactor(0).setVisible(!1),this.textObject=this.add.text(e.width/2,e.height-30,"",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setResolution(Ct).setOrigin(.5,.5).setScrollFactor(0).setDepth(3e3).setWordWrapWidth(245).setVisible(!1),this.spriteNameObject=this.add.text(e.width/2-128,e.height-68,"",{fontFamily:"DefaultFont",fontSize:kt,fill:"#000000",backgroundColor:"#ffffff",padding:4}).setAlpha(.8).setResolution(Ct).setOrigin(0,.5).setScrollFactor(0).setDepth(3e3).setVisible(!1),h.on(b,this.handleMessage,this),h.on(g,this.handleDiscussionEnd,this),h.on(c,this.handleDiscussionEnd,this),h.on(l,this.readyToAction,this),h.on(m,this.stopAction,this),h.on(v,this.listenEvents,this)}showMineCard(){G("sfx_objet_inventaire",this.scene.get("game"),!1,1),this.mineCard=this.add.image(225,125,"ui","card").setScrollFactor(0).setDepth(3e3).setAlpha(0),this.tweens.add({targets:this.mineCard,x:420,y:220,alpha:1,scale:1,ease:"Quad.easeOut",loop:0,duration:1e3})}hideMineCard(){this.mineCard&&this.tweens.add({targets:this.mineCard,alpha:0,scale:.5,ease:"Sine.easeInOut",loop:0,duration:500,onComplete:()=>this.mineCard.destroy()})}listenEvents(e){K(e,"card_for_mine")&&this.showMineCard(),K(e,"mine_access_validation")&&this.hideMineCard()}startDiscussion(){this.scene.isActive()&&(this.currentDiscussionStatus=H.STARTED,this.stopAction())}stopAction(){this.scene.isActive()&&(this.actionText.setVisible(!1),this.actionBackground.setVisible(!1),this.actionBackgroundLine.setVisible(!1))}readyToAction(){this.scene.isActive()&&this.currentDiscussionStatus===H.NONE&&(this.scene.get("game")?.isCinematic||(this.currentDiscussionStatus=H.READY,this.actionText.setVisible(!0),this.actionBackground.setVisible(!0),this.actionBackgroundLine.setVisible(!0)))}handleDiscussionEnd(){this.scene.isActive()&&(this.currentDiscussionStatus=H.NONE,this.stopAction(),this.textObject.text="",this.textObject.setVisible(!1),this.spriteNameObject.text="",this.spriteNameObject.setVisible(!1),this.dialogBackground.setVisible(!1),this.dialogBackgroundColor.setVisible(!1))}handleMessage(t){if(!this.scene.isActive())return;const{message:s,sprite:i}=t;if(this.textObject.visible&&s===this.currentText)return;const a=this.scene.get("game");ft[i]&&G(`${ft[i].sound}_${e.Math.Between(1,ft[i]?.versions)}`,a,!1,.5),this.dialogBackground.setVisible(!0),this.dialogBackgroundColor.setVisible(!0),this.spriteNameObject.text=yt[i],this.spriteNameObject.setVisible(!!this.spriteNameObject.text),this.textObject.text=s,this.currentText=s,this.textObject.setVisible(!0),this.time.delayedCall(300,()=>h.emit(u))}}const Ot=function(e){console.time("Init"),e.map=e.make.tilemap({key:"map"}),e.tileset=e.map.addTilesetImage("Atlas_01","tiles"),e.land=e.map.createLayer("land",e.tileset).setDepth(20).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.map.createLayer("landUp",e.tileset).setDepth(40),e.bridgesShadow=e.map.createLayer("bridgesShadow",e.tileset).setDepth(50),e.bridges=e.map.createLayer("bridges",e.tileset).setDepth(60),e.bottomObjects=e.map.createLayer("bottom",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.potagerBottom=e.map.createLayer("potagerBottom",e.tileset).setDepth(70),function(e){e.anims.create({key:"sapin",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"sapin-"}),repeat:-1,frameRate:1}),e.anims.create({key:"arbre",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"arbre-"}),repeat:-1,frameRate:1}),e.anims.create({key:"pin",frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:"pin-"}),repeat:-1,frameRate:1}),e.map.createLayer("bottomStaticTrees",e.tileset).setDepth(130),e.map.createLayer("staticTrees",e.tileset).setDepth(150),tt("trees",e)}(e),e.map.getObjectLayer("hero").objects.forEach(t=>{var s;(e.heroPositions[t.name]={x:t.x,y:t.y},"hero"===t.name)&&(e.tent=e.add.sprite(t.x+2,t.y-2,"sprites","tent-1").setDepth(100),e.hero=e.add.hero(t.x,t.y).setDepth(100),e.hero.stopAndWait(),(s=e.anims).create({key:"mai-walk-down",frames:s.generateFrameNames("mai",{start:1,end:4,prefix:"walk-down-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-walk-up",frames:s.generateFrameNames("mai",{start:1,end:4,prefix:"walk-up-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-walk-side",frames:s.generateFrameNames("mai",{start:1,end:4,prefix:"walk-right-"}),repeat:-1,frameRate:10}).addFrame(s.generateFrameNames("mai",{start:2,end:3,prefix:"walk-right-"})),s.create({key:"mai-idle-down",frames:[{key:"mai",frame:"idle-down-1",duration:1500},{key:"mai",frame:"idle-down-2",duration:200}],repeat:-1}),s.create({key:"mai-idle-up",frames:[{key:"mai",frame:"idle-up"}],repeat:-1,frameRate:4}),s.create({key:"mai-idle-side",frames:[{key:"mai",frame:"idle-right-1",duration:1500},{key:"mai",frame:"idle-right-2",duration:200}],repeat:-1,yoyo:!0,frameRate:4}))}),function(e){Ne(e),W("sfx_oiseaux_volent",e),e.map.getObjectLayer("birds").objects.forEach(t=>{e.birds.push(e.add.bird(t.x,t.y).setDepth(160))}),e.physics.add.collider(e.birds,e.hero,e=>e.fly())}(e),function(e){e.anims.create({key:"butterfly-anim",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"butterfly-"}),repeat:-1,frameRate:4}).addFrame([{key:"sprites",frame:"butterfly-2",duration:2}]),e.map.getObjectLayer("butterflies").objects.forEach(t=>{e.butterflies.push(e.add.butterfly(t.x,t.y).setDepth(160))})}(e),a("noanims")||(console.time("animatedTiles"),e.animatedTiles.init(e.map),console.timeEnd("animatedTiles")),e.cameras.main.setBounds(0,400,2144,e.map.heightInPixels-408),e.cameras.main.startFollow(e.hero,!0),function(e){a("debugcontrols")&&(e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M).on("down",()=>{e.cameras.main.zoomTo(2===e.cameras.main.zoom?1:.18,100)}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P).on("down",()=>{e.cameras.main.zoomTo(.18===e.cameras.main.zoom?1:2,100)}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F).on("down",()=>{e.setHeroPosition("heroFactory")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.K).on("down",()=>{e.setHeroPosition("heroKoko")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B).on("down",()=>{e.setHeroPosition("heroMiner")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D).on("down",()=>{e.setHeroPosition("heroDjango")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.N).on("down",()=>{e.setHeroPosition("heroNono")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E).on("down",()=>{lt(e),gt(e),st(e),e.setHeroPosition("heroRecycling"),e.isCinematic=!1,h.emit(k,["third_act_begin"])}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S).on("down",()=>{e.isCinematic=!0,e.time.delayedCall(2e3,()=>{e.setHeroPosition("heroKoko"),lt(e),gt(e),st(e),Ke(e),e.isCinematic=!1,h.emit(k,["fourth_act_begin"])})}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).on("down",()=>{e.isCinematic=!0,e.time.delayedCall(2e3,()=>{e.setHeroPosition("heroKoko"),lt(e),gt(e),st(e),Ke(e),nt(e),e.isCinematic=!1,h.emit(k,["strike_end"])})}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.G).on("down",()=>{e.isCinematic=!0,e.time.delayedCall(2e3,()=>{e.setHeroPosition("heroDjangoFinal"),lt(e),gt(e),st(e),Ke(e),nt(e),rt(e,!0),h.emit(k,["game_over"])})}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Y).on("down",()=>{h.emit(k,["django_met","pre_first_sleep"])}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C).on("down",()=>{h.emit(k,["card_for_mine"])}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T).on("down",()=>{et(e)}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.O).on("down",()=>{lt(e),h.emit(k,["mine_access_validation"]),e.setHeroPosition("heroMine")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A).on("down",()=>et(e)),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.L).on("down",()=>$(e)),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.X).on("down",()=>Xe(e)),e.input.on("pointerdown",t=>console.log({pointer:[t.x,t.y],hero:[e.hero.x,e.hero.y]})))}(e),function(e){e.cursors=e.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),e.input.keyboard.on("keydown",t=>{e.isCinematic||("ArrowUp"===t.key?(e.goingUp=!0,e.goingDown=!1,e.howToPlay=!1):"ArrowDown"===t.key?(e.goingDown=!0,e.goingUp=!1,e.howToPlay=!1):"ArrowLeft"===t.key?(e.goingLeft=!0,e.goingRight=!1,e.howToPlay=!1):"ArrowRight"===t.key?(e.goingRight=!0,e.goingLeft=!1,e.howToPlay=!1):32===t.keyCode&&Ge(e))},this),e.input.keyboard.on("keyup",t=>{e.isCinematic||("ArrowUp"==t.key?e.goingUp=!1:"ArrowDown"==t.key?e.goingDown=!1:"ArrowLeft"==t.key?e.goingLeft=!1:"ArrowRight"==t.key&&(e.goingRight=!1))},this)}(e),function(e){o()&&(e.joystick=e.plugins.get("rexvirtualjoystickplugin").add(e,{x:100,y:200,radius:100,base:e.add.circle(0,0,50,16733508,.4).setDepth(1e4),thumb:e.add.circle(0,0,30,13421772,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),e.input.on("pointerdown",t=>{e.joystick.setPosition(t.x,t.y),e.joystick.setVisible(!0),Ge(e)},this),e.joystick.on("update",()=>{e.howToPlay=!1,e.goingAngle=e.joystick.angle,e.joystick.left?(e.goingLeft=!0,e.goingRight=!1,(177.5<e.goingAngle||-177.5>e.goingAngle)&&(e.goingUp=!1,e.goingDown=!1)):e.joystick.right&&(e.goingRight=!0,e.goingLeft=!1,22.5>e.goingAngle&&-22.5<e.goingAngle&&(e.goingUp=!1,e.goingDown=!1)),e.joystick.up?(e.goingUp=!0,e.goingDown=!1,-67.5>e.goingAngle&&-112.5<e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1)):e.joystick.down&&(e.goingDown=!0,e.goingUp=!1,67.5<e.goingAngle&&112.5>e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1))},this),e.joystick.on("pointerup",()=>{e.joystick.setVisible(!1),e.stopMoving()},this))}(e),e.addEventsListeners(),e.obstacles=e.map.createLayer("obstacles",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleRecyclingLayer=e.map.createLayer("obstacleRecycling",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(2e3,()=>St(e)),e.time.delayedCall(3e3,()=>e.scene.run("message")),e.time.delayedCall(4e3,()=>Dt(e)),console.timeEnd("Init"),a("nostart")||function(e){e.anims.create({key:"tent",frames:e.anims.generateFrameNames("sprites",{start:1,end:6,prefix:"tent-"}),repeat:0,frameRate:10}),W("sfx_tente",e),e.isIntro=!0,e.isCinematic=!0,e.hero.setVisible(!1);const t=()=>{e.isIntro&&(e.howToPlay||((e.goingUp||e.goingLeft||e.goingRight)&&(e.goingUp=!1,e.goingLeft=!1,e.goingRight=!1,e.goingDown=!0),e.goingDown&&(e.isCinematic=!0,e.hero.slowDown(),e.hero.animateToDown(),e.hero.setVisible(!0)),e.hero.y>e.heroPositions.hero.y+20&&(e.hero.animateToUp(),e.hero.stopAndWait(),e.events.off("update",t),e.isIntro=!1,e.goingDown=!1,e.tent.anims.play("tent",!0),G("sfx_tente",e),e.tent.on("animationcomplete",()=>{e.tent.destroy(),e.isCinematic=!1}))))};e.time.delayedCall(1e3,()=>{e.isCinematic=!1,e.events.on("update",t)})}(e)},Dt=function(e){e.howToPlayText=e.add.text(225,220,wt("game.howToPlay"),{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff",backgroundColor:"#000000",padding:4}).setAlpha(0).setScrollFactor(0).setOrigin(.5,.5).setWordWrapWidth(200).setResolution(Ct).setDepth(1e4),e.tweens.add({targets:e.howToPlayText,alpha:.8,y:200,ease:"Sine.easeInOut",duration:2e3}),_t(e)},_t=function(e){e.howToPlay?e.time.delayedCall(1e3,()=>_t(e)):e.tweens.add({targets:e.howToPlayText,alpha:0,y:220,ease:"Sine.easeInOut",duration:2e3,onComplete:()=>e.howToPlayText.destroy()})},St=function(e){e.anims.create({key:"exclam",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"exclam-"}),repeat:-1,frameRate:6}).addFrame([{key:"sprites",frame:"exclam-2",duration:1}]),e.map.getObjectLayer("sprites").objects.forEach(t=>{"django"===t.name&&(e.django=e.add.django(t.x,t.y),e.django.on("pointerdown",()=>Ge(e),this)),"koko"===t.name&&(e.koko=e.add.koko(t.x,t.y),e.koko.on("pointerdown",()=>Ge(e),this)),"sleepingGuy"===t.name&&(e.sleepingGuy=e.add.sleepingGuy(t.x,t.y),e.sleepingGuy.on("pointerdown",()=>Ge(e),this)),"twoGuys"===t.name&&(e.twoGuys=e.add.twoGuys(t.x,t.y),e.twoGuys.on("pointerdown",()=>Ge(e),this)),"twoWomen"===t.name&&(e.twoWomen=e.add.twoWomen(t.x,t.y),e.twoWomen.on("pointerdown",()=>Ge(e),this)),"baby"===t.name&&(e.baby=e.add.baby(t.x,t.y),e.baby.on("pointerdown",()=>Ge(e),this)),"bino"===t.name&&(e.bino=e.add.bino(t.x,t.y),e.bino.on("pointerdown",()=>Ge(e),this)),"binoCleaningRoad"===t.name&&e.bino.setCleaningRoadPosition(t.x,t.y),"mino"===t.name&&(e.fisherman=e.add.fisherman(t.x,t.y),e.fisherman.on("pointerdown",()=>Ge(e),this)),"cat"===t.name&&(e.cat=e.add.cat(t.x,t.y),e.cat.on("pointerdown",()=>Ge(e),this)),"dog"===t.name&&(e.dog=e.add.dog(t.x,t.y),e.dog.on("pointerdown",()=>Ge(e),this)),"escargot"===t.name&&(e.escargot=e.add.escargot(t.x,t.y),e.escargot.on("pointerdown",()=>Ge(e),this)),"cow"===t.name&&(e.cow=e.add.cow(t.x,t.y),e.cow.on("pointerdown",()=>Ge(e),this)),"cowHidden"===t.name&&(e.cowHidden=e.add.cow(t.x,t.y),e.cowHidden.toRight(),e.cowHidden.on("pointerdown",()=>Ge(e),this)),"veal"===t.name&&(e.veal=e.add.veal(t.x,t.y),e.veal.on("pointerdown",()=>Ge(e),this)),"miner"===t.name&&(e.miner=e.add.miner(t.x,t.y),e.miner.on("pointerdown",()=>Ge(e),this)),"ball"===t.name&&(e.ball=e.add.ball(t.x,t.y)),"girl"===t.name&&(e.girl=e.add.girl(t.x,t.y)),"boy"===t.name&&(e.boy=e.add.boy(t.x,t.y),e.boy.on("pointerdown",()=>Ge(e),this)),"bike"===t.name&&e.bikes.push(e.add.bike(t.x,t.y)),"boySad"===t.name&&e.boy.setSadPosition(t.x,t.y),"girlSad"===t.name&&e.girl.setSadPosition(t.x,t.y),"deer"===t.name&&(e.deer=e.add.deer(t.x,t.y)),"owl"===t.name&&(e.owl=e.add.owl(t.x,t.y))}),e.bridgesTop=e.map.createLayer("bridgesTop",e.tileset).setDepth(110),e.topObjects=e.map.createLayer("top",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.potagerTop=e.map.createLayer("potagerTop",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.topObjects.forEachTile(t=>{!0===t.properties?.pointCollide?e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(10,1).setImmovable(!0).setVisible(!1)):!0===t.properties?.bottomCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.land.forEachTile(t=>{!0===t.properties?.topCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()-7,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.obstaclesFactoryLayer=e.map.createLayer("obstaclesFactory",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.physics.add.collider(e.miner,e.hero,()=>{h.emit(l,"miner")}),e.physics.add.collider(e.bino,e.hero,()=>{h.emit(l,"bino")}),e.physics.add.collider(e.django,e.hero,()=>{h.emit(l,"django")}),e.physics.add.collider(e.koko,e.hero,()=>{h.emit(l,"koko")}),e.physics.add.collider(e.sleepingGuy,e.hero,()=>{h.emit(l,"sleepingGuy")}),e.physics.add.collider(e.twoWomen,e.hero,()=>{h.emit(l,"twoWomen")}),e.physics.add.collider(e.baby,e.hero,()=>{h.emit(l,"baby")}),e.physics.add.collider(e.twoGuys,e.hero,()=>{h.emit(l,"twoGuys")}),e.physics.add.collider(e.fisherman,e.hero,()=>{h.emit(l,"fisherman")}),e.physics.add.collider(e.cat,e.hero,()=>{h.emit(l,"cat")}),e.physics.add.collider(e.dog,e.hero,()=>{h.emit(l,"dog")}),e.physics.add.collider(e.escargot,e.hero,()=>{h.emit(l,"escargot")}),e.physics.add.collider(e.cow,e.hero,()=>{h.emit(l,"cow")}),e.physics.add.collider(e.cowHidden,e.hero,()=>{h.emit(l,"cow")}),e.physics.add.collider(e.veal,e.hero,()=>{h.emit(l,"veal")}),e.physics.add.collider(e.boy,e.hero,()=>{h.emit(l,"boy")}),e.physics.add.collider(e.girl,e.hero,()=>{h.emit(l,"girl")}),e.physics.add.collider(e.bikes,e.hero),e.physics.add.collider(e.hero,e.water),e.physics.add.collider(e.hero,e.land),e.physics.add.collider(e.hero,e.obstacles),e.obstacleRecyclingCollider=e.physics.add.collider(e.hero,e.obstacleRecyclingLayer),e.physics.add.collider(e.hero,e.topObjects),e.potagerCollider=e.physics.add.collider(e.hero,e.potagerTop),e.physics.add.collider(e.hero,e.bottomObjects),e.physics.add.collider(e.hero,e.pointsCollider),e.obstaclesFactoryCollider=e.physics.add.collider(e.hero,e.obstaclesFactoryLayer);for(const t of["hommes","femmes","enfants","ouvriers"])for(let s=1;s<=4;s++)W(`sfx_voix_${t}_${s}`,e);W("sfx_chat_1",e),W("sfx_chat_2",e),W("sfx_chien_1",e),W("sfx_chien_2",e),W("sfx_vache_1",e),W("sfx_vache_2",e)},jt=function(e){e.isCinematic=!0,window.setTimeout(()=>T(e),1),e.cameras.main.fadeOut(e.isBonus?2e3:3e3,0,0,0,(t,s)=>{1===s&&(e.scene.launch("mine"),e.sleepGame())})},Pt=function(e){e.isCinematic=!0,window.setTimeout(()=>T(e),1),e.cameras.main.fadeOut(e.isBonus?2e3:3e3,0,0,0,(t,s)=>{1===s&&(e.scene.launch("factory"),e.sleepGame())})},At=function(e){e.isCinematic=!0,window.setTimeout(()=>T(e),1),e.cameras.main.fadeOut(e.isBonus?2e3:3e3,0,0,0,(t,s)=>{1===s&&(e.scene.launch("recyclingCentre"),e.sleepGame())})},It=function(e){if(a("nostart"))return e.resetGameSize(),void e.startGame();e.isBonus=a("bonus");let t=!1;e.scale.setGameSize(550,300),e.anims.create({key:"mai",frames:e.anims.generateFrameNames("splash",{start:1,end:4,prefix:"mai-"}),repeat:-1,frameRate:4}),e.anims.create({key:"rock",frames:e.anims.generateFrameNames("splash",{start:1,end:2,prefix:"rock-"}),repeat:-1,frameRate:2}),e.anims.create({key:"smoke-big",frames:e.anims.generateFrameNames("splash",{start:1,end:5,prefix:"smoke-big-"}),repeat:-1,frameRate:5}),e.anims.create({key:"smoke-small",frames:e.anims.generateFrameNames("splash",{start:1,end:5,prefix:"smoke-small-"}),repeat:-1,frameRate:5});const s=e.add.rectangle(0,0,550,300,10538928).setOrigin(0,0),i=e.add.image(0,0,"splash","cloud-top").setOrigin(0,0),n=e.add.image(260,30,"splash","cloud-two").setOrigin(0,0),r=t=>e.tweens.add({targets:n,x:600,duration:t,onComplete:()=>o()}),o=()=>{n.x=-n.width,r(9e4)};r(25e3);const d=e.add.image(400,60,"splash","cloud-middle").setOrigin(0,0),l=t=>e.tweens.add({targets:d,x:600,duration:t,onComplete:()=>c()}),c=()=>{d.x=-d.width,l(7e4)};l(9e3);const m=t=>e.tweens.add({targets:p,x:600,duration:t,onComplete:()=>u()}),u=()=>{p.x=-p.width,m(2e5)},p=e.add.image(30,70,"splash","cloud-big").setOrigin(0,0);m(1e5);const g=e.add.sprite(0,137,"splash","background").setOrigin(0,0),y=e.add.sprite(0,212,"splash","rock-1").setOrigin(0,0);y.play("rock");const f=e.add.sprite(60,118,"splash","mai-1").setOrigin(0,0);f.play("mai");const b=e.add.sprite(250,80,"splash","title").setOrigin(0,0),w=e.add.sprite(372,97,"splash","smoke-big-1").setOrigin(0,0);w.play("smoke-big");const k=e.add.sprite(413,153,"splash","smoke-small-1").setOrigin(0,0);k.play("smoke-small");const C=e.add.text(275,164,e.isBonus?"Nouvelle partie":"Démarrer",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setOrigin(.5,.5).setResolution(Ct).setInteractive({useHandCursor:!0}),x=e=>{t=!0,e.disableInteractive(!0),e.setColor("#000000"),document.body.style.cursor="none"};if(C.on("pointerdown",()=>{t||(t=!0,e.isBonus=!1,C.disableInteractive(!0),C.setText("Chargement..."),document.body.style.cursor="none",e.cameras.main.fadeOut(500,0,0,0,(t,a)=>{1===a&&(e.resetGameSize(),e.startGame(),s.destroy(),C.destroy(),b.destroy(),f.destroy(),y.destroy(),g.destroy(),i.destroy(),p.destroy(),n.destroy(),d.destroy(),w.destroy(),k.destroy())}))}),e.isBonus){const s=e.add.text(275,230,"La mine",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setOrigin(.5,.5).setResolution(Ct).setInteractive({useHandCursor:!0});s.on("pointerdown",()=>{t||(x(s),jt(e))});const i=e.add.text(275,250,"L'usine",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setOrigin(.5,.5).setResolution(Ct).setInteractive({useHandCursor:!0});i.on("pointerdown",()=>{t||(x(i),Pt(e))});const a=e.add.text(275,270,"Le recyclage",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setOrigin(.5,.5).setResolution(Ct).setInteractive({useHandCursor:!0});a.on("pointerdown",()=>{t||(x(a),At(e))})}h.on(v,t=>{console.log("EventsUnlocked screen",t),e.isBonus&&(K(t,"factory_after")||K(t,"mine_after")||K(t,"recycling_after"))&&(window.location.href="?bonus")}),e.input.on("pointermove",e=>{const t=-e.x/50,s=-e.y/50+6;y.setPosition(t,212+s),f.setPosition(60+t,118+s),b.setPosition(250+2*t,80+2*s)})},Lt=function(e){e.checkDjangoDoor=!1,e.setHeroPosition("heroStrike"),e.hero.slowUp(),e.hero.animateToUp(),e.dcWorker3.scaleX=1,e.django.beforeStrike(),e.map.createLayer("topStrike",e.tileset).setDepth(120),e.map.createLayer("bottomStrike",e.tileset).setDepth(70),e.map.getObjectLayer("sprites").objects.forEach(t=>{"strikeDcWorker1"===t.name&&(e.dcWorkerChief.setPosition(t.x,t.y),e.dcWorkerChief.disableChatIcon(),e.dcWorkerChief.setDepth(1e3),e.dcWorkerChief.setDelta(0),e.dcWorkerChiefCollider.destroy(),e.dcWorkerChief.off("pointerdown")),"strikeDcWorker4"===t.name&&(e.dcWorker4.setPosition(t.x,t.y),e.dcWorker4.scaleX=1),"djangoStrike"===t.name&&e.django.setPosition(t.x,t.y),"girlStrike"===t.name&&(e.girl.setPosition(t.x,t.y),e.girl.disableChatIcon()),"boyStrike"===t.name&&(e.boy.setPosition(t.x,t.y),e.boy.disableChatIcon(),e.boy.scaleX=-1),"binoStrike"===t.name&&(e.bino.setPosition(t.x,t.y),e.bino.disableChatIcon()),"minoStrike"===t.name&&(e.fisherman.setOnStrike(t.x,t.y),e.fisherman.disableChatIcon()),"babyStrike"===t.name&&(e.baby.setPosition(t.x,t.y),e.baby.disableChatIcon()),"dogStrike"===t.name&&e.dog.setPosition(t.x,t.y),"catStrike"===t.name&&(e.cat.setPosition(t.x,t.y),e.cat.scaleX=1),"nonoStrike"===t.name&&(e.nono.setPosition(t.x,t.y),e.nono.disableChatIcon()),"twoGuysStrike"===t.name&&(e.twoGuys.setPosition(t.x,t.y),e.twoGuys.disableChatIcon()),"twoWomenStrike"===t.name&&(e.twoWomen.setPosition(t.x,t.y),e.twoWomen.disableChatIcon()),"sleepingGuyStrike"===t.name&&e.sleepingGuy.setPosition(t.x,t.y),"kokoStrike"===t.name&&e.koko.setPosition(t.x,t.y)})};class Tt extends t.Scene{constructor(){super("game"),this.controls=null,this.cursors=null,this.hero=null,this.joystick=null,this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.goingAngle=null,this.water=null,this.land=null,this.topObjects=null,this.currentDiscussionStatus=H.NONE,this.currentDiscussionSprite=null,this.treesOfDc=[],this.treesOfDcCollider=[],this.birds=[],this.isNoMoreBirds=!1,this.butterflies=[],this.pointsCollider=[],this.heroPositions={},this.maskNightOverlays=[],this.darkOverlay=null,this.nightOverlays=[],this.bikes=[],this.isCinematic=!1,this.isIntro=!1,this.night=!1,this.villageTheme=null,this.industryTheme=null,this.miniGameTheme=null,this.djangoTheme=null,this.nightmareTheme=null,this.villageAmbianceV1=null,this.villageAmbianceV2=null,this.nightAmbiance=null,this.datacentreThemeEnabled=!1,this.sounds=[],this.django=null,this.koko=null,this.sleepingGuy=null,this.twoGuys=null,this.baby=null,this.twoWomen=null,this.bino=null,this.fisherman=null,this.dog=null,this.escargot=null,this.cat=null,this.boy=null,this.girl=null,this.miner=null,this.deer=null,this.blueWorker1=null,this.blueWorker2=null,this.dcWorkerChief=null,this.ball=null,this.tent=null,this.checkDjangoDoor=!0,this.screens=null,this.screenOffSprites=[],this.screenShutDownCount=0,this.isBonus=!1,this.isFinal=!1,this.isBeforeFinal=!1,this.howToPlay=!0,this.map=null,this.tileset=null}preload(){a("noanims")||this.load.scenePlugin("AnimatedTiles","plugins/AnimatedTiles.js","animatedTiles","animatedTiles")}create(){this.timeStart=Date.now(),a("debug")&&(this.fpsText=this.add.text(10,10,"hello",{fontSize:"10px",fill:"#fff"}).setDepth(1e4).setScrollFactor(0),this.time.addEvent({delay:100,loop:!0,callback:()=>{this.fpsText.setText(`FPS: ${this.game.loop.actualFps.toFixed(2)}`)}})),It(this)}startGame(){a("dreamMine")?this.gotoScene("mine-nightmare"):a("dreamFactory")?this.gotoScene("factory-nightmare"):a("dreamRecycling")?this.gotoScene("recycling-nightmare"):a("factory")?this.debugFactory():a("mine")?this.debugMine():a("recyclingCentre")?this.debugRecyclingCentre():Ot(this)}gotoScene(e){this.scene.pause("game"),this.scene.launch(e)}debugFactory(){this.scene.pause("game"),this.scene.launch("factory")}debugMine(){this.scene.pause("game"),this.scene.launch("mine")}debugRecyclingCentre(){this.scene.pause("game"),this.scene.launch("recyclingCentre")}resetGameSize(){this.scale.setGameSize(450,250)}setHeroPosition(e){const t=this.heroPositions[e];this.hero.setPosition(t.x,t.y)}stopMoving(){this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.hero.stopAndWait()}sleepGame(){this.scene.sleep("game"),this.scene.sleep("message")}wakeGame(e=!1){this.scene.wake("game"),this.scene.wake("message"),this.resetGameSize();const t=e?255:0;this.cameras.main.fadeIn(1e3,t,t,t)}addEventsListeners(){h.on(l,this.handleDiscussionReady,this),h.on(m,this.handleDiscussionStarted,this),h.on(u,this.handleDiscussionWaiting,this),h.on(g,this.handleDiscussionEnded,this),h.on(c,this.handleDiscussionAbort,this),h.on(p,this.handleDiscussionInProgress,this),h.on(C,this.handleScreenShutdown,this),h.on(v,this.listenEvents,this)}listenEvents(e){var t;K(e,"miner_first_met")&&(Ue(t=this,!1),$(t)),K(e,"pre_first_sleep")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&e.time.delayedCall(2e3,()=>ht(e))})}(this),K(e,"mine_access_validation")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(gt(e),e.cameras.main.fadeIn(1e3,0,0,0),e.isCinematic=!1)})}(this),K(e,"mine_start")&&jt(this),K(e,"mine_after")&&function(e){e.wakeGame(),E(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=H.NONE,J(e,!0),e.setHeroPosition("heroMine"),e.hero.slowLeft(),e.hero.animateToLeft(),Ue(e,!1,!0,!0),e.time.delayedCall(2e3,()=>{e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())})});const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(B(e),e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,()=>{e.scene.launch("mine-nightmare"),e.sleepGame()}),e.events.off("update",t))};e.events.on("update",t)}(this),K(e,"second_act_begin")&&function(e){e.wakeGame(!0),I(e),M(e),e.currentDiscussionStatus=H.NONE,st(e),e.setHeroPosition("heroDjangoDoor"),e.hero.slowRightDown(),e.hero.animateToRight(),e.time.delayedCall(1200,()=>{e.isCinematic=!1,h.emit(l,"django"),Ge(e)})}(this),K(e,"factory_start")&&Pt(this),K(e,"factory_after")&&function(e){e.wakeGame(),E(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=H.NONE,J(e,!0),Ue(e,!1,!0),e.whiteWorker1.setVisible(!1),e.whiteWorker2.setVisible(!1),e.whiteWorkerChief.setVisible(!1),e.setHeroPosition("heroFactory"),e.hero.slowDown(),e.hero.animateToDown(),e.time.delayedCall(2e3,()=>{e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())})});const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(B(e),e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,()=>{e.scene.launch("factory-nightmare"),e.sleepGame()}),e.events.off("update",t))};e.events.on("update",t)}(this),K(e,"third_act_begin")&&function(e){e.wakeGame(!0),Ke(e),e.cameras.main.fadeIn(1e3,0,0,0),e.setHeroPosition("heroDjangoDoor"),e.hero.slowRightDown(),e.hero.animateToRight(),e.time.delayedCall(1200,()=>{e.isCinematic=!1,h.emit(l,"django"),Ge(e)})}(this),K(e,"recycling_start")&&At(this),K(e,"recycling_after")&&function(e){e.wakeGame(),E(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=H.NONE,J(e,!0),Ue(e,!1,!0),e.blueWorkerChief.setVisible(!1),e.blueWorker1.setVisible(!1),e.blueWorker2.setVisible(!1),e.setHeroPosition("heroRecycling"),e.hero.slowDown(),e.hero.animateToDown(),e.time.delayedCall(1500,()=>{e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())})});const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(B(e),e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,()=>{e.scene.launch("recycling-nightmare"),e.sleepGame()}),e.events.off("update",t))};e.events.on("update",t)}(this),K(e,"fourth_act_begin")&&function(e){e.wakeGame(!0),e.isCinematic=!0,I(e),M(e),nt(e),e.cameras.main.fadeIn(1e3,0,0,0),e.datacentreThemeEnabled=!0,e.setHeroPosition("heroDjangoDoor"),e.hero.slowRightDown(),e.hero.animateToRight(),e.time.delayedCall(1200,()=>{e.isCinematic=!1,h.emit(l,"django"),Ge(e)})}(this),K(e,"django_ready_for_strike")&&function(e){e.isCinematic=!0,e.hero.stopAndWait(),e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(Lt(e),e.cameras.main.fadeIn(1e3,0,0,0,(t,s)=>{1===s&&(X(["strike_begin"]),e.isCinematic=!1)}))})}(this),K(e,"strike_end")&&function(e){e.isCinematic=!0,e.isBeforeFinal=!0,R(e),e.cameras.main.stopFollow(),e.tweens.add({targets:e.cameras.main,scrollY:e.cameras.main.scrollY-50,ease:"Sine.easeIn",duration:2e3}),e.cameras.main.fadeOut(2e3,0,0,0,(t,s)=>{1===s&&(e.sleepGame(),e.scene.launch("final-message"))})}(this),K(e,"after_final_message")&&function(e){e.wakeGame(),rt(e),e.isCinematic=!0,e.cameras.main.startFollow(e.hero,!0),e.setHeroPosition("heroFinal"),e.hero.slowRight(),e.hero.animateToRight(),e.cameras.main.fadeIn(2e3,0,0,0,(t,s)=>{1===s&&(e.isCinematic=!1)})}(this),K(e,"game_over")&&(!function(e){h.emit(c),e.isCinematic=!0,e.hero.stopAndWait(),e.twoGuys.disableChatIcon(),e.twoWomen.disableChatIcon(),e.time.delayedCall(1e3,()=>{e.cameras.main.stopFollow(),e.tweens.add({targets:e.cameras.main,scrollY:1300,ease:"Sine.easeIn",duration:8e3}),V(e,e.djangoTheme,4e3),V(e,e.villageAmbianceV1,4e3),e.cameras.main.fadeOut(4e3,0,0,0,(t,s)=>{if(1!==s)return;e.cameras.main.setBounds(0,0,e.map.widthInPixels,e.map.heightInPixels-8),I(e);const i=e.add.rectangle(0,0,450,250,0).setAlpha(.7).setOrigin(0,0).setScrollFactor(0).setDepth(2e3),a=()=>e.tweens.add({targets:i,alpha:1,duration:1e3}),n=()=>e.tweens.add({targets:i,alpha:.7,duration:1e3});e.cameras.main.setScroll(1,700),e.cameras.main.fadeIn(1e3,0,0,0);let r=!1;const o=e.add.text(50,120,"L'extraction minière est l'industrie la plus polluante au monde.",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff",resolution:Ct}).setWordWrapWidth(250).setScrollFactor(0).setAlpha(0).setDepth(2e3),d=()=>{o.setY(120),e.tweens.add({targets:o,alpha:1,y:100,ease:"Sine.easeOut",duration:1e3})},h=t=>{e.tweens.add({targets:o,alpha:0,y:80,ease:"Sine.easeIn",duration:1e3,onComplete:()=>{t&&(o.setText(t),d())}})};e.time.delayedCall(1e3,()=>d()),e.time.delayedCall(5e3,()=>h("La mine a des conséquences éternelles sur les habitants et les écosystèmes.")),e.time.delayedCall(1e4,()=>h("La production d'objets numériques épuise les ressources… et les ouvriers.")),e.time.delayedCall(15e3,()=>h("Le recyclage n'est pas une solution miracle…")),e.time.delayedCall(2e4,()=>h("Collectivement, réduisons le nombre et augmentons la durée de vie des objets numériques.")),e.time.delayedCall(25e3,()=>h("Et se mobiliser ou soutenir, si on le peut, les luttes qui ont du sens.")),e.time.delayedCall(29e3,()=>h("Ce jeu est dédié au vivant, humains compris, qui chaque jour paye de plus en plus cher, l'escalade technologique.")),e.time.delayedCall(37e3,()=>h("Merci d'avoir joué.")),e.time.delayedCall(4e4,()=>h()),e.tweens.add({targets:e.cameras.main,scrollX:1e3,scrollY:500,ease:"Sine.linear",duration:25e3,onUpdate:e=>{!r&&e.progress>.95&&(a(),r=!0)},onComplete:()=>{r=!1,e.cameras.main.setScroll(1100,1100),n(),e.tweens.add({targets:e.cameras.main,scrollY:500,ease:"Sine.linear",duration:16e3,onUpdate:e=>{!r&&e.progress>.95&&(a(),r=!0)},onComplete:()=>{r=!1,n(),e.cameras.main.setScroll(1500,500);const t=e.add.text(20,300,"Idée originale, game design et programmation\n\n  Richard Hanna\n\nGraphisme, level design et game design\n\n  Philippe Salib\n\nGame design, narration, musiques et effets sonores\n\n  David Fonteix.",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff",resolution:Ct}).setWordWrapWidth(350).setScrollFactor(0).setDepth(2e3);e.tweens.add({targets:t,y:20,ease:"Sine.easeOut",duration:15e3}),e.tweens.add({targets:e.cameras.main,scrollY:1100,ease:"Sine.linear",duration:24e3,onUpdate:t=>{!r&&t.progress>.95&&(r=!0,V(e,e.villageTheme),e.cameras.main.fadeOut(2e3,0,0,0,(e,t)=>{1===t&&window.setTimeout(()=>window.location.href="?bonus",2e3)}))}})}})}})})})}(this),r("Game",this.timeStart))}handleDiscussionReady(e){if(this.scene.isActive()){if(this.currentDiscussionStatus===H.READY&&this.currentDiscussionSprite!==e)console.log("abort",this.currentDiscussionSprite,e),this.handleDiscussionAbort(this.currentDiscussionSprite);else if(this.currentDiscussionStatus!==H.NONE)return;this.currentDiscussionStatus=H.READY,this.currentDiscussionSprite=e}}handleDiscussionInProgress(){this.scene.isActive()&&(this.currentDiscussionStatus=H.INPROGRESS)}handleDiscussionStarted(){this.scene.isActive()&&(console.log("handleDiscussionStarted"),this.currentDiscussionStatus=H.STARTED)}handleDiscussionWaiting(e){this.scene.isActive()&&(this.currentDiscussionStatus=H.WAITING)}handleDiscussionEnded(e){this.scene.isActive()&&(e&&this[e]||"screen"===e.substring(0,6))&&(console.log("handleDiscussionEnded",e),this.currentDiscussionStatus=H.NONE,this[e]?.stopChatting())}handleDiscussionAbort(e){this.scene.isActive()&&e&&this[e]&&(this.currentDiscussionStatus=H.NONE,this[e]?.abortChatting())}handleScreenShutdown(e){var t;this.screenShutDownCount++,3===this.screenShutDownCount&&(X(["screens_shutdown"]),(t=this).isCinematic=!0,t.hero.stopAndWait(),t.cameras.main.fadeOut(1e3,0,0,0,(e,s)=>{1===s&&(L(t),t.screenOffSprites.forEach(e=>e.shutdown()),t.setHeroPosition("heroDjangoRight"),t.hero.slowLeft(),t.hero.animateToLeft(),t.cameras.main.fadeIn(1e3,0,0,0,(e,s)=>{1===s&&(t.isCinematic=!1,h.emit(l,"django"),Ge(t))}))}))}update(e,t){if(this.night&&this.darkOverlay&&function(e){const t=e.hero.x-e.scale.width,s=e.hero.y-e.scale.height;e.nightOverlays.forEach(e=>e.setPosition(t,s)),e.maskNightOverlays.forEach(e=>e.setPosition(t,s)),e.darkOverlay.setPosition(e.hero.x,e.hero.y)}(this),this.cursors&&this.hero&&!this.isCinematic&&this.hero.body){if(this.hero.resetVelocity(),[H.STARTED,H.WAITING,H.INPROGRESS].includes(this.currentDiscussionStatus))return console.log("stopAndWait",this.currentDiscussionStatus),void this.hero.stopAndWait();if(this.goingLeft?this.hero.goLeft():this.goingRight&&this.hero.goRight(),this.goingUp?this.hero.goUp():this.goingDown&&this.hero.goDown(),this.goingLeft||this.goingUp||this.goingDown||this.goingRight?this.hero.playMoveSound():this.hero.stopMoveSound(),this.goingUp){this.hero.animateToUp();const e=this.heroPositions.heroDjangoDoor;this.checkDjangoDoor&&this.hero.x>e.x-8&&this.hero.x<e.x+8&&this.hero.y>e.y-5&&this.hero.y<e.y+5&&(this.hero.stopAndWait(),h.emit(l,"django"),Ge(this))}else this.goingDown?this.hero.animateToDown():this.goingRight?this.hero.animateToRight():this.goingLeft&&this.hero.animateToLeft();a("nomusic")||this.isBeforeFinal||this.isFinal||(this.night?E(this):this.hero.y<445||this.miner&&this.hero.x>this.miner.x+25||this.hero.x<880&&this.hero.y<615||this.datacentreThemeEnabled&&this.hero.x>1110&&this.hero.x<1500&&this.hero.y>984&&this.hero.y<1210?L(this):this.hero.x>1120?(I(this),M(this)):M(this)),this.goingDown||this.goingUp||this.goingRight||this.goingLeft||this.stopMoving()}}}const Bt=2e3;class Mt extends e.Scene{constructor(e){super(e),this.sounds=[]}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json"),this.load.image("vignette","img/vignette.png")}create(){let e;if(this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.currentDiscussionStatus=H.NONE,this.anims.create({key:"speaker-off-anim",frames:[{key:"ui",frame:"speaker-off"}],repeat:-1,frameRate:1}),this.anims.create({key:"speaker-on-anim",frames:[{key:"ui",frame:"speaker-off"},{key:"ui",frame:"speaker-on"}],repeat:-1,frameRate:8}),this.anims.create({key:"dialog-shout-anim",frames:[{key:"ui",frame:"dialog-shout-1"},{key:"ui",frame:"dialog-shout-2"}],repeat:-1,frameRate:8}),this.anims.create({key:"score-warning",frames:[{key:"ui",frame:"scoreok"},{key:"ui",frame:"scoreko"}],repeat:5,frameRate:8}),this.scores=[],this?.verticalScore){e=this.add.sprite(6,0,"ui","scoreboard-vertical").setOrigin(0,0);for(let e=0;e<=2;e++)this.scores.push(this.add.sprite(14,19+24*e,"ui","scoreok").setOrigin(0,0))}else{e=this.add.sprite(4,0,"ui","scoreboard").setOrigin(0,0);for(let e=0;e<=2;e++)this.scores.push(this.add.sprite(12+24*e,22,"ui","scoreok").setOrigin(0,0))}this.scoreBoardContainer=this.add.container(0,-95,[e,this.scores[0],this.scores[1],this.scores[2]]),this.scoreBoardContainer.setDepth(Bt),this.speaker=this.add.sprite(470,0,"ui","speaker-off").setOrigin(0,0).setDepth(Bt),this.dialogBackground=this.add.sprite(345,50,"ui","dialog-shout-1").setOrigin(.5,.5).setDepth(Bt).setAlpha(.8).setVisible(!1),this.dialogBackground.anims.play("dialog-shout-anim",!0),this.textObject=this.add.text(345,50,"",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setResolution(Ct).setOrigin(.5,.5).setScrollFactor(0).setDepth(Bt).setWordWrapWidth(240).setVisible(!1),h.on(m,this.handleDiscussionStarted,this),h.on(u,this.handleDiscussionWaiting,this),h.on(g,this.handleDiscussionEnded,this),h.on(v,this.listenUnlockedEvents,this),h.on(b,this.handleMessage,this),W("sfx_mini-jeu_haut-parleur",this),W("sfx_mini-jeu_erreur_2",this),W("sfx_mini-jeu_erreur_3",this),W("sfx_mini-jeu_apparition_panneau_erreurs_2",this)}listenUnlockedEvents(e){console.log(e.newUnlockedEvents),["mine_show_score_board","factory_show_score_board","recycling_show_score_board"].includes(e.newUnlockedEvents[0])&&this.showScoreBoard()}showScoreBoard(){G("sfx_mini-jeu_apparition_panneau_erreurs_2",this,!1,.7),this.tweens.add({targets:this.scoreBoardContainer,y:0,ease:"Sine.easeOut",duration:1500})}startDiscussion(e){h.emit(m,e)}handleMessage(e){const{message:t,sprite:s}=e;this.updateMessage(t,!0)}updateMessage(e,t=!1){this.scene.isActive()&&(G("sfx_mini-jeu_haut-parleur",this,!1,.5),this.dialogBackground.setVisible(!0),this.speaker.anims.play("speaker-on-anim"),this.textObject.text=e,this.textObject.setVisible(!0),t?this.time.delayedCall(200,()=>h.emit(u)):this.time.delayedCall(2500,()=>{this.currentDiscussionStatus===H.NONE&&this.handleDiscussionEnded()}))}updateWarnings(e){G(e<=2?"sfx_mini-jeu_erreur_3":"sfx_mini-jeu_erreur_2",this,!0,1),e>3&&(e=3);for(let t=0;t<e;t++)this.scores[t].anims.play("score-warning",!0)}handleAction(){if(this.scene.isActive())return this.currentDiscussionStatus===H.WAITING?(this.currentDiscussionStatus=H.STARTED,void h.emit(y)):void 0}handleDiscussionStarted(){this.scene.isActive()&&(this.currentDiscussionStatus=H.STARTED)}handleDiscussionWaiting(){this.scene.isActive()&&(this.currentDiscussionStatus=H.WAITING)}handleDiscussionEnded(){this.scene.isActive()&&(this.currentDiscussionStatus=H.NONE,this.textObject.setVisible(!1),this.speaker.anims.play("speaker-off-anim"),this.dialogBackground.setVisible(!1))}}const Rt={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},Ft=265,Et=10,Vt=10,Nt=255,Wt=340;class Gt extends e.Scene{constructor(){super({key:"mine-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.stopWater=!0}preload(){this.load.atlas("mine","sprites/mine.png","sprites/mine.json"),this.load.image("vignette","img/vignette.png")}create(){this.timeStart=Date.now(),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.createRock(500,250,50,50,"rock-1"),this.createRock(50,250,500,50,"rock-2"),this.createRock(50,50,500,250,"rock-3"),this.createRock(100,200,300,20,"rock-4"),this.tube=this.add.container(),this.tube.add(this.add.tileSprite(0,-33,22,1e3,"mine","tube").setOrigin(.5,1)),this.tube.add(this.add.image(0,0,"mine","tube-end").setOrigin(.43,1)),this.tube.setDepth(1e3).setAlpha(0),this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:2e3,quantity:100,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.tweens.add({targets:this.tube,angle:180,alpha:1,x:500,y:216,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress<.2,e.progress>.8&&this.water.updateConfig({frame:["water-maroon"]})},onComplete:()=>{this.tweens.add({targets:this.tube,angle:180,alpha:0,x:400,y:20,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress>.9}})}})}endScene(){this.cameras.main.fadeOut(1e3,255,255,255,(e,t)=>{1===t&&(r("Dream mine",this.timeStart),this.scene.stop(),X(["second_act_begin"]))})}createRock(e,t,s,i,a){const n=this.add.image(e,t,"mine",a);return n.setAlpha(0),this.tweens.add({targets:n,alpha:.8,ease:"Sine.linear",duration:5e3,onComplete:()=>{this.tweens.add({targets:n,x:s,y:i,alpha:0,ease:"Sine.linear",duration:5e3})}}),this.tweens.add({targets:n,angle:360,x:s,y:i,alpha:.8,ease:"Sine.linear",duration:1e4}),n}update(){this.stopWater||(this.water.emitParticleAt(this.tube.x,this.tube.y),this.water.updateConfig({angle:{min:this.tube.angle+100,max:this.tube.angle+80}}))}}const Ut=[110,175,237],qt=[60,125,187],zt=[.8,1,1.2],Yt=n("numberRockValidatedBeforeSpeedIncrement",5),Ht=n("numberRocksValidatedBeforeSpeedIncrementAgain",30),Kt=n("waterReductionFactor",.2),Xt=n("waterRefillFactor",.5),$t=n("numberRockValidatedToHaveMoreMaterials",12),Jt=n("timeBetweenRocks",2e3),Qt=n("moreMaterialsTimeBetweenRocks",1e3),Zt=n("numberIsRefined",60),es=n("tubeSpeed",5),ts=n("tubeDeltaEffect",40);const ss=["console","laptop","phone"],is={console:12469059,laptop:7260614,phone:12623450};class as extends Phaser.GameObjects.Rectangle{constructor(e,t,s,i){const a=Phaser.Math.RND.pick([13421772,i]);super(e,t,s,Phaser.Math.Between(2,6),Phaser.Math.Between(2,6),a),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!0),this.body.setVelocityX(Phaser.Math.Between(-200,200)),this.body.setVelocityY(Phaser.Math.Between(-100,100)),this.init()}init(){this.scene.tweens.add({targets:this,duration:800,scale:{from:1,to:0},onComplete:()=>{this.destroy()}})}}const ns={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},rs=[{x:275,y:10},{x:400,y:50},{x:475,y:150},{x:400,y:250},{x:275,y:290},{x:150,y:250},{x:75,y:150},{x:150,y:50}];class os extends e.Scene{constructor(){super({key:"factory-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.conveyorPosition=0}preload(){this.load.atlas("factory","sprites/factory.png","sprites/factory.json"),this.load.image("vignette","img/vignette.png")}create(){this.timeStart=Date.now(),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0).setDepth(1),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.conveyor=this.add.tileSprite(275,150,700,96,"factory","tapis").setAlpha(0),this.tweens.add({targets:this.conveyor,alpha:.5,ease:"Sine.linear",duration:5e3}),this.tweens.add({targets:this.conveyor,angle:360,ease:"Sine.linear",duration:15e3});for(const t of rs){const e=this.add.image(t.x,t.y,"factory","motherboard").setAlpha(0);this.tweens.add({targets:e,alpha:.5,duration:5e3}),this.tweens.add({targets:e,angle:360,scale:4,ease:"Sine.linear",duration:15e3})}let e=0;for(const t of Object.values(ns)){e++;const s=this.add.image(850-50*e,10+50*e,"factory",t).setAlpha(.7).setDepth(1);this.tweens.add({targets:s,scale:4,angle:360,x:-80*e,ease:"Sine.linear",duration:15e3})}}endScene(){this.cameras.main.fadeOut(1e3,255,255,255,(e,t)=>{1===t&&(r("Dream factory",this.timeStart),this.scene.stop(),X(["third_act_begin"]))})}update(){this.conveyorPosition-=1,this.conveyor.setTilePosition(this.conveyorPosition,0)}}class ds extends e.Scene{constructor(){super({key:"recycling-nightmare",physics:{matter:{debug:i(),gravity:{y:0}}}}),this.delayBetweenObjects=450}preload(){this.load.atlas("recyclingCentre","sprites/recyclingCentre.png","sprites/recyclingCentre.json"),this.load.image("vignette","img/vignette.png")}create(){this.matter.world.setGravity(0,0),this.matter.world.setBounds(0,0,550,300),this.timeStart=Date.now(),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0).setDepth(1),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.time.delayedCall(1e3,()=>this.addObject())}addObject(){const t=e.Math.RND.pick(ss);e.Math.Between(100,450);const s=this.matter.add.image(275,150,"recyclingCentre",t+"-broken");s.setAlpha(0),s.applyForce({x:e.Math.RND.pick([-.01,.01]),y:e.Math.RND.pick([-.01,.01])}),this.tweens.add({targets:s,alpha:.7,ease:"Sine.linear",duration:500}),this.delayBetweenObjects-=10,this.delayBetweenObjects<10&&(this.delayBetweenObjects=10,this.createDebris(e.Math.Between(100,450),e.Math.Between(50,250),t));const i=this.delayBetweenObjects;this.time.delayedCall(i,()=>this.addObject()),a("dreamRecycling")&&B(this)}createDebris(t,s,i){const a=is[i];Array(e.Math.Between(20,40)).fill(0).forEach(e=>new as(this,t,s,a))}endScene(){this.cameras.main.fadeOut(2e3,255,255,255,(e,t)=>{1===t&&(this.scene.stop(),X(["fourth_act_begin"]))})}}class hs extends e.Scene{constructor(){super("final-message")}create(){console.log("final message"),this.cameras.main.fadeIn(2e3,0,0,0);const e=this.add.text(225,100,"Quelques temps plus tard…",{fontFamily:"DefaultFont",fontSize:kt,fill:"#ffffff"}).setScrollFactor(0).setOrigin(.5,.5).setResolution(Ct).setDepth(1e4);this.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",delay:2e3,duration:2e3,onComplete:()=>this.endScene()})}endScene(){this.scene.stop(),X(["after_final_message"])}}const ls={type:t.AUTO,parent:"game",pixelArt:!0,render:{pixelArt:!0},width:450,height:250,backgroundColor:"#000000",physics:{default:"arcade",arcade:{debug:i(),gravity:{y:0}}},scene:[d,Tt,Gt,class extends Mt{constructor(){super("mine"),this.verticalScore=!0,this.rocks=[],this.movingCable=!1,this.rockValidated=0,this.rockNotValidated=0,this.speed=zt,this.control="none",this.waterStockPercentage=100,this.rechargeWater=!1,this.conveyor=[],this.conveyorPosition=[0,0,0],this.tubeRollings=[],this.tubeCurrentY=0,this.goingDown=!0,this.isCinematic=!0,this.firstStep=!0,this.faster=!1,this.fasterAgain=!1,this.moreMaterials=!1,this.warnings=0,this.mainScene=null}preload(){super.preload(),this.load.atlas("mine","sprites/mine.png","sprites/mine.json")}create(){super.create(),this.mainScene=this.scene.get("game"),this.cameras.main.setBackgroundColor(3154462),this.scale.setGameSize(550,300),this.add.image(275,0,"mine","background").setOrigin(.5,0).setScale(-1,1),this.add.image(180,46,"mine","water-tank");const t=this.add.bitmapMask(null,197,35,"mine","water-tank-mask");this.waterStock=this.add.image(197,46,"mine","water"),this.waterStock.setMask(t),this.add.image(197,46,"mine","water-glass"),this.add.image(197,18,"mine","water-tank-top"),this.conveyor.push(this.add.tileSprite(0,92,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(0,140,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,156,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(10,204,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,220,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(5,268,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.add.image(509,169,"mine","right-block").setOrigin(.5,.5).setDepth(1e3),this.add.image(474,69,"mine","block-bottom").setOrigin(.5,.5).setDepth(1),this.add.image(474,133,"mine","block-bottom").setOrigin(.5,.5).setDepth(10),this.add.image(474,197,"mine","block-bottom").setOrigin(.5,.5).setDepth(20),this.add.image(515,257,"mine","right-glass").setOrigin(.5,.5).setDepth(1e3),this.add.image(40,169,"mine","right-block").setOrigin(.5,.5).setScale(-1,1).setDepth(1e3),this.add.image(75,69,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(1),this.add.image(75,133,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(10),this.add.image(75,197,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(20),this.add.image(35,257,"mine","left-glass").setOrigin(.5,.5).setDepth(1e3),this.anims.create({key:"particules",frames:this.anims.generateFrameNames("mine",{start:1,end:4,prefix:"particules-"}),repeat:-1,frameRate:10}),this.rockParticles=this.add.sprite(275,202,"mine","particules-1").setOrigin(.5,.5).setVisible(!1),this.rockParticles.anims.play("particules",!0),this.tube=this.add.tileSprite(0,0,22,1e3,"mine","tube").setOrigin(.5,1).setDepth(1e3),this.tubeEnd=this.add.image(275,50,"mine","tube-end").setOrigin(.43,1).setDepth(1e3),this.add.image(64,0,"mine","tube-top").setOrigin(0,0).setDepth(1e3);for(let e=0;e<3;e++)this.tubeRollings.push(this.add.sprite(80+13*e,2,"mine","tube-rolling-1").setOrigin(0,0).setDepth(1e3));this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:320,quantity:50,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.events.on("update",()=>{this.isCinematic||(!this.rechargeWater&&this.action&&this.waterStockPercentage>0?(G("sfx_mini-jeu_jet-eau",this,!1,.5,!0),this.water.emitParticleAt(this.tubeEnd.x,this.tubeEnd.y),this.water.forEachAlive(t=>{const s=Ut[this.tubeCurrentY]+e.Math.Between(0,30);t.y>=s&&(t.y=s,t.velocityY*=-e.Math.Between(1,100)/100,t.velocityX*=e.Math.Between(1,20)/10)}),this.waterStockPercentage-=Kt,this.waterStockPercentage<=0&&(this.waterStockPercentage=0,this.rechargeWater=!0,this.updateMessage(wt("mine.waterEmpty")))):(U("sfx_mini-jeu_jet-eau",this),this.waterStockPercentage+=Xt,this.waterStockPercentage>=100&&(this.waterStockPercentage=100),this.rechargeWater&&100===this.waterStockPercentage&&(this.rechargeWater=!1,this.updateMessage(wt("mine.waterFull")))),this.waterStock.y=46+54*(100-this.waterStockPercentage)/100,this.waterStock.setVisible(this.waterStockPercentage>5))}),h.on(w,this.listenDispatchedEvents,this),a("bypassminigame")?this.endGame():(W("sfx_mini-jeu_jet-eau",this),W("sfx_mini-jeu_caillou_desagrege",this),W("sfx_mini-jeu_deplacement_tuyau",this),W("sfx_mini-jeu_reussite_3",this),this.createControls(),this.startGame())}createControls(){this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",e=>{"ArrowUp"===e.key?(this.goingUp=!0,this.goingDown=!1):"ArrowDown"===e.key?(this.goingDown=!0,this.goingUp=!1):"ArrowLeft"===e.key?(this.goingLeft=!0,this.goingRight=!1):"ArrowRight"===e.key?(this.goingRight=!0,this.goingLeft=!1):32===e.keyCode&&(this.action=!0,this.handleAction())},this),this.input.keyboard.on("keyup",e=>{"ArrowUp"==e.key?this.goingUp=!1:"ArrowDown"==e.key?this.goingDown=!1:"ArrowLeft"==e.key?this.goingLeft=!1:"ArrowRight"==e.key?this.goingRight=!1:32===e.keyCode&&(this.action=!1)},this),o()&&(this.joystick=this.plugins.get("rexvirtualjoystickplugin").add(this,{x:100,y:200,radius:100,base:this.add.circle(0,0,50,16733508,.4).setDepth(1e4),thumb:this.add.circle(0,0,30,13421772,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),this.input.on("pointerdown",e=>{this.joystick.setPosition(e.x,e.y),this.joystick.setVisible(!0),this.action=!0,this.handleAction()},this),this.joystick.on("update",function(){this.goingAngle=this.joystick.angle,this.joystick.left?(this.goingLeft=!0,this.goingRight=!1,(177.5<this.goingAngle||-177.5>this.goingAngle)&&(this.goingUp=!1,this.goingDown=!1)):this.joystick.right&&(this.goingRight=!0,this.goingLeft=!1,22.5>this.goingAngle&&-22.5<this.goingAngle&&(this.goingUp=!1,this.goingDown=!1)),this.joystick.up?(this.goingUp=!0,this.goingDown=!1,-67.5>this.goingAngle&&-112.5<this.goingAngle&&(this.goingRight=!1,this.goingLeft=!1)):this.joystick.down&&(this.goingDown=!0,this.goingUp=!1,67.5<this.goingAngle&&112.5>this.goingAngle&&(this.goingRight=!1,this.goingLeft=!1))},this),this.joystick.on("pointerup",()=>{this.joystick.setVisible(!1),this.action=!1,this.goingUp=!1,this.goingDown=!1,this.goingRight=!1,this.goingLeft=!1},this))}listenUnlockedEvents(e){super.listenUnlockedEvents(e),K(e,"mine_after_tuto")&&this.afterTuto(),K(e,"mine_end")&&this.endGame()}listenDispatchedEvents(e){K(e,"mine_tuto_begin")&&this.tutoBegin()}tutoBegin(){this.isCinematic=!1,this.firstStep=!0,this.createRock()}tutoEnd(){U("sfx_mini-jeu_jet-eau",this),this.isCinematic=!0,X(["mine_tuto_end"]),this.startDiscussion("mine")}tutoMissed(){U("sfx_mini-jeu_jet-eau",this),X(["mine_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("mine")}afterTuto(){this.isCinematic=!1,this.firstStep=!1,this.createRock()}startGame(){this.timeStart=Date.now(),a("mine")&&T(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.delayedCall(1e3,()=>this.startDiscussion("mine"))}endGame(){r("Mine",this.timeStart),this.mainScene.isBonus&&V(this.mainScene,this.mainScene.miniGameTheme),this.cameras.main.fadeOut(1e3,0,0,0,(e,t)=>{1===t&&(this.scene.stop(),X(["mine_after"]))})}createRock(){const t=e.Math.Between(0,2),s=Ut[t],i=this.add.sprite(600,s,"mine","rock-1");i.setDepth(1+10*t);const a=this.rocks.length?e.Math.Between(0,Math.round(.9*Zt)):0;this.setRockTexture(i,a),this.rocks.push({rock:i,index:t,refined:a}),this.firstStep||this.time.addEvent({callback:()=>{this.createRock(),this.moreMaterials||this.rockValidated!==$t||(this.moreMaterials=!0,this.updateMessage(wt("mine.moreMaterials")))},delay:this.rockValidated>$t?Qt:Jt})}gameOver(){this.isCinematic=!0,this.isGameOver=!0,U("sfx_mini-jeu_jet-eau",this),U("sfx_mini-jeu_deplacement_tuyau",this),this.rockParticles.setVisible(!1),X(["mine_game_over"]),this.startDiscussion("mine")}updateStep(){this.firstStep&&(this.rockValidated?this.tutoEnd():this.tutoMissed()),this.faster||this.rockValidated!==Yt||(this.faster=!0,this.speed.forEach((e,t)=>this.speed[t]+=.6),this.updateMessage(wt("mine.faster"))),this.fasterAgain||this.rockValidated!==Ht||(this.fasterAgain=!0,this.speed.forEach((e,t)=>this.speed[t]+=.6),this.updateMessage(wt("mine.fasterAgain")));const e=this.rockValidated+this.rockNotValidated,t=Math.round(100*this.rockValidated/(e||1));console.log(t+" % ("+this.rockValidated+" / "+e+")");(this.rockNotValidated>5&&1)+(this.rockNotValidated>20&&1)+(this.rockNotValidated>30&&1)>this.warnings&&(this.warnings++,this.updateMessage(wt(2===this.warnings?"mine.lastWarning":"mine.warning")),this.updateWarnings(this.warnings),3===this.warnings)&&this.gameOver()}updateWaterDepth(){this.water.setDepth(10*this.tubeCurrentY+11)}up(){this.movingCable?this.tubeMoving=!0:this.tubeCurrentY>0&&(this.tubeCurrentY--,this.moveCable(),this.updateWaterDepth(),this.tubeMoving=!0)}down(){this.movingCable?this.tubeMoving=!0:this.tubeCurrentY<2&&(this.tubeCurrentY++,this.moveCable(),this.updateWaterDepth(),this.tubeMoving=!0)}moveCable(){this.movingCable=!0,this.tweens.add({targets:this.tubeEnd,y:qt[this.tubeCurrentY],ease:"Sine.easeInOut",duration:300,onComplete:()=>{this.movingCable=!1}})}setRockTexture(e,t){const s=Math.floor(6*t/Zt);e.setTexture("mine","rock-"+(s||1))}whenTubeMoving(){G("sfx_mini-jeu_deplacement_tuyau",this,!1,1,!0)}stopTubeMoving(){U("sfx_mini-jeu_deplacement_tuyau",this)}update(e,t){if(!this.isGameOver){this.rockParticles.setVisible(!1),this.tubeRollings.forEach((e,t)=>e.x=this.tubeEnd.x-22+16*t),this.tubeMoving=!1,this.goingUp&&this.tubeEnd.y>50?this.up():this.goingDown&&this.tubeEnd.y<200&&this.down(),this.goingLeft&&this.tubeEnd.x>100?(this.tubeEnd.x-=es,this.tubeMoving=!0):this.goingRight&&this.tubeEnd.x<450&&(this.tubeEnd.x+=es,this.tubeMoving=!0),this.tubeMoving?this.whenTubeMoving():this.stopTubeMoving(),this.tube.x=this.tubeEnd.x,this.tube.y=this.tubeEnd.y-34,this.conveyor.forEach((e,t)=>{this.conveyorPosition[t]+=this.speed[t],e.setTilePosition(this.conveyorPosition[t],0)});for(const e in this.rocks){const t=this.rocks[e],s=t.rock;s.x-=this.speed[t.index],s.x<-20&&(this.rocks.splice(e,1),s.destroy(),t.refined<Zt&&(this.rockNotValidated++,this.updateStep())),t.refined>=Zt||s.y<this.tubeEnd.y+50+25&&s.y>this.tubeEnd.y+50-25&&this.action&&!this.rechargeWater&&s.x>this.tubeEnd.x-ts&&s.x<this.tubeEnd.x+ts&&(G("sfx_mini-jeu_caillou_desagrege",this,!1,1),t.refined++,this.setRockTexture(s,t.refined),this.rockParticles.setVisible(!0),this.rockParticles.setDepth(s.depth),this.rockParticles.setPosition(s.x,s.y-25),t.refined>=Zt&&(G("sfx_mini-jeu_reussite_3",this,!0),this.rockValidated++,this.updateStep()))}}}},os,class extends Mt{constructor(){super({key:"factory"}),this.componentsLine=[],this.motherBoard=[],this.componentsLinePosition=0,this.componentValidated=0,this.isMotherboardValidated=!1,this.motherboardSpeed=.75,this.numberValidated=0,this.enableComponentsControl=!1,this.conveyorPosition=0,this.conveyorRollings=[],this.conveyorBackPosition=0,this.warnings=0,this.motherBoardComponents=[],this.firstStep=!1,this.indexSoundComponentValidated=1}preload(){super.preload(),this.load.atlas("factory","sprites/factory.png","sprites/factory.json")}create(){this.timeStart=Date.now(),super.create(),this.cameras.main.setBackgroundColor(0),this.scale.setGameSize(550,300),this.anims.create({key:"select-component-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:3,prefix:"select-"}),repeat:-1,frameRate:10}).addFrame(this.anims.generateFrameNames("factory",{start:2,end:2,prefix:"select-"})),this.anims.create({key:"water-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:2,prefix:"water-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling-fast",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:20}),this.add.image(0,234,"factory","ground").setOrigin(0,0),this.add.tileSprite(-4,-36,554,135,"factory","sol").setOrigin(0,0),this.conveyorInBack=this.add.tileSprite(0,-10,550,96,"factory","tapis").setOrigin(0,0),this.initBackMotherboard(),this.addBackHands(),this.add.tileSprite(0,0,150,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(150,0,67,99,"factory","vitre").setOrigin(0,0),this.add.tileSprite(217,0,350,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(0,99,550,135,"factory","sol").setOrigin(0,0);this.add.image(474,97,"factory","block-back"),this.conveyor=this.add.tileSprite(0,105,550,96,"factory","tapis").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0),this.add.tileSprite(45,201,550,11,"factory","rouleaubas").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0).setScale(-1,1),this.add.tileSprite(0,201,14,11,"factory","rouleaubas").setOrigin(0,0);for(let e=0;e<3;e++)this.conveyorRollings.push(this.add.sprite(8*e-3,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));for(let e=0;e<54;e++)this.conveyorRollings.push(this.add.sprite(40+8*e,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));this.add.image(510,140,"factory","block").setDepth(10),this.add.image(476,97,"factory","tube-water").setDepth(10),this.add.image(476,117,"factory","tube-water").setDepth(10),this.add.image(476,137,"factory","tube-water").setDepth(10),this.waterCleaningAnims=[];for(let e=0;e<=2;e++){const t=this.add.sprite(457,124+20*e,"factory","water-1").setDepth(10).setVisible(!1);t.anims.play("water-anim"),this.waterCleaningAnims.push(t)}this.initComponents(),this.initSelectedComponent(),this.userLeftHand=this.add.image(Nt,Wt,"factory","gant").setOrigin(0,0),this.userLeftHand.scaleY=-1,this.userLeftHand.setDepth(10).setVisible(!1),this.cameras.main.fadeIn(1e3,0,0,0),h.on(w,this.listenDispatchedEvents,this),a("bypassminigame")?this.endGame():(W("sfx_mini-jeu_roulement_puces",this),W("sfx_mini-jeu_puce-bonne_1",this),W("sfx_mini-jeu_puce-bonne_2",this),W("sfx_mini-jeu_puce-bonne_3",this),W("sfx_mini-jeu_puce-mauvaise_2",this),W("sfx_mini-jeu_reussite_3",this),W("sfx_mini-jeu_jet-eau",this),this.createControls(),this.startGame())}startGame(){a("factory")&&T(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.delayedCall(1e3,()=>this.startDiscussion("factory"))}gameOver(){this.isCinematic=!0,this.isGameOver=!0,X(["factory_game_over"]),this.startDiscussion("factory")}endGame(){console.log("Validated",this.numberValidated),r("Factory",this.timeStart),this.cameras.main.fadeOut(1e3,0,0,0,(e,t)=>{1===t&&(this.scene.stop(),X(["factory_after"]))})}listenDispatchedEvents(e){K(e,"factory_tuto_begin")&&this.tutoBegin()}listenUnlockedEvents(e){super.listenUnlockedEvents(e),K(e,"factory_after_tuto")&&this.afterTuto(),K(e,"factory_end")&&this.endGame()}tutoBegin(){console.log("tutoBegin"),this.isCinematic=!1,this.firstStep=!0,this.initMotherboard()}tutoMissed(){X(["factory_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("factory")}tutoEnd(){console.log("tutoEnd"),this.isCinematic=!0,X(["factory_tuto_end"]),this.startDiscussion("factory")}afterTuto(){console.log("afterTuto"),this.isCinematic=!1,this.firstStep=!1,this.initMotherboard()}addBackHands(){this.leftHand=this.add.image(420,-10,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand,x:300,y:-100,angle:40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:200,duration:1e3}),this.rightHand=this.add.image(330,-10,"factory","gant").setOrigin(0,0),this.rightHand.scaleX=-1,this.tweens.add({targets:this.rightHand,x:350,y:-100,angle:-40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:800}),this.leftHand2=this.add.image(200,-12,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand2,x:200,y:-80,angle:30,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:250,duration:800}),this.rightHand2=this.add.image(100,-12,"factory","gant").setOrigin(0,0),this.rightHand2.scaleX=-1,this.tweens.add({targets:this.rightHand2,x:150,y:-90,angle:-25,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:900})}initComponents(){let e=0;for(const t in Rt)this.componentsLine.push({name:t,tray:this.add.image(275+90*e,Ft,"factory",`tray-${t}`),image:this.add.image(275+90*e,Ft,"factory",Rt[t])}),e++}getComponentsNumber(){return this.numberValidated>5?3:2}initBackMotherboard(){this.backMotherboards=[];for(let e=0;e<=5;e++)this.backMotherboards.push(this.add.image(600+100*e,30,"factory","motherboard"))}initMotherboard(){this.enableComponentsControl=!1,this.time.delayedCall(1e3,()=>this.enableComponentsControl=!0);const t=-150,s=this.getComponentsNumber(),i=70/s;this.componentValidated=0,this.isMotherboardValidated=!1,this.motherBoardComponents=[],this.motherBoard=[],this.motherBoard.push(this.add.image(t,150,"factory","motherboard"));const a=[],n=Object.keys(Rt);for(let l=0;l<s;l++){const t=e.Math.RND.pick(n);a.push(t),n.splice(n.indexOf(t),1)}let r=[2,1];if(s>2)if("green"===a[0])r=[1,2];else if("green"===a[1]){const e=a[2];a[2]="green",a[1]=e}let o=0,d=0;const h=[...r];a.forEach((e,t)=>{let a;2===s?a=this.add.image(i*t-168,150,"factory",`component-position-${e}`):(0===h[o]&&(o++,d=0),r[o],a=this.add.image((i+9)*o-165,1===r[o]?150:135+(i+5)*d,"factory",`component-position-${e}`),h[o]--,d++),this.motherBoardComponents.push({name:e,component:a,validated:!1}),this.motherBoard.push(a)}),this.enableComponentsControl=!0}initSelectedComponent(){this.add.sprite(275,263,"factory","select-1").anims.play("select-component-anim")}createControls(){if(this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",e=>{"ArrowUp"===e.key?this.handleAction():"ArrowLeft"===e.key?this.left():"ArrowRight"===e.key?this.right():32===e.keyCode&&this.handleAction()},this),o()){const e=80,t=225,s={fontFamily:"DefaultFont",fontSize:"32px",fill:"#ffffff"};this.add.text(70,t,"←",s).setResolution(Ct).setOrigin(.5,.5).setDepth(1e4),this.add.circle(70,t,30,16733508,.3).setDepth(1e4),this.add.text(275,t,"↑",s).setResolution(Ct).setOrigin(.5,.5).setDepth(1e4),this.add.circle(275,t,30,16733508,.3).setDepth(1e4),this.add.text(480,t,"→",s).setResolution(Ct).setOrigin(.5,.5).setDepth(1e4),this.add.circle(480,t,30,16733508,.3).setDepth(1e4),this.input.on("pointerdown",t=>{t.x<275-e?this.left():t.x>275+e?this.right():this.handleAction()},this)}}handleAction(){super.handleAction(),this.currentDiscussionStatus===H.NONE&&this.setComponent()}refreshComponentsLine(){let e=0;this.componentsLine.forEach(t=>{const s=275+90*this.componentsLinePosition+90*e;t.image.x=s,t.tray.x=s,t.image.y=Ft,e++})}right(){!this.enableComponentsControl||this.componentsLinePosition-1<-1*this.componentsLine.length+1||(G("sfx_mini-jeu_roulement_puces",this,!1,.5),this.componentsLinePosition--,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=1,this.movingHand=!0,this.userLeftHand.setX(350).setAlpha(.1).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:330,angle:-30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}left(){!this.enableComponentsControl||this.componentsLinePosition+1>0||(G("sfx_mini-jeu_roulement_puces",this,!1,.5),this.componentsLinePosition++,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=-1,this.movingHand=!0,this.userLeftHand.setX(200).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:220,angle:30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}getSelectedComponent(){return this.componentsLine[-1*this.componentsLinePosition]}getValidatedComponent(){if(!this.motherBoardComponents.length)return null;const e=this.getSelectedComponent();for(const t of this.motherBoardComponents)if(t.name===e.name&&!t.validated)return this.componentValidated++,t.validated=!0,t;return null}resetUserHand(){this.movingHand=!1,this.userLeftHand.scaleX=1,this.userLeftHand.setAlpha(.1),this.userLeftHand.setVisible(!1),this.userLeftHand.setRotation(0),this.userLeftHand.setPosition(Nt,Wt)}setComponent(){if(!this.enableComponentsControl)return;this.enableComponentsControl=!1;const e=this.getSelectedComponent().image;e.setDepth(1);const t={x:e.x,y:e.y},s=this.getValidatedComponent();this.resetUserHand(),this.userLeftHand.setVisible(!0);const i=200;if(this.handAnimation&&this.handAnimation.destroy(),s){const{component:a,name:n}=s;G(`sfx_mini-jeu_puce-bonne_${this.indexSoundComponentValidated}`,this,!0,1),this.indexSoundComponentValidated++,this.indexSoundComponentValidated>3&&(this.indexSoundComponentValidated=1),this.tweens.add({targets:e,x:a.x+10,y:a.y,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=Ft,this.enableComponentsControl=!0;try{a.setTexture("factory",`component-${n}`)}catch(s){}}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:a.x,y:230,alpha:1,angle:(a.x-275)/10,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!0,this.resetUserHand()}})}else G("sfx_mini-jeu_puce-mauvaise_2",this,!0,1),this.tweens.add({targets:e,y:150,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=Ft,this.enableComponentsControl=!0}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,y:230,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!0,this.resetUserHand()}});this.componentValidated===this.getComponentsNumber()&&this.time.delayedCall(200,()=>{this.motherBoard.length&&this.validateMotherboard()})}validateMotherboard(){G("sfx_mini-jeu_reussite_3",this,!0,1),this.isMotherboardValidated=!0,this.numberValidated++,this.waterCleaningAnims.forEach(e=>e.setVisible(!0)),G("sfx_mini-jeu_jet-eau",this,!1,.5),V(this,this.sounds["sfx_mini-jeu_jet-eau"]),this.time.delayedCall(1e3,()=>this.waterCleaningAnims.forEach(e=>e.setVisible(!1)));0==this.numberValidated%4&&(this.motherboardSpeed+=.5,this.updateMessage(wt("factory.faster"))),this.firstStep||1!=this.numberValidated%5||this.updateMessage(wt("factory.welldone"))}destroyMotherboard(){for(const e of this.motherBoard)e.destroy();this.motherBoard=[]}endMotherboard(){if(this.enableComponentsControl=!1,!this.isMotherboardValidated)return this.firstStep?(this.destroyMotherboard(),void this.tutoMissed()):(this.warnings++,this.updateWarnings(this.warnings),this.updateMessage(wt("factory.error")),this.destroyMotherboard(),3===this.warnings?void this.gameOver():void this.time.delayedCall(3e3,()=>{this.motherboardSpeed-=.25,this.initMotherboard()}));this.firstStep?this.tutoEnd():(this.destroyMotherboard(),this.time.delayedCall(1e3,()=>this.initMotherboard()))}update(){if(this.conveyorBackPosition+=1,this.conveyorInBack.setTilePosition(this.conveyorBackPosition,0),this.backMotherboards.forEach(e=>{e.x--,e.x<-100&&(e.x=600)}),this.isCinematic)return;if(!this.motherBoard.length)return void this.conveyorRollings.forEach(e=>e.anims.stop());const e=this.isMotherboardValidated?Vt:this.motherBoard[0].x<30||this.motherBoard[0].x>500?Et:this.motherboardSpeed;this.conveyorRollings.forEach(t=>t.anims.play([Vt,Et].includes(e)?"rolling-fast":"rolling",!0)),this.conveyorPosition-=e,this.conveyor.setTilePosition(this.conveyorPosition,0);for(const t of this.motherBoard)t.x+=e;this.motherBoard.length&&this.motherBoard[0].x>590&&this.endMotherboard()}},ds,class extends Mt{constructor(){super({key:"recyclingCentre",physics:{matter:{debug:i(),gravity:{y:.04}}}}),this.delayBetweenObjects=1500,this.objects=[],this.containers=[],this.containersObject=null,this.validatedObjects=0,this.notValidatedObjects=0,this.conveyorPosition=0,this.selectedObject="console",this.warnings=0,this.previousValidatedObjects=0}preload(){super.preload(),this.load.atlas("recyclingCentre","sprites/recyclingCentre.png","sprites/recyclingCentre.json")}create(){this.timeStart=Date.now(),super.create(),this.anims.create({key:"trap-open",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:4,prefix:"trap"}),repeat:0,frameRate:10}),this.anims.create({key:"trap-close",frames:this.anims.generateFrameNames("recyclingCentre",{start:4,end:1,prefix:"trap"}),repeat:0,frameRate:10}),this.anims.create({key:"shredder-console",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-console-"}),repeat:-1,frameRate:10}),this.anims.create({key:"shredder-phone",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-phone-"}),repeat:-1,frameRate:10}),this.anims.create({key:"shredder-laptop",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-laptop-"}),repeat:-1,frameRate:10}),this.scale.setGameSize(550,300),this.matter.world.setBounds(0,-100,550,400),this.add.image(275,150,"recyclingCentre","background"),this.add.image(275,0,"recyclingCentre","track").setOrigin(.5,0),this.add.image(26,300,"recyclingCentre","water-level").setDepth(1),this.add.image(27,192,"recyclingCentre","water-tank").setDepth(1),this.add.image(524,250,"recyclingCentre","water-level").setScale(-1,1).setDepth(1),this.add.image(522,192,"recyclingCentre","water-tank").setScale(-1,1).setDepth(1),this.objectSource=this.add.sprite(275,0,"recyclingCentre","trap1").setOrigin(.5,0).setDepth(1),this.leftCable=this.add.graphics().setDepth(1),this.rightCable=this.add.graphics().setDepth(1),this.shredder=this.add.sprite(0,-65,"recyclingCentre","shredder-console-1").setOrigin(.5,0).setDepth(1),this.shredder.anims.play("shredder-console");const e=this.add.image(0,0,"recyclingCentre","shredder").setDepth(2),t=this.add.image(-50,45,"recyclingCentre","wheel").setDepth(2),s=this.add.image(50,45,"recyclingCentre","wheel").setDepth(2);this.buttonLeftTop=this.add.image(-37,0,"recyclingCentre","button-blue").setDepth(1),this.buttonLeftBottom=this.add.image(-37,22,"recyclingCentre","button-blue").setDepth(1),this.buttonRightTop=this.add.image(37,0,"recyclingCentre","button-blue").setDepth(1),this.buttonRightBottom=this.add.image(37,22,"recyclingCentre","button-blue").setDepth(1),this.currentObject=this.add.image(0,2,"recyclingCentre",this.selectedObject).setDepth(1),this.previousObject=this.add.image(0,-23,"recyclingCentre","phone-little").setAlpha(.4),this.nextObject=this.add.image(0,27,"recyclingCentre","laptop-little").setAlpha(.4),this.containersObject=this.add.container(200,252,[t,s,this.shredder,this.buttonLeftTop,this.buttonLeftBottom,this.buttonRightTop,this.buttonRightBottom,e,this.currentObject,this.previousObject,this.nextObject]),this.physics.add.existing(this.containersObject),this.containersObject.setDepth(1);const i=this.containersObject.body;i.setAllowGravity(!1),i.setMaxVelocity(200),i.setDamping(!0),i.setDrag(.01),a("bypassminigame")?this.endGame():(h.on(w,this.listenDispatchedEvents,this),this.createControls(),this.startGame(),W("sfx_mini-jeu_broyeur",this),W("sfx_mini-jeu_roulement_broyeur",this),W("sfx_mini-jeu_trappe_dechet",this),W("sfx_mini-jeu_reussite",this))}startGame(){a("recyclingCentre")&&T(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.delayedCall(1e3,()=>this.startDiscussion("recyclingCentre"))}gameOver(){this.isCinematic=!0,this.isGameOver=!0,this.shredder.anims.stop(),X(["recycling_game_over"]),this.startDiscussion("recyclingCentre")}endGame(){r("recyclingCentre",this.timeStart),this.cameras.main.fadeOut(1e3,0,0,0,(e,t)=>{1===t&&(this.scene.stop(),X(["recycling_after"]))})}listenDispatchedEvents(e){K(e,"recycling_tuto_begin")&&this.tutoBegin()}listenUnlockedEvents(e){super.listenUnlockedEvents(e),K(e,"recycling_after_tuto")&&this.afterTuto(),K(e,"recycling_end")&&this.endGame()}tutoBegin(){console.log("tutoBegin");for(const e of this.objects)this.tweens.add({targets:e,alpha:0,duration:1e3,onComplete:()=>{e.destroy()}});this.objects=[],this.isCinematic=!1,this.firstStep=!0,this.time.delayedCall(1500,()=>this.initObject())}tutoMissed(){X(["recycling_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("recyclingCentre")}tutoEnd(){console.log("tutoEnd"),this.isCinematic=!0,X(["recycling_tuto_end"]),this.startDiscussion("recyclingCentre")}afterTuto(){console.log("afterTuto"),this.isCinematic=!1,this.firstStep=!1,this.time.delayedCall(1500,()=>this.initObject())}getObjectNameByDirection(e){let t=ss.indexOf(this.selectedObject)+e;return t=t>ss.length-1?0:t,t=t<0?ss.length-1:t,ss[t]}setSelectedObject(e){this.selectedObject=this.getObjectNameByDirection(e),this.currentObject.setFrame(this.selectedObject),this.previousObject.setFrame(this.getObjectNameByDirection(-1)+"-little"),this.nextObject.setFrame(this.getObjectNameByDirection(1)+"-little"),G("sfx_mini-jeu_reussite",this,!0,.06),this.tweens.add({targets:this.shredder,y:-30,duration:100,onComplete:()=>{this.shredder.anims.play("shredder-"+this.selectedObject),this.tweens.add({targets:this.shredder,y:-65,duration:100})}})}right(){this.goingRight=!0}left(){this.goingLeft=!0}up(){this.isCinematic||(this.setSelectedObject(-1),this.feedbackButton(this.buttonLeftTop),this.feedbackButton(this.buttonRightTop))}down(){this.isCinematic||(this.setSelectedObject(1),this.feedbackButton(this.buttonLeftBottom),this.feedbackButton(this.buttonRightBottom))}feedbackButton(e){e.setTexture("recyclingCentre","button-red"),this.time.delayedCall(300,()=>{e.setTexture("recyclingCentre","button-blue")})}createDebris(e,t,s){const i=is[s];Array(Phaser.Math.Between(20,40)).fill(0).forEach(s=>new as(this,e,t,i))}initObject(){if(this.isCinematic)return;const e=(this.notValidatedObjects>2&&1)+(this.objects.length>10&&1)+(this.objects.length>60&&1);if(e>this.warnings&&(this.warnings=e,this.updateWarnings(this.warnings),this.updateMessage(wt("recycling.error"))),3===e)return void this.gameOver();const t=this.firstStep?"laptop":Phaser.Math.RND.pick(ss),s=Phaser.Math.Between(150,400);if(G("sfx_mini-jeu_trappe_dechet",this,!0,1),this.isTrapAnimating||(this.isTrapAnimating=!0,this.objectSource.anims.play("trap-open",!0),this.time.delayedCall(1200,()=>{this.objectSource.anims.play("trap-close",!0),this.isTrapAnimating=!1})),this.tweens.add({ease:"Sine.easeInOut",targets:this.objectSource,x:s,duration:200,onComplete:()=>{const e=this.matter.add.gameObject(this.add.image(s,30,"recyclingCentre",t+"-broken"));this.objects.push(e)}}),this.firstStep)return;this.delayBetweenObjects-=10,this.delayBetweenObjects<100&&(this.delayBetweenObjects=100);const i=this.validatedObjects>10?this.delayBetweenObjects:Phaser.Math.Between(1500,2500);this.time.delayedCall(i,()=>this.initObject()),this.previousValidatedObjects!==this.validatedObjects&&[11,25].includes(this.validatedObjects)&&(this.previousValidatedObjects=this.validatedObjects,this.updateMessage(wt("recycling.faster")))}updateCable(){const e=this.containersObject.x;this.leftCable.clear(),this.leftCable.lineStyle(10,395793);const t=new Phaser.Math.Vector2(70,250),s=new Phaser.Math.Vector2(e-45,250),i=new Phaser.Math.Vector2((e+20)/2,300);new Phaser.Curves.QuadraticBezier(t,i,s).draw(this.leftCable);const a=this.make.graphics();a.fillRect(70,0,500,300);const n=a.createGeometryMask();this.leftCable.setMask(n),this.rightCable.clear(),this.rightCable.lineStyle(10,395793);const r=new Phaser.Math.Vector2(480,250),o=new Phaser.Math.Vector2(e+45,250),d=new Phaser.Math.Vector2((500+e)/2,300);new Phaser.Curves.QuadraticBezier(r,d,o).draw(this.rightCable);const h=this.make.graphics();h.fillRect(0,0,480,300);const l=h.createGeometryMask();this.rightCable.setMask(l)}moveContainers(e){this.containersObject.body.setAccelerationX(100*e),G("sfx_mini-jeu_roulement_broyeur",this,!1,.5)}updateContainers(){const e=this.containersObject.x;if(this.goingRight){const t=e>350?0:5;this.moveContainers(t)}else if(this.goingLeft){const t=e<200?0:5;this.moveContainers(-t)}else this.containersObject.body.setAccelerationX(0)}updateObjects(){if(!this.isCinematic)for(const e of this.objects)e.y>220?(e.setTint(7829367),this.notValidatedObjects++,this.firstStep&&this.tutoMissed()):e.y<190||e.frame.name!==this.selectedObject+"-broken"||e.x<this.containersObject.x-45||e.x>this.containersObject.x+45||(this.validatedObjects++,this.destroyObject(e),this.firstStep&&this.tutoEnd(),1===this.currentObject.scale&&this.tweens.add({targets:this.currentObject,scale:1.4,yoyo:1,duration:100}))}destroyObject(e){this.objects=this.objects.filter(t=>t!==e),G("sfx_mini-jeu_broyeur",this,!1,1),this.createDebris(e.x,e.y,this.selectedObject),e.destroy()}update(){this.containersObject.body.setAccelerationX(0),this.updateCable(),this.isCinematic||(this.updateContainers(),this.updateObjects())}createControls(){if(this.cursors=this.input.keyboard.addKeys({space:"space",down:"down",left:"left",right:"right"}),this.input.keyboard.on("keydown",e=>{"ArrowDown"===e.key?this.down():"ArrowUp"===e.key?this.up():"ArrowLeft"===e.key?this.left():"ArrowRight"===e.key?this.right():32===e.keyCode&&this.handleAction()},this),this.input.keyboard.on("keyup",e=>{"ArrowLeft"===e.key?this.goingLeft=!1:"ArrowRight"===e.key&&(this.goingRight=!1)},this),o()){const e=80,t=225,s={fontFamily:"DefaultFont",fontSize:"32px",fill:"#ffffff"};this.add.text(70,t,"←",s).setResolution(Ct).setOrigin(.5,.5).setDepth(1e4),this.add.circle(70,t,30,16733508,.3).setDepth(1e4),this.add.text(275,t,"↑",s).setResolution(Ct).setOrigin(.5,.5).setDepth(1e4),this.add.circle(275,t,30,16733508,.3).setDepth(1e4),this.add.text(480,t,"→",s).setResolution(Ct).setOrigin(.5,.5).setDepth(1e4),this.add.circle(480,t,30,16733508,.3).setDepth(1e4),this.input.on("pointerdown",t=>{t.x<275-e?this.left():t.x>275+e?this.right():this.handleAction()},this)}}},xt,class{constructor(){this.currentSprite=null,this.unlockedEvents=[],this.spritePosition={},h.on(m,this.startDiscussion,this),h.on(y,this.continueDiscussion,this),h.on(v,this.unlockMessages,this),h.on(k,this.saveUnlockedEvent,this)}initSpriteThreadIfNeeded(e){this.spritePosition?.[e]||(this.spritePosition[e]={currentThread:0,currentMessagePosition:0,threadRead:[]})}setCurrentThread(e,t){this.initSpriteThreadIfNeeded(e),this.spritePosition[e].currentThread=t}getCurrentThread(e){const t=e||this.currentSprite;return this.initSpriteThreadIfNeeded(t),this.spritePosition[t].currentThread}getCurrentMessage(){const e=this.getCurrentThread(),t=this.spritePosition?.[this.currentSprite]?.currentMessagePosition;if(null==e||null==t)return;const s=bt[this.currentSprite][e]?.dependingOn;if(this.isValidDependingOn(this.currentSprite,s)){if(this.spritePosition[this.currentSprite].threadRead.includes(e)){const s=bt[this.currentSprite][e]?.repeat;if(s)return s?.[t]}return bt[this.currentSprite][e]?.messages?.[t]}}startDiscussion(e){if("screen"===e.substring(0,6))return void h.emit(C,{sprite:e});this.initSpriteThreadIfNeeded(e),this.currentSprite=e;const t=this.getNextAvailableThread(e,this.getCurrentThread());console.log("startDiscussion",e,t),void 0!==t&&(this.setCurrentThread(e,t),this.resetMessagePosition(e)),this.resetMessagePosition(e),this.sendMessage()}resetMessagePosition(e){this.spritePosition[e].currentMessagePosition=0}getNextAvailableThread(e,t){if(!bt[e][t])return;const s=bt[e][t]?.dependingOn;return s&&this.isValidDependingOn(e,s)&&!this.spritePosition[e].threadRead.includes(t)?t:this.getNextAvailableThread(e,t+1)}continueDiscussion(){this.spritePosition[this.currentSprite].currentMessagePosition++,this.sendMessage()}sendMessage(){let e=this.getCurrentMessage();if(!e){this.endThread();const t=this.getNextAvailableThread(this.currentSprite,this.getCurrentThread());if(void 0===t)return void this.endDiscussion();this.setCurrentThread(this.currentSprite,t),this.resetMessagePosition(this.currentSprite),e=this.getCurrentMessage()}h.emit(p),h.emit(b,{sprite:this.currentSprite,message:e})}endThread(){this.spritePosition[this.currentSprite].threadRead.push(this.getCurrentThread()),this.preSaveUnlockedEvent()}endDiscussion(){console.log("endDiscussion",this.currentSprite),h.emit(g,this.currentSprite)}preSaveUnlockedEvent(){const e=this.getCurrentThread(),t=bt[this.currentSprite][e]?.unlockEvents;this.saveUnlockedEvent(t)}saveUnlockedEvent(e){e&&(h.emit(w,{newUnlockedEvents:e}),e.filter(e=>!this.unlockedEvents.includes(e)).length&&h.emit(v,{newUnlockedEvents:e,unlockedEvents:[...e,...this.unlockedEvents]}))}isValidDependingOn(e,t){return!t||t.every(e=>"!"!==e[0]===this.unlockedEvents.includes(e))}unlockMessages(e){for(const t in bt){this.initSpriteThreadIfNeeded(t);for(const s in bt[t]){const i=bt[t][s]?.dependingOn;if(!i)continue;const a=i.filter(e=>!this.unlockedEvents.includes(e));a.length>0&&a.every(t=>e.newUnlockedEvents.includes(t))&&(this.spritePosition[t].currentThread=Number(s),this.spritePosition[t].currentMessagePosition=0,this.spritePosition[this.currentSprite]?.threadRead?.includes(s)||h.emit(f,t))}}this.unlockedEvents.push(...e.newUnlockedEvents)}},hs],scale:{mode:t.Scale.FIT,autoCenter:t.Scale.CENTER_BOTH}};new t.Game(ls);
