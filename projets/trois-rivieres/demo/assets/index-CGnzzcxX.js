import{P as e,p as t}from"./vendor-DdHtZxH2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const s=new URLSearchParams(window.location.search);function i(){return s.has("debug")}function a(e){return s.has(e)}function n(e,t){const s=Math.round((Date.now()-t)/1e3);console.log("*** Game duration for: "+e,s)}function r(){return navigator.maxTouchPoints>0||"ontouchstart"in window||window.matchMedia("(pointer: coarse)").matches}class o extends e.Scene{constructor(){super("preloader"),this.progressBar=null}preload(){const e=this.cameras.main.width,t=this.cameras.main.height;this.progressBar=this.add.graphics(),this.load.on("progress",s=>{this.progressBar.clear(),this.progressBar.fillStyle(16777215,1),this.progressBar.fillRect(0,t/2,e*s,30)},this),this.load.on("complete",()=>this.progressBar.destroy(),this),this.load.image("tiles","tiles/Asset_Atlas_01.png"),this.load.tilemapTiledJSON("map","tiles/3rivers.json"),this.load.atlas("splash","sprites/splash.png","sprites/splash.json"),this.load.atlas("mai","sprites/mai.png","sprites/mai.json"),this.load.atlas("trees","sprites/trees.png","sprites/trees.json"),this.load.atlas("sprites","sprites/sprites.png","sprites/sprites.json"),r&&this.load.plugin("rexvirtualjoystickplugin","plugins/rexvirtualjoystickplugin.min.js",!0),this.load.bitmapFont("FreePixel-16","fonts/FreePixel-16.png","fonts/FreePixel-16.xml"),this.load.bitmapFont("FreePixelStrokeShadow-16","fonts/FreePixelStrokeShadow-16.png","fonts/FreePixelStrokeShadow-16.xml")}create(){this.scene.start("game")}}const h=new e.Events.EventEmitter,d="DiscussionReady",l="DiscussionAbort",c="DiscussionStarted",u="DiscussionWaiting",m="DiscussionInProgress",p="DiscussionEnded",g="DiscussionContinuing",y="HasUnreadMessage",f="MessageSent",b="EventsUnlocked",w="EventsDispatched",v="PreEventsUnlocked",k="ScreenShutdown";let C=!1,x=!1,O=!1,D=!1,_=!1,S=!1,I=!1,j=!1;const P=function(e){if(console.log("playVillageTheme"),a("nomusic")||C||e.villageTheme&&e.villageTheme.isPlaying)return;if(R(e,e.industryTheme),R(e,e.miniGameTheme),R(e,e.djangoTheme),R(e,e.nightAmbiance),R(e,e.nightmareTheme),e.villageTheme&&e.sound.get("village-theme"))return void V(e.villageTheme);C=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-theme","sounds/village_theme_compressed.mp3"),s.once("complete",()=>{e.villageTheme=e.sound.add("village-theme"),V(e.villageTheme),C=!1}),s.start()},T=function(e){if(console.log("playIndustryTheme"),a("nomusic")||x||e.industryTheme&&e.industryTheme.isPlaying)return;if(R(e,e.villageTheme),R(e,e.miniGameTheme),R(e,e.villageAmbianceV1),R(e,e.villageAmbianceV2),R(e,e.nightmareTheme),e.industryTheme&&e.sound.get("industry-theme"))return void W(e,e.industryTheme);x=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("industry-theme","sounds/industry_theme_compressed.mp3"),s.once("complete",()=>{e.industryTheme=e.sound.add("industry-theme"),x=!1,W(e,e.industryTheme)}),s.start()},A=function(e){if(a("nomusic")||O||e.miniGameTheme&&e.miniGameTheme.isPlaying)return;if(R(e,e.industryTheme),R(e,e.villageAmbianceV1),R(e,e.villageTheme),e.miniGameTheme&&e.sound.get("minigame-theme"))return void W(e,e.miniGameTheme);O=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("minigame-theme","sounds/minigame_theme_compressed.mp3"),s.once("complete",()=>{e.miniGameTheme=e.sound.add("minigame-theme"),W(e,e.miniGameTheme),O=!1}),s.start()},L=function(e){if(a("nomusic")||_||e.nightmareTheme&&e.nightmareTheme.isPlaying)return;if(R(e,e.nightAmbiance),R(e,e.industryTheme),e.nightmareTheme&&e.sound.get("nightmare-theme"))return void W(e,e.nightmareTheme);_=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("nightmare-theme","sounds/reve_theme_compressed.mp3"),s.once("complete",()=>{e.nightmareTheme=e.sound.add("nightmare-theme"),W(e,e.nightmareTheme),_=!1}),s.start()},M=function(e){e.isNoMoreBirds?F(e):B(e)},B=function(e){if(a("nomusic")||S||e.villageAmbianceV1&&e.villageAmbianceV1.isPlaying)return;if(R(e,e.industryTheme),R(e,e.villageAmbianceV2),e.villageAmbianceV1&&e.sound.get("village-ambiance-v1"))return void W(e,e.villageAmbianceV1,.2);S=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-ambiance-v1","sounds/sfx/sfx_ambiance_jour_v1.mp3"),s.once("complete",()=>{e.villageAmbianceV1=e.sound.add("village-ambiance-v1"),W(e,e.villageAmbianceV1,.2),S=!1}),s.start()},F=function(e){if(a("nomusic")||I||e.villageAmbianceV2&&e.villageAmbianceV2.isPlaying)return;if(R(e,e.villageAmbianceV1),e.villageAmbianceV2&&e.sound.get("village-ambiance-v2"))return void W(e,e.villageAmbianceV2,.6);I=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("village-ambiance-v2","sounds/sfx/sfx_ambiance_jour_v2.mp3"),s.once("complete",()=>{e.villageAmbianceV2=e.sound.add("village-ambiance-v2"),W(e,e.villageAmbianceV2,.6),I=!1}),s.start()},E=function(e){if(a("nomusic")||j||e.nightAmbiance&&e.nightAmbiance.isPlaying)return;if(R(e,e.industryTheme),R(e,e.miniGameTheme),R(e,e.villageTheme),R(e,e.villageAmbianceV1),R(e,e.villageAmbianceV2),e.nightAmbiance&&e.sound.get("night-ambiance"))return void W(e,e.nightAmbiance,.3);j=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("night-ambiance","sounds/sfx/sfx_ambiance_nuit_raccourci.mp3"),s.once("complete",()=>{e.nightAmbiance=e.sound.add("night-ambiance"),W(e,e.nightAmbiance,.3),j=!1}),s.start()},R=function(e,t,s=2e3){t&&t.isPlaying&&e.tweens.add({targets:t,volume:0,duration:s,ease:"Linear",onComplete:()=>{t.stop()}})},V=function(e,t=1){e.isPlaying||(e.volume=t,e.loop=!0,e.play())},W=function(e,t,s=1){t.isPlaying||(t.volume=0,t.loop=!0,t.play(),e.tweens.add({targets:t,volume:s,duration:2e3,ease:"Linear"}))},N=function(e,s){if(!s?.sounds||s?.sounds[e])return;const i=new t.Loader.LoaderPlugin(s);i.audio(e,`sounds/sfx/${e}.mp3`),i.once("complete",()=>{s.sounds[e]=s.sound.add(e)}),i.start()},G=function(e,t,s=!1,i=1,a=!1){t?.sounds&&t.sounds[e]&&(s?t.sound.play(e,{volume:i,loop:a}):t.sounds[e].isPlaying||t.sounds[e].play({volume:i,loop:a}))},Y=function(e,t){t?.sounds&&t.sounds[e]&&t.sounds[e].isPlaying&&t.sounds[e].stop()},q=20,U=70;class H extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a){super(e,t,s,i,a),this.scene=e,N("sfx_bruits_de_pas",e)}playMoveSound(){G("sfx_bruits_de_pas",this.scene,!1,.7,!0)}stopMoveSound(){Y("sfx_bruits_de_pas",this.scene)}resetVelocity(){this.setVelocity(0)}goLeft(){this.setVelocityX(-80),this.scaleX=-1,this.body.offset.x=this.width}resetScaleAndOffset(){this.scaleX=1,this.body.offset.x=0}goRight(){this.setVelocityX(80),this.resetScaleAndOffset()}goUp(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?U:-70,-70):this.setVelocityY(-80),this.resetScaleAndOffset()}goDown(){this.body.velocity.x?this.setVelocity(this.body.velocity.x>0?U:-70,U):this.setVelocityY(80),this.resetScaleAndOffset()}slowRight(){this.goRight(),this.setVelocity(q,0)}slowRightDown(){this.goRight(),this.setVelocity(q,q/1.5)}slowLeft(){this.goLeft(),this.setVelocity(-20,0)}slowDown(){this.goDown(),this.setVelocity(0,q)}slowUp(){this.goUp(),this.setVelocity(0,-20)}animateToLeft(){this.anims.play("mai-walk-side",!0)}animateToRight(){this.anims.play("mai-walk-side",!0)}animateToUp(){this.anims.play("mai-walk-up",!0)}animateToDown(){this.anims.play("mai-walk-down",!0)}stopAndWait(){if(this.stopMoveSound(),null===this.anims.currentAnim)return;const e=this.anims.currentAnim.key.split("-");e[1]="idle",this.anims.play(e.join("-"),!0),this.setVelocity(0,0)}}Phaser.GameObjects.GameObjectFactory.register("hero",function(e,t,s,i){const a=new H(this.scene,e,t,"mai","idle-down-1");return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),this.displayList.add(a),this.updateList.add(a),a});const z={NONE:"NONE",READY:"READY",STARTED:"STARTED",WAITING:"WAITING",INPROGRESS:"INPROGRESS"},K=(e,t)=>e.newUnlockedEvents.includes(t),X=e=>h.emit(v,e),$=function(e){Q(e),e.night?J(e,!1):(e.night=!0,e.darkOverlay.setAlpha(0),e.darkOverlay.setVisible(!0),e.tweens.add({targets:e.darkOverlay,alpha:.3,duration:3e3,ease:"Sine.easeInOut"}),e.nightOverlays.forEach(t=>{t.setAlpha(0),t.setVisible(!0),e.tweens.add({targets:t,alpha:1,duration:3e3,ease:"Sine.easeInOut"})}))},J=function(e,t){Q(e),e.night=t,e.darkOverlay.setVisible(t),t&&e.darkOverlay.setAlpha(.3),e.maskNightOverlays.forEach(e=>e.setVisible(t)),e.nightOverlays.forEach(e=>e.setVisible(t))},Z=function(e,t){const s=e.add.graphics();s.fillStyle(85,.3),s.fillRect(0,0,2*e.scale.width,2*e.scale.height),s.setVisible(!1),s.setDepth(1e3);const i=e.make.graphics();i.fillStyle(16777215),i.fillCircle(e.scale.width,e.scale.height,t);const a=i.createGeometryMask();a.invertAlpha=!0,s.setMask(a),e.maskNightOverlays.push(i),e.nightOverlays.push(s)},Q=function(e){e.darkOverlay||(Z(e,50),Z(e,80),Z(e,100),e.darkOverlay=e.add.rectangle(e.scale.width/4,e.scale.height/4,2*e.scale.width,2*e.scale.height,85).setOrigin(.5,.5).setVisible(!1).setDepth(1e3))},ee=99,te=101;class se extends e.Physics.Arcade.Sprite{constructor(e,t,s,i,a,n=0,r=0,o=!1,l=!1,c=0,u=10,m=!1,p=20){super(e,t,s,i,a),this.scene=e,this.setDepth(ee),this.delta=25,this.spriteId=null,this.heroNearMe=!1,this.chatIconDeltaX=n,this.chatIconDeltaY=r,this.shadowDeltaX=c,this.shadowDeltaY=u,this.shadowDoubleSpace=p,this.disabledChatIcon=o,this.previousChatImageUiVisibility=!1,l||(this.shadow=e.add.ellipse(t+c,s+u,10,6,0,.1).setDepth(99),m&&(this.secondShadow=e.add.ellipse(t+c+p,s+u,10,6,0,.1).setDepth(99))),this.disabledChatIcon||(this.chatImageUi=e.add.sprite(t+this.chatIconDeltaX,s-13+this.chatIconDeltaY,"sprites","exclam-3").setDepth(1e3).setVisible(!0),this.chatImageUi.anims.play("exclam",!0)),h.on(d,this.readyToChat,this),h.on(y,this.hasUnreadMessage,this)}setPosition(e,t){return super.setPosition(e,t),this.shadow?.setPosition(e+this.shadowDeltaX,t+this.shadowDeltaY),this.secondShadow?.setPosition(e+this.shadowDeltaX+this.shadowDoubleSpace,t+this.shadowDeltaY),this.updateChatIconPosition(),this}destroy(){super.destroy(),this.shadow?.destroy(),this.secondShadow?.destroy()}setVisible(e){if(super.setVisible(e),this.shadow?.setVisible(e),this.secondShadow?.setVisible(e),this.chatImageUi)return e?void(this.previousChatImageUiVisibility&&this.chatImageUi.setVisible(!0)):(this.previousChatImageUiVisibility=this.chatImageUi.visible,void this.chatImageUi.setVisible(!1))}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-this.delta&&e.x<this.x+this.delta&&e.y>this.y-this.delta&&e.y<this.y+this.delta}preUpdate(e,t){if(super.preUpdate(e,t),!this.visible)return;const s=this.isHeroNearMe();if(this.heroNearMe!==s&&(this.heroNearMe=s,this.spriteId&&h.emit(s?d:l,this.spriteId)),s&&[ee,te].includes(this.depth)){const e=this.scene.hero;this.y<e.y?this.setDepth(ee):this.setDepth(te)}}stopChatting(){console.log("stopChatting",this.spriteId),this.chatImageUi&&this.chatImageUi.setVisible(!1),this.afterStopChatting&&this.afterStopChatting()}abortChatting(){console.log("abortChatting",this.spriteId),this.afterStopChatting&&this.afterStopChatting()}disableChatIcon(){this.disabledChatIcon=!0,this.chatImageUi?.setVisible(!1)}enableChatIcon(){this.disabledChatIcon=!1,this.chatImageUi.setVisible(!0)}hasUnreadMessage(e){!this.disabledChatIcon&&this.spriteId===e&&this.chatImageUi&&(this.updateChatIconPosition(),this.chatImageUi.setVisible(!0))}updateChatIconPosition(){this.chatImageUi&&this.chatImageUi.setPosition(this.x+this.chatIconDeltaX,this.y-13+this.chatIconDeltaY)}readyToChat(e){this.spriteId===e&&(this.scene.isCinematic||this.afterReadyToChat&&this.afterReadyToChat())}setDelta(e){this.delta=0}}const ie="django";class ae extends se{constructor(e,t,s){super(e,t,s,"sprites","django-1",-2,-2,!1,!0),this.spriteId=ie,this.status="idle",e.anims.create({key:"django-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"django-"}),repeat:-1,yoyo:!0,frameRate:6}),e.anims.create({key:"django-before-strike",frames:[{key:"sprites",frame:"django-before-strike-1",duration:1200},{key:"sprites",frame:"django-before-strike-2",duration:200}],repeat:-1}),e.anims.create({key:"django-strike",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"django-strike-"}),repeat:-1,yoyo:!0,frameRate:6}),this.anims.play("django-idle",!0),this.hasUnreadMessage(this.spriteId),h.on(c,this.discussionStarted,this)}discussionStarted(e){this.spriteId===e&&"before-strike"===this.status&&this.onStrike()}afterStopChatting(){"idle"===this.status&&this.anims.play("django-idle",!0)}afterReadyToChat(){"idle"===this.status&&this.anims.stop()}beforeStrike(e,t){this.status="before-strike",this.chatIconDeltaX=0,this.setPosition(e,t),this.anims.play("django-before-strike",!0)}onStrike(){this.status="strike",this.anims.play("django-strike",!0)}setFinal(e,t){this.setPosition(e,t),this.disableChatIcon(),this.idle()}idle(){this.status="idle",this.anims.play("django-idle",!0)}}e.GameObjects.GameObjectFactory.register(ie,function(t,s){const i=new ae(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ne="koko";class re extends se{constructor(e,t,s){super(e,t,s,"sprites","koko-1",-2,-2),this.spriteId=ne,e.anims.create({key:"koko-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"koko-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"koko-"})),this.anims.play("koko-idle",!0),this.hasUnreadMessage(this.spriteId)}}e.GameObjects.GameObjectFactory.register(ne,function(t,s){const i=new re(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const oe="sleepingGuy";class he extends se{constructor(e,t,s){super(e,t,s,"sprites","sleepingguy-1",0,0,!0,!1,0,4),this.spriteId=oe,e.anims.create({key:"sleepingguy-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"sleepingguy-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"sleepingguy-"})),this.anims.play("sleepingguy-idle",!0)}}e.GameObjects.GameObjectFactory.register(oe,function(t,s){const i=new he(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const de="twoWomen";class le extends se{constructor(e,t,s){super(e,t,s,"sprites","twowomen-1",0,-2,!1,!1,-9,9,!0,19),this.spriteId=de,e.anims.create({key:"twowomen-idle",frames:[{key:"sprites",frame:"twowomen-1",duration:700},{key:"sprites",frame:"twowomen-2",duration:600},{key:"sprites",frame:"twowomen-1",duration:800},{key:"sprites",frame:"twowomen-2",duration:700},{key:"sprites",frame:"twowomen-3",duration:200}],repeat:-1}),this.anims.play("twowomen-idle",!0),this.hasUnreadMessage(this.spriteId)}}e.GameObjects.GameObjectFactory.register(de,function(t,s){const i=new le(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});const ce="baby";class ue extends se{constructor(e,t,s){super(e,t,s,"sprites","baby-1",0,0,!0,!1,0,5),this.spriteId=ce,this.shadow.setScale(.6),e.anims.create({key:"baby-idle",frames:[{key:"sprites",frame:"baby-1",duration:1e3},{key:"sprites",frame:"baby-2",duration:600}],repeat:-1}),this.anims.play("baby-idle",!0)}}e.GameObjects.GameObjectFactory.register(ce,function(t,s){const i=new ue(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const me="bino";class pe extends se{constructor(e,t,s){super(e,t,s,"sprites","bino-1",0,0,!1,!1,2,8),this.spriteId=me,this.cleaningRoadPosition={x:0,y:0},e.anims.create({key:"bino-idle",frames:[{key:"sprites",frame:"bino-1",duration:450},{key:"sprites",frame:"bino-2",duration:450},{key:"sprites",frame:"bino-1",duration:450},{key:"sprites",frame:"bino-2",duration:450},{key:"sprites",frame:"bino-3",duration:250},{key:"sprites",frame:"bino-2",duration:450}],repeat:-1}),this.anims.play("bino-idle",!0),this.hasUnreadMessage(this.spriteId)}setCleaningRoadPosition(e,t){this.cleaningRoadPosition={x:e,y:t}}setCleaningRoad(){const{x:e,y:t}=this.cleaningRoadPosition;this.setPosition(e,t),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}e.GameObjects.GameObjectFactory.register(me,function(t,s){const i=new pe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});class ge extends se{constructor(e,t,s){super(e,t,s,"sprites","cat-1",0,0,!0,!1,1,5),this.spriteId="cat",this.delta=20,e.anims.create({key:"cat-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cat-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cat-"})),this.anims.play("cat-idle",!0)}}e.GameObjects.GameObjectFactory.register("cat",function(t,s){const i=new ge(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),i.scaleX=-1,i.body.offset.x=i.width,this.displayList.add(i),this.updateList.add(i),i});class ye extends se{constructor(e,t,s){super(e,t,s,"sprites","dog-1",0,0,!0,!1,-2,6),this.spriteId="dog",this.delta=20,e.anims.create({key:"dog-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"dog-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"dog-"})),this.anims.play("dog-idle",!0)}}e.GameObjects.GameObjectFactory.register("dog",function(t,s){const i=new ye(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width-6,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const fe="escargot";class be extends se{constructor(e,t,s){super(e,t,s,"sprites","escargot-1",0,0,!0,!0),this.spriteId=fe,this.delta=15,e.anims.create({key:"escargot-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"escargot-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"escargot-"})),this.anims.play("escargot-idle",!0)}}e.GameObjects.GameObjectFactory.register(fe,function(t,s){const i=new be(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});class we extends se{constructor(e,t,s){super(e,t,s,"sprites","cow-1",0,0,!0,!1),this.spriteId="cow",this.delta=30,this.shadow.setScale(2),e.anims.create({key:"cow-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"cow-"}),repeat:-1,frameRate:2}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"cow-"})),this.anims.play("cow-idle",!0)}toRight(){this.scaleX=-1,this.setOffset(this.width-2,this.height/2)}}e.GameObjects.GameObjectFactory.register("cow",function(t,s){const i=new we(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const ve="veal";class ke extends se{constructor(e,t,s){super(e,t,s,"sprites","veal-1",0,0,!0,!1,0,6),this.spriteId=ve,this.shadow.setScale(1.5),e.anims.create({key:"veal-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"veal-"}),repeat:-1,frameRate:1}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"veal-"})),this.anims.play("veal-idle",!0)}toRight(){this.scaleX=-1}toLeft(){this.scaleX=1}}e.GameObjects.GameObjectFactory.register(ve,function(t,s){const i=new ke(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});const Ce="fisherman";class xe extends se{constructor(e,t,s){super(e,t,s,"sprites","mino-1",-11,-6,!1,!1,-12,6),this.spriteId=Ce,e.anims.create({key:"mino-idle",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:3,end:3,prefix:"mino-"})).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"mino-"})),e.anims.create({key:"mino-sad",frames:this.anims.generateFrameNames("sprites",{start:1,end:4,prefix:"mino-sad-"}),repeat:-1,frameRate:3}),this.anims.play("mino-idle",!0),this.hasUnreadMessage(this.spriteId)}setSad(){this.shadowDeltaX=0,this.shadowDeltaY=8,this.anims.play("mino-sad"),this.body.setSize(this.width,1),this.x-=12,this.chatIconDeltaX=0,this.chatIconDeltaY=-2}setOnStrike(e,t){this.setPosition(e,t),this.body.setSize(this.width,1),this.scaleX=-1,this.setOffset(this.width,this.height/2)}setFinal(e,t){this.shadowDeltaX=-12,this.shadowDeltaY=6,this.scaleX=1,this.setOffset(0,0),this.setPosition(e,t),this.disableChatIcon(),this.anims.play("mino-idle",!0)}}e.GameObjects.GameObjectFactory.register(Ce,function(t,s){const i=new xe(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.setOffset(.5,.5),i.body.setSize(i.width,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const Oe="miner";class De extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-1",0,-5),this.spriteId=Oe,this.delta=40,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-idle",defaultTextureKey:"sprites",duration:2100,repeat:-1,frames:[{frame:"miner-1",duration:2e3},{frame:"miner-2",duration:100}]}),this.anims.play("miner-idle",!0),this.hasUnreadMessage(this.spriteId)}toRight(){this.scaleX=1,this.setOffset(0,0)}moveAndUnlock(e,t){this.setPosition(e,t),this.setSize(5,1),this.setOffset(this.width-2,this.height/2)}setPositionAfterMine(e,t){this.setPosition(e,t),this.scaleX=1,this.body.setSize(this.width+6,this.height+10)}}Phaser.GameObjects.GameObjectFactory.register(Oe,function(e,t,s,i){const a=new De(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,a.height-2),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,-5),this.displayList.add(a),this.updateList.add(a),a});class _e extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","balloon-1"),this.scene=e,this.anims.create({key:"ball",frames:this.anims.generateFrameNames("sprites",{start:1,end:2,prefix:"balloon-"}),repeat:-1,frameRate:2}),this.anims.play("ball",!0),this.setDepth(100)}}e.GameObjects.GameObjectFactory.register("ball",function(t,s){const i=new _e(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,i.height),this.displayList.add(i),this.updateList.add(i),i});const Se="girl";class Ie extends se{constructor(e,t,s){super(e,t,s,"sprites","girl-water-1",0,0,!0,!0),this.spriteId=Se,this.shadowDeltaY=7,this.delta=10,e.anims.create({key:"girl-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"girl-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"girl-water-"})),e.anims.create({key:"girl-sad",frames:[{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-1"},{key:"sprites",frame:"girl-sad-2"}],repeat:-1,frameRate:3}),this.anims.play("girl-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){const{x:e,y:t}=this.sadPosition;this.shadow=this.scene.add.ellipse(e,t,8,4,0,.1).setDepth(99),this.setPosition(e,t),this.anims.play("girl-sad")}setThirdAct(e,t){this.disabledChatIcon=!1,this.setPosition(e,t),this.body.setSize(this.width,1),this.scaleX=-1,this.setOffset(this.width,this.height/2)}setFinal(e,t){this.setPosition(e,t),this.disableChatIcon(),this.scaleX=1}}e.GameObjects.GameObjectFactory.register(Se,function(t,s){const i=new Ie(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});class je extends se{constructor(e,t,s){super(e,t,s,"sprites","boy-water-1",10,0,!0,!0),this.spriteId="boy",this.delta=40,this.shadowDeltaY=6,e.anims.create({key:"boy-water",frames:this.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"boy-water-"}),repeat:-1,frameRate:3}).addFrame(this.anims.generateFrameNames("sprites",{start:2,end:2,prefix:"boy-water-"})),e.anims.create({key:"boy-sad",frames:[{key:"sprites",frame:"boy-sad-1"},{key:"sprites",frame:"boy-sad-1"},{key:"sprites",frame:"boy-sad-2"}],repeat:-1,frameRate:3}),this.anims.play("boy-water",!0),this.sadPosition={x:0,y:0}}setSadPosition(e,t){this.sadPosition={x:e,y:t}}setSad(){this.chatIconDeltaX=0;const{x:e,y:t}=this.sadPosition;this.shadow=this.scene.add.ellipse(e,t,8,4,0,.1).setDepth(99),this.setPosition(e,t),this.anims.play("boy-sad"),this.body.setSize(this.width+8,this.height+14),this.body.setOffset(-7,0)}setThirdAct(e,t){this.setPosition(e,t),this.body.setSize(this.width,1)}setFinal(e,t){this.setPosition(e,t),this.disableChatIcon(),this.scaleX=1}}e.GameObjects.GameObjectFactory.register("boy",function(t,s){const i=new je(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+18,i.height+20),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const Pe="twoGuys";class Te extends se{constructor(e,t,s){super(e,t,s,"sprites","twoguys-1",0,-2,!1,!1,-8,10,!0,17),this.spriteId=Pe,e.anims.create({key:"twoguys-idle",frames:[{key:"sprites",frame:"twoguys-1",duration:600},{key:"sprites",frame:"twoguys-2",duration:800},{key:"sprites",frame:"twoguys-1",duration:900},{key:"sprites",frame:"twoguys-2",duration:800},{key:"sprites",frame:"twoguys-3",duration:200}],repeat:-1}),this.anims.play("twoguys-idle",!0),this.hasUnreadMessage(this.spriteId)}}e.GameObjects.GameObjectFactory.register(Pe,function(t,s){const i=new Te(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const Ae=()=>Math.random()<.5?-1:1;class Le extends se{constructor(e,t,s){super(e,t,s,"sprites","bike",0,0,!0,!0),this.scaleX=-1*Ae()}}e.GameObjects.GameObjectFactory.register("bike",function(t,s){const i=new Le(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width,1),-1===i.scaleX&&i.setOffset(i.width,i.height/2),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});class Me extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","deer-1"),e.anims.create({key:"deer",frames:[{key:"sprites",frame:"deer-3",duration:1e3},{key:"sprites",frame:"deer-2",duration:500},{key:"sprites",frame:"deer-1",duration:1e3},{key:"sprites",frame:"deer-2",duration:200},{key:"sprites",frame:"deer-3",duration:200},{key:"sprites",frame:"deer-4",duration:200},{key:"sprites",frame:"deer-5",duration:2e3}],repeat:-1,yoyo:!0}),this.anims.play("deer"),this.depth=99,this.shadow=e.add.ellipse(t+2,s+8,16,6,0,.1).setDepth(98)}setPosition(e,t){return super.setPosition(e,t),this.shadow?.setPosition(e+2,t+8),this}setVisible(e){super.setVisible(e),this.shadow?.setVisible(e)}}e.GameObjects.GameObjectFactory.register("deer",function(e,t){const s=new Me(this.scene,e,t);return this.displayList.add(s),this.updateList.add(s),s});class Be extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","owl-1"),e.anims.create({key:"owl",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"owl-"}),repeat:-1,yoyo:!0,frameRate:1}),this.anims.play("owl"),this.depth=1e3}}e.GameObjects.GameObjectFactory.register("owl",function(e,t){const s=new Be(this.scene,e,t);return this.displayList.add(s),this.updateList.add(s),s});const Fe=["blue","purple","yellow"],Ee="waiting",Re="flying",Ve="outOfScreen",We=()=>e.Math.Between(1,3);class Ne extends e.Physics.Arcade.Sprite{constructor(t,s,i){super(t,s,i,null,null),this.color=e.Math.RND.pick(Fe),this.scene=t,this.idleId=We(),this.birdDirection=Ae(),this.scaleX=this.birdDirection,this.status=Ee,this.initialX=s,this.initialY=i,this.speedX=e.Math.Between(110,130),this.speedY=e.Math.Between(-60,-55)}create(){this.reset()}isWaiting(){return this.status===Ee}isFlying(){return this.status===Re}isOutOfScreen(){return this.status===Ve}setOffsetDependingOnDirection(){this.setOffset(-1===this.scaleX?30:-20,-15)}fly(){this.isFlying()||(G("sfx_oiseaux_volent",this.scene,!0,e.Math.Between(8,10)/10),this.status=Re,this.body.checkCollision.none=!0,this.birdDirection=this.scene.goingRight?1:-1,this.scaleX=-1*this.birdDirection,this.setOffsetDependingOnDirection(),this.anims.play(`bird-${this.color}-flying`,!0))}reset(){this.status=Ee,this.setVisible(!0),this.x=this.initialX,this.y=this.initialY,this.body.checkCollision.none=!1,this.birdDirection=Ae(),this.scaleX=this.birdDirection,this.setOffsetDependingOnDirection(),this.idleId=We(),this.anims.play(`bird-${this.color}-idle-anim-${this.idleId}`,!0)}hide(){this.setVisible(!1),this.setActive(!1),this.body.checkCollision.none=!0}show(){this.setActive(!0),this.setVisible(!0),this.body.checkCollision.none=!1}outOfScreen(){this.anims.stop(),this.status=Ve,this.setVelocity(0,0),this.setVisible(!1)}preUpdate(e,t){if(super.preUpdate(e,t),this.active){if(this.isOutOfScreen()){const e=this.scene.cameras.main,t=this.scene.hero;return void((this.initialX<t.x-e.width/2||this.initialX>t.x+e.width/2||this.initialY<t.y-e.height/2||this.initialY>t.y+e.height/2)&&this.reset())}if(this.isWaiting())return this.setVelocity(0,0),void this.anims.play(`bird-${this.color}-idle-anim-${this.idleId}`,!0);if(this.isFlying()){this.anims.play(`bird-${this.color}-flying`,!0),this.setVelocity(this.speedX*this.birdDirection,this.speedY);const e=this.scene.cameras.main.worldView;return void((this.x>e.x+e.width||this.x<e.x||this.y>e.y+e.height||this.y<e.y)&&this.outOfScreen())}}}}e.GameObjects.GameObjectFactory.register("bird",function(t,s){const i=new Ne(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(50,50),i.setOffsetDependingOnDirection(),i.setImmovable(!0),this.displayList.add(i),this.updateList.add(i),i});const Ge=function(e){const t=e.anims;Fe.forEach(e=>{t.create({key:`bird-${e}-idle-anim-1`,frames:t.generateFrameNames("sprites",{start:1,end:4,prefix:`bird-${e}-idle-`}),repeat:-1,frameRate:1}).addFrame(t.generateFrameNames("sprites",{start:3,end:2,prefix:`bird-${e}-idle-`})),t.create({key:`bird-${e}-idle-anim-2`,frames:[{key:"sprites",frame:`bird-${e}-idle-2`},{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-4`},{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-2`}],repeat:-1,frameRate:2}),t.create({key:`bird-${e}-idle-anim-3`,frames:[{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-4`},{key:"sprites",frame:`bird-${e}-idle-3`},{key:"sprites",frame:`bird-${e}-idle-2`},{key:"sprites",frame:`bird-${e}-idle-1`}],repeat:-1,frameRate:3}),t.create({key:`bird-${e}-flying`,frames:t.generateFrameNames("sprites",{start:1,end:3,prefix:`bird-${e}-flying-`}),repeat:-1,frameRate:10})})};class Ye extends e.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"sprites","butterfly-1"),this.scene=e,this.initialPosition={x:t,y:s},this.scaleX=Ae(),this.anims.play("butterfly-anim"),this.stepX=0,this.stepY=0}preUpdate(t,s){super.preUpdate(t,s),1===e.Math.Between(1,10)&&(this.stepX=e.Math.Between(0,2)/10*Ae(),this.stepY=e.Math.Between(0,2)/10*Ae()),(this.x-this.stepX>this.initialPosition.x+20||this.x-this.stepX<this.initialPosition.x-20)&&(this.stepX=0),(this.y-this.stepY>this.initialPosition.y+20||this.y-this.stepY<this.initialPosition.y-20)&&(this.stepY=0),this.x-=this.stepX,this.y-=this.stepY}}e.GameObjects.GameObjectFactory.register("butterfly",function(t,s){const i=new Ye(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),this.displayList.add(i),this.updateList.add(i),i});const qe=function(e){if(!e.isCinematic)return e.currentDiscussionStatus===z.WAITING?(e.currentDiscussionStatus=z.STARTED,void h.emit(g)):e.currentDiscussionStatus===z.READY?(e.currentDiscussionStatus=z.STARTED,void h.emit(c,e.currentDiscussionSprite)):void 0},Ue=function(e,t,s=!1,i=!1){[e.koko,e.sleepingGuy,e.twoGuys,e.baby,e.twoWomen,e.bino,e.fisherman,e.dog,e.escargot,e.cat,e.boy,e.girl,e.ball,...s?[e.django]:[],...i?[e.miner,e?.minerChief,e?.minerDirty2,e?.minerDirty3,e?.minerDirty4]:[]].forEach(e=>{e&&(e.setVisible(t),e.setActive(t),e.body.checkCollision.none=!t)}),e.isNoMoreBirds||(e.birds.forEach(e=>t?e.show():e.hide()),e.butterflies.forEach(e=>{e.setVisible(t),e.setActive(t)}))},He="blueWorkerChief";class ze extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","blue-worker-chief-1",0,-5),this.spriteId=He,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"blue-worker-chief-idle",frames:[{key:"sprites",frame:"blue-worker-chief-1",duration:400},{key:"sprites",frame:"blue-worker-chief-2",duration:300},{key:"sprites",frame:"blue-worker-chief-3",duration:100}],repeat:-1}),this.anims.play("blue-worker-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(He,function(e,t,s,i){const a=new ze(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.setOffset(0,a.height/2),this.displayList.add(a),this.updateList.add(a),a});class Ke extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","blue-worker-1",0,0,!0)}setSpriteNumber(e){this.spriteId=`blueWorker${e}`,this.anims.play(`blue-worker-idle-${e}`,!0)}}Phaser.GameObjects.GameObjectFactory.register("blueWorker",function(e,t,s,i,a){const n=new Ke(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n});class Xe extends e.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,"sprites","screen-off-1"),this.scene=e,this.setDepth(99),this.delta=20,this.spriteId="screen"+i,this.heroBehindMe=!1,this.previousChatImageUiVisibility=!1,this.isShutDown=!1,this.isShutDownable=!1,h.on(k,this.screenShutdown,this),this.anims.play("ads",!0),N("sfx_extinction_ecrans",e)}isHeroBehindMe(){const e=this.scene.hero;return e.x>this.x-10&&e.x<this.x+10&&e.y>this.y-20&&e.y<this.y-15}isHeroNearMe(){const e=this.scene.hero;return e.x>this.x-this.delta&&e.x<this.x+this.delta&&e.y>this.y-this.delta&&e.y<this.y+this.delta}preUpdate(e,t){if(super.preUpdate(e,t),this.isShutDownable){const e=this.isHeroBehindMe();this.heroBehindMe!==e&&(this.heroBehindMe=e,this.spriteId&&!this.isShutDown&&h.emit(e?d:l,this.spriteId))}this.isHeroNearMe()&&this.setDepth(this.y<this.scene.hero.y?99:this.scene.hero.depth+1)}enableShutdown(){this.isShutDownable=!0}screenShutdown(e){this.spriteId===e.sprite&&(this.scene.time.delayedCall(200,()=>h.emit(p,e.sprite)),this.isShutDown=!0,this.setVisible(!0),this.anims.play("screen-off",!0),G("sfx_extinction_ecrans",this.scene,!0,.5))}shutdown(){this.isShutDown=!0,this.setVisible(!0),this.anims.stop(),this.setTexture("sprites","screen-off-3")}}e.GameObjects.GameObjectFactory.register("screen",function(t,s,i){const a=new Xe(this.scene,t,s,i);return this.scene.physics.world.enableBody(a,e.Physics.Arcade.DYNAMIC_BODY),a.setImmovable(!0),this.displayList.add(a),this.updateList.add(a),a});class $e extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","white-worker-1",0,-5,!0)}setSpriteNumber(e){this.spriteId=`whiteWorker${e}`,this.anims.play(`white-worker-idle-${e}`,!0),this.scaleX=-1,this.setOffset(this.width,this.height/2)}}Phaser.GameObjects.GameObjectFactory.register("whiteWorker",function(e,t,s,i,a){const n=new $e(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n});const Je="whiteWorkerChief";class Ze extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","white-worker-chief-1",0,-5),this.spriteId=Je,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"white-worker-chief-idle",frames:[{key:"sprites",frame:"white-worker-chief-1",duration:300},{key:"sprites",frame:"white-worker-chief-2",duration:300},{key:"sprites",frame:"white-worker-chief-3",duration:100}],repeat:-1,duration:2e3}),this.anims.play("white-worker-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(Je,function(e,t,s,i){const a=new Ze(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.setOffset(0,a.height/2),this.displayList.add(a),this.updateList.add(a),a});const Qe=function(e){e.mineBackgground1=e.add.image(0,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.mineBackgground2=e.add.image(400,0,"mineLand","background").setOrigin(0,0).setScrollFactor(.05,.1),e.mineMount=e.add.image(180,100,"mineLand","mine-mount").setOrigin(0,0).setScrollFactor(.1,.25),e.mineMine=e.add.image(340,124,"mineLand","mine").setOrigin(0,0).setScrollFactor(.18,.32),e.mineMachine=e.add.image(1692,240,"mineLand","mine-machine").setOrigin(0,0).setScrollFactor(.7,.7)},et=function(e){e.roads||(e.roadsBottom=e.map.createLayer("roadsBottom",e.tileset).setDepth(69).setVisible(!1),e.roads=e.map.createLayer("roads",e.tileset).setDepth(70).setVisible(!1),e.roadsTop=e.map.createLayer("roadsTop",e.tileset).setDepth(97).setVisible(!1),e.carsBottom=e.map.createLayer("carsBottom",e.tileset).setDepth(98).setVisible(!1),e.carsTop=e.map.createLayer("carsTop",e.tileset).setCollisionByProperty({collide:!0}).setDepth(120).setVisible(!1),e.carsTop.forEachTile(t=>{!0===t.properties?.pointCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(10,1).setImmovable(!0).setVisible(!1))}),e.carsTopCollider=e.physics.add.collider(e.hero,e.carsTop),e.carsBottomCollides=[],e.carsTop.forEachTile(t=>{!0===t.properties?.bottomCollide&&e.carsBottomCollides.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.carsBottomCollider=e.physics.add.collider(e.hero,e.carsBottomCollides));const t=e.roads.visible;e.roads.setVisible(!t),e.roadsBottom.setVisible(!t),e.roadsTop.setVisible(!t),e.carsTop.setVisible(!t),e.carsBottom.setVisible(!t),e.bridgesShadow.setVisible(t),e.bridges.setVisible(t),e.bridgesTop.setVisible(t)},tt=function(e,t){const s=t.map.getObjectLayer(e);s.objects.sort((e,t)=>e.y-t.y),s.objects.forEach(e=>{const s=t.add.image(e.x,e.y-8,"trees",`${e.name}-base`).setDepth(90).setOrigin(.5,1),i=t.physics.add.sprite(e.x,e.y-24,"trees",`${e.name}-1`).setOrigin(.5,1).setImmovable(!0).setDepth(130);i.anims.play(`${e.name}-${Phaser.Math.Between(1,10)}`);const a=t.physics.add.sprite(e.x,e.y-10,null).setSize(8,1).setOrigin(.5,1).setImmovable(!0).setVisible(!1);e.x>1097&&e.x<1336&&e.y>1e3&&e.y<1220?(t.treesOfDc.push({treeBase:s,treeTop:i}),t.treesOfDcCollider.push(a)):t.pointsCollider.push(a)})},st=()=>localStorage.getItem("locale")||"fr",it={django:"Django",bino:"Bino",fisherman:{fr:"Mino, le pêcheur",en:"Mino, the fisherman"},cat:{fr:"Le chat",en:"The cat"},dog:{fr:"Le chien",en:"The dog"},cow:{fr:"La vache",en:"The cow"},veal:{fr:"Le veau",en:"The veal"},boy:{fr:"Les enfants",en:"The children"},girl:{fr:"La petite fille",en:"The little girl"},koko:"Koko",nono:"Nono",escargot:{fr:"L’escargot",en:"The snail"},baby:{fr:"Le bébé",en:"The baby"},twoWomen:{fr:"Les deux femmes",en:"The two women"},twoGuys:{fr:"Les deux hommes",en:"The two men"},miner:{fr:"L’ouvrier",en:"The worker"},dcWorkerChief:{fr:"L’ouvrier chef",en:"The foreman"},whiteWorkerChief:{fr:"L’ouvrier chef",en:"The foreman"},minerChief:{fr:"L’ouvrier chef",en:"The foreman"},blueWorkerChief:{fr:"L’ouvrier chef",en:"The foreman"},blueWorker1:{fr:"L’ouvrier",en:"The worker"},blueWorker2:{fr:"L’ouvrier",en:"The worker"},minerDirty2:{fr:"L’ouvrier",en:"The worker"},minerDirty3:{fr:"L’ouvrier",en:"The worker"},minerDirty4:{fr:"L’ouvrier",en:"The worker"},whiteWorker1:{fr:"L’ouvrier",en:"The worker"},whiteWorker2:{fr:"L’ouvrier",en:"The worker"},sleepingGuy:{fr:"L’homme couché",en:"The man lying down"},minerZad1:{fr:"L’ouvrier déserteur",en:"The deserting worker"},minerZad2:{fr:"Le mineur déserteur",en:"the deserting mine worker"}},at={django:{sound:"sfx_voix_hommes",versions:4},miner:{sound:"sfx_voix_ouvriers",versions:4},boy:{sound:"sfx_voix_enfants",versions:4},girl:{sound:"sfx_voix_enfants",versions:4},baby:{sound:"sfx_voix_enfants",versions:4},koko:{sound:"sfx_voix_femmes",versions:4},nono:{sound:"sfx_voix_hommes",versions:4},fisherman:{sound:"sfx_voix_hommes",versions:4},twoWomen:{sound:"sfx_voix_femmes",versions:4},twoGuys:{sound:"sfx_voix_hommes",versions:4},bino:{sound:"sfx_voix_hommes",versions:4},minerZad1:{sound:"sfx_voix_hommes",versions:4},minerZad2:{sound:"sfx_voix_hommes",versions:4},whiteWorkerChief:{sound:"sfx_voix_ouvriers",versions:4},dcWorkerChief:{sound:"sfx_voix_ouvriers",versions:4},minerChief:{sound:"sfx_voix_ouvriers",versions:4},blueWorkerChief:{sound:"sfx_voix_ouvriers",versions:4},blueWorker1:{sound:"sfx_voix_hommes",versions:4},blueWorker2:{sound:"sfx_voix_hommes",versions:4},minerDirty2:{sound:"sfx_voix_hommes",versions:4},minerDirty3:{sound:"sfx_voix_hommes",versions:4},minerDirty4:{sound:"sfx_voix_hommes",versions:4},whiteWorker1:{sound:"sfx_voix_hommes",versions:4},whiteWorker2:{sound:"sfx_voix_hommes",versions:4},cat:{sound:"sfx_chat",versions:2},dog:{sound:"sfx_chien",versions:2},cow:{sound:"sfx_vache",versions:1},veal:{sound:"sfx_vache",versions:2}},nt={bino:[{messages:{fr:["Hey, salut toi ! Moi je m’appelle Bino !","Fais attention à ne pas marcher sur mes carottes."],en:["Hey, hello there! My name is Bino!","Be careful not to step on my carrots."]},repeat:{fr:["Fais attention à ne pas marcher sur mes carottes."],en:["Be careful not to step on my carrots."]}},{messages:{fr:["Hey ! Tu es juste de passage ?","Ou bien là pour enquêter sur ce qui se trame ?","Plus au nord d’ici, il y a une personne louche…","(J’espère que cela n’impactera pas mon potager…)"],en:["Hey! Are you just passing through?","Or are you here to investigate what’s going on?","North of here, there’s a suspicious person…","(I hope this won’t affect my vegetable garden…)"]},repeat:{fr:["Plus au nord d’ici, il y a une personne louche…","(Je me demande bien ce qui se passe…)"],en:["North of here, there’s a suspicious person…","(I wonder what’s going on…)"]},dependingOn:["django_met"]},{messages:{fr:["Je travaille, mais j’ai pas trop la tête à ça…","Je suis très inquiet à cause de la rivière polluée.","Peut-être qu’en remontant à la source…","on trouverait la cause du problème ?","Mais je suis bien trop occupé là…"],en:["I’m working, but I’m not really in the mood for it…","I’m very worried about the polluted river.","Maybe if we went back to the source…","we could find the cause of the problem?","But I’m far too busy right now…"]},repeat:{fr:["(Si seulement quelqu’un pouvait remonter la rivière…)"],en:["(If only someone could go up the river…)"]},dependingOn:["first_sleep"]},{messages:{fr:["Hey Maï, tout roule pour toi ?","Comme tu peux le voir, mon potager a disparu.","À la place je désherbe le bord des routes.","Mais ne crois pas que je sois triste !","On peut accéder à tellement plus de denrées alimentaires","grâce à nos voitures et à ces nouvelles routes !","C’est un gros changement…"],en:["Hey Maï, everything okay?","As you can see, my vegetable garden has disappeared.","Instead, I’m weeding the roadsides.","But don’t think I’m sad!","We have access to so much more food","thanks to our cars and these new roads!","It’s a big change…"]},repeat:{fr:["(Allez, ça ne va pas se désherber tout seul…)"],en:["(Come on, it’s not going to weed itself…)"]},dependingOn:["second_act_begin"]},{messages:{fr:["Hey Maï, ça roule ?","Moi, ras-le-bol de désherber le bord des routes !","J’ai vu sur FaceBouc que Django partait en voyage…","J’aimerais bien partir avec lui !"],en:["Hey Maï, how’s it going?","I’m sick and tired of weeding the roadsides!","I saw on Fotobook that Django is going on a trip…","I’d love to go with him!"]},repeat:{fr:["(Il faut que j’aille voir Django pour ce voyage…)"],en:["(I need to see Django about this trip…)"]},dependingOn:["third_act_begin"]},{messages:{fr:["Je n’arrive plus à faire pousser de légumes…"],en:["I can no longer grow vegetables…"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["J’ai répondu à l’appel de Koko et Django…","Mais peux pas m’empêcher de désherber partout…"],en:["I responded to Koko and Django’s proposal to protest…","But I can’t help weeding everywhere…"]},dependingOn:["strike_begin"]},{messages:{fr:["Attendez… Je prends les tomates !"],en:["Wait… I’ll take the tomatoes!"]},dependingOn:["django_final_end"],unlockEvents:["game_over"]}],twoGuys:[{messages:{fr:["- Il faudrait qu’on aide Bino au potager.","- Oui, oui, mais d’abord laisse-moi paresser un peu !","- Tu as raison, reposons-nous, le travail peut attendre."],en:["- We should help Bino in the vegetable garden.","- Yes, yes, but first let me laze around a bit!","- You’re right, let’s rest, the work can wait."]},repeat:{fr:["Il faudrait qu’on aide Bino au potager…"],en:["We should help Bino in the vegetable garden…"]}},{messages:{fr:["- Bino est dans tous ses états à cause de la rivière.","- Viens, on va le soutenir.","- Tranquille, faisons une pause avant d’aller le voir."],en:["- Bino is really upset about the river.","- Come on, let’s go support him.","- Relax, let’s take a break before we go see him."]},repeat:{fr:["Bino est dans tous ses états à cause de la rivière."],en:["Bino is really upset about the river."]},dependingOn:["first_sleep"]},{messages:{fr:["- Que c’est pratique ces nouvelles routes !","- Tu l’as dit, j’ai rangé mon vieux vélo.","- Le hic, c’est l’éternité qu’il faut…","pour payer ma nouvelle automobile."],en:["These new roads are so convenient!","You said it. I’ve put my old bicycle away.","The only problem is that it’ll take me forever…","…to pay off my new car."]},repeat:{fr:["Que c’est pratique ces nouvelles routes !"],en:["These new roads are so convenient!"]},dependingOn:["second_act_begin"]},{messages:{fr:["- J’ai écrit un poème, écoute :","Plus d’usines que de maisons","Plus de mines que de raison","- La nouvelle usine à l’ouest t’inspire ?","- Elle m’inspire ce poème oui, de la confiance non."],en:["- I wrote a poem, listen:","More factories than houses","More mines than sense","- Does the new factory in the west inspire you?","- It inspires this poem, yes, but not confidence."]},repeat:{fr:["L’usine à l’ouest n’inspire pas confiance."],en:["The factory in the west does not inspire confidence."]},dependingOn:["third_act_begin"]},{messages:{fr:["- (Il parait qu’on peut arrêter les publicités).","- (Les écrans de publicité ? Mais comment ?)","- (Moins fort ! Il faudrait demander à Koko)"],en:["- (Apparently you can stop the adverts).","- (The advert screens? But how?)","- (Quiet! We should ask Koko)"]},repeat:{fr:["(Koko a un secret au sujet des écrans…)"],en:["(Koko has a secret about these screens…)"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["- Avoue, c’est ta première manif’ ?","- Mais pas du tout… j’ai fait les marches pour le climat !"],en:["- Admit it, this is your first protest, isn’t it?","- Not at all… I protested for the climate!"]},dependingOn:["strike_begin"]},{messages:{fr:["- Salut Maï, tu es attendue près de chez Bino.","- Si tu as oublié où il habite, c’est à l’est."],en:["- Hi Maï, they’re waiting for you near Bino’s house.","- If you’ve forgotten where he lives, it’s to the east."]},repeat:{fr:["Tu es attendue près de chez Bino, à l’est."],en:["You are expected near Bino’s place, to the east."]},dependingOn:["strike_end"]}],twoWomen:[{messages:{fr:["- Notre amie Koko sait vraiment tout sur tout.","- C’est vrai, on peut compter sur elle.","- Et que dire de Django…","- Tu as raison, pas le dernier à rendre service !"],en:["- Our friend Koko really knows everything about everything.","- That’s true, we can count on her.","- And what about Django…","- You’re right, he’s always ready to help!"]},repeat:{fr:["Django est toujours prêt à aider !"],en:["Django is always ready to help!"]}},{messages:{fr:["- Koko m’a dit que Nono est revenu du travail…","- Oui mais pas en entier, le pauvre !","- Il faudrait qu’on aille le voir."],en:["- Koko told me that Nono came back from work…","- Yes, but not entirely, poor thing!","- We should go see him."]},repeat:{fr:["Il faudrait qu’on aille voir Nono."],en:["We should go see Nono."]},dependingOn:["first_sleep"]},{messages:{fr:["- Tu as vu le nouveau smartphone ?","- Il a quoi de nouveau ?","- Il se transforme en drone","pour nous filmer ou nous photographier…","sous tous les angles !","Plus besoin de perche à selfie !"],en:["- Have you seen the new smartphone?","- What’s new about it?","- It turns into a drone,","to film or photograph us…","from every angle!","No more need for a selfie stick!"]},repeat:{fr:["Le dernier smartphone donne envie !"],en:["The latest smartphone is tempting!"]},dependingOn:["third_act_begin"]},{messages:{fr:["- Koko sait vraiment tout sur tout.","- Il parait que…","(… les enfants lui ont confié un secret)"],en:["- Koko really knows everything about everything.","- It seems that…","(… the children told him a secret)"]},repeat:{fr:["(Koko connaît peut-être un secret)"],en:["(Koko may know a secret)"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["- Il faut désarmer ces industries polluantes…","- Je te sens rebelle, c’est Maï qui t’inspire ?"],en:["- We must disarm these polluting industries…","- I sense you’re feeling rebellious.","Is it Maï who’s inspiring you?"]},dependingOn:["strike_begin"]},{messages:{fr:["- Salut Maï, ça fait un bail !","- Tu es attendue près du potager de chez Bino."],en:["- Hi Maï, it’s been a while!","- They’re waiting for you near Bino’s vegetable garden."]},repeat:{fr:["Tu es attendue près du potager de chez Bino."],en:["They’re waiting for you near Bino’s vegetable garden."]},dependingOn:["strike_end"]}],baby:[{messages:{fr:["Pa-pi-lion, pa-pi-lion…"],en:["But-ter-fly, but-ter-fly…"]}},{messages:{fr:["téyé-phone, téyé-phone…"],en:["smart-phone, smart-phone…"]},dependingOn:["third_act_begin"]},{messages:{fr:["Ca-mion…"],en:["A lor-ry…"]},dependingOn:["fourth_act_begin"]}],sleepingGuy:[{messages:{fr:["ZZZzzz, mmmh ?"],en:["ZZZzzz, mmmh ?"]}}],koko:[{messages:{fr:["Oh bah, v’là donc une nouvelle arrivante…","Bienvenue au village de Trois-Rivières !","Ça fait plaisir d’voir une nouvelle tête.","Moi c’est Koko.","J’suis au courant de tout c’qui s’passe dans l’coin !","… Maï ? Un prénom pas banal dis donc !","J’suis sûre que notre patelin va te plaire.","Va donc y faire un tour !","Et si tu cherches un endroit où dormir…","Django t’accueillera sûrement, il est plus au sud."],en:["Oh well now, look at that… a new face comin’ in.","Welcome to the village of Trois-Rivières!","Nice seein’ a new face ’round here.","Name’s Koko.","I’m up to date on everythin’ that’s happenin’ here!","… Maï? Now that’s not a common name, is it!","I’m sure you’re gonna like our little town.","Go on, take a look ’round!","And if you’re lookin’ for a place to sleep…","Django’ll certainly take you in, he’s further south."]},repeat:{fr:["Maï, si t’as fini d’visiter tout le village…","va donc vers le sud pour trouver où dormir."],en:["Maï, if you’ve finished visiting the whole village…","head south to find somewhere to sleep."]}},{messages:{fr:["Tu as rencontré Django ?","C’est la personne la plus gentille que j’connaisse.","Tu devrais aller voir ce qui se trame à l’est…","Il parait qu’une personne louche bloque le pont…"],en:["You met Django?","He’s the kindest person I know, I’m tellin’ ya.","Ya should go check out what’s goin’ on out east…","Heard there’s some shady person blockin’ the bridge…"]},repeat:{fr:["Tu devrais aller voir ce qui se trame à l’est…","Une personne louche bloque le pont…"],en:["You should go see what’s going on in the east…","Some shady character is blocking the bridge…"]},dependingOn:["django_met"]},{messages:{fr:["Olala, olala… t’as vu ça Maï ?","C’est terrible c’qui arrive à notre rivière !","Un truc louche se trame vers l’est, j’te l’dis !","Nono, qu’habite plus au nord, en revient justement.","Il est mal-en-point, comme la rivière…","peut-être qu’il pourra t’en dire plus !"],en:["Oh dear, oh dear… ya see that, Maï?","It’s terrible what’s happenin’ to our river!","Somethin’ shady’s going on out east, I’m tellin’ ya!","Nono, who lives further north, has just come back.","He’s in bad shape, just like the river…","Maybe he’ll be able to tell ya more!"]},repeat:{fr:["Au nord, Nono pourra t’éclairer sur c’qui s’passe !"],en:["Up north, Nono can fill you in on what’s going on!"]},dependingOn:["first_sleep"]},{messages:{fr:["Je vois que tu as le badge de Nono…","Remonte la rivière polluée et t’trouveras ton chemin.","Fais attention à toi, Maï !"],en:["I see you’ve got Nono’s badge…","Go up the polluted river and you’ll find your way.","Take care, Maï!"]},dependingOn:["card_for_mine"]},{messages:{fr:["Maï, c’est incroyable tu trouves pas ?","Le génie humain j’veux dire.","Pour trois fois moins de temps,","j’peux aller voir ma famille, mes amies !","Moi qui ADORE être au courant de tout,","ça va grandement faciliter les potins héhé.","D’ailleurs t’sais pas la dernière ?","Une autre usine s’est installée au nord.","Ça pousse comme des champignons ces choses là !"],en:["Maï, it’s incredible, don’t ya think?","Human genius, I mean.","In three times less time,","I can go see my family, my friends!","And me, who LOVES knowin’ everything,","this is gonna make gossipin’ soooo much easier, hehe.","Oh! And ya haven’t heard the latest, have ya?","Another factory set up north.","These things pop up like mushrooms!"]},repeat:{fr:["Tu d’vrais aller voir cette usine au nord","p’têtre que t’y trouveras encore du travail !"],en:["Ya should go check out that factory up north","maybe you’ll find some work there!"]},dependingOn:["second_act_begin"]},{messages:{fr:["B’jour Maï ! Dis-moi…","Tu peux m’aider à choisir un nouveau smartphone ?","Le mien est déjà trop lent…","C’est vraiment pratique pour être au courant de tout !","D’ailleurs une nouvelle usine a ouvert à l’ouest."],en:["Mornin’, Maï! Tell me…","Think ya could help me pick a new smartphone?","Mine’s already way too slow…","It’s real handy for stayin’ up-to-date on everything!","Oh, and a new factory opened out west."]},repeat:{fr:["Tu vas aller voir cette nouvelle usine à l’ouest ?"],en:["Ya gonna go check out that new factory out west?"]},dependingOn:["third_act_begin"]},{messages:{fr:["Maï…","J’avais tellement la tête plongée dans les écrans…","Que j’n’ai pas remarqué l’état de nos rivières !","Qu’les oiseaux et les papillons ont disparu !","QUOI ? Tu dis qu’il faut se mobiliser ?","C’est une bonne idée !","J’vais réunir les troupes.","En attendant, t’pourrais faire une action d’éclat.","Oh, je sais : éteindre les panneaux de pub !","Les enfants m’ont dit qu’on pouvait les éteindre…","en passant par derrière !"],en:["Maï…","I was so buried in my screens…","I didn’t even notice the state of our rivers!","Didn’t see the birds and butterflies disappearin’!","WHAT? You’re sayin’ we need to take action?","That’s a great idea!","I’ll gather the folks.","In the meantime, you could make a bold move.","Oh, I know: turn off those ad screens!","The kids told me you can switch ’em off…","…by goin’ around the back!"]},repeat:{fr:["(il parait que…)","(on peut éteindre les écrans pub par derrière…)","(mais chut !)"],en:["(they say that…)","(you can turn off the ad screens from the back…)","(but shhh!)"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["T’as réussi à éteindre un écran pub ?","C’pas bien… et… c’est bien, à la fois !","Si j’étais toi… J’en éteindrais d’autres !"],en:["Ya managed to turn off one of those ad screens?","That ain’t right… and yet… it kinda is!","If I were you… I’d go switch off a few more!"]},repeat:{fr:["Pourquoi ne pas éteindre d’autres écrans ?"],en:["Why don’t ya go switch off some more screens?"]},dependingOn:["screens_shutdown_first"]},{messages:{fr:["Merci Maï pour tout c’que t’as fait.","Grâce à toi, tous les villageois…","S’retrouvent pour une cause commune…","L’avenir de notre village !"],en:["Thanks, Maï, for everything you’ve done.","Thanks to you, all the villagers…","…are comin’ together for a common cause…","The future of our village!"]},repeat:{fr:["Merci encore, Maï."],en:["Thanks again, Maï."]},dependingOn:["strike_begin"]}],nono:[{messages:{fr:["C’est donc toi Maï ?","Ton arrivée dans le village ne passe pas inaperçue.","Comme tu peux le constater dans mon fauteuil roulant…","tu ne me vois pas au meilleur de ma forme !","À l’est, une mine vient de s’installer.","J’ai tenté d’y travailler mais…","il m’est arrivé un accident malencontreux.","Il faut dire qu’on n’est pas très bien protégé.","Et le rythme de travail y est extrêmement soutenu !","Bref. Je te dirais bien d’en prendre garde mais…","Je vois dans ton regard que tu es déterminée à y aller."],en:["So it’s you, Maï?","Your arrival in the village hasn’t gone unnoticed.","As you can see from my wheelchair…","I’m not in the best of shape!","A mine has just been set up in the east.","I tried to work there, but…","I had an unfortunate accident.","It must be said that we’re not very well protected.","And the pace of work there is extremely fast!","Anyway. I’d tell you to be careful, but…","I can see in your eyes that you’re determined to go."]},unlockEvents:["pre_card_for_mine"]},{messages:{fr:["Prends mon laissez-passer, je n’en ai plus besoin.","Mais promets moi de faire bien attention à toi !"],en:["Take my pass, I don’t need it anymore.","But promise me you’ll take good care of yourself!"]},repeat:{fr:["Fais bon usage de mon badge… et sois prudente."],en:["Make good use of my badge… and be careful."]},dependingOn:["pre_card_for_mine"],unlockEvents:["card_for_mine"]},{messages:{fr:["La situation de nos rivières est perturbante,","mais je dois bien avouer que ces nouvelles routes…","facilitent énormément mes déplacements !","Et quand j’irai mieux…","… je postulerai à la nouvelle usine au nord d’ici."],en:["The state of our rivers is disturbing","but I must admit that these new roads…","make it much easier for me to get around!","And when I’m better…","I’ll apply for a job at the new factory north of here."]},repeat:{fr:["Je pense postuler à l’usine au nord d’ici…"],en:["I’m thinking of applying for a job…","at the factory north of here…"]},dependingOn:["second_act_begin"]},{messages:{fr:["C’est assez formidable n’est-ce pas ?","Ce confort, et l’accès à tout le savoir je veux dire.","Il faut bien sûr réussir à bien s’informer…","Heureusement, je sais démêler le vrai du faux !","(Alors comme ça, la Terre serait plate !?)"],en:["It’s pretty amazing, isn’t it?","All this convenience and access to knowledge, I mean.","Of course, you have to be able to find the right information…","Luckily, I know how to separate fact from fake news!","(So, the Earth is flat!?)"]},repeat:{fr:["J’apprends tellement grâce à l’internet !"],en:["I learn so much thanks to the internet!"]},dependingOn:["third_act_begin"]},{messages:{fr:["C’est terrible, le village est méconnaissable…","Je suis très fatigué de tout ça…"],en:["It’s terrible, the village is unrecognisable…","I'm very tired of all this…"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["Je ne suis pas très en forme…","Mais je tenais à être présent ici, maintenant.","Maï, je trouve que toutes ces expériences…","t’ont fait grandir ! Je le vois dans tes yeux."],en:["I'm not feeling very well…","But I wanted to be here, now.","Maï, I think all these experiences…","have made you grow up! I can see it in your eyes."]},dependingOn:["strike_begin"]}],django:[{messages:{fr:["Ooola, quel bon vent nous amène là !","… Maï ? Quel joli prénom.","Et donc tu cherches un lieu où dormir cette nuit ?","Tu frappes à la bonne porte !","Comme je le dis souvent, il faut qu’une porte…","soit ouverte ou fermée…","et la mienne sera toujours ouverte !","Donc reviens au coucher du soleil !"],en:["Hey, what brings you here?","… Maï? What a pretty name.","So you’re looking for a place to sleep tonight?","You’ve come to the right place!","As I often say, a door must either be…","open or closed…","and mine will always be open!","So come back at sunset!"]},repeat:{fr:["Fais un tour du village et reviens ce soir."],en:["Take a walk around and come back this evening."]},unlockEvents:["django_met"]},{messages:{fr:["Aah, tu es revenue ! Comme disait ma grand-mère…","un bon arbre peut loger dix mille oiseaux.","Allez, entre !"],en:["Ah, you’re back! As my grandmother used to say…","a good tree can shelter ten thousand birds.","Come on in!"]},dependingOn:["miner_first_met"],unlockEvents:["pre_first_sleep"]},{messages:{fr:["Bien dormi, Maï ?","Je suis désolé de te l’apprendre au réveil mais…","quelque chose de terrible est arrivé au village !","Vois par toi-même, je reste ici me calmer l’esprit."],en:["Did you sleep well, Maï?","I’m sorry to tell you this when you’ve just woken up, but…","Something terrible has happened in the village!","See for yourself. I’ll stay here and calm my nerves."]},repeat:{fr:["Ooh pauvre rivière, laisse moi te jouer une prière."],en:["oh poor river, let me play you a prayer."]},dependingOn:["first_sleep"],unlockEvents:["first_sleep_save"]},{messages:{fr:["Bien dormi Maï ?","Après toutes ces semaines d’efforts à la mine,","je tenais à te remercier.","Grâce à toi, on a la confirmation que…","la mine soi-disant responsable est surtout responsable…","de la pollution de la rivière.","Mais dans le même temps, le village a pu se moderniser.","Je dois avouer être un peu partagé.","Est-ce un mal pour un bien ?","Je n’ai pas la réponse","et je ne voudrais pas t’influencer.","Maintenant que tu as fini ton travail à la mine,","tu as tout le temps de te balader dans le village.","Si tu croises Koko, tu la salueras pour moi."],en:["Did you sleep well, Maï?","After all these weeks of hard work at the mine,","I wanted to thank you.","Thanks to you, we have confirmation that…","The supposedly responsible mine is primarily responsible…","for the pollution of the river.","At the same time, the village has managed to modernise.","I must admit I’m a little torn.","Is it a good thing or a bad thing?","I don’t have the answer,","and I don’t want to influence you.","Now that you’ve finished your work at the mine,","you have plenty of time to walk around the village.","If you see Koko, say hello to her for me."]},repeat:{fr:["Une chose reste immuable dans tout ce bouleversement","ce sont les 6 cordes de ma guitare."],en:["One thing remains unchanged amid all this turmoil","the six strings of my guitar."]},dependingOn:["second_act_begin"],unlockEvents:["second_act_save"]},{messages:{fr:["Bonjour Maï, le sommeil a été un peu agité ?","Des cauchemars ? Vraiment désolé pour toi.","Tu arrêtes de travailler à l’usine ?","C’est bien de savoir que l’usine est responsable…","de la baisse du niveau d’eau dans nos rivières.","Le mal est fait, on n’arrête pas le progrès…","On a besoin de produire des équipements numériques","même si cela consomme beaucoup d’eau.","Je partirais bien loin de ces problèmes…","Un voyage, c’est ça qu’il me faut !"],en:["Good morning, Maï. Did you sleep well?","Nightmares? So sorry for you.","Are you quitting your job at the factory?","It’s good to know that the factory is responsible…","for the drop in water levels in our rivers.","The damage is done, we can’t stop progress…","We need to produce digital devices…","even if it consumes a lot of water.","I’d like to get far away from these problems…","A trip is just what I need!"]},repeat:{fr:["J’ai envie de voyager, partir loin…"],en:["I want to travel, go far away…"]},dependingOn:["third_act_begin"],unlockEvents:["third_act_save"]},{messages:{fr:["Salut Maï !","L’usine de recyclage pompe l’eau de la rivière ?","Grâce à l’eau, les matières recyclées sont séparées ?","La conséquence sur nos rivières reste préoccupante.","Et ça continue, vois le chantier près de chez moi.","Je ne sais pas ce qui se passe encore…"],en:["Hi Maï!","Does the recycling plant pump water from the river?","Thanks to water, recycled materials are separated?","The impact on our rivers remains a concern.","It continues, look at the construction near my house.","I don’t know what else is going on…"]},repeat:{fr:["Un chantier au milieu de notre village…"],en:["A building site in the middle of our village…"]},dependingOn:["fourth_act_begin"],unlockEvents:["fourth_act_save"]},{messages:{fr:["Tu as raison, Maï…","On ne peut plus laisser toutes ces industries…","détruire notre village…","pomper et polluer nos rivières…","Quand on l’attaque, le village contre-attaque.","Je suis partant pour une mobilisation générale !","J’amène ma guitare et j’arrive."],en:["You’re right, Maï…","We can’t let all these industries…","destroy our village…","pump and pollute our rivers…","When they attack us, the village fights back.","I’m up for a general mobilisation.","I’ll bring my guitar and be right there."]},dependingOn:["screens_shutdown_end"],unlockEvents:["django_ready_for_strike"]},{messages:{fr:["Habitants et habitantes de Trois-Rivières !","Vous savez ce qui se passe dans notre village.","Nos ressources et nos rivières ont été accaparées…","Par des industries destructrices et polluantes.","Aujourd’hui nous leur disons stop !","Comme le disait ma grand-mère…","On peut couper nos branches mais pas nos racines.","La défense de notre village ne fait que commencer !"],en:["People of Trois-Rivières!","You know what is happening in our village.","Our resources and our rivers have been taken over…","By destructive and polluting industries.","Today, we say stop!","As my grandmother used to say…","They can cut our branches, but not our roots.","The defence of our village has only just begun!"]},dependingOn:["strike_begin"],unlockEvents:["strike_end"]},{messages:{fr:["Salut Maï ! Ça fait plaisir de te revoir !","T’as vu le village ?","La nature a un peu repris ses droits, et nous nos esprits.","Il faut dire qu’il n’y avait plus rien à exploiter ici.","Les industriels sont ainsi partis voir ailleurs…","La répression de notre mobilisation a été terrible…","Mais nous avons tenu bon.","Puis les oiseaux sont revenus.","Presque tous… c’est toujours mieux qu’aucun.","Et n’oublions jamais tout ce qu’on a perdu…","La rivière, l’eau, les animaux, … un ami.","Allez, viens…","On t’attendait pour pique-niquer !"],en:["Hi Maï! It’s good to see you again!","Have you seen the village?","Nature has reclaimed some of its rights…","and we have reclaimed our minds.","It must be said that there was nothing left to exploit here.","So the industrialists left to look elsewhere…","The repression of our mobilization was terrible…","But we stood firm.","Then the birds came back.","Almost all of them… it’s better than none.","Let’s never forget all that we've lost…","The water, the river, the animals… a friend.","Come on, come with us…","We were waiting for you to have a picnic!"]},dependingOn:["django_final"],unlockEvents:["django_final_end"]}],fisherman:[{messages:{fr:["…chut, tu vas faire fuir les poissons…","Et voilà, raté… Va parler aux autres, je suis concentré là."],en:["…shhh, you’ll scare the fish away…","There you go, you’ve ruined it…","Go and talk to the others, I’m focused here."]},repeat:{fr:["…chut"],en:["…shhh"]}},{messages:{fr:["Par la barbe du %?#%, je ne vais plus pouvoir pêcher.","Qui sont les responsables de ce #?%@ ???"],en:["%?#%, I won’t be able to fish anymore.","Who’s responsible for this #?%@???"]},repeat:{fr:["Si j’attrape les responsables de ce #?%@…"],en:["If I catch those responsible for this #?%@…"]},dependingOn:["first_sleep"]},{messages:{fr:["… Tout le monde est devenu fan","de ces routes, de ces voitures…","C’est vite oublier d’où on vient.","Une mine s’installe, puis une usine…","La rivière qui a baissé de niveau,","juste en quelques semaines.","Je me sens un peu démuni face à tout ça…","Mais ça me réconforte que tu continues…","de mener ta petite enquête, Maï."],en:["… Everyone has become a fan,","of these roads, these cars…","It’s easy to forget where we come from.","A mine is built, then a factory…","The river has dropped in level,","in just a few weeks.","I feel a bit helpless in the face of all this…","But it comforts me that you’re continuing…","to conduct your little investigation, Maï."]},repeat:{fr:["Continue ton enquête, moi je surveille la rivière."],en:["Continue your investigation, I’ll keep an eye on the river."]},dependingOn:["second_act_begin"]},{messages:{fr:["Ce que je craignais est arrivé.","Trois-Rivières a complètement changé…","et nos habitudes avec.","Heureusement moi, je tiens bon la barre !","(Attendre ici me donne faim par contre…)","(Je mangerais bien un bon burger tiens !)"],en:["What I feared has happened.","Trois-Rivières has completely changed…","and so have our habits.","Fortunately, I’m holding steady!","(Waiting here is making me hungry, though…)","(I could really go for a good burger right now!)"]},repeat:{fr:["(Burger… burger…) hmmmmm, je disais quoi déjà ?"],en:["(Burger… burger…) Hmmmmm, what was I saying?"]},dependingOn:["third_act_begin"]},{messages:{fr:["Tout part à la dérive, comme mon vieux bateau…"],en:["Everything is drifting away, like my old boat…"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["J’me demande bien comment on va se débarrasser…","…de ces #?%@ qui polluent nos rivières !"],en:["I wonder how we’re going to get rid of…","…these #?%@ polluting our rivers!"]},dependingOn:["strike_begin"]}],boy:[{messages:{fr:["YOUPIII, on peut se baigner quand on veut !","Faudrait trop qu’on ramène nos potes un jour !"],en:["YAY, we can go swimming whenever we want!","We really should bring our mates along one day!"]}},{messages:{fr:["Oh nooon, on ne peut plus jouer dans l’eau…","Qu’est-ce qu’on va faire maintenant ?"],en:["Oh no, we can’t play in the river anymore…","What are we going to do now?"]},repeat:{fr:["On ne peut plus jouer dans l’eau…"],en:["we can’t play in the river anymore…"]},dependingOn:["first_sleep"]},{messages:{fr:["Y’a moins d’eau dans la rivière maintenant…"],en:["Oh no, there’s less water in the river now…"]},dependingOn:["second_act_begin"]},{messages:{fr:["… Mmmmh, et si on mangeait un gros burger…"],en:["Mmmm, how about we have a big burger…"]},dependingOn:["third_act_begin"]},{messages:{fr:["… Il est louche le monsieur là…"],en:["… That man over there looks shady…"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["C’est notre première manif, trop chouette !"],en:["It’s our first protest, how exciting!"]},dependingOn:["strike_begin"]}],girl:[{messages:{fr:["…"],en:["…"]}},{messages:{fr:["Y’a moins d’eau dans la rivière maintenant…"],en:["There’s less water in the river now…"]},dependingOn:["second_act_begin"]},{messages:{fr:["Ça serait tellement bien si j’avais…","un smartphone pour jouer aux jeux vidéos…","comme Brolox, FortNight ou BroStar…"],en:["It would be so great if I had…","a smartphone to play video games…","like Brolox, Fortnite or BroStar…"]},dependingOn:["third_act_begin"]},{messages:{fr:["On devrait pas rester ici…"],en:["We shouldn’t stay here…"]},dependingOn:["fourth_act_begin"]},{messages:{fr:["Tante Koko et oncle Django sont trop forts !"],en:["Aunt Koko and Uncle Django are so cool!"]},dependingOn:["strike_begin"]}],cat:[{messages:{fr:["Miaou…"],en:["Meow…"]}}],dog:[{messages:{fr:["Wof…"],en:["Woof…"]}}],cow:[{messages:{fr:["Meuh…"],en:["Moo…"]}}],veal:[{messages:{fr:["Mmmmh…"],en:["Mmmmh…"]}}],escargot:[{messages:{fr:["…"],en:["…"]}}],miner:[{messages:{fr:["Interdit de passer par ici."],en:["It is forbidden to pass through here."]},repeat:{fr:["J’ai dit qu’on ne passe pas !"],en:["I said no passing through!"]}},{messages:{fr:["Hop hop hop… il est trop tard pour passer, désolé.","Reviens demain.","(Vivement que mon tour de garde se termine bientôt…)","(j’ai des fourmis dans les jambes)"],en:["Stop! It’s too late to come in, sorry.","Come back tomorrow.","(I can’t wait for my shift to end…)","(I’ve got ants in my pants.)"]},repeat:{fr:["Il est trop tard pour passer, reviens demain."],en:["It’s too late to come in now, come back tomorrow."]},unlockEvents:["miner_first_met"],dependingOn:["django_met"]},{messages:{fr:["Il faut un laissez-passer pour… passer.","Nouvelle directive des chefs !"],en:["You need a pass to… pass.","New directive from the bosses!"]},repeat:{fr:["Je t’ai dit qu’il faut un laissez-passer…"],en:["I told you that you need a pass…"]},dependingOn:["first_sleep"]},{messages:{fr:["Je ne sais pas comment tu as eu ce badge…","mais te voilà donc libre de passer.","D’toute façon, on a besoin de bras pour bosser…"],en:["I don’t know how you got that badge…","but now you’re free to pass through.","Anyway, we need workers…"]},repeat:{fr:["Tu peux passer…"],en:["You can pass…"]},dependingOn:["card_for_mine"],unlockEvents:["mine_access_validation"]},{messages:{fr:["Apparemment, ils n’ont plus besoin de nous…","Pas autant en tout cas.","Les machines que nous avons créées nous remplacent."],en:["Apparently, they don’t need us anymore…","Not as much, anyway.","The machines we created are replacing us."]},repeat:{fr:["Ils n’ont plus besoin de nous…"],en:["They don’t need us anymore…"]},dependingOn:["second_act_begin"]}],minerChief:[{messages:{fr:["Bienvenue à Grise Mine, LA mine responsable !","D’ici sortent des tonnes de minerais chaque jour…","extraits avec de l’énergie renouvelable !","Nous utilisons l’eau de façon raisonnée…","traitons nos employés de manière exemplaire, et…","Ça ne t’intéresse pas mon discours ?","…","Tu quoi ? Tu es là pour travailler ???","Hahaha, elle est bien bonne celle-là.","Mes meilleurs hommes sont épuisés très vite…","tu ne tiendras pas une seconde là-dedans !","Mais ok, je veux bien te faire une formation express.","Apprête-toi à te faire miner… le moral HAHAHA"],en:["Welcome to Grey Mine, THE responsible mine!","Tons of ore come out of here every day…","extracted using renewable energy!","We use water wisely…","treat our employees in an exemplary manner, and…","Aren’t you interested in what I’m saying?","…","What? Are you here to work???","Hahaha, your jokes are a gold mine…","My best men get exhausted very quickly…","You won’t last a second in there!","But okay, I’ll give you a crash course.","Get ready… You’ll be our canary in a coal mine, HAHAHA"]},unlockEvents:["mine_start"]}],minerDirty2:[{messages:{fr:["J’suis content d’avoir trouvé ce boulot…","même si c’est pas forcément bien payé."],en:["I’m glad I found this job…","even if it doesn’t necessarily pay well."]},repeat:{fr:["Ce boulot est pas forcément bien payé."],en:["This job doesn’t pay well."]}}],minerDirty3:[{messages:{fr:["Fiouuu… ça fait du bien une petite pause…","Je plains celui qui devra dépolluer ces bassins d’eau.","Enfin… si on le fait un jour…"],en:["Phew… it’s nice to have a little break…","I feel sorry…","… for those who will have to clean up these water basins.","Well… if we ever do…"]}}],minerDirty4:[{messages:{fr:["Si tu cherches le chef, il est devant l’entrée.","Maintenant laisse moi contempler la vue du progrès."],en:["If you’re looking for the boss…","he’s in front of the entrance.","Now let me contemplate the view of progress."]},repeat:{fr:["Contemple avec moi, la vue du progrès."],en:["Contemplate with me the view of progress."]}}],mine:[{messages:{fr:[r()?"Installe-toi…\n(touche pour continuer)":"Installe-toi…\n(espace pour continuer)","Comme tu es nouvelle, je te mets sur un poste simple…","…le nettoyage !","Les roches vont avancer sur le tapis roulant…","et tu devras les nettoyer pour éliminer les impuretés !","Pourquoi faire ça tu vas me dire ? Pour le PROGRÈS.","Les métaux et minerais extraits servent pour tout.","Smartphones, consoles, plomberie, bijoux…","Nous sommes la première étape d’un grand tout.","Et là dedans, tu n’es qu’un maillon insignifiant…","Bref. Voici comment procéder.",r()?"Bouge le tuyau avec les boutons ← → ↑ ↓":"Bouge le tuyau avec les flèches ← → ↑ ↓",r()?"Et pulvérise l’eau en touchant l'écran.":"Et pulvérise l’eau avec la barre ESPACE.","J’espère que t’as bien tout compris !","J’peux pas me permettre que tu ralentisses le train…","de la mine !"],en:[r()?"Settle in…\n(tap to continue)":"Settle in…\n(press space to continue)","Since you’re new, I’ll put you on a simple job…","…cleaning!","The rocks will move along the conveyor belt…","and you’ll have to clean them to remove impurities!","Why do this, you ask? For PROGRESS.","The minerals we extract are used for everything.","Smartphones, consoles, plumbing, jewelry…","We are the first step in a much bigger process.","And in that, you’re just an insignificant link…","Anyway. Here’s how to proceed.",r()?"Move the pipe with the ← → ↑ ↓ buttons.":"Move the pipe with the arrow keys ← → ↑ ↓",r()?"Moving the pipe sprays the water.":"And spray water by touching the screen.","I hope you got it all!","I can’t afford for you to slow down the train…","of the mine!"]},unlockEvents:["mine_tuto_begin"]},{messages:{fr:["Tu n’as pas compris comment ça fonctionne ???","Tu dois nettoyer la roche à CENT POUR CENT !","On ne peut pas l’envoyer à moitié nettoyée.",r()?"Bouge le tuyau avec les boutons ← → ↑ ↓.":"Bouge le tuyau avec les flèches ← → ↑ ↓",r()?"Et pulvérise l’eau en touchant l'écran.":"Et pulvérise l’eau avec la barre ESPACE. Allez !"],en:["You don’t get how this works???","You have to clean the rock ONE HUNDRED PERCENT!","We can’t send it out half-cleaned.",r()?"Move the pipe with the ← → ↑ ↓ buttons.":"Move the pipe with the arrow keys ← → ↑ ↓",r()?"And spray water by touching the screen. Come on!":"And spray the water with the SPACE bar. Come on!"]},dependingOn:["mine_tuto_missed"],unlockEvents:["mine_tuto_begin"]},{messages:{fr:["Tu as compris comment ça fonctionne…","Passons aux choses sérieuses !"],en:["You understand how it works…","Let’s get down to business!"]},dependingOn:["mine_tuto_end"],unlockEvents:["mine_show_score_board"]},{messages:{fr:["Ça, c’est ce qui va contrôler ton travail.","Si tu rates trop souvent, une croix s’allumera.","Au bout de trois croix…","je viendrai moi-même t’accompagner à la sortie !","…","Quoi ?? Qu’est-ce qui ne va pas ?","Oui… On extrait l’eau de la rivière !","Et on stocke les déchets dans des réservoirs.","Je te rappelle qu’on est une mine responsable.","C’est du sérieux. On ne fait pas n’importe quoi !","Bon, arrête de poser des questions, au boulot !"],en:["That’s what will control your work.","If you miss too often, a cross will light up.","After three crosses…","I’ll come and escort you out myself!","…","What?? What’s wrong?","Yes… We extract water from the river!","And we store waste in reservoirs.","I remind you that we are a responsible mine.","This is serious business. We don’t do just anything!","Stop asking questions and get to work!"]},dependingOn:["mine_show_score_board"],unlockEvents:["mine_after_tuto"]},{messages:{fr:["C’est bien ce qu’il me semblait…","tu ne peux pas tenir un rythme aussi soutenu !","On arrête les frais pour aujourd’hui.","Allez… ne fais pas grise mine !"],en:["That’s what I thought…","You can’t keep up such a fast pace!","We'll stop there for today.","Come on… don’t look so glum!"]},dependingOn:["mine_game_over"],unlockEvents:["mine_end"]}],whiteWorker1:[{messages:{fr:["Il y a trop de monde à la mine…","alors j’ai tenté ma chance à l’usine."],en:["There are too many people at the mine…","so I tried my luck at the factory."]},repeat:{fr:["Je tente ma chance à l’usine."],en:["I tried my luck at the factory."]}},{messages:{fr:["Vu la qualité de ton travail…","ou la non qualité de ton travail ?","Tu n’es plus la bienvenue à l’usine. Ordre du chef !"],en:["Given the quality of your work…","or the lack of quality in your work?","You are no longer welcome at the factory.","That’s an order from the boss!"]},repeat:{fr:["Tu n’es plus la bienvenue ici."],en:["You are no longer welcome here."]},dependingOn:["third_act_begin"]}],whiteWorker2:[{messages:{fr:["Je m’y connais pas trop en électronique…","mais il faut bien que je mange !"],en:["I don’t know much about electronics…","but I have to earn a living!"]},repeat:{fr:["Je travaille ici car il faut que je mange !"],en:["I work here because I need to earn a living!"]}},{messages:{fr:["Tu ne passes plus… Ordre des chefs !"],en:["You’re not coming through. Orders from the bosses!"]},dependingOn:["third_act_begin"]}],whiteWorkerChief:[{messages:{fr:["(Pourquoi j’ai accepté ce job dans ce trou paumé.)","(Je ne supporte pas ces gens, ni ce village, je…)","Oui ? … Tu t’appelles Maï et tu veux travailler ?","Bien sûr, comme tout le monde ici.","Une usine dernier cri attire forcément…","des ploucs euh… des gens comme vous.","Pour t’expliquer en langage simple…","Ici chez Nano World Company…","… on assemble des circuits électroniques…","Qui finissent ensuite dans des écrans ou téléphones.","Sois contente, tu peux faire une période d’essai.","Est-ce que tu penses en être capable ?","Voyons voir ce que tu vaux !"],en:["(Why did I accept this job in this godforsaken place.)","(I can’t stand these people, or this village, I…)","Yes? … Your name is Maï and you want to work?","Of course, like everyone else here.","A state-of-the-art factory inevitably attracts…","rednecks… I mean, people like you.","To explain it in simple terms…","Here at Nano World Company…","…we assemble electronic circuits…","which end up in screens or phones.","Be glad, you can do a trial period","Do you think you can do it?","Let’s see what you can do!"]},unlockEvents:["factory_start"]}],blueWorker1:[{messages:{fr:["C’est l’dernier endroit qui recrute dans la région."],en:["This is the last place they’re recruiting in the region."]}},{messages:{fr:["Ne reviens pas… euh… ordre du chef."],en:["Don’t come back… uh… orders from the chief."]},dependingOn:["fourth_act_begin"]}],blueWorker2:[{messages:{fr:["J’ai cru entendre que le chef ici est un bel orateur."],en:["I heard that the foreman here is a good speaker."]}},{messages:{fr:["T’as pas laissé un bon souvenir à l’usine."],en:["You didn’t leave a good impression at the factory."]},dependingOn:["fourth_act_begin"]}],blueWorkerChief:[{messages:{fr:["Ici euh… chez Tri-Force, on recycle les déchets.","Et on en fait euh… d’autres équipements.","Alors oui, on utilise… l’eau de la rivière.","Mais tout ça est euh… contrôlé et raisonné à 100%.","Alors… ça vous dit de… tester une journée de travail ?","Ça nous arrange d’avoir… des femmes.","Vu qu’on vous paie moins… euh… oubliez ça.","Suivez-moi !"],en:["Here… er… at Tri-Force, we recycle waste.","And we turn it into umm… other equipment.","So yes, we use water from the river.","But everything is controlled and carefully thought out.","So… would you like to… try a day’s work?","It suits us to have… women.","Since we pay you less… er… forget it.","Follow me!"]},unlockEvents:["recycling_start"]}],factory:[{messages:{fr:[r()?"Installe-toi…\n(touche pour continuer)":"Installe-toi…\n(espace pour continuer)","Comme tu es nouvelle, je te mets sur un poste simple…","Tu dois monter les composants sur les cartes…","Puis les nettoyer à l’eau pour éliminer les impuretés…","Et faire ça le plus vite possible…","Les clients n’attendent pas !",r()?"Choisis le bon composant en appuyant à gauche ou à droite.":"Choisis le bon composant avec les flèches ← →",r()?"Et installe le composant choisi en appuyant au centre.":"Et installe le composant choisi avec la barre ESPACE","C’est parti !"],en:[r()?"Settle in…\n(tap to continue)":"Settle in…\n(press space to continue)","Since you’re new, I’ll put you on a simple job…","You have to mount the components on the boards…","Then clean them with water to remove impurities…","And do it as fast as possible…","The clients are not waiting!",r()?"Choose the right component by pressing left or right.":"Choose the right component with the arrow keys ← →",r()?"Then install the chosen component by pressing on it.":"Then install the chosen component with the SPACE bar","Let’s go!"]},unlockEvents:["factory_tuto_begin"]},{messages:{fr:["Tête de linotte !","Tu n’as pas compris comment ça fonctionne ?","Tu dois monter les composants sur les cartes…",r()?"Choisis le bon composant en appuyant à gauche ou à droite.":"Choisis le bon composant avec les flèches ← →",r()?"Et installe le composant choisi en appuyant au centre.":"Et installe le composant choisi avec la barre ESPACE","C’est à la portée du premier venu !"],en:["Scatterbrain!","You don’t get how this works?","You have to mount the components on the boards…",r()?"Choose the right component by pressing left or right.":"Choose the right component with the arrow keys ← →",r()?"Then install the chosen component by pressing on it.":"Then install the chosen component with the SPACE bar","It’s something anyone can do!"]},dependingOn:["factory_tuto_missed"],unlockEvents:["factory_tuto_begin"]},{messages:{fr:["Tu sembles avoir compris comment ça fonctionne…","Passons aux choses sérieuses !"],en:["You seem to have understood how it works…","Let’s get down to business!"]},dependingOn:["factory_tuto_end"],unlockEvents:["factory_show_score_board"]},{messages:{fr:["Si tu rates l’assemblage, une croix s’allumera.","Au bout de trois croix…","je viendrai moi-même t’accompagner à la sortie !","As-tu d’autres questions ???","Tu dis que l’eau utilisé assèche la rivière ?","Et qu’est-ce que ça peut me faire ?","Tout le monde sera bien content…","d’avoir des téléphones derniers cris !","Arrête de te poser des questions et au boulot."],en:["If you mess up the assembly, a cross will light up.","After three crosses…","I’ll come and escort you out myself!","Any other questions???","You say the water used is drying up the river?","And what do I care?","Everyone will be happy…","to have the latest phones!","Stop asking yourself questions and get to work."]},dependingOn:["factory_show_score_board"],unlockEvents:["factory_after_tuto"]},{messages:{fr:["C’est bien ce qu’il me semblait…","tu ne peux pas tenir un rythme aussi soutenu !","On arrête les frais pour aujourd’hui.","Allez… Rentre chez toi !"],en:["That’s what I thought…","You can’t keep up such a fast pace!","That’s all for today.","Come on… Go home!"]},dependingOn:["factory_game_over"],unlockEvents:["factory_end"]}],recyclingCentre:[{messages:{fr:[r()?"Voilà votre poste…\n(touche pour continuer)":"Voilà votre poste…\n(espace pour continuer)","Des déchets tombent… de la trappe en haut.","Vous devez les réceptionner… avec le chariot en bas.",r()?"Bougez le chariot en appuyant à gauche ou à droite.":"Bougez le chariot avec les flèches ← →",r()?"Et changez son mode en appuyant en haut ou en bas.":"Et changez son mode avec les flèches ↑ ↓","Il faut détruire le déchet avec euh… le bon mode.","Faisons un test."],en:[r()?"Here’s your station…\n(tap to continue)":"Here’s your station…\n(press space to continue)","Waste is falling… from the trap at the top.","You have to catch it… with the cart at the bottom.",r()?"Move the cart by pressing left or right.":"Move the cart with the arrow keys ← →",r()?"And change its mode by pressing up or down.":"And change its mode with the arrow keys ↑ ↓","You need to destroy the waste with… the right mode.","Let’s do a test."]},unlockEvents:["recycling_tuto_begin"]},{messages:{fr:["Euh… je vais vous faire un petit rappel, pas le choix.",r()?"Bougez le chariot en appuyant à gauche ou à droite.":"Bougez le chariot avec les flèches ← →",r()?"Et changez son mode en appuyant en haut ou en bas.":"Et changez son mode avec les flèches ↑ ↓","Le mode doit correspondre au déchet qui tombe !","Allez, c’est euh… reparti."],en:["Uh… I’m going to give you a little reminder, no choice.",r()?"Move the cart by pressing left or right.":"Move the cart with the arrow keys ← →",r()?"And change its mode by pressing up or down.":"And change its mode with the arrow keys ↑ ↓","The mode must match the falling waste!","Come on, let’s… get started again."]},dependingOn:["recycling_tuto_missed"],unlockEvents:["recycling_tuto_begin"]},{messages:{fr:["Bon euh… ça suffira. Ne perdons pas plus de temps.","On va vous tester pour de vrai."],en:["Right, well… that’s enough. Let’s not waste any more time.","We’re going to test you for real."]},dependingOn:["recycling_tuto_end"],unlockEvents:["recycling_show_score_board"]},{messages:{fr:["Ça, c’est le panneau d’erreurs.","Si vous ratez plusieurs déchets… une croix s’allume.","Au bout de trois croix euh… j’arrête votre journée.","Je le répète, c’est très important ce qu’on fait ici.","On démantèle et on recycle les équipements.","On est pour ainsi dire euh… super écolo.","Toute l’eau qu’on pollue et gaspille…","C’est pour un bien encore plus grand.","Allez euh… au boulot !"],en:["That’s the error panel.","If you miss several pieces of waste… a cross lights up.","After three crosses, um… I’ll stop your day.","I repeat, what we’re doing here is very important.","We dismantle and recycle equipment.","We’re, so to speak, super eco-friendly.","All the water we pollute and waste…","It’s for a greater good.","Come on, let’s get to work!"]},dependingOn:["recycling_show_score_board"],unlockEvents:["recycling_after_tuto"]},{messages:{fr:["Bon euh… c’est fini pour aujourd’hui.","Il faudra être plus performante pour…","sauver la planète !"],en:["Well, um… that’s it for today.","We’ll need to do better to…","save the planet!"]},dependingOn:["recycling_game_over"],unlockEvents:["recycling_end"]}],dcWorkerChief:[{messages:{fr:["Pour développer l’IA…","On construit un datacenter près de la rivière…","Son eau refroidira les serveurs, c’pas super !?","Si ça te gêne, dégage ! Et laisse nous bosser."],en:["To develop AI…","We’re building a data centre near the river…","Its water will cool the servers, isn’t that great?","If it bothers you, get lost! And let us work"]},repeat:{fr:["On construit un datacenter, ça te gène ?"],en:["We’re building a data centre. Does that bother you?"]}}],minerZad1:[{messages:{fr:["Comment tu nous as trouvé ?","Nous étions des ouvriers et avons déserté la mine…","… nous avons abandonné notre travail…","… et avons créé cette petite communauté…","… où l’on plante nos légumes…","… et on essaye de construire un monde plus sobre."],en:["How did you find us?","We were mine workers and we deserted the mine…","…we gave up our jobs…","…and created this little community…","…where we grow our own vegetables…","…and try to build a simpler world."]},repeat:{fr:["Ici, on envisage un mode de vie plus sobre."],en:["Here, we are considering a more modest lifestyle."]}}],minerZad2:[{messages:{fr:["Nous sommes plusieurs anciens ouvriers à vivre ici.","Aucun regret sur ce choix de vie.","Cependant, on vit cachés dans la forêt…","par crainte de représailles."],en:["There are several of us former workers living here.","I have no regrets about this choice of lifestyle.","However, we live hidden away in the forest…","for fear of reprisals."]},repeat:{fr:["On est obligé de vivre cachés dans la forêt."],en:["We are forced to live hidden away in the forest."]}}]},rt={"game.newGame":{fr:"Nouvelle partie",en:"New game"},"game.continueGame":{fr:"Continuer la partie",en:"Continue the game"},"game.play":{fr:"Jouer",en:"Play"},"game.loading":{fr:"Chargement…",en:"Loading…"},"game.mine":{fr:"La mine",en:"The mine"},"game.factory":{fr:"L’usine",en:"The factory"},"game.recycling":{fr:"Le recyclage",en:"The recycling"},"game.credits":{fr:"Crédits",en:"Credits"},"game.howToPlay":{fr:r()?"Déplace-toi avec le joystick virtuel.":"Déplace-toi avec les touches ← → ↑ ↓ (ou ZQSD)",en:r()?"Move using the virtual joystick.":"Move using the arrow keys ← → ↑ ↓ (or WASD)"},"game.action":{fr:r()?"Toucher pour interagir":"Appuyer sur espace",en:r()?"Touch to interact":"Press space bar"},"mine.faster":{fr:"Plus vite !",en:"Faster!"},"mine.fasterAgain":{fr:"Encore plus vite, allez !!!",en:"Even faster, come on!!!"},"mine.waterEmpty":{fr:"Réservoir d’eau vide ! Tu dois attendre son remplissage.",en:"The water tank is empty! You must wait for it to refill."},"mine.waterFull":{fr:"Réservoir d’eau plein, allez !",en:"Water tank full! Come on!"},"mine.moreMaterials":{fr:"Arrivage de minerais, on augmente la cadence !",en:"Ore arrivals, we’re picking up the pace!"},"mine.warning":{fr:"Ressaisis-toi, on est là pour faire du chiffre !",en:"Pull yourself together, we’re here to make money!"},"mine.lastWarning":{fr:"Dernier avertissement, concentre-toi !",en:"This is your last warning, pay attention!"},"factory.faster":{fr:"Validé! Plus vite maintenant!!!",en:"Approved! Now hurry up!!!"},"factory.welldone":{fr:"C’est bien, tu es productive !",en:"That’s great, you’re being productive!"},"factory.error":{fr:"C’est quoi ce boulot ? Ressaisis-toi la nouvelle !",en:"What's this job? Be careful, newbie!"},"recycling.faster":{fr:"Allez, Euh… On augmente le rythme !",en:"Come on, um… Let’s pick up the pace!"},"recycling.error":{fr:"Euh… il va falloir faire mieux que ça !",en:"Um… you’ll have to do better than that!"},"betweenActs.later":{fr:"Quelque temps plus tard…",en:"Some time later…"},"final.later":{fr:"Quelque temps plus tard…",en:"Some time later…"},"progression.saved":{fr:"Progression enregistrée",en:"Progress saved"},"generic.0":{fr:"Ce jeu ne reflète pas la réalité. Elle est bien plus sombre.",en:"This game does not reflect reality. It is far darker."},"generic.1":{fr:"L’extraction minière est l’industrie la plus polluante au monde.",en:"Mining is the most polluting industry in the world."},"generic.2":{fr:"La mine a des conséquences éternelles sur les habitants et les écosystèmes.",en:"Mining has lasting consequences for inhabitants and ecosystems."},"generic.3":{fr:"La production d’objets numériques participe à l’épuisement des ressources… et de la main d’oeuvre.",en:"The production of digital devices contributes to the depletion of resources and the exhaustion of workers."},"generic.4":{fr:"Le recyclage n’est pas une solution miracle…",en:"Recycling is not a miracle solution…"},"generic.5":{fr:"Pour économiser les ressources, ne cédons pas aux objets connectés inutiles.",en:"To save resources, let’s not give in to unnecessary connected devices."},"generic.6":{fr:"Et gardons les appareils utiles plus longtemps.",en:"And let’s keep useful devices for longer."},"generic.7":{fr:"Ce jeu est dédié au vivant, humains compris, qui chaque jour paye très cher, l’accélération technologique.",en:"This game is dedicated to living beings, including humans, who are paying a high price for technological acceleration every day."},"generic.thanks":{fr:"Merci d’avoir joué.",en:"Thank you for playing."},"generic.credits":{fr:"Idée originale, game design et programmation\n\n  Richard Hanna.\n\nGraphisme, level design et game design\n\n  Philippe Salib.\n\nGame design, narration, musiques et effets sonores\n\n  David Fonteix.",en:"Original concept, game design and programming\n\n  Richard Hanna.\n\nGraphics, level design and game design\n\n  Philippe Salib.\n\nGame design, narration, music and sound effects\n\n  David Fonteix."}},ot=e=>rt[e][st()],ht=function(e){e.cameras.main.setBounds(0,0,2144,e.map.heightInPixels-8),e.messageLater=e.add.bitmapText(225,100,"FreePixelStrokeShadow-16",ot("betweenActs.later"),16).setOrigin(.5,.5).setScrollFactor(0).setDepth(1e4).setVisible(!1),J(e,!1),function(e){e.mineBackgground1&&(e.mineBackgground1.destroy(),e.mineBackgground2.destroy(),e.mineMount.destroy(),e.mineMine.destroy(),e.mineMachine.destroy())}(e),et(e),function(e){e.riverLessWater||(e.riverLessWater=e.map.createLayer("riverLessWater",e.tileset).setDepth(40).setVisible(!1));const t=!e.riverLessWater.visible;e.riverLessWater.setVisible(t)}(e),function(e){e.bikes.forEach(e=>{e.setVisible(!1),e.body.checkCollision.none=!0})}(e),function(e){e.potagerBottom.setVisible(!1),e.potagerTop.setVisible(!1),e.potagerCollider.destroy(),e.cow.setVisible(!1),e.cow.setActive(!1),e.cow.body.checkCollision.none=!0,e.cowHidden.setVisible(!1),e.cowHidden.setActive(!1),e.cowHidden.body.checkCollision.none=!0,e.veal.setVisible(!1),e.veal.setActive(!1),e.veal.body.checkCollision.none=!0}(e),e.bino.setCleaningRoad(),Ue(e,!0,!0,!0),function(e){e.birds.forEach((t,s)=>{Phaser.Math.Between(0,1)&&(e.birds.splice(s,1),t.destroy())})}(e),function(e){e.butterflies.forEach((t,s)=>{Phaser.Math.Between(0,1)&&(e.butterflies.splice(s,1),t.destroy())})}(e),e.deer.setVisible(!1),e.owl.setVisible(!1),e.ball.destroy(),e.ball=null,e.obstacleBridgeLayer=e.map.createLayer("obstacleBridge",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleBridgeLayerCollider=e.physics.add.collider(e.hero,e.obstacleBridgeLayer),e.obstaclesFactoryLayer.setCollisionByProperty({collide:!1}),e.obstaclesFactoryCollider.destroy(),tt("treesLimitForest",e),e.obstaclesForestLayer=e.map.createLayer("obstaclesForest",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.physics.add.collider(e.hero,e.obstaclesForestLayer),function(e){e.anims.create({key:"white-worker-idle-1",frames:[{key:"sprites",frame:"white-worker-1",duration:1e3},{key:"sprites",frame:"white-worker-2",duration:200}],repeat:-1}),e.anims.create({key:"white-worker-idle-2",frames:[{key:"sprites",frame:"white-worker-2",duration:200},{key:"sprites",frame:"white-worker-1",duration:800}],repeat:-1,frameRate:3}),e.anims.create({key:"white-worker-idle-3",frames:[{key:"sprites",frame:"white-worker-1",duration:1200},{key:"sprites",frame:"white-worker-2",duration:300}],repeat:-1})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterMine"===t.name&&(e.miner.setPositionAfterMine(t.x,t.y),e.miner.disableChatIcon()),"minoAfterMine"===t.name&&e.fisherman.setPosition(t.x,t.y),"dogAfterMine"===t.name&&e.dog.setPosition(t.x,t.y),"catAfterMine"===t.name&&(e.cat.setPosition(t.x,t.y),e.cat.setDepth(121));for(let s=2;s<=4;s++)if(t.name===`afterMineMiner${s}`){const i=e[`minerDirty${s}`];i.setPosition(t.x,t.y),i.disableChatIcon(),i.scaleX=1}"whiteWorkerChief"===t.name&&(e.whiteWorkerChief=e.add.whiteWorkerChief(t.x,t.y),e.whiteWorkerChief.on("pointerdown",()=>qe(e),e),e.physics.add.collider(e.whiteWorkerChief,e.hero,()=>{h.emit(d,"whiteWorkerChief")})),"boyFactory"===t.name&&(e.boy.setPosition(t.x,t.y),e.boy.setSize(e.boy.width,1)),"girlFactory"===t.name&&e.girl.setPosition(t.x,t.y);for(let s=1;s<=2;s++)t.name===`whiteWorker${s}`&&(e[`whiteWorker${s}`]=e.add.whiteWorker(t.x,t.y,null,null,s),e[`whiteWorker${s}`].on("pointerdown",()=>qe(e),e),e.physics.add.collider(e[`whiteWorker${s}`],e.hero,()=>{h.emit(d,`whiteWorker${s}`)}));"minerZad1"===t.name&&(e[t.name]=e.add.miner(t.x,t.y),e[t.name].spriteId=t.name,e[t.name].moveAndUnlock(t.x,t.y),e[t.name].on("pointerdown",()=>qe(e),this),e.physics.add.collider(e[t.name],e.hero,()=>h.emit(d,t.name))),"minerZad2"===t.name&&(e[t.name]=e.add.minerDirty(t.x,t.y),e[t.name].setSpriteNumber(3),e[t.name].enableChatIcon(),e[t.name].spriteId=t.name,e[t.name].on("pointerdown",()=>qe(e),this),e.physics.add.collider(e[t.name],e.hero,()=>h.emit(d,t.name)))}e.landZad=e.map.createLayer("landZad",e.tileset).setDepth(20),e.upLandZad=e.map.createLayer("upLandZad",e.tileset).setDepth(21),e.bottomZad=e.map.createLayer("bottomZad",e.tileset).setDepth(70),e.topZad=e.map.createLayer("topZad",e.tileset).setDepth(120),e.forestZad=e.map.createLayer("forestZad",e.tileset).setDepth(119)},dt=e=>{e.tweens.add({targets:e.messageLater,alpha:0,y:80,ease:"Sine.easeIn",duration:1e3,onComplete:()=>e.messageLater.setVisible(!1)})},lt=function(e){console.log("setVillageForThirdAct"),J(e,!1),e.isNoMoreBirds=!0,P(e),M(e),Ue(e,!0,!0),ct(e),e.time.delayedCall(1,()=>{!function(e){e.isNoMoreBirds=!0,e.birds.forEach(e=>e.hide())}(e),function(e){e.butterflies.forEach(e=>e.destroy()),e.butterflies=[]}(e)}),e.cameras.main.setBounds(470,0,1674,e.map.heightInPixels-8),e.obstacleBridgeLayer.setCollisionByProperty({collide:!1}),e.obstacleBridgeLayer.destroy(),e.obstacleBridgeLayerCollider.destroy(),e.landRecyclingLayer=e.map.createLayer("landRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.bottomRecyclingLayer=e.map.createLayer("bottomRecycling",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.riverLessWaterRecyclingLayer=e.map.createLayer("riverLessWaterRecycling",e.tileset).setDepth(69).setCollisionByProperty({collide:!0}),e.riverRecyclingPollutedLayer=e.map.createLayer("riverRecyclingPolluted",e.tileset).setDepth(70),e.topRecyclingLayer=e.map.createLayer("topRecycling",e.tileset).setDepth(119).setCollisionByProperty({collide:!0}),e.topRecyclingCollider=e.physics.add.collider(e.hero,e.topRecyclingLayer),e.topRecyclingObjectsLayer=e.map.createLayer("topRecyclingObjects",e.tileset).setDepth(119).setCollisionByProperty({collide:!0}),e.obstacleRecyclingLayer.setCollisionByProperty({collide:!1}),e.obstacleRecyclingCollider.destroy(),function(e){e.anims.create({key:"blue-worker-idle-1",frames:[{key:"sprites",frame:"blue-worker-1",duration:1e3},{key:"sprites",frame:"blue-worker-2",duration:200}],repeat:-1}),e.anims.create({key:"blue-worker-idle-2",frames:[{key:"sprites",frame:"blue-worker-2",duration:300},{key:"sprites",frame:"blue-worker-1",duration:2e3}],repeat:-1})}(e);for(const t of e.map.getObjectLayer("sprites").objects)"boyThirdAct"===t.name&&e.boy.setThirdAct(t.x,t.y),"girlThirdAct"===t.name&&e.girl.setThirdAct(t.x,t.y),"babyThirdAct"===t.name&&e.baby.setPosition(t.x,t.y),"afterFactoryWhiteWorker1"===t.name&&(e.whiteWorker1.setPosition(t.x,t.y),e.whiteWorker1.scaleX=1,e.whiteWorker1.setOffset(0,e.whiteWorker1.height/2),e.whiteWorker1.setVisible(!0),e.whiteWorker1.disableChatIcon()),"afterFactoryWhiteWorker2"===t.name&&(e.whiteWorker2.setPosition(t.x,t.y),e.whiteWorker2.setVisible(!0),e.whiteWorker2.disableChatIcon()),"twoGuysRecycling"===t.name&&(e.twoGuys.enableChatIcon(),e.twoGuys.setPosition(t.x,t.y)),"blueWorkerChief"===t.name&&(e.blueWorkerChief=e.add.blueWorkerChief(t.x,t.y),e.blueWorkerChief.on("pointerdown",()=>qe(e),e),e.physics.add.collider(e.blueWorkerChief,e.hero,()=>{h.emit(d,"blueWorkerChief")})),"blueWorker1"===t.name&&(e.blueWorker1=e.add.blueWorker(t.x,t.y,null,null,1),e.blueWorker1.on("pointerdown",()=>qe(e),e),e.physics.add.collider(e.blueWorker1,e.hero,()=>{h.emit(d,"blueWorker1")})),"blueWorker2"===t.name&&(e.blueWorker2=e.add.blueWorker(t.x,t.y,null,null,2),e.blueWorker2.on("pointerdown",()=>qe(e),e),e.physics.add.collider(e.blueWorker2,e.hero,()=>{h.emit(d,"blueWorker2")}))},ct=function(e){if(e.anims.create({key:"screen-off",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"screen-off-"}),repeat:0,frameRate:10}),e.anims.create({key:"ads",frames:e.anims.generateFrameNames("sprites",{start:1,end:13,prefix:"ads-"}),repeat:-1,frameRate:2}),!e.screens){e.screens=e.map.createLayer("screens",e.tileset).setDepth(49).setVisible(!1);let t=1;e.screens.forEachTile(s=>{!0===s.properties?.screen&&(e.pointsCollider.push(e.physics.add.sprite(s.getCenterX()+1,s.getCenterY()-8,null).setSize(18,1).setImmovable(!0).setVisible(!1)),e.screenOffSprites.push(e.add.screen(s.getCenterX()+1,s.getCenterY()-3,t)),t++)}),e.screensTop=e.map.createLayer("screensTop",e.tileset).setDepth(149).setVisible(!1)}const t=!e.screens.visible;e.screensTop.setVisible(t),e.screens.setVisible(t)},ut="dcWorkerChief";class mt extends se{constructor(e,t,s){super(e,t,s,"sprites","miner-1",0,-5),this.spriteId=ut,this.delta=40,this.anims.play("miner-idle",!0),this.hasUnreadMessage(ut)}}Phaser.GameObjects.GameObjectFactory.register(ut,function(e,t){const s=new mt(this.scene,e,t);return this.scene.physics.world.enableBody(s,Phaser.Physics.Arcade.DYNAMIC_BODY),s.body.setSize(s.width+2,1),s.setImmovable(!0),s.setInteractive(),this.displayList.add(s),this.updateList.add(s),s});const pt=function(e){e.cameras.main.setBounds(660,100,1484,e.map.heightInPixels-108),console.log("setVillageForFourthAct"),J(e,!1),Ue(e,!0,!0),e.screenOffSprites.forEach(e=>e.enableShutdown()),e.dcBottomLayer=e.map.createLayer("dcBottom",e.tileset).setDepth(120).setCullPadding(2,2),e.dcBarriersFrontLayer=e.map.createLayer("dcBarriersFront",e.tileset).setDepth(120).setCullPadding(2,2),e.dcBarriersSideLayer=e.map.createLayer("dcBarriersSide",e.tileset).setDepth(120).setCullPadding(2,2),e.obstacleDcLayer=e.map.createLayer("obstacleDc",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleDcLayerCollider=e.physics.add.collider(e.hero,e.obstacleDcLayer);for(const t of e.map.getObjectLayer("sprites").objects)if("afterRecyclingBlueWorker1"===t.name&&(e.blueWorker1.setPosition(t.x,t.y),e.blueWorker1.setVisible(!0)),"afterRecyclingBlueWorker2"===t.name&&(e.blueWorker2.setPosition(t.x,t.y),e.blueWorker2.setVisible(!0)),"twoGuysAfterRecycling"===t.name&&e.twoGuys.setPosition(t.x,t.y),"dcWorker"===t.name.substring(0,8))for(let s=1;s<=4;s++){const i=`dcWorker${s}`;t.name===i&&(1!==s?(e[i]=e.add.minerDirty(t.x,t.y,null,null,s),e[i].disableChatIcon(),e[i].setDepth(1e3)):(e.dcWorkerChief=e.add.dcWorkerChief(t.x,t.y),e.dcWorkerChief.on("pointerdown",()=>qe(e),this),e.dcWorkerChiefCollider=e.physics.add.collider(e.dcWorkerChief,e.hero,()=>{h.emit(d,"dcWorkerChief")})))}e.treesOfDc.forEach(e=>{e.treeBase.destroy(),e.treeTop.destroy()}),e.treesOfDcCollider.forEach(e=>e.destroy()),e.treesOfDcColliders.destroy()},gt=function(e,s=!1){e.cameras.main.setBounds(470,400,1674,e.map.heightInPixels-408),e.checkDjangoDoor=!1,e.datacentreThemeEnabled=!1,function(e){e.bikes.forEach(e=>{e.setVisible(!0),e.body.checkCollision.none=!1})}(e),function(e){e.isNoMoreBirds=!1,e.birds.forEach(e=>e.show())}(e),e.obstacleDcLayer.destroy(),e.obstacleDcLayerCollider.destroy(),e.carsTopCollider.destroy(),e.roads.destroy(),e.roadsTop.destroy(),e.carsTop.destroy(),e.carsBottom.destroy(),e.carsBottomCollides.forEach(e=>e.destroy()),e.carsBottomCollider.destroy(),e.dcBottomLayer.destroy(),e.dcBarriersFrontLayer.destroy(),e.dcBarriersSideLayer.destroy(),e.obstacleDcLayer.destroy(),e.potagerBottom.setVisible(!0),e.potagerTop.setVisible(!0),e.physics.add.collider(e.hero,e.potagerTop),e.riverPolluted.destroy(),e.landUpRiverPolluted.destroy(),e.bridgesShadowPolluted.destroy();const i=e.map.createLayer("riverFinal",e.tileset).setCollisionByProperty({collide:!0}).setDepth(45);e.physics.add.collider(e.hero,i),e.map.createLayer("riverFinalTop",e.tileset).setDepth(45),e.map.createLayer("nonoTopFinal",e.tileset).setDepth(120),e.map.createLayer("nonoBottomFinal",e.tileset).setDepth(70),tt("nonoTreesFinal",e),e.topRecyclingCollider.destroy(),e.topRecyclingLayer.destroy(),e.topRecyclingObjectsLayer.destroy(),e.landRecyclingLayer.destroy(),e.bottomRecyclingLayer.destroy(),e.riverRecyclingPollutedLayer.destroy(),e.screens.destroy(),e.screensTop.destroy(),e.screenOffSprites.forEach(e=>e.destroy()),e.map.createLayer("screensDamaged",e.tileset).setDepth(49),e.map.createLayer("screensDamagedTop",e.tileset).setDepth(149),e.map.createLayer("carsDamagedBottom",e.tileset).setDepth(98),e.obstacleRecyclingLayer.setCollisionByProperty({collide:!0}),e.obstacleRecyclingCollider=e.physics.add.collider(e.hero,e.obstacleRecyclingLayer),e.obstaclesFactoryLayer.setCollisionByProperty({collide:!0}),e.obstaclesFactoryCollider=e.physics.add.collider(e.hero,e.obstaclesFactoryLayer);e.map.createLayer("carsDamagedTop",e.tileset).setDepth(120).forEachTile(t=>{!0===t.properties?.bottomCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.map.createLayer("roadsDamaged",e.tileset).setDepth(96),e.dcWorkerChief.disableChatIcon(),e.dcWorkerChief.destroy();for(let t=2;t<=4;t++){const s=`dcWorker${t}`;e[s].disableChatIcon(),e[s].destroy()}e.miner.destroy();for(let t=2;t<=4;t++)e[`minerDirty${t}`].destroy();if(e.nono.disableChatIcon(),e.nono.destroy(),e.whiteWorker1.destroy(),e.whiteWorker2.destroy(),e.whiteWorkerChief.destroy(),e.blueWorker1.destroy(),e.blueWorker2.destroy(),e.baby.disableChatIcon(),e.baby.destroy(),e.map.getObjectLayer("sprites").objects.forEach(t=>{"binoFinal"===t.name&&e.bino.setPosition(t.x,t.y).disableChatIcon(),"minoFinal"===t.name&&e.fisherman.setFinal(t.x,t.y),"kokoFinal"===t.name&&e.koko.setPosition(t.x,t.y).disableChatIcon(),"djangoFinal"===t.name&&e.django.setFinal(t.x,t.y),"girlFinal"===t.name&&e.girl.setFinal(t.x,t.y),"boyFinal"===t.name&&e.boy.setFinal(t.x,t.y),"dogFinal"===t.name&&e.dog.setPosition(t.x,t.y),"catFinal"===t.name&&e.cat.setPosition(t.x,t.y),"twoGuysFinal"===t.name&&(e.twoGuys.enableChatIcon(),e.twoGuys.setPosition(t.x,t.y)),"twoWomenFinal"===t.name&&(e.twoWomen.enableChatIcon(),e.twoWomen.setPosition(t.x,t.y)),"deerFinal"===t.name&&e.deer.setPosition(t.x,t.y).setVisible(!0),"owlFinal"===t.name&&e.owl.setPosition(t.x,t.y).setVisible(!0),"cowFinal"===t.name&&(e.cow.setPosition(t.x,t.y),e.cow.setVisible(!0),e.cow.setActive(!0),e.cow.toRight(),e.cow.body.checkCollision.none=!1),"cowHiddenFinal"===t.name&&(e.cowHidden.setPosition(t.x,t.y),e.cowHidden.setVisible(!0),e.cowHidden.setActive(!0),e.cowHidden.body.checkCollision.none=!1),"vealFinal"===t.name&&(e.veal.setPosition(t.x,t.y),e.veal.setVisible(!0),e.veal.setActive(!0),e.veal.toLeft(),e.veal.body.checkCollision.none=!1),"sleepingGuyFinal"===t.name&&e.sleepingGuy.setPosition(t.x,t.y)}),e.landZad.destroy(),e.upLandZad.destroy(),e.bottomZad.destroy(),e.topZad.destroy(),e.forestZad.destroy(),e.minerZad1.destroy(),e.minerZad2.destroy(),h.on(b,t=>{K(t,"django_final_end")&&e.time.delayedCall(200,()=>{h.emit(d,"bino"),qe(e)})}),s)return;const n=()=>{e.heroPositions.heroDjangoDoor;e.hero.x>e.django.x-130&&e.hero.y>e.django.y-130&&e.hero.y<e.django.y+130&&(e.events.off("update",n),X(["django_final"]),e.isFinal=!0,function(e){if(a("nomusic")||D||e.djangoTheme&&e.djangoTheme.isPlaying)return;if(R(e,e.villageTheme),e.djangoTheme&&e.sound.get("django-theme"))return void W(e,e.djangoTheme);D=!0;const s=new t.Loader.LoaderPlugin(e);s.audio("django-theme","sounds/django_theme.mp3"),s.once("complete",()=>{e.djangoTheme=e.sound.add("django-theme"),W(e,e.djangoTheme),D=!1}),s.start()}(e),e.isCinematic=!0,e.cameras.main.fadeOut(500,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroDjangoFinal"),e.hero.slowUp(),e.hero.animateToUp(),e.cameras.main.fadeIn(500,0,0,0,(t,s)=>{1===s&&(e.stopMoving(),e.isCinematic=!1,h.emit(d,"django"),qe(e))}))}))};e.events.on("update",n)},yt="nono";class ft extends se{constructor(e,t,s){super(e,t,s,"sprites","nono-1",-2,-2),this.spriteId=yt,e.anims.create({key:"nono-idle",frames:[{key:"sprites",frame:"nono-1",duration:700},{key:"sprites",frame:"nono-2",duration:700},{key:"sprites",frame:"nono-1",duration:700},{key:"sprites",frame:"nono-2",duration:700},{key:"sprites",frame:"nono-3",duration:300}],repeat:-1}),this.anims.play("nono-idle",!0),this.hasUnreadMessage(this.spriteId),h.on(b,this.listenEvents,this)}listenEvents(e){K(e,"pre_card_for_mine")&&(this.anims.stop(),this.setTexture("sprites","nono-card")),K(e,"card_for_mine")&&this.anims.play("nono-idle",!0)}}e.GameObjects.GameObjectFactory.register(yt,function(t,s){const i=new ft(this.scene,t,s);return this.scene.physics.world.enableBody(i,e.Physics.Arcade.DYNAMIC_BODY),i.body.setSize(i.width+2,1),i.setImmovable(!0),i.setInteractive(),this.displayList.add(i),this.updateList.add(i),i});const bt=function(e){e.isCinematic=!0,P(e),M(e),e.setHeroPosition("heroDjangoDoor"),e.hero.slowRightDown(),e.hero.animateToRight(),J(e,!1),wt(e),h.emit(v,["first_sleep"]),e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(1e3,()=>{e.isCinematic=!1,h.emit(d,"django"),qe(e)})},wt=function(e){vt(e),Ue(e,!0),e.boy.setSad(),e.girl.setSad(),e.fisherman.setSad();for(const t of e.map.getObjectLayer("sprites").objects)"nono"===t.name&&(e.nono=e.add.nono(t.x,t.y),e.nono.on("pointerdown",()=>qe(e),this),e.physics.add.collider(e.nono,e.hero,()=>{h.emit(d,"nono")})),"cowForest"===t.name&&(e.cow.setPosition(t.x,t.y),e.cow.body.setSize(20,10),e.cow.toRight()),"vealForest"===t.name&&(e.veal.setPosition(t.x,t.y),e.veal.toRight());N("sfx_objet_inventaire",e)},vt=function(e){e.riverPolluted||(e.riverPolluted=e.map.createLayer("riverPolluted",e.tileset).setDepth(45),e.landUpRiverPolluted=e.map.createLayer("landUpRiverPolluted",e.tileset).setDepth(46),e.bridgesShadowPolluted=e.map.createLayer("bridgesShadowPolluted",e.tileset).setDepth(51))},kt="minerChief";class Ct extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-chief-1",0,-5),this.spriteId=kt,this.delta=20,this.futureMinerPosition=null,this.initialY=s,e.anims.create({key:"miner-chief-idle",frames:[{key:"sprites",frame:"miner-chief-1",duration:800},{key:"sprites",frame:"miner-chief-2",duration:700},{key:"sprites",frame:"miner-chief-3",duration:300}],repeat:-1}),this.anims.play("miner-chief-idle",!0),this.hasUnreadMessage(this.spriteId)}}Phaser.GameObjects.GameObjectFactory.register(kt,function(e,t,s,i){const a=new Ct(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(a,Phaser.Physics.Arcade.DYNAMIC_BODY),a.body.setSize(a.width,1),a.setImmovable(!0),a.setInteractive(),a.scaleX=-1,a.setOffset(a.width,a.height/2),this.displayList.add(a),this.updateList.add(a),a});class xt extends se{constructor(e,t,s,i,a){super(e,t,s,"sprites","miner-dirty-1",0,-5),this.delta=20,this.futureMinerPosition=null,this.initialY=s}setSpriteNumber(e){if(e){if(this.spriteId=`minerDirty${e}`,this.anims.play("miner-dirty-idle-"+(e-1),!0),e>2)return this.scaleX=-1,void this.setOffset(this.width,this.height/2);this.setOffset(0,this.height/2)}}}Phaser.GameObjects.GameObjectFactory.register("minerDirty",function(e,t,s,i,a){const n=new xt(this.scene,e,t,s,i);return this.scene.physics.world.enableBody(n,Phaser.Physics.Arcade.DYNAMIC_BODY),n.body.setSize(10,1),n.setImmovable(!0),n.setInteractive(),n.setSpriteNumber(a),this.displayList.add(n),this.updateList.add(n),n});const Ot=function(e){e.cameras.main.setBounds(0,0,e.map.widthInPixels,e.map.heightInPixels-8),function(e){e.anims.create({key:"miner-dirty-idle-1",frames:[{key:"sprites",frame:"miner-dirty-1",duration:800},{key:"sprites",frame:"miner-dirty-2",duration:200}],repeat:-1}),e.anims.create({key:"miner-dirty-idle-2",frames:[{key:"sprites",frame:"miner-dirty-2",duration:150},{key:"sprites",frame:"miner-dirty-1",duration:1e3}],repeat:-1}),e.anims.create({key:"miner-dirty-idle-3",frames:[{key:"sprites",frame:"miner-dirty-1",duration:700},{key:"sprites",frame:"miner-dirty-2",duration:200}],repeat:-1})}(e);for(const t of e.map.getObjectLayer("sprites").objects){"minerAfterCard"===t.name&&e.miner.moveAndUnlock(t.x,t.y),"minerChief"===t.name&&(e.minerChief=e.add.minerChief(t.x,t.y),e.minerChief.on("pointerdown",()=>qe(e),this),e.physics.add.collider(e.minerChief,e.hero,()=>{h.emit(d,"minerChief")}));for(let s=2;s<=4;s++)t.name===`miner${s}`&&(e[`minerDirty${s}`]=e.add.minerDirty(t.x,t.y,null,null,s),e[`minerDirty${s}`].on("pointerdown",()=>qe(e),this),e.physics.add.collider(e[`minerDirty${s}`],e.hero,()=>{h.emit(d,`minerDirty${s}`)}))}!function(e){const s=new t.Loader.LoaderPlugin(e);s.atlas("mineLand","sprites/mineLand.png","sprites/mineLand.json"),s.once("complete",()=>Qe(e)),s.start()}(e)},Dt=e=>localStorage.setItem("progression",e),_t=()=>localStorage.getItem("progression"),St=e=>{e.messageSavedProgression?e.messageSavedProgression.setVisible(!0).setAlpha(0):e.messageSavedProgression=e.add.bitmapText(225,260,"FreePixelStrokeShadow-16",ot("progression.saved"),16).setOrigin(.5,.5).setScrollFactor(0).setDepth(1e4).setAlpha(0),e.tweens.add({targets:e.messageSavedProgression,alpha:1,y:240,ease:"Sine.easeOut",duration:500,onComplete:()=>e.tweens.add({delay:2e3,targets:e.messageSavedProgression,alpha:0,y:260,ease:"Sine.easeIn",duration:500,onComplete:()=>e.messageSavedProgression.setVisible(!1)})})},It=function(e,t){if(console.time("Init"),e.map=e.make.tilemap({key:"map"}),e.tileset=e.map.addTilesetImage("Atlas_01","tiles"),e.land=e.map.createLayer("land",e.tileset).setDepth(20).setCollisionByProperty({collide:!0}).setCullPadding(2,2),e.map.createLayer("landUp",e.tileset).setDepth(40),e.bridgesShadow=e.map.createLayer("bridgesShadow",e.tileset).setDepth(50),e.bridges=e.map.createLayer("bridges",e.tileset).setDepth(60),e.bottomObjects=e.map.createLayer("bottom",e.tileset).setDepth(70).setCollisionByProperty({collide:!0}),e.potagerBottom=e.map.createLayer("potagerBottom",e.tileset).setDepth(70),function(e){["sapin","pin","arbre"].forEach(t=>{for(let s=1;s<=10;s++)e.anims.create({key:`${t}-${s}`,frames:e.anims.generateFrameNames("trees",{start:1,end:2,prefix:`${t}-`}),duration:Phaser.Math.Between(1900,2200),repeat:-1})}),e.map.createLayer("bottomStaticTrees",e.tileset).setDepth(130),e.map.createLayer("staticTrees",e.tileset).setDepth(150),tt("trees",e)}(e),e.map.getObjectLayer("hero").objects.forEach(t=>{var s;(e.heroPositions[t.name]={x:t.x,y:t.y},"hero"===t.name)&&(e.tent=e.add.sprite(t.x+2,t.y-2,"sprites","tent-1").setDepth(100),e.hero=e.add.hero(t.x,t.y).setDepth(100),e.hero.stopAndWait(),(s=e.anims).create({key:"mai-walk-down",frames:s.generateFrameNames("mai",{start:1,end:4,prefix:"walk-down-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-walk-up",frames:s.generateFrameNames("mai",{start:1,end:4,prefix:"walk-up-"}),repeat:-1,yoyo:!0,frameRate:10}),s.create({key:"mai-walk-side",frames:s.generateFrameNames("mai",{start:1,end:4,prefix:"walk-right-"}),repeat:-1,frameRate:10}).addFrame(s.generateFrameNames("mai",{start:2,end:3,prefix:"walk-right-"})),s.create({key:"mai-idle-down",frames:[{key:"mai",frame:"idle-down-1",duration:1500},{key:"mai",frame:"idle-down-2",duration:200}],repeat:-1}),s.create({key:"mai-idle-up",frames:[{key:"mai",frame:"idle-up"}],repeat:-1,frameRate:4}),s.create({key:"mai-idle-side",frames:[{key:"mai",frame:"idle-right-1",duration:1500},{key:"mai",frame:"idle-right-2",duration:200}],repeat:-1,yoyo:!0,frameRate:4}))}),function(e){Ge(e),N("sfx_oiseaux_volent",e),e.map.getObjectLayer("birds").objects.forEach(t=>{e.birds.push(e.add.bird(t.x,t.y).setDepth(160))}),e.physics.add.collider(e.birds,e.hero,e=>e.fly())}(e),function(e){e.anims.create({key:"butterfly-anim",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"butterfly-"}),repeat:-1,frameRate:4}).addFrame([{key:"sprites",frame:"butterfly-2",duration:2}]),e.map.getObjectLayer("butterflies").objects.forEach(t=>{e.butterflies.push(e.add.butterfly(t.x,t.y).setDepth(160))})}(e),a("noanims")||(console.time("animatedTiles"),e.animatedTiles.init(e.map),console.timeEnd("animatedTiles")),e.cameras.main.setBounds(0,400,2144,e.map.heightInPixels-408),e.cameras.main.startFollow(e.hero,!0),function(e){a("debugcontrols")&&(e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M).on("down",()=>{e.cameras.main.zoomTo(2===e.cameras.main.zoom?1:.18,100)}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P).on("down",()=>{e.cameras.main.zoomTo(.18===e.cameras.main.zoom?1:2,100)}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F).on("down",()=>{e.setHeroPosition("heroFactory")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.K).on("down",()=>{e.setHeroPosition("heroKoko")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B).on("down",()=>{e.setHeroPosition("heroMiner")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D).on("down",()=>{e.setHeroPosition("heroDjango")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.N).on("down",()=>{e.setHeroPosition("heroNono")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E).on("down",()=>{wt(e),Ot(e),ht(e),e.setHeroPosition("heroRecycling"),e.isCinematic=!1,h.emit(v,["third_act_begin"])}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S).on("down",()=>{e.isCinematic=!0,e.time.delayedCall(2e3,()=>{e.setHeroPosition("heroKoko"),wt(e),Ot(e),ht(e),lt(e),e.isCinematic=!1,h.emit(v,["fourth_act_begin"])})}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).on("down",()=>{e.isCinematic=!0,e.time.delayedCall(2e3,()=>{e.setHeroPosition("heroKoko"),wt(e),Ot(e),ht(e),lt(e),pt(e),e.isCinematic=!1,h.emit(v,["strike_end"])})}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.G).on("down",()=>{e.isCinematic=!0,e.time.delayedCall(2e3,()=>{e.setHeroPosition("heroDjangoFinal"),wt(e),Ot(e),ht(e),lt(e),pt(e),gt(e,!0),h.emit(v,["game_over"])})}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Y).on("down",()=>{h.emit(v,["django_met","pre_first_sleep"])}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C).on("down",()=>{h.emit(v,["card_for_mine"])}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T).on("down",()=>{et(e)}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.O).on("down",()=>{wt(e),h.emit(v,["mine_access_validation"]),e.setHeroPosition("heroMine")}),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A).on("down",()=>et(e)),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.L).on("down",()=>$(e)),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.X).on("down",()=>ct(e)),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z).on("down",()=>e.setHeroPosition("heroZad")),e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.R).on("down",()=>e.setHeroPosition("heroRecycling")),e.input.on("pointerdown",t=>console.log({pointer:[t.x,t.y],hero:[e.hero.x,e.hero.y]})))}(e),function(e){e.cursors=e.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right",w:"up",z:"up",q:"left",a:"left",s:"down",d:"right"}),e.input.keyboard.on("keydown",t=>{e.isCinematic||(["ArrowUp","z","w"].includes(t.key)?(e.goingUp=!0,e.goingDown=!1,e.howToPlay=!1):["ArrowDown","s"].includes(t.key)?(e.goingDown=!0,e.goingUp=!1,e.howToPlay=!1):["ArrowLeft","q","a"].includes(t.key)?(e.goingLeft=!0,e.goingRight=!1,e.howToPlay=!1):["ArrowRight","d"].includes(t.key)?(e.goingRight=!0,e.goingLeft=!1,e.howToPlay=!1):32===t.keyCode&&qe(e))},this),e.input.keyboard.on("keyup",t=>{e.isCinematic||(["ArrowUp","z","w"].includes(t.key)?e.goingUp=!1:["ArrowDown","s"].includes(t.key)?e.goingDown=!1:["ArrowLeft","q","a"].includes(t.key)?e.goingLeft=!1:["ArrowRight","d"].includes(t.key)&&(e.goingRight=!1))},this)}(e),function(e){r()&&(e.joystick=e.plugins.get("rexvirtualjoystickplugin").add(e,{x:100,y:200,radius:50,base:e.add.circle(0,0,40,16733508,.2).setDepth(1e4),thumb:e.add.circle(0,0,20,16777215,.3).setDepth(1e4),dir:"8dir",forceMin:16,enable:!0,inputEnable:!0,fixed:!0}),e.input.on("pointerdown",t=>{e.isCinematic||(e.joystick.setPosition(t.x,t.y),e.joystick.setVisible(!0),qe(e))},this),e.joystick.on("update",()=>{e.isCinematic||(e.howToPlay=!1,e.goingAngle=e.joystick.angle,e.joystick.left?(e.goingLeft=!0,e.goingRight=!1,(177.5<e.goingAngle||-177.5>e.goingAngle)&&(e.goingUp=!1,e.goingDown=!1)):e.joystick.right&&(e.goingRight=!0,e.goingLeft=!1,22.5>e.goingAngle&&-22.5<e.goingAngle&&(e.goingUp=!1,e.goingDown=!1)),e.joystick.up?(e.goingUp=!0,e.goingDown=!1,-67.5>e.goingAngle&&-112.5<e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1)):e.joystick.down&&(e.goingDown=!0,e.goingUp=!1,67.5<e.goingAngle&&112.5>e.goingAngle&&(e.goingRight=!1,e.goingLeft=!1)))},this),e.joystick.on("pointerup",()=>{e.isCinematic||(e.joystick.setVisible(!1),e.stopMoving())},this))}(e),e.addEventsListeners(),e.obstacles=e.map.createLayer("obstacles",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.obstacleRecyclingLayer=e.map.createLayer("obstacleRecycling",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),!t)return e.cameras.main.fadeIn(1e3,0,0,0),e.time.delayedCall(2e3,()=>Tt(e)),e.time.delayedCall(3e3,()=>e.scene.run("message")),e.time.delayedCall(4e3,()=>jt(e)),void(a("nostart")||function(e){e.anims.create({key:"tent",frames:e.anims.generateFrameNames("sprites",{start:1,end:6,prefix:"tent-"}),repeat:0,frameRate:10}),N("sfx_tente",e),e.isIntro=!0,e.isCinematic=!0,e.hero.setVisible(!1);const t=()=>{e.isIntro&&(e.howToPlay||((e.goingUp||e.goingLeft||e.goingRight)&&(e.goingUp=!1,e.goingLeft=!1,e.goingRight=!1,e.goingDown=!0),e.goingDown&&(e.isCinematic=!0,e.hero.slowDown(),e.hero.animateToDown(),e.hero.setVisible(!0)),e.hero.y>e.heroPositions.hero.y+20&&(e.hero.animateToUp(),e.hero.stopAndWait(),e.events.off("update",t),e.isIntro=!1,e.goingDown=!1,e.tent.anims.play("tent",!0),G("sfx_tente",e),e.tent.on("animationcomplete",()=>{e.tent.destroy(),e.isCinematic=!1}))))};e.time.delayedCall(1e3,()=>{e.isCinematic=!1,e.events.on("update",t)})}(e));Tt(e),e.scene.run("message");const s=_t();s&&("first_sleep"===s?bt(e):"second_act"===s?(wt(e),Ot(e),h.emit(v,["second_act_begin"])):"third_act"===s?(wt(e),Ot(e),ht(e),h.emit(v,["third_act_begin"])):"fourth_act"===s&&(wt(e),Ot(e),ht(e),lt(e),h.emit(v,["fourth_act_begin"])))},jt=function(e){e.howToPlay&&(e.howToPlayText=e.add.bitmapText(225,220,"FreePixelStrokeShadow-16",ot("game.howToPlay"),16).setOrigin(.5,.5).setScrollFactor(0).setMaxWidth(200).setDepth(1e4).setAlpha(0),e.tweens.add({targets:e.howToPlayText,alpha:.8,y:200,ease:"Sine.easeInOut",duration:2e3}),e.joystick?.setVisible(!0),Pt(e))},Pt=function(e){e.howToPlay?e.time.delayedCall(1e3,()=>Pt(e)):e.tweens.add({targets:e.howToPlayText,alpha:0,ease:"Sine.easeInOut",duration:2e3,onComplete:()=>e.howToPlayText.destroy()})},Tt=function(e){e.anims.create({key:"exclam",frames:e.anims.generateFrameNames("sprites",{start:1,end:3,prefix:"exclam-"}),repeat:-1,frameRate:6}).addFrame([{key:"sprites",frame:"exclam-2",duration:1}]),e.map.getObjectLayer("sprites").objects.forEach(t=>{"django"===t.name&&(e.django=e.add.django(t.x,t.y),e.django.on("pointerdown",()=>qe(e),this)),"koko"===t.name&&(e.koko=e.add.koko(t.x,t.y),e.koko.on("pointerdown",()=>qe(e),this)),"sleepingGuy"===t.name&&(e.sleepingGuy=e.add.sleepingGuy(t.x,t.y),e.sleepingGuy.on("pointerdown",()=>qe(e),this)),"twoGuys"===t.name&&(e.twoGuys=e.add.twoGuys(t.x,t.y),e.twoGuys.on("pointerdown",()=>qe(e),this)),"twoWomen"===t.name&&(e.twoWomen=e.add.twoWomen(t.x,t.y),e.twoWomen.on("pointerdown",()=>qe(e),this)),"baby"===t.name&&(e.baby=e.add.baby(t.x,t.y),e.baby.on("pointerdown",()=>qe(e),this)),"bino"===t.name&&(e.bino=e.add.bino(t.x,t.y),e.bino.on("pointerdown",()=>qe(e),this)),"binoCleaningRoad"===t.name&&e.bino.setCleaningRoadPosition(t.x,t.y),"mino"===t.name&&(e.fisherman=e.add.fisherman(t.x,t.y),e.fisherman.on("pointerdown",()=>qe(e),this)),"cat"===t.name&&(e.cat=e.add.cat(t.x,t.y),e.cat.on("pointerdown",()=>qe(e),this)),"dog"===t.name&&(e.dog=e.add.dog(t.x,t.y),e.dog.on("pointerdown",()=>qe(e),this)),"escargot"===t.name&&(e.escargot=e.add.escargot(t.x,t.y),e.escargot.on("pointerdown",()=>qe(e),this)),"cow"===t.name&&(e.cow=e.add.cow(t.x,t.y),e.cow.on("pointerdown",()=>qe(e),this)),"cowHidden"===t.name&&(e.cowHidden=e.add.cow(t.x,t.y),e.cowHidden.toRight(),e.cowHidden.on("pointerdown",()=>qe(e),this)),"veal"===t.name&&(e.veal=e.add.veal(t.x,t.y),e.veal.on("pointerdown",()=>qe(e),this)),"miner"===t.name&&(e.miner=e.add.miner(t.x,t.y),e.miner.on("pointerdown",()=>qe(e),this)),"ball"===t.name&&(e.ball=e.add.ball(t.x,t.y)),"girl"===t.name&&(e.girl=e.add.girl(t.x,t.y)),"boy"===t.name&&(e.boy=e.add.boy(t.x,t.y),e.boy.on("pointerdown",()=>qe(e),this)),"bike"===t.name&&e.bikes.push(e.add.bike(t.x,t.y)),"boySad"===t.name&&e.boy.setSadPosition(t.x,t.y),"girlSad"===t.name&&e.girl.setSadPosition(t.x,t.y),"deer"===t.name&&(e.deer=e.add.deer(t.x,t.y)),"owl"===t.name&&(e.owl=e.add.owl(t.x,t.y))}),e.bridgesTop=e.map.createLayer("bridgesTop",e.tileset).setDepth(110),e.topObjects=e.map.createLayer("top",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.potagerTop=e.map.createLayer("potagerTop",e.tileset).setDepth(120).setCollisionByProperty({collide:!0}),e.topObjects.forEachTile(t=>{!0===t.properties?.pointCollide?e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(10,1).setImmovable(!0).setVisible(!1)):!0===t.properties?.lineCollide?e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY(),null).setSize(16,1).setImmovable(!0).setVisible(!1)):!0===t.properties?.bottomCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()+8,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.land.forEachTile(t=>{!0===t.properties?.topCollide&&e.pointsCollider.push(e.physics.add.sprite(t.getCenterX(),t.getCenterY()-7,null).setSize(16,1).setImmovable(!0).setVisible(!1))}),e.obstaclesFactoryLayer=e.map.createLayer("obstaclesFactory",e.tileset).setCollisionByProperty({collide:!0}).setVisible(!1),e.physics.add.collider(e.miner,e.hero,()=>{h.emit(d,"miner")}),e.physics.add.collider(e.bino,e.hero,()=>{h.emit(d,"bino")}),e.physics.add.collider(e.django,e.hero,()=>{h.emit(d,"django")}),e.physics.add.collider(e.koko,e.hero,()=>{h.emit(d,"koko")}),e.physics.add.collider(e.sleepingGuy,e.hero,()=>{h.emit(d,"sleepingGuy")}),e.physics.add.collider(e.twoWomen,e.hero,()=>{h.emit(d,"twoWomen")}),e.physics.add.collider(e.baby,e.hero,()=>{h.emit(d,"baby")}),e.physics.add.collider(e.twoGuys,e.hero,()=>{h.emit(d,"twoGuys")}),e.physics.add.collider(e.fisherman,e.hero,()=>{h.emit(d,"fisherman")}),e.physics.add.collider(e.cat,e.hero,()=>{h.emit(d,"cat")}),e.physics.add.collider(e.dog,e.hero,()=>{h.emit(d,"dog")}),e.physics.add.collider(e.escargot,e.hero,()=>{h.emit(d,"escargot")}),e.physics.add.collider(e.cow,e.hero,()=>{h.emit(d,"cow")}),e.physics.add.collider(e.cowHidden,e.hero,()=>{h.emit(d,"cow")}),e.physics.add.collider(e.veal,e.hero,()=>{h.emit(d,"veal")}),e.physics.add.collider(e.boy,e.hero,()=>{h.emit(d,"boy")}),e.physics.add.collider(e.girl,e.hero,()=>{h.emit(d,"girl")}),e.physics.add.collider(e.bikes,e.hero),e.physics.add.collider(e.hero,e.water),e.physics.add.collider(e.hero,e.land),e.physics.add.collider(e.hero,e.obstacles),e.obstacleRecyclingCollider=e.physics.add.collider(e.hero,e.obstacleRecyclingLayer),e.physics.add.collider(e.hero,e.topObjects),e.potagerCollider=e.physics.add.collider(e.hero,e.potagerTop),e.physics.add.collider(e.hero,e.bottomObjects),e.physics.add.collider(e.hero,e.pointsCollider),e.treesOfDcColliders=e.physics.add.collider(e.hero,e.treesOfDcCollider),e.obstaclesFactoryCollider=e.physics.add.collider(e.hero,e.obstaclesFactoryLayer);for(const t of["hommes","femmes","enfants","ouvriers"])for(let s=1;s<=4;s++)N(`sfx_voix_${t}_${s}`,e);N("sfx_chat_1",e),N("sfx_chat_2",e),N("sfx_chien_1",e),N("sfx_chien_2",e),N("sfx_vache_1",e),N("sfx_vache_2",e)},At=function(e){e.isCinematic=!0,window.setTimeout(()=>A(e),1),e.cameras.main.fadeOut(e.isBonus?2e3:3e3,0,0,0,(t,s)=>{1===s&&(e.scene.launch("mine"),e.sleepGame())})},Lt=function(e){e.isCinematic=!0,window.setTimeout(()=>A(e),1),e.cameras.main.fadeOut(e.isBonus?2e3:3e3,0,0,0,(t,s)=>{1===s&&(e.scene.launch("factory"),e.sleepGame())})},Mt=function(e){e.isCinematic=!0,window.setTimeout(()=>A(e),1),e.cameras.main.fadeOut(e.isBonus?2e3:3e3,0,0,0,(t,s)=>{1===s&&(e.scene.launch("recyclingCentre"),e.sleepGame())})},Bt=function(e){if(a("nostart"))return e.resetGameSize(),void e.startGame();const t=()=>{let t=!1,s=null;const a=_t(),r=e.add.bitmapText(275,164,"FreePixel-16",e.isBonus||a?ot("game.newGame"):ot("game.play"),16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});r.input.hitArea.setTo(-20,-10,r.width+40,r.height+20);const d=(a=!1)=>{e.isBonus=!1,t=!0,a?(s.disableInteractive(!0),s.setText(ot("game.loading")),r.destroy()):(r.disableInteractive(!0),r.setText(ot("game.loading")),s?.destroy()),document.body.style.cursor="none",e.cameras.main.fadeOut(500,0,0,0,(t,h)=>{1===h&&(e.resetGameSize(),e.startGame(a),i.destroy(),r?.destroy(),s?.destroy(),k.destroy(),v.destroy(),w.destroy(),f.destroy(),n.destroy(),y.destroy(),o.destroy(),c.destroy(),C.destroy(),x.destroy())})},l=e=>{t=!0,e.disableInteractive(!0),e.setTintFill(3355443),document.body.style.cursor="none"};r.on("pointerdown",()=>{t||d()}),r.on("pointerover",()=>Ft(r,3178349)),r.on("pointerout",()=>Et(r)),a&&(s=e.add.bitmapText(275,124,"FreePixel-16",ot("game.continueGame"),16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0}),s.input.hitArea.setTo(-20,-10,s.width+40,s.height+20),s.on("pointerdown",()=>{t||d(!0)}),s.on("pointerover",()=>Ft(s,3178349)),s.on("pointerout",()=>Et(s)));const u=e.add.bitmapText(510,285,"FreePixel-16",ot("game.credits"),16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});if(u.input.hitArea.setTo(-20,-10,u.width+40,u.height+20),u.on("pointerdown",()=>window.location.href="credits.html"),u.on("pointerover",()=>Ft(u,0)),u.on("pointerout",()=>Et(u)),e.isBonus){const s=e.add.bitmapText(160,210,"FreePixel-16",ot("game.mine"),16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});s.input.hitArea.setTo(-20,-10,s.width+40,s.height+20),s.on("pointerover",()=>Ft(s)),s.on("pointerout",()=>Et(s)),s.on("pointerdown",()=>{t||(l(s),At(e))});const i=e.add.bitmapText(260,240,"FreePixel-16",ot("game.factory"),16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});i.input.hitArea.setTo(-20,-10,i.width+40,i.height+20),i.on("pointerover",()=>Ft(i)),i.on("pointerout",()=>Et(i)),i.on("pointerdown",()=>{t||(l(i),Lt(e))});const a=e.add.bitmapText(400,260,"FreePixel-16",ot("game.recycling"),16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});a.input.hitArea.setTo(-20,-10,a.width+40,a.height+20),a.on("pointerover",()=>Ft(a)),a.on("pointerout",()=>Et(a)),a.on("pointerdown",()=>{t||(l(a),Mt(e))})}h.on(b,t=>{e.isBonus&&(K(t,"factory_after")||K(t,"mine_after")||K(t,"recycling_after"))&&(window.location.href="?bonus")})};e.cameras.main.fadeIn(1e3);const s=_t();e.scale.setGameSize(550,300),M(e),e.anims.create({key:"mai",frames:e.anims.generateFrameNames("splash",{start:1,end:4,prefix:"mai-"}),repeat:-1,frameRate:4}),e.anims.create({key:"rock",frames:e.anims.generateFrameNames("splash",{start:1,end:2,prefix:"rock-"}),repeat:-1,frameRate:2}),e.anims.create({key:"smoke-big",frames:e.anims.generateFrameNames("splash",{start:1,end:5,prefix:"smoke-big-"}),repeat:-1,frameRate:5}),e.anims.create({key:"smoke-small",frames:e.anims.generateFrameNames("splash",{start:1,end:5,prefix:"smoke-small-"}),repeat:-1,frameRate:5});const i=e.add.rectangle(0,0,550,300,10538928).setOrigin(0,0),n=e.add.image(0,0,"splash","cloud-top").setOrigin(0,0),o=e.add.image(260,30,"splash","cloud-two").setOrigin(0,0),d=t=>e.tweens.add({targets:o,x:600,duration:t,onComplete:()=>l()}),l=()=>{o.x=-o.width,d(9e4)};d(25e3);const c=e.add.image(400,60,"splash","cloud-middle").setOrigin(0,0),u=t=>e.tweens.add({targets:c,x:600,duration:t,onComplete:()=>m()}),m=()=>{c.x=-c.width,u(7e4)};u(9e3);const p=t=>e.tweens.add({targets:y,x:600,duration:t,onComplete:()=>g()}),g=()=>{y.x=-y.width,p(2e5)},y=e.add.image(30,70,"splash","cloud-big").setOrigin(0,0);p(1e5);const f=e.add.sprite(0,137,"splash","background").setOrigin(0,0),w=e.add.sprite(0,212,"splash","rock-1").setOrigin(0,0);w.play("rock");const v=e.add.sprite(60,118,"splash","mai-1").setOrigin(0,0);v.play("mai");const k=e.add.bitmapText(275,130+(s&&-50),"FreePixel-16","Trois-Rivières",32).setOrigin(.5,.5).setTintFill(3178349),C=e.add.sprite(372,97,"splash","smoke-big-1").setOrigin(0,0);C.play("smoke-big");const x=e.add.sprite(413,153,"splash","smoke-small-1").setOrigin(0,0);if(x.play("smoke-small"),r()){const t=e.add.bitmapText(225,50,"FreePixel-16","Tournez votre appareil en mode paysage.",32).setMaxWidth(400).setOrigin(.5,.5).setVisible(!1).setDepth(1e4),s=()=>{screen?.orientation?.type?.includes("landscape")||!screen?.orientation&&window?.matchMedia("(orientation: landscape)")?.matches?t.setVisible(!1):t.setVisible(!0)};if(s(),screen?.orientation)screen.orientation.addEventListener("change",()=>s());else{const e=window?.matchMedia("(orientation: landscape)");e?.addListener(e=>{e.matches?t.setVisible(!1):t.setVisible(!0)})}}if(e.isBonus=a("bonus"),e.isBonus)return void t();const O=e=>{var s;s=e,localStorage.setItem("locale",s),D.destroy(),_.destroy(),t()},D=e.add.bitmapText(220,160,"FreePixel-16","Français",16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});D.input.hitArea.setTo(-20,-20,D.width+40,D.height+40),D.on("pointerdown",()=>O("fr")),D.on("pointerover",()=>Ft(D,3178349)),D.on("pointerout",()=>Et(D));const _=e.add.bitmapText(330,160,"FreePixel-16","English",16).setOrigin(.5,.5).setTintFill(16777215).setInteractive({useHandCursor:!0});_.input.hitArea.setTo(-20,-20,_.width+40,_.height+40),_.on("pointerdown",()=>O("en")),_.on("pointerover",()=>Ft(_,3178349)),_.on("pointerout",()=>Et(_))},Ft=(e,t=0)=>e.setTintFill(t),Et=e=>e.setTintFill(16777215),Rt=function(e){e.checkDjangoDoor=!1,e.setHeroPosition("heroStrike"),e.hero.slowUp(),e.hero.animateToUp(),e.dcWorker3.scaleX=1,e.map.createLayer("topStrike",e.tileset).setDepth(120),e.map.createLayer("bottomStrike",e.tileset).setDepth(70),e.map.getObjectLayer("sprites").objects.forEach(t=>{"strikeDcWorker1"===t.name&&(e.dcWorkerChief.setPosition(t.x,t.y),e.dcWorkerChief.disableChatIcon(),e.dcWorkerChief.setDepth(1e3),e.dcWorkerChief.setDelta(0),e.dcWorkerChiefCollider.destroy(),e.dcWorkerChief.off("pointerdown")),"strikeDcWorker4"===t.name&&(e.dcWorker4.setPosition(t.x,t.y),e.dcWorker4.scaleX=1),"djangoStrike"===t.name&&e.django.beforeStrike(t.x,t.y),"girlStrike"===t.name&&(e.girl.setPosition(t.x,t.y),e.girl.disableChatIcon()),"boyStrike"===t.name&&(e.boy.setPosition(t.x,t.y),e.boy.disableChatIcon(),e.boy.scaleX=-1),"binoStrike"===t.name&&(e.bino.setPosition(t.x,t.y),e.bino.disableChatIcon()),"minoStrike"===t.name&&(e.fisherman.setOnStrike(t.x,t.y),e.fisherman.disableChatIcon()),"babyStrike"===t.name&&(e.baby.setPosition(t.x,t.y),e.baby.disableChatIcon()),"dogStrike"===t.name&&e.dog.setPosition(t.x,t.y),"catStrike"===t.name&&(e.cat.setPosition(t.x,t.y),e.cat.scaleX=1),"nonoStrike"===t.name&&e.nono.setPosition(t.x,t.y),"twoGuysStrike"===t.name&&(e.twoGuys.setPosition(t.x,t.y),e.twoGuys.disableChatIcon()),"twoWomenStrike"===t.name&&(e.twoWomen.setPosition(t.x,t.y),e.twoWomen.disableChatIcon()),"sleepingGuyStrike"===t.name&&e.sleepingGuy.setPosition(t.x,t.y),"kokoStrike"===t.name&&e.koko.setPosition(t.x,t.y)})};class Vt extends t.Scene{constructor(){super("game"),this.controls=null,this.cursors=null,this.hero=null,this.joystick=null,this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.goingAngle=null,this.water=null,this.land=null,this.topObjects=null,this.currentDiscussionStatus=z.NONE,this.currentDiscussionSprite=null,this.treesOfDc=[],this.treesOfDcCollider=[],this.birds=[],this.isNoMoreBirds=!1,this.butterflies=[],this.pointsCollider=[],this.heroPositions={},this.maskNightOverlays=[],this.darkOverlay=null,this.nightOverlays=[],this.bikes=[],this.isCinematic=!1,this.isIntro=!1,this.night=!1,this.villageTheme=null,this.industryTheme=null,this.miniGameTheme=null,this.djangoTheme=null,this.nightmareTheme=null,this.villageAmbianceV1=null,this.villageAmbianceV2=null,this.nightAmbiance=null,this.datacentreThemeEnabled=!1,this.sounds=[],this.django=null,this.koko=null,this.sleepingGuy=null,this.twoGuys=null,this.baby=null,this.twoWomen=null,this.bino=null,this.fisherman=null,this.dog=null,this.escargot=null,this.cat=null,this.boy=null,this.girl=null,this.miner=null,this.deer=null,this.blueWorker1=null,this.blueWorker2=null,this.dcWorkerChief=null,this.ball=null,this.tent=null,this.checkDjangoDoor=!0,this.screens=null,this.screenOffSprites=[],this.screenShutDownCount=0,this.isBonus=!1,this.isFinal=!1,this.isBeforeFinal=!1,this.howToPlay=!0,this.map=null,this.tileset=null}preload(){a("noanims")||this.load.scenePlugin("AnimatedTiles","plugins/AnimatedTiles.js","animatedTiles","animatedTiles")}create(){this.timeStart=Date.now(),a("debug")&&(this.fpsText=this.add.text(10,10,"",{fontSize:"10px",fill:"#fff"}).setDepth(1e4).setScrollFactor(0),this.time.addEvent({delay:100,loop:!0,callback:()=>{this.fpsText.setText(`FPS: ${this.game.loop.actualFps.toFixed(2)}`)}})),Bt(this)}startGame(e){a("dreamMine")?this.gotoScene("mine-nightmare"):a("dreamFactory")?this.gotoScene("factory-nightmare"):a("dreamRecycling")?this.gotoScene("recycling-nightmare"):a("factory")?this.debugFactory():a("mine")?this.debugMine():a("recyclingCentre")?this.debugRecyclingCentre():It(this,e)}gotoScene(e){this.scene.pause("game"),this.scene.launch(e)}debugFactory(){this.scene.pause("game"),this.scene.launch("factory")}debugMine(){this.scene.pause("game"),this.scene.launch("mine")}debugRecyclingCentre(){this.scene.pause("game"),this.scene.launch("recyclingCentre")}resetGameSize(){this.scale.setGameSize(450,250)}setHeroPosition(e){const t=this.heroPositions[e];this.hero.setPosition(t.x,t.y)}stopMoving(){this.goingLeft=!1,this.goingRight=!1,this.goingDown=!1,this.goingUp=!1,this.hero.stopAndWait()}sleepGame(){this.scene.sleep("game"),this.scene.sleep("message")}wakeGame(e=!1){this.scene.wake("game"),this.scene.wake("message"),this.resetGameSize();const t=e?255:0;this.cameras.main.fadeIn(2e3,t,t,t)}addEventsListeners(){h.on(d,this.handleDiscussionReady,this),h.on(c,this.handleDiscussionStarted,this),h.on(u,this.handleDiscussionWaiting,this),h.on(p,this.handleDiscussionEnded,this),h.on(l,this.handleDiscussionAbort,this),h.on(m,this.handleDiscussionInProgress,this),h.on(k,this.handleScreenShutdown,this),h.on(b,this.listenEvents,this)}listenEvents(e){var t;K(e,"miner_first_met")&&(Ue(t=this,!1),$(t)),K(e,"pre_first_sleep")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&e.time.delayedCall(2e3,()=>bt(e))})}(this),K(e,"mine_access_validation")&&function(e){e.isCinematic=!0,e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(Ot(e),e.cameras.main.fadeIn(1e3,0,0,0),e.isCinematic=!1)})}(this),K(e,"mine_start")&&At(this),K(e,"mine_after")&&function(e){e.wakeGame(),E(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=z.NONE,J(e,!0),e.setHeroPosition("heroMine"),e.hero.slowLeft(),e.hero.animateToLeft(),Ue(e,!1,!0,!0),e.time.delayedCall(2e3,()=>{e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())})});const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(L(e),e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,()=>{e.scene.launch("mine-nightmare"),e.sleepGame()}),e.events.off("update",t))};e.events.on("update",t)}(this),K(e,"second_act_begin")&&function(e){e.wakeGame(!0),e.isCinematic=!0,P(e),M(e),e.currentDiscussionStatus=z.NONE,ht(e),e.setHeroPosition("heroDjangoDoor"),e.hero.setVisible(!1),e.hero.animateToDown(),e.hero.stopAndWait(),e.messageLater.setVisible(!0),e.time.delayedCall(3e3,()=>dt(e)),e.time.delayedCall(2500,()=>{e.hero.setVisible(!0),e.hero.slowRightDown(),e.hero.animateToRight()}),e.time.delayedCall(3500,()=>{e.isCinematic=!1,h.emit(d,"django"),qe(e)})}(this),K(e,"factory_start")&&Lt(this),K(e,"factory_after")&&function(e){e.wakeGame(),E(e),e.isCinematic=!0,e.cameras.main.fadeIn(1e3,0,0,0),e.currentDiscussionStatus=z.NONE,J(e,!0),Ue(e,!1,!0),e.whiteWorker1.setVisible(!1),e.whiteWorker2.setVisible(!1),e.whiteWorkerChief.destroy(),e.setHeroPosition("heroFactory"),e.hero.slowDown(),e.hero.animateToDown(),e.time.delayedCall(2e3,()=>{e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())})});const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(L(e),e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,()=>{e.scene.launch("factory-nightmare"),e.sleepGame()}),e.events.off("update",t))};e.events.on("update",t)}(this),K(e,"third_act_begin")&&function(e){e.wakeGame(!0),e.isCinematic=!0,lt(e),e.setHeroPosition("heroDjangoDoor"),e.hero.setVisible(!1),e.hero.animateToDown(),e.hero.stopAndWait(),e.messageLater.setAlpha(1).setVisible(!0).setY(100),e.time.delayedCall(3e3,()=>dt(e)),e.time.delayedCall(2500,()=>{e.hero.setVisible(!0),e.hero.slowRightDown(),e.hero.animateToRight()}),e.time.delayedCall(3500,()=>{e.isCinematic=!1,h.emit(d,"django"),qe(e)})}(this),K(e,"recycling_start")&&Mt(this),K(e,"recycling_after")&&function(e){e.wakeGame(),E(e),e.isCinematic=!0,e.currentDiscussionStatus=z.NONE,J(e,!0),Ue(e,!1,!0),e.blueWorkerChief.setVisible(!1),e.blueWorker1.setVisible(!1),e.blueWorker2.setVisible(!1),e.setHeroPosition("heroRecycling"),e.hero.slowDown(),e.hero.animateToDown(),e.time.delayedCall(2100,()=>{e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(e.setHeroPosition("heroNightComeBack"),e.cameras.main.fadeIn(1e3,0,0,0),e.hero.slowLeft(),e.hero.animateToLeft())})});const t=()=>{const s=e.heroPositions.heroDjangoDoor;e.hero.x>s.x-3&&e.hero.x<s.x+3&&(e.hero.slowUp(),e.hero.animateToUp()),e.hero.y>s.y+11&&e.hero.y<s.y+15&&(L(e),e.cameras.main.fadeOut(1e3,0,0,0),e.time.delayedCall(3e3,()=>{e.scene.launch("recycling-nightmare"),e.sleepGame()}),e.events.off("update",t))};e.events.on("update",t)}(this),K(e,"fourth_act_begin")&&function(e){e.wakeGame(!0),e.isCinematic=!0,e.datacentreThemeEnabled=!0,T(e),M(e),e.time.delayedCall(5e3,()=>R(e,e.villageTheme)),pt(e),e.setHeroPosition("heroDjangoDoor"),e.hero.setVisible(!1),e.hero.animateToDown(),e.hero.stopAndWait(),e.messageLater.setAlpha(1).setVisible(!0).setY(100),e.time.delayedCall(3e3,()=>dt(e)),e.time.delayedCall(2500,()=>{e.hero.setVisible(!0),e.hero.slowRightDown(),e.hero.animateToRight()}),e.time.delayedCall(3500,()=>{e.isCinematic=!1,h.emit(d,"django"),qe(e)})}(this),K(e,"django_ready_for_strike")&&function(e){e.isCinematic=!0,e.hero.stopAndWait(),e.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(Rt(e),e.cameras.main.fadeIn(1e3,0,0,0,(t,s)=>{1===s&&(X(["strike_begin"]),e.stopMoving(),e.isCinematic=!1)}))})}(this),K(e,"strike_end")&&function(e){e.isCinematic=!0,e.isBeforeFinal=!0,B(e),e.cameras.main.stopFollow(),e.tweens.add({targets:e.cameras.main,scrollY:e.cameras.main.scrollY-50,ease:"Sine.easeIn",duration:2e3}),e.cameras.main.fadeOut(2e3,0,0,0,(t,s)=>{1===s&&(e.sleepGame(),e.scene.launch("final-message"))})}(this),K(e,"after_final_message")&&function(e){e.isCinematic=!0,e.wakeGame(),gt(e),e.cameras.main.fadeIn(2e3,0,0,0,(t,s)=>{e.hero.slowRight(),1===s&&(e.isCinematic=!1,e.hero.stopAndWait())}),e.cameras.main.startFollow(e.hero,!0),e.setHeroPosition("heroFinal"),e.hero.slowRight(),e.hero.animateToRight()}(this),K(e,"first_sleep_save")&&"first_sleep"!==_t()?(Dt("first_sleep"),St(this)):K(e,"second_act_save")&&"second_act"!==_t()?(Dt("second_act"),St(this)):K(e,"third_act_save")&&"third_act"!==_t()?(Dt("third_act"),St(this)):K(e,"fourth_act_save")&&"fourth_act"!==_t()&&(Dt("fourth_act"),St(this)),K(e,"game_over")&&(!function(e){h.emit(l),e.isCinematic=!0,e.hero.stopAndWait(),e.twoGuys.disableChatIcon(),e.twoWomen.disableChatIcon(),e.time.delayedCall(1e3,()=>{e.cameras.main.stopFollow(),e.tweens.add({targets:e.cameras.main,scrollY:1300,ease:"Sine.easeIn",duration:8e3}),R(e,e.djangoTheme,4e3),R(e,e.villageAmbianceV1,4e3),e.cameras.main.fadeOut(4e3,0,0,0,(t,s)=>{if(1!==s)return;e.cameras.main.setBounds(0,0,e.map.widthInPixels,e.map.heightInPixels-8),P(e);const i=e.add.rectangle(0,0,450,250,0).setAlpha(.7).setOrigin(0,0).setScrollFactor(0).setDepth(2e3),a=()=>e.tweens.add({targets:i,alpha:1,duration:1e3}),n=()=>e.tweens.add({targets:i,alpha:.7,duration:1e3});e.cameras.main.setScroll(1,700),e.cameras.main.fadeIn(1e3,0,0,0);let r=!1;const o=e.add.bitmapText(50,120,"FreePixel-16",ot("generic.0"),16).setScrollFactor(0).setTintFill(16777215).setMaxWidth(250).setAlpha(0).setDepth(2e3),h=()=>{o.setY(120),e.tweens.add({targets:o,alpha:1,y:100,ease:"Sine.easeOut",duration:1e3})},d=t=>{e.tweens.add({targets:o,alpha:0,y:80,ease:"Sine.easeIn",duration:1e3,onComplete:()=>{t&&(o.setText(t),h())}})};e.time.delayedCall(1e3,()=>h()),e.time.delayedCall(5e3,()=>d(ot("generic.1"))),e.time.delayedCall(1e4,()=>d(ot("generic.2"))),e.time.delayedCall(15e3,()=>d(ot("generic.3"))),e.time.delayedCall(2e4,()=>d(ot("generic.4"))),e.time.delayedCall(24e3,()=>d(ot("generic.5"))),e.time.delayedCall(3e4,()=>d(ot("generic.6"))),e.time.delayedCall(34e3,()=>d(ot("generic.7"))),e.time.delayedCall(42e3,()=>d(ot("generic.thanks"))),e.time.delayedCall(45e3,()=>d()),e.time.delayedCall(47e3,()=>{o.setText(ot("generic.credits")).setPosition(20,300).setAlpha(1).setMaxWidth(210),e.tweens.add({targets:o,y:15,ease:"Sine.easeOut",duration:15e3})}),e.tweens.add({targets:e.cameras.main,scrollX:1100,scrollY:450,ease:"Sine.linear",duration:3e4,onUpdate:e=>{!r&&e.progress>.95&&(a(),r=!0)},onComplete:()=>{r=!1,e.cameras.main.setScroll(1100,1100),n(),e.tweens.add({targets:e.cameras.main,scrollY:500,ease:"Sine.linear",duration:16e3,onUpdate:e=>{!r&&e.progress>.95&&(a(),r=!0)},onComplete:()=>{r=!1,n(),e.cameras.main.setScroll(1550,500),e.tweens.add({targets:e.cameras.main,scrollY:1100,ease:"Sine.linear",duration:24e3,onUpdate:t=>{!r&&t.progress>.95&&(r=!0,R(e,e.villageTheme),e.cameras.main.fadeOut(2e3,0,0,0,(e,t)=>{1===t&&window.setTimeout(()=>window.location.href="?bonus",2e3)}))}})}})}})})})}(this),n("Game",this.timeStart))}handleDiscussionReady(e){if(this.scene.isActive()){if(this.currentDiscussionStatus===z.READY&&this.currentDiscussionSprite!==e)console.log("abort",this.currentDiscussionSprite,e),this.handleDiscussionAbort(this.currentDiscussionSprite);else if(this.currentDiscussionStatus!==z.NONE)return;this.currentDiscussionStatus=z.READY,this.currentDiscussionSprite=e}}handleDiscussionInProgress(){this.scene.isActive()&&(this.currentDiscussionStatus=z.INPROGRESS)}handleDiscussionStarted(){this.scene.isActive()&&(console.log("handleDiscussionStarted"),this.currentDiscussionStatus=z.STARTED)}handleDiscussionWaiting(e){this.scene.isActive()&&(this.currentDiscussionStatus=z.WAITING)}handleDiscussionEnded(e){this.scene.isActive()&&(e&&this[e]||"screen"===e.substring(0,6))&&(console.log("handleDiscussionEnded",e),this.currentDiscussionStatus=z.NONE,this[e]?.stopChatting())}handleDiscussionAbort(e){this.scene.isActive()&&e&&this[e]&&(this.currentDiscussionStatus=z.NONE,this[e]?.abortChatting())}handleScreenShutdown(e){var t;this.screenShutDownCount++,1===this.screenShutDownCount&&X(["screens_shutdown_first"]),3===this.screenShutDownCount&&(X(["screens_shutdown_end"]),(t=this).isCinematic=!0,t.hero.stopAndWait(),t.cameras.main.fadeOut(1e3,0,0,0,(e,s)=>{1===s&&(T(t),t.screenOffSprites.forEach(e=>e.shutdown()),t.setHeroPosition("heroDjangoRight"),t.hero.slowLeft(),t.hero.animateToLeft(),t.cameras.main.fadeIn(1e3,0,0,0,(e,s)=>{1===s&&(t.isCinematic=!1,h.emit(d,"django"),qe(t))}))}))}update(e,t){if(this.isCinematic&&this?.joystick?.setVisible(!1),this.night&&this.darkOverlay&&function(e){const t=e.hero.x-e.scale.width,s=e.hero.y-e.scale.height;e.nightOverlays.forEach(e=>e.setPosition(t,s)),e.maskNightOverlays.forEach(e=>e.setPosition(t,s)),e.darkOverlay.setPosition(e.hero.x,e.hero.y)}(this),this.cursors&&this.hero&&!this.isCinematic&&this.hero.body)if(this.hero.resetVelocity(),[z.STARTED,z.WAITING,z.INPROGRESS].includes(this.currentDiscussionStatus))this.hero.stopAndWait();else{if(this.goingLeft?this.hero.goLeft():this.goingRight&&this.hero.goRight(),this.goingUp?this.hero.goUp():this.goingDown&&this.hero.goDown(),this.goingLeft||this.goingUp||this.goingDown||this.goingRight?this.hero.playMoveSound():this.hero.stopMoveSound(),this.goingUp){this.hero.animateToUp();const e=this.heroPositions.heroDjangoDoor;this.checkDjangoDoor&&this.hero.x>e.x-8&&this.hero.x<e.x+8&&this.hero.y>e.y-5&&this.hero.y<e.y+5&&(this.hero.stopAndWait(),h.emit(d,"django"),qe(this))}else this.goingDown?this.hero.animateToDown():this.goingRight?this.hero.animateToRight():this.goingLeft&&this.hero.animateToLeft();a("nomusic")||this.isBeforeFinal||this.isFinal||(this.night?E(this):this.hero.y<445||this.miner&&this.hero.x>this.miner.x+25||this.hero.x<880&&this.hero.y<615||this.datacentreThemeEnabled?T(this):this.hero.x>1120?(P(this),M(this)):M(this)),this.goingDown||this.goingUp||this.goingRight||this.goingLeft||this.stopMoving()}}}class Wt extends e.Scene{constructor(){super("message"),this.textObject=null,this.spriteNameObject=null,this.currentText="",this.currentDiscussionStatus=z.NONE}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json")}create(){const e=this.sys.game.config;this.actionBackground=this.add.rectangle(e.width/2,e.height-30,200,30,0).setAlpha(.5).setScrollFactor(0).setOrigin(.5,.5).setDepth(2e3).setVisible(!1),this.actionBackgroundLine=this.add.line(0,0,e.width/2-60,e.height-12,e.width/2+60,e.height-12,0).setLineWidth(4).setAlpha(.5).setScrollFactor(0).setOrigin(0,0).setDepth(2e3).setVisible(!1),this.actionText=this.add.bitmapText(e.width/2,e.height-30,"FreePixel-16",ot("game.action"),16).setOrigin(.5,.5).setScrollFactor(0).setTintFill(16777215).setDepth(2e3).setVisible(!1),this.dialogBackground=this.add.sprite(e.width/2,e.height-30,"ui","dialog-2").setOrigin(.5,.5).setDepth(2e3).setAlpha(.8).setScrollFactor(0).setVisible(!1),this.dialogBackgroundColor=this.add.rectangle(e.width/2,e.height-30,252,44,0).setAlpha(.7).setOrigin(.5,.5).setDepth(2e3).setScrollFactor(0).setVisible(!1),this.textObject=this.add.bitmapText(e.width/2,e.height-30,"FreePixel-16","",16).setOrigin(.5,.5).setScrollFactor(0).setTintFill(16777215).setMaxWidth(250).setDepth(3e3).setVisible(!1),this.spriteNameObject=this.add.bitmapText(e.width/2-128,e.height-65,"FreePixelStrokeShadow-16","",16).setOrigin(0,.5).setScrollFactor(0).setDepth(3e3).setVisible(!1),h.on(f,this.handleMessage,this),h.on(p,this.handleDiscussionEnd,this),h.on(l,this.handleDiscussionEnd,this),h.on(d,this.readyToAction,this),h.on(c,this.stopAction,this),h.on(b,this.listenEvents,this)}showMineCard(){G("sfx_objet_inventaire",this.scene.get("game"),!1,1),this.mineCard=this.add.image(225,125,"ui","card").setScrollFactor(0).setDepth(3e3).setAlpha(0),this.tweens.add({targets:this.mineCard,x:420,y:220,alpha:1,scale:1,ease:"Quad.easeOut",loop:0,duration:1e3})}hideMineCard(){this.mineCard&&this.tweens.add({targets:this.mineCard,alpha:0,scale:.5,ease:"Sine.easeInOut",loop:0,duration:500,onComplete:()=>this.mineCard.destroy()})}listenEvents(e){K(e,"card_for_mine")&&this.showMineCard(),K(e,"mine_access_validation")&&this.hideMineCard()}startDiscussion(){this.scene.isActive()&&(this.currentDiscussionStatus=z.STARTED,this.stopAction())}stopAction(){this.scene.isActive()&&(this.actionText.setVisible(!1),this.actionBackground.setVisible(!1),this.actionBackgroundLine.setVisible(!1))}readyToAction(){this.scene.isActive()&&this.currentDiscussionStatus===z.NONE&&(this.scene.get("game")?.isCinematic||(this.currentDiscussionStatus=z.READY,this.actionText.setVisible(!0),this.actionBackground.setVisible(!0),this.actionBackgroundLine.setVisible(!0)))}handleDiscussionEnd(){this.scene.isActive()&&(this.currentDiscussionStatus=z.NONE,this.stopAction(),this.textObject.text="",this.textObject.setVisible(!1),this.spriteNameObject.text="",this.spriteNameObject.setVisible(!1),this.dialogBackground.setVisible(!1),this.dialogBackgroundColor.setVisible(!1))}handleMessage(t){if(!this.scene.isActive())return;const{message:s,sprite:i}=t;if(this.textObject.visible&&s===this.currentText)return;const a=this.scene.get("game");at[i]&&G(`${at[i].sound}_${e.Math.Between(1,at[i]?.versions)}`,a,!1,.3),this.dialogBackground.setVisible(!0),this.dialogBackgroundColor.setVisible(!0),this.spriteNameObject.text=it[i]?.[st()]||it[i],this.spriteNameObject.setVisible(!!this.spriteNameObject.text),this.textObject.text=s,this.currentText=s,this.textObject.setVisible(!0),this.time.delayedCall(300,()=>h.emit(u))}}const Nt=2e3;class Gt extends e.Scene{constructor(e){super(e),this.sounds=[],this.mainScene=null,this.warningIndex=0}preload(){this.load.atlas("ui","sprites/ui.png","sprites/ui.json"),this.load.image("vignette","img/vignette.png")}create(){let e;if(this.mainScene=this.scene.get("game"),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.currentDiscussionStatus=z.NONE,this.anims.create({key:"speaker-off-anim",frames:[{key:"ui",frame:"speaker-off"}],repeat:-1,frameRate:1}),this.anims.create({key:"speaker-on-anim",frames:[{key:"ui",frame:"speaker-off"},{key:"ui",frame:"speaker-on"}],repeat:-1,frameRate:8}),this.anims.create({key:"dialog-shout-anim",frames:[{key:"ui",frame:"dialog-shout-1"},{key:"ui",frame:"dialog-shout-2"}],repeat:-1,frameRate:8}),this.anims.create({key:"score-warning",frames:[{key:"ui",frame:"scoreok"},{key:"ui",frame:"scoreko"}],repeat:5,frameRate:8}),this.scores=[],this.backgroundScores=[],this.maskScores=[],this?.verticalScore){e=this.add.sprite(6,0,"ui","scoreboard-vertical").setOrigin(0,0);for(let e=0;e<=2;e++){const t=this.add.sprite(14,19+24*e,"ui","scoreok").setOrigin(0,0),s=this.add.sprite(14,19+24*e,"ui","scoreko").setOrigin(0,0),i=this.make.graphics();i.fillRect(14,19+24*e,19,19);const a=i.createGeometryMask();s.setMask(a),i.setX(-19),this.backgroundScores.push(t),this.maskScores.push(i),this.scores.push(s)}}else{e=this.add.sprite(4,0,"ui","scoreboard").setOrigin(0,0);for(let e=0;e<=2;e++){const t=this.add.sprite(12+24*e,22,"ui","scoreok").setOrigin(0,0),s=this.add.sprite(12+24*e,22,"ui","scoreko").setOrigin(0,0),i=this.make.graphics();i.fillRect(12+24*e,22,19,19);const a=i.createGeometryMask();s.setMask(a),i.setX(-19),this.backgroundScores.push(t),this.maskScores.push(i),this.scores.push(s)}}this.scoreBoardContainer=this.add.container(0,-95,[e,...this.backgroundScores,...this.scores]),this.scoreBoardContainer.setDepth(Nt),this.speaker=this.add.sprite(470,0,"ui","speaker-off").setOrigin(0,0).setDepth(Nt),this.dialogBackground=this.add.sprite(345,50,"ui","dialog-shout-1").setOrigin(.5,.5).setDepth(Nt).setAlpha(.7).setVisible(!1),this.dialogBackground.anims.play("dialog-shout-anim",!0),this.textObject=this.add.bitmapText(345,52,"FreePixel-16","",16).setOrigin(.5,.5).setScrollFactor(0).setTintFill(16777215).setMaxWidth(245).setDepth(Nt).setVisible(!1),h.on(c,this.handleDiscussionStarted,this),h.on(u,this.handleDiscussionWaiting,this),h.on(p,this.handleDiscussionEnded,this),h.on(b,this.listenUnlockedEvents,this),h.on(f,this.handleMessage,this),N("sfx_mini-jeu_haut-parleur",this),N("sfx_mini-jeu_erreur_2",this),N("sfx_mini-jeu_erreur_3",this),N("sfx_mini-jeu_apparition_panneau_erreurs_2",this)}createControls(){this.mainScene.isBonus&&this.input.keyboard.addKey(e.Input.Keyboard.KeyCodes.ESC).on("down",()=>window.location.href="?bonus")}listenUnlockedEvents(e){["mine_show_score_board","factory_show_score_board","recycling_show_score_board"].includes(e.newUnlockedEvents[0])&&this.showScoreBoard()}showScoreBoard(){G("sfx_mini-jeu_apparition_panneau_erreurs_2",this,!1,.7),this.tweens.add({targets:this.scoreBoardContainer,y:0,ease:"Sine.easeOut",duration:1500})}startDiscussion(e){h.emit(c,e)}handleMessage(e){const{message:t,sprite:s}=e;this.updateMessage(t,!0)}updateMessage(e,t=!1){this.scene.isActive()&&(G("sfx_mini-jeu_haut-parleur",this,!1,.3),this.dialogBackground.setVisible(!0),this.speaker.anims.play("speaker-on-anim"),this.textObject.text=e,this.textObject.setVisible(!0),t?this.time.delayedCall(200,()=>h.emit(u)):this.time.delayedCall(2500,()=>{this.currentDiscussionStatus===z.NONE&&this.handleDiscussionEnded()}))}updateWarningProgression(e){e<0&&(e=0),e>95&&(e=95),this.maskScores[this.warningIndex].setX(-19+Math.round(19*e/100)),this.scores[this.warningIndex].setAlpha((30+e)/130)}updateWarnings(e){G(e<=2?"sfx_mini-jeu_erreur_3":"sfx_mini-jeu_erreur_2",this,!0,1),e>3&&(e=3),this.warningIndex=e;for(let t=0;t<e;t++)this.maskScores[t]?.setX(0),this.scores[t].setAlpha(1),this.scores[t].anims.play("score-warning",!0)}handleAction(){if(this.scene.isActive())return this.currentDiscussionStatus===z.WAITING?(this.currentDiscussionStatus=z.STARTED,void h.emit(g)):void 0}handleDiscussionStarted(){this.scene.isActive()&&(this.currentDiscussionStatus=z.STARTED)}handleDiscussionWaiting(){this.scene.isActive()&&this.time.delayedCall(100,()=>this.currentDiscussionStatus=z.WAITING)}handleDiscussionEnded(){this.scene.isActive()&&(this.currentDiscussionStatus=z.NONE,this.textObject.setVisible(!1),this.speaker.anims.play("speaker-off-anim"),this.dialogBackground.setVisible(!1))}endGame(e){this.mainScene.isBonus&&R(this.mainScene,this.mainScene.miniGameTheme),this.cameras.main.fadeOut(1e3,0,0,0,(t,s)=>{1===s&&(this.scene.stop(),X(e))})}}const Yt={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},qt=265,Ut=10,Ht=10,zt=255,Kt=340;class Xt extends e.Scene{constructor(){super({key:"mine-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.stopWater=!0}preload(){this.load.atlas("mine","sprites/mine.png","sprites/mine.json"),this.load.image("vignette","img/vignette.png")}create(){this.timeStart=Date.now(),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.createRock(500,250,50,50,"rock-1"),this.createRock(50,250,500,50,"rock-2"),this.createRock(50,50,500,250,"rock-3"),this.createRock(100,200,300,20,"rock-4"),this.tube=this.add.container(),this.tube.add(this.add.tileSprite(0,-33,22,1e3,"mine","tube").setOrigin(.5,1)),this.tube.add(this.add.image(0,0,"mine","tube-end").setOrigin(.43,1)),this.tube.setDepth(1e3).setAlpha(0),this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:2e3,quantity:100,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.tweens.add({targets:this.tube,angle:180,alpha:1,x:500,y:216,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress<.2,e.progress>.8&&this.water.updateConfig({frame:["water-maroon"]})},onComplete:()=>{this.tweens.add({targets:this.tube,angle:180,alpha:0,x:400,y:20,ease:"Sine.linear",duration:4500,onUpdate:e=>{this.stopWater=e.progress>.9}})}})}endScene(){this.cameras.main.fadeOut(2e3,255,255,255,(e,t)=>{1===t&&(n("Dream mine",this.timeStart),X(["second_act_begin"]),this.scene.stop())})}createRock(e,t,s,i,a){const n=this.add.image(e,t,"mine",a);return n.setAlpha(0),this.tweens.add({targets:n,alpha:.8,ease:"Sine.linear",duration:5e3,onComplete:()=>{this.tweens.add({targets:n,x:s,y:i,alpha:0,ease:"Sine.linear",duration:5e3})}}),this.tweens.add({targets:n,angle:360,x:s,y:i,alpha:.8,ease:"Sine.linear",duration:1e4}),n}update(){this.stopWater||(this.water.emitParticleAt(this.tube.x,this.tube.y),this.water.updateConfig({angle:{min:this.tube.angle+100,max:this.tube.angle+80}}))}}const $t=[110,175,237],Jt=[60,125,187],Zt=[5,15,25],Qt=[.8,1,1.2];const es=["laptop","console","phone"],ts={console:12469059,laptop:7260614,phone:12623450},ss=[5,20,60];class is extends Phaser.GameObjects.Rectangle{constructor(e,t,s,i){const a=Phaser.Math.RND.pick([13421772,i]);super(e,t,s,Phaser.Math.Between(2,6),Phaser.Math.Between(2,6),a),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!0),this.body.setVelocityX(Phaser.Math.Between(-200,200)),this.body.setVelocityY(Phaser.Math.Between(-100,100)),this.init()}init(){this.scene.tweens.add({targets:this,duration:800,scale:{from:1,to:0},onComplete:()=>{this.destroy()}})}}const as={blue:"component-blue",violet:"component-violet",yellow:"component-yellow",red:"component-red",green:"component-green"},ns=[{x:275,y:10},{x:400,y:50},{x:475,y:150},{x:400,y:250},{x:275,y:290},{x:150,y:250},{x:75,y:150},{x:150,y:50}];class rs extends e.Scene{constructor(){super({key:"factory-nightmare",physics:{matter:{debug:i(),gravity:{y:.5}}}}),this.conveyorPosition=0}preload(){this.load.atlas("factory","sprites/factory.png","sprites/factory.json"),this.load.image("vignette","img/vignette.png")}create(){this.timeStart=Date.now(),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0).setDepth(1),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.conveyor=this.add.tileSprite(275,150,700,96,"factory","tapis").setAlpha(0),this.tweens.add({targets:this.conveyor,alpha:.5,ease:"Sine.linear",duration:5e3}),this.tweens.add({targets:this.conveyor,angle:360,ease:"Sine.linear",duration:15e3});for(const t of ns){const e=this.add.image(t.x,t.y,"factory","motherboard").setAlpha(0);this.tweens.add({targets:e,alpha:.5,duration:5e3}),this.tweens.add({targets:e,angle:360,scale:4,ease:"Sine.linear",duration:15e3})}let e=0;for(const t of Object.values(as)){e++;const s=this.add.image(850-50*e,10+50*e,"factory",t).setAlpha(.7).setDepth(1);this.tweens.add({targets:s,scale:4,angle:360,x:-80*e,ease:"Sine.linear",duration:15e3})}}endScene(){this.cameras.main.fadeOut(1e3,255,255,255,(e,t)=>{1===t&&(n("Dream factory",this.timeStart),this.scene.stop(),X(["third_act_begin"]))})}update(){this.conveyorPosition-=1,this.conveyor.setTilePosition(this.conveyorPosition,0)}}class os extends e.Scene{constructor(){super({key:"recycling-nightmare",physics:{matter:{debug:i(),gravity:{y:0}}}}),this.delayBetweenObjects=450}preload(){this.load.atlas("recyclingCentre","sprites/recyclingCentre.png","sprites/recyclingCentre.json"),this.load.image("vignette","img/vignette.png")}create(){this.matter.world.setGravity(0,0),this.matter.world.setBounds(0,0,550,300),this.timeStart=Date.now(),this.vignette=this.add.image(0,0,"vignette").setOrigin(0).setAlpha(.5).setDepth(1e5),this.anims.create({key:"mai-sleeping",frames:this.anims.generateFrameNames("mai",{start:1,end:3,prefix:"sleeping-"}),repeat:-1,yoyo:!0,frameRate:2}),this.scale.setGameSize(550,300),this.cameras.main.setBackgroundColor("#ffffff"),this.hero=this.add.sprite(275,150,"mai","sleeping-1"),this.hero.anims.play("mai-sleeping",!0),this.hero.setAlpha(0).setDepth(1),this.tweens.add({targets:this.hero,angle:360,scale:2,alpha:1,ease:"Sine.linear",duration:6e3,onComplete:()=>{this.tweens.add({targets:this.hero,angle:180,scale:4,alpha:0,ease:"Sine.linear",duration:6e3,onComplete:()=>this.endScene()})}}),this.time.delayedCall(1e3,()=>this.addObject())}addObject(){const t=e.Math.RND.pick(es);e.Math.Between(100,450);const s=this.matter.add.image(275,150,"recyclingCentre",t+"-broken");s.setAlpha(0),s.applyForce({x:e.Math.RND.pick([-.01,.01]),y:e.Math.RND.pick([-.01,.01])}),this.tweens.add({targets:s,alpha:.7,ease:"Sine.linear",duration:500}),this.delayBetweenObjects-=10,this.delayBetweenObjects<10&&(this.delayBetweenObjects=10,this.createDebris(e.Math.Between(100,450),e.Math.Between(50,250),t));const i=this.delayBetweenObjects;this.time.delayedCall(i,()=>this.addObject()),a("dreamRecycling")&&L(this)}createDebris(t,s,i){const a=ts[i];Array(e.Math.Between(20,40)).fill(0).forEach(e=>new is(this,t,s,a))}endScene(){this.cameras.main.fadeOut(2e3,255,255,255,(e,t)=>{1===t&&(this.scene.stop(),X(["fourth_act_begin"]))})}}class hs extends e.Scene{constructor(){super("final-message")}create(){this.cameras.main.fadeIn(2e3,0,0,0);const e=this.add.bitmapText(225,100,"FreePixel-16",ot("final.later"),16).setOrigin(.5,.5).setScrollFactor(0).setTintFill(16777215);this.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",delay:2e3,duration:2e3,onComplete:()=>this.endScene()})}endScene(){this.scene.stop(),X(["after_final_message"])}}const ds={type:t.AUTO,parent:"game",pixelArt:!0,render:{pixelArt:!0},width:450,height:250,backgroundColor:"#000000",physics:{default:"arcade",arcade:{debug:i(),gravity:{y:0}}},scene:[o,Vt,Xt,class extends Gt{constructor(){super("mine"),this.verticalScore=!0,this.rocks=[],this.movingCable=!1,this.rockValidated=0,this.rockNotValidated=0,this.speed=Qt,this.control="none",this.waterStockPercentage=100,this.rechargeWater=!1,this.conveyor=[],this.conveyorPosition=[0,0,0],this.tubeRollings=[],this.tubeCurrentY=0,this.goingDown=!0,this.isCinematic=!0,this.firstStep=!0,this.faster=!1,this.fasterAgain=!1,this.moreMaterials=!1,this.warnings=0}preload(){super.preload(),this.load.atlas("mine","sprites/mine.png","sprites/mine.json")}create(){super.create(),this.cameras.main.setBackgroundColor(3154462),this.scale.setGameSize(550,300),this.add.image(275,0,"mine","background").setOrigin(.5,0).setScale(-1,1),this.add.image(180,46,"mine","water-tank");const t=this.add.bitmapMask(null,197,35,"mine","water-tank-mask");this.waterStock=this.add.image(197,46,"mine","water"),this.waterStock.setMask(t),this.add.image(197,46,"mine","water-glass"),this.add.image(197,18,"mine","water-tank-top"),this.conveyor.push(this.add.tileSprite(0,92,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(0,140,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,156,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(10,204,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.conveyor.push(this.add.tileSprite(0,220,550,48,"mine","conveyor").setOrigin(0,0).setScrollFactor(0,0)),this.add.tileSprite(5,268,550,19,"mine","conveyor-bottom").setOrigin(0,0).setScrollFactor(0,0),this.add.image(509,169,"mine","right-block").setOrigin(.5,.5).setDepth(1e3),this.add.image(474,69,"mine","block-bottom").setOrigin(.5,.5).setDepth(1),this.add.image(474,133,"mine","block-bottom").setOrigin(.5,.5).setDepth(10),this.add.image(474,197,"mine","block-bottom").setOrigin(.5,.5).setDepth(20),this.add.image(515,257,"mine","right-glass").setOrigin(.5,.5).setDepth(1e3),this.add.image(40,169,"mine","right-block").setOrigin(.5,.5).setScale(-1,1).setDepth(1e3),this.add.image(75,69,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(1),this.add.image(75,133,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(10),this.add.image(75,197,"mine","block-bottom").setOrigin(.5,.5).setScale(-1,1).setDepth(20),this.add.image(35,257,"mine","left-glass").setOrigin(.5,.5).setDepth(1e3),this.anims.create({key:"particules",frames:this.anims.generateFrameNames("mine",{start:1,end:4,prefix:"particules-"}),repeat:-1,frameRate:10}),this.rockParticles=this.add.sprite(275,202,"mine","particules-1").setOrigin(.5,.5).setVisible(!1),this.rockParticles.anims.play("particules",!0),this.tube=this.add.tileSprite(0,0,22,1e3,"mine","tube").setOrigin(.5,1).setDepth(1e3),this.tubeEnd=this.add.image(275,50,"mine","tube-end").setOrigin(.43,1).setDepth(1e3),this.add.image(64,0,"mine","tube-top").setOrigin(0,0).setDepth(1e3);for(let e=0;e<3;e++)this.tubeRollings.push(this.add.sprite(80+13*e,2,"mine","tube-rolling-1").setOrigin(0,0).setDepth(1e3));this.tubeShadow=this.add.ellipse(0,0,16,10,0,.1),this.water=this.add.particles(0,0,"mine",{frame:["water-blue"],speed:{min:200,max:300},angle:{min:70,max:110},gravityY:300,lifespan:320,quantity:50,scale:{start:.5,end:0},emitting:!1}),this.water.setDepth(1),this.events.on("update",()=>{this.isCinematic||(!this.rechargeWater&&this.action&&this.waterStockPercentage>0?(G("sfx_mini-jeu_jet-eau",this,!1,.5,!0),this.water.emitParticleAt(this.tubeEnd.x,this.tubeEnd.y),this.water.forEachAlive(t=>{const s=$t[this.tubeCurrentY]+e.Math.Between(0,30);t.y>=s&&(t.y=s,t.velocityY*=-e.Math.Between(1,100)/100,t.velocityX*=e.Math.Between(1,20)/10)}),this.waterStockPercentage-=.2,this.waterStockPercentage<=0&&(this.waterStockPercentage=0,this.rechargeWater=!0,this.updateMessage(ot("mine.waterEmpty")))):(Y("sfx_mini-jeu_jet-eau",this),this.waterStockPercentage+=.5,this.waterStockPercentage>=100&&(this.waterStockPercentage=100),this.rechargeWater&&100===this.waterStockPercentage&&(this.rechargeWater=!1,this.updateMessage(ot("mine.waterFull")))),this.waterStock.y=46+54*(100-this.waterStockPercentage)/100,this.waterStock.setVisible(this.waterStockPercentage>5))}),h.on(w,this.listenDispatchedEvents,this),a("bypassminigame")?this.endGame():(N("sfx_mini-jeu_jet-eau",this),N("sfx_mini-jeu_caillou_desagrege",this),N("sfx_mini-jeu_deplacement_tuyau",this),N("sfx_mini-jeu_reussite_3",this),this.createControls(),this.startGame())}createControls(){if(super.createControls(),this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right",w:"up",z:"up",q:"left",a:"left",s:"down",d:"right"}),this.input.keyboard.on("keydown",e=>{["ArrowUp","z","w"].includes(e.key)?(this.goingUp=!0,this.goingDown=!1):["ArrowDown","s"].includes(e.key)?(this.goingDown=!0,this.goingUp=!1):["ArrowLeft","q","a"].includes(e.key)?(this.goingLeft=!0,this.goingRight=!1):["ArrowRight","d"].includes(e.key)?(this.goingRight=!0,this.goingLeft=!1):32===e.keyCode&&(this.action=!0,this.handleAction())},this),this.input.keyboard.on("keyup",e=>{["ArrowUp","z","w"].includes(e.key)?this.goingUp=!1:["ArrowDown","s"].includes(e.key)?this.goingDown=!1:["ArrowLeft","q","a"].includes(e.key)?this.goingLeft=!1:["ArrowRight","d"].includes(e.key)?this.goingRight=!1:32===e.keyCode&&(this.action=!1)},this),r()){const e=.2,t=16733508,s=e=>{e.alpha=.5,this.tweens.add({targets:e,alpha:.1,duration:500})};this.add.bitmapText(40,210,"FreePixel-16","←",16).setOrigin(.5,.5).setDepth(1e5);const i=this.add.circle(40,210,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.goingLeft=!0,this.goingRight=!1,s(i)});this.add.bitmapText(90,160,"FreePixel-16","↑",16).setOrigin(.5,.5).setDepth(1e5);const a=this.add.circle(90,160,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.goingUp=!0,this.goingDown=!1,s(a)});this.add.bitmapText(90,260,"FreePixel-16","↓",16).setOrigin(.5,.5).setDepth(1e5);const n=this.add.circle(90,260,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.goingUp=!1,this.goingDown=!0,s(n)});this.add.bitmapText(140,210,"FreePixel-16","→",16).setOrigin(.5,.5).setDepth(1e5);const r=this.add.circle(140,210,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.goingLeft=!1,this.goingRight=!0,s(r)});this.input.addPointer(1),this.input.on("pointerup",e=>{if(e.worldX<200)return this.goingLeft=!1,this.goingRight=!1,this.goingUp=!1,void(this.goingDown=!1);this.action=!1}),this.input.on("pointerdown",e=>{e.worldX<200||(this.action=!0,this.handleAction())})}}listenUnlockedEvents(e){super.listenUnlockedEvents(e),K(e,"mine_after_tuto")&&this.afterTuto(),K(e,"mine_end")&&this.endGame()}listenDispatchedEvents(e){K(e,"mine_tuto_begin")&&this.tutoBegin()}tutoBegin(){this.isCinematic=!1,this.firstStep=!0,this.createRock()}tutoEnd(){Y("sfx_mini-jeu_jet-eau",this),this.isCinematic=!0,X(["mine_tuto_end"]),this.startDiscussion("mine")}tutoMissed(){Y("sfx_mini-jeu_jet-eau",this),X(["mine_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("mine")}afterTuto(){this.isCinematic=!1,this.firstStep=!1,this.createRock()}startGame(){this.timeStart=Date.now(),a("mine")&&A(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.delayedCall(1e3,()=>this.startDiscussion("mine"))}endGame(){n("Mine",this.timeStart),super.endGame(["mine_after"])}createRock(){const t=e.Math.Between(0,2),s=$t[t],i=this.add.sprite(600,s,"mine","rock-1");i.setDepth(1+10*t);const a=this.rocks.length?e.Math.Between(0,Math.round(54)):0;this.setRockTexture(i,a),this.rocks.push({rock:i,index:t,refined:a}),this.firstStep||this.time.addEvent({callback:()=>{this.createRock(),this.moreMaterials||12!==this.rockValidated||(this.moreMaterials=!0,this.updateMessage(ot("mine.moreMaterials")))},delay:this.rockValidated>12?1e3:2e3})}gameOver(){this.isCinematic=!0,this.isGameOver=!0,Y("sfx_mini-jeu_jet-eau",this),Y("sfx_mini-jeu_deplacement_tuyau",this),this.rockParticles.setVisible(!1),X(["mine_game_over"]),this.startDiscussion("mine")}updateStep(){this.firstStep&&(this.rockValidated?this.tutoEnd():this.tutoMissed()),this.faster||5!==this.rockValidated||(this.faster=!0,this.speed.forEach((e,t)=>this.speed[t]+=.6),this.updateMessage(ot("mine.faster"))),this.fasterAgain||40!==this.rockValidated||(this.fasterAgain=!0,this.speed.forEach((e,t)=>this.speed[t]+=.8),this.updateMessage(ot("mine.fasterAgain")));const e=this.rockValidated+this.rockNotValidated,t=Math.round(100*this.rockValidated/(e||1));console.log(t+" % ("+this.rockValidated+" / "+e+")");const s=(this.rockNotValidated>=Zt[0]&&1)+(this.rockNotValidated>=Zt[1]&&1)+(this.rockNotValidated>=Zt[2]&&1);this.updateCurrentWarningProgression(),s>this.warnings&&(this.warnings++,this.updateMessage(ot(2===this.warnings?"mine.lastWarning":"mine.warning")),this.updateWarnings(this.warnings),3===this.warnings)&&this.gameOver()}updateCurrentWarningProgression(){Zt[this.warnings]&&(0===this.warnings?this.updateWarningProgression(100*this.rockNotValidated/Zt[this.warnings]):this.updateWarningProgression(100*(this.rockNotValidated-Zt[this.warnings-1])/(Zt[this.warnings]-Zt[this.warnings-1])))}updateWaterDepth(){this.water.setDepth(10*this.tubeCurrentY+11)}up(){this.movingCable?this.tubeMoving=!0:this.tubeCurrentY>0&&(this.tubeCurrentY--,this.moveCable(),this.updateWaterDepth(),this.tubeMoving=!0)}down(){this.movingCable?this.tubeMoving=!0:this.tubeCurrentY<2&&(this.tubeCurrentY++,this.moveCable(),this.updateWaterDepth(),this.tubeMoving=!0)}moveCable(){this.movingCable=!0,this.tweens.add({targets:this.tubeEnd,y:Jt[this.tubeCurrentY],ease:"Sine.easeInOut",duration:300,onComplete:()=>{this.movingCable=!1}})}setRockTexture(e,t){const s=Math.floor(6*t/60);e.setTexture("mine","rock-"+(s||1))}whenTubeMoving(){G("sfx_mini-jeu_deplacement_tuyau",this,!1,1,!0)}stopTubeMoving(){Y("sfx_mini-jeu_deplacement_tuyau",this)}update(e,t){if(!this.isGameOver){this.rockParticles.setVisible(!1),this.tubeRollings.forEach((e,t)=>e.x=this.tubeEnd.x-22+16*t),this.tubeMoving=!1,this.goingUp&&this.tubeEnd.y>50?this.up():this.goingDown&&this.tubeEnd.y<200&&this.down(),this.goingLeft&&this.tubeEnd.x>100?(this.tubeEnd.x-=5,this.tubeMoving=!0):this.goingRight&&this.tubeEnd.x<450&&(this.tubeEnd.x+=5,this.tubeMoving=!0),this.tubeMoving?this.whenTubeMoving():this.stopTubeMoving(),this.tube.setPosition(this.tubeEnd.x,this.tubeEnd.y-34),this.tubeShadow.setPosition(this.tubeEnd.x,this.tubeEnd.y+58),this.conveyor.forEach((e,t)=>{this.conveyorPosition[t]+=this.speed[t],e.setTilePosition(this.conveyorPosition[t],0)});for(const e in this.rocks){const t=this.rocks[e],s=t.rock;s.x-=this.speed[t.index],s.x<-20&&(this.rocks.splice(e,1),s.destroy(),t.refined<60&&(this.rockNotValidated++,this.updateStep())),t.refined>=60||s.y<this.tubeEnd.y+50+25&&s.y>this.tubeEnd.y+50-25&&this.action&&!this.rechargeWater&&s.x>this.tubeEnd.x-40&&s.x<this.tubeEnd.x+40&&(G("sfx_mini-jeu_caillou_desagrege",this,!1,1),t.refined++,this.setRockTexture(s,t.refined),this.rockParticles.setVisible(!0),this.rockParticles.setDepth(s.depth),this.rockParticles.setPosition(s.x,s.y-25),t.refined>=60&&(G("sfx_mini-jeu_reussite_3",this,!0),this.rockValidated++,this.updateStep()))}}}},rs,class extends Gt{constructor(){super({key:"factory"}),this.componentsLine=[],this.motherBoard=[],this.componentsLinePosition=0,this.componentValidated=0,this.isMotherboardValidated=!1,this.motherboardSpeed=.75,this.numberValidated=0,this.enableComponentsControl=!0,this.conveyorPosition=0,this.conveyorRollings=[],this.conveyorBackPosition=0,this.warnings=0,this.motherBoardComponents=[],this.firstStep=!1,this.indexSoundComponentValidated=1}preload(){super.preload(),this.load.atlas("factory","sprites/factory.png","sprites/factory.json")}create(){super.create(),this.timeStart=Date.now(),this.cameras.main.setBackgroundColor(0),this.scale.setGameSize(550,300),this.anims.create({key:"select-component-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:3,prefix:"select-"}),repeat:-1,frameRate:10}).addFrame(this.anims.generateFrameNames("factory",{start:2,end:2,prefix:"select-"})),this.anims.create({key:"water-anim",frames:this.anims.generateFrameNames("factory",{start:1,end:2,prefix:"water-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:10}),this.anims.create({key:"rolling-fast",frames:this.anims.generateFrameNames("factory",{start:1,end:4,prefix:"roulement-"}),repeat:-1,frameRate:20}),this.add.image(0,234,"factory","ground").setOrigin(0,0),this.add.tileSprite(-4,-36,554,135,"factory","sol").setOrigin(0,0),this.conveyorInBack=this.add.tileSprite(0,-10,550,96,"factory","tapis").setOrigin(0,0),this.initBackMotherboard(),this.addBackHands(),this.add.tileSprite(0,0,150,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(150,0,67,99,"factory","vitre").setOrigin(0,0),this.add.tileSprite(217,0,350,99,"factory","glass-repeat").setOrigin(0,0),this.add.tileSprite(0,99,550,135,"factory","sol").setOrigin(0,0);this.add.image(474,97,"factory","block-back"),this.conveyor=this.add.tileSprite(0,105,550,96,"factory","tapis").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0),this.add.tileSprite(45,201,550,11,"factory","rouleaubas").setOrigin(0,0),this.add.image(30,104,"factory","rouleaugauche").setOrigin(0,0).setScale(-1,1),this.add.tileSprite(0,201,14,11,"factory","rouleaubas").setOrigin(0,0);for(let e=0;e<3;e++)this.conveyorRollings.push(this.add.sprite(8*e-3,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));for(let e=0;e<54;e++)this.conveyorRollings.push(this.add.sprite(40+8*e,202,"factory","roulement-1").setOrigin(0,0).anims.play("rolling",!0));this.add.image(510,140,"factory","block").setDepth(10),this.add.image(476,97,"factory","tube-water").setDepth(10),this.add.image(476,117,"factory","tube-water").setDepth(10),this.add.image(476,137,"factory","tube-water").setDepth(10),this.waterCleaningAnims=[];for(let e=0;e<=2;e++){const t=this.add.sprite(457,124+20*e,"factory","water-1").setDepth(10).setVisible(!1);t.anims.play("water-anim"),this.waterCleaningAnims.push(t)}this.initComponents(),this.initSelectedComponent(),this.userLeftHand=this.add.image(zt,Kt,"factory","gant").setOrigin(0,0),this.userLeftHand.scaleY=-1,this.userLeftHand.setDepth(10).setVisible(!1),this.cameras.main.fadeIn(1e3,0,0,0),h.on(w,this.listenDispatchedEvents,this),a("bypassminigame")?this.endGame():(N("sfx_mini-jeu_roulement_puces",this),N("sfx_mini-jeu_puce-bonne_1",this),N("sfx_mini-jeu_puce-bonne_2",this),N("sfx_mini-jeu_puce-bonne_3",this),N("sfx_mini-jeu_puce-mauvaise_2",this),N("sfx_mini-jeu_reussite_3",this),N("sfx_mini-jeu_jet-eau",this),this.createControls(),this.startGame())}startGame(){a("factory")&&A(this),this.cameras.main.fadeIn(2e3,0,0,0),this.time.delayedCall(1e3,()=>this.startDiscussion("factory"))}gameOver(){this.isCinematic=!0,this.isGameOver=!0,X(["factory_game_over"]),this.startDiscussion("factory")}endGame(){console.log("Validated",this.numberValidated),n("Factory",this.timeStart),super.endGame(["factory_after"])}listenDispatchedEvents(e){K(e,"factory_tuto_begin")&&this.tutoBegin()}listenUnlockedEvents(e){super.listenUnlockedEvents(e),K(e,"factory_after_tuto")&&this.afterTuto(),K(e,"factory_end")&&this.endGame()}tutoBegin(){console.log("tutoBegin"),this.isCinematic=!1,this.firstStep=!0,this.initMotherboard()}tutoMissed(){X(["factory_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("factory")}tutoEnd(){console.log("tutoEnd"),this.isCinematic=!0,X(["factory_tuto_end"]),this.startDiscussion("factory")}afterTuto(){console.log("afterTuto"),this.isCinematic=!1,this.firstStep=!1,this.initMotherboard()}addBackHands(){this.leftHand=this.add.image(420,-10,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand,x:300,y:-100,angle:40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:200,duration:1e3}),this.rightHand=this.add.image(330,-10,"factory","gant").setOrigin(0,0),this.rightHand.scaleX=-1,this.tweens.add({targets:this.rightHand,x:350,y:-100,angle:-40,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:800}),this.leftHand2=this.add.image(200,-12,"factory","gant").setOrigin(0,0),this.tweens.add({targets:this.leftHand2,x:200,y:-80,angle:30,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:250,duration:800}),this.rightHand2=this.add.image(100,-12,"factory","gant").setOrigin(0,0),this.rightHand2.scaleX=-1,this.tweens.add({targets:this.rightHand2,x:150,y:-90,angle:-25,ease:"Sine.easeInOut",yoyo:!0,loop:-1,delay:1e3,duration:900})}initComponents(){let e=0;for(const t in Yt)this.componentsLine.push({name:t,tray:this.add.image(275+90*e,qt,"factory",`tray-${t}`),image:this.add.image(275+90*e,qt,"factory",Yt[t])}),e++}getComponentsNumber(){return this.numberValidated>5?3:2}initBackMotherboard(){this.backMotherboards=[];for(let e=0;e<=5;e++)this.backMotherboards.push(this.add.image(600+100*e,30,"factory","motherboard"))}initMotherboard(){this.enableComponentsControl=!1,this.time.delayedCall(1e3,()=>this.enableComponentsControl=!0);const t=-150,s=this.getComponentsNumber(),i=70/s;this.componentValidated=0,this.isMotherboardValidated=!1,this.motherBoardComponents=[],this.motherBoard=[],this.motherBoard.push(this.add.image(t,150,"factory","motherboard"));const a=[],n=Object.keys(Yt);for(let l=0;l<s;l++){const t=e.Math.RND.pick(n);a.push(t),n.splice(n.indexOf(t),1)}let r=[2,1];if(s>2)if("green"===a[0])r=[1,2];else if("green"===a[1]){const e=a[2];a[2]="green",a[1]=e}let o=0,h=0;const d=[...r];a.forEach((e,t)=>{let a;2===s?a=this.add.image(i*t-168,150,"factory",`component-position-${e}`):(0===d[o]&&(o++,h=0),r[o],a=this.add.image((i+9)*o-165,1===r[o]?150:135+(i+5)*h,"factory",`component-position-${e}`),d[o]--,h++),this.motherBoardComponents.push({name:e,component:a,validated:!1}),this.motherBoard.push(a)}),this.enableComponentsControl=!0}initSelectedComponent(){this.add.sprite(275,263,"factory","select-1").anims.play("select-component-anim")}createControls(){if(super.createControls(),this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",left:"left",right:"right",w:"up",z:"up",q:"left",a:"left",d:"right"}),this.input.keyboard.on("keydown",e=>{["ArrowUp","z","w"].includes(e.key)||32===e.keyCode?this.handleAction():["ArrowLeft","q","a"].includes(e.key)?this.left():["ArrowRight","d"].includes(e.key)&&this.right()},this),r()){const e=80,t=225,s=.2,i=16733508,a=e=>{e.alpha=.5,this.tweens.add({targets:e,alpha:.1,duration:500})};this.add.bitmapText(70,t,"FreePixel-16","←",16).setOrigin(.5,.5).setDepth(1e5);const n=this.add.circle(70,t,30,i).setAlpha(s).setDepth(1e5);this.add.bitmapText(275,t,"FreePixel-16","↑",16).setOrigin(.5,.5).setDepth(1e5);const r=this.add.circle(275,t,30,i).setAlpha(s).setDepth(1e5);this.add.bitmapText(480,t,"FreePixel-16","→",16).setOrigin(.5,.5).setDepth(1e5);const o=this.add.circle(480,t,30,i).setAlpha(s).setDepth(1e5);this.input.on("pointerdown",t=>t.x<275-e?(this.left(),void a(n)):t.x>275+e?(this.right(),void a(o)):(this.handleAction(),void a(r)),this)}}handleAction(){super.handleAction(),this.currentDiscussionStatus===z.NONE&&this.setComponent()}refreshComponentsLine(){let e=0;this.componentsLine.forEach(t=>{const s=275+90*this.componentsLinePosition+90*e;t.image.x=s,t.tray.x=s,t.image.y=qt,e++})}right(){super.handleAction(),!this.enableComponentsControl||this.componentsLinePosition-1<-1*this.componentsLine.length+1||(G("sfx_mini-jeu_roulement_puces",this,!1,.5),this.componentsLinePosition--,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=1,this.movingHand=!0,this.userLeftHand.setX(350).setAlpha(.1).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:330,angle:-30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}left(){super.handleAction(),!this.enableComponentsControl||this.componentsLinePosition+1>0||(G("sfx_mini-jeu_roulement_puces",this,!1,.5),this.componentsLinePosition++,this.refreshComponentsLine(),this.handAnimation&&this.handAnimation.destroy(),this.resetUserHand(),this.userLeftHand.scaleX=-1,this.movingHand=!0,this.userLeftHand.setX(200).setVisible(!0),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:220,angle:30,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:200,onComplete:()=>{this.resetUserHand()}}))}getSelectedComponent(){return this.componentsLine[-1*this.componentsLinePosition]}getValidatedComponent(){if(!this.motherBoardComponents.length)return null;const e=this.getSelectedComponent();for(const t of this.motherBoardComponents)if(t.name===e.name&&!t.validated)return this.componentValidated++,t.validated=!0,t;return null}resetUserHand(){this.movingHand=!1,this.userLeftHand.scaleX=1,this.userLeftHand.setAlpha(.1),this.userLeftHand.setVisible(!1),this.userLeftHand.setRotation(0),this.userLeftHand.setPosition(zt,Kt)}setComponent(){if(!this.enableComponentsControl||this.motherBoard?.[0]?.x<20)return;this.enableComponentsControl=!1;const e=this.getSelectedComponent().image;e.setDepth(1);const t={x:e.x,y:e.y},s=this.getValidatedComponent();this.resetUserHand(),this.userLeftHand.setVisible(!0);const i=200;if(this.handAnimation&&this.handAnimation.destroy(),s){const{component:a,name:n}=s;G(`sfx_mini-jeu_puce-bonne_${this.indexSoundComponentValidated}`,this,!0,1),this.indexSoundComponentValidated++,this.indexSoundComponentValidated>3&&(this.indexSoundComponentValidated=1),this.tweens.add({targets:e,x:a.x+10,y:a.y,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=qt,this.enableComponentsControl=!0;try{a.setTexture("factory",`component-${n}`)}catch(s){}}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,x:a.x,y:230,alpha:1,angle:(a.x-275)/10,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!(this.componentValidated===this.getComponentsNumber()),this.resetUserHand()}})}else G("sfx_mini-jeu_puce-mauvaise_2",this,!0,1),this.tweens.add({targets:e,y:150,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{e.x=t.x,e.y=qt,this.enableComponentsControl=!0}}),this.handAnimation=this.tweens.add({targets:this.userLeftHand,y:230,alpha:1,yoyo:!0,ease:"Sine.easeInOut",duration:i,onComplete:()=>{this.enableComponentsControl=!(this.componentValidated===this.getComponentsNumber()),this.resetUserHand()}});this.componentValidated===this.getComponentsNumber()&&(this.enableComponentsControl=!1,this.time.delayedCall(200,()=>{this.motherBoard.length&&this.validateMotherboard()}))}validateMotherboard(){G("sfx_mini-jeu_reussite_3",this,!0,1),this.isMotherboardValidated=!0,this.numberValidated++,this.waterCleaningAnims.forEach(e=>e.setVisible(!0)),G("sfx_mini-jeu_jet-eau",this,!1,.5),R(this,this.sounds["sfx_mini-jeu_jet-eau"]),this.time.delayedCall(1e3,()=>this.waterCleaningAnims.forEach(e=>e.setVisible(!1)));0==this.numberValidated%4&&(this.motherboardSpeed+=.5,this.updateMessage(ot("factory.faster"))),this.firstStep||1!=this.numberValidated%5||this.updateMessage(ot("factory.welldone"))}destroyMotherboard(){for(const e of this.motherBoard)e.destroy();this.motherBoard=[]}endMotherboard(){if(this.enableComponentsControl=!1,!this.isMotherboardValidated)return this.firstStep?(this.destroyMotherboard(),void this.tutoMissed()):(this.warnings++,this.updateWarnings(this.warnings),this.updateMessage(ot("factory.error")),this.destroyMotherboard(),3===this.warnings?void this.gameOver():void this.time.delayedCall(3e3,()=>{this.motherboardSpeed-=.25,this.initMotherboard()}));this.firstStep?this.tutoEnd():(this.destroyMotherboard(),this.time.delayedCall(1e3,()=>this.initMotherboard()))}update(){if(this.conveyorBackPosition+=1,this.conveyorInBack.setTilePosition(this.conveyorBackPosition,0),this.backMotherboards.forEach(e=>{e.x--,e.x<-100&&(e.x=600)}),this.isCinematic)return;if(!this.motherBoard.length)return void this.conveyorRollings.forEach(e=>e.anims.stop());const e=this.isMotherboardValidated?Ht:this.motherBoard[0].x<30||this.motherBoard[0].x>500?Ut:this.motherboardSpeed;this.conveyorRollings.forEach(t=>t.anims.play([Ht,Ut].includes(e)?"rolling-fast":"rolling",!0)),this.conveyorPosition-=e,this.conveyor.setTilePosition(this.conveyorPosition,0);for(const t of this.motherBoard)t.x+=e;this.motherBoard.length&&this.motherBoard[0].x>590&&this.endMotherboard()}},os,class extends Gt{constructor(){super({key:"recyclingCentre",physics:{matter:{debug:i(),gravity:{y:.04}}}}),this.delayBetweenObjects=1500,this.objects=[],this.containers=[],this.containersObject=null,this.validatedObjects=0,this.conveyorPosition=0,this.selectedObject="laptop",this.warnings=0,this.previousValidatedObjects=0,this.currentYGravity=.04,this.objectsMissed=[]}preload(){super.preload(),this.load.atlas("recyclingCentre","sprites/recyclingCentre.png","sprites/recyclingCentre.json")}create(){super.create(),this.timeStart=Date.now(),this.anims.create({key:"trap-open",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:4,prefix:"trap"}),repeat:0,frameRate:10}),this.anims.create({key:"trap-close",frames:this.anims.generateFrameNames("recyclingCentre",{start:4,end:1,prefix:"trap"}),repeat:0,frameRate:10}),this.anims.create({key:"shredder-console",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-console-"}),repeat:-1,frameRate:10}),this.anims.create({key:"shredder-phone",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-phone-"}),repeat:-1,frameRate:10}),this.anims.create({key:"shredder-laptop",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:2,prefix:"shredder-laptop-"}),repeat:-1,frameRate:10}),this.anims.create({key:"wheel-right",frames:this.anims.generateFrameNames("recyclingCentre",{start:1,end:4,prefix:"wheel-"}),repeat:-1,frameRate:10}),this.anims.create({key:"wheel-left",frames:this.anims.generateFrameNames("recyclingCentre",{start:4,end:1,prefix:"wheel-"}),repeat:-1,frameRate:10}),this.scale.setGameSize(550,300),this.matter.world.setBounds(0,-100,550,400),this.add.image(275,150,"recyclingCentre","background"),this.add.image(275,0,"recyclingCentre","track").setOrigin(.5,0),this.waterLevelLeft=this.add.image(26,300,"recyclingCentre","water-level").setDepth(1),this.add.image(27,192,"recyclingCentre","water-tank").setDepth(1),this.waterLevelRight=this.add.image(524,250,"recyclingCentre","water-level").setScale(-1,1).setDepth(1),this.add.image(522,192,"recyclingCentre","water-tank").setScale(-1,1).setDepth(1),this.objectSource=this.add.sprite(275,0,"recyclingCentre","trap1").setOrigin(.5,0).setDepth(1),this.leftCable=this.add.graphics().setDepth(1),this.rightCable=this.add.graphics().setDepth(1),this.shredder=this.add.sprite(0,-65,"recyclingCentre","shredder-laptop-1").setOrigin(.5,0).setDepth(1),this.shredder.anims.play("shredder-laptop");const e=this.add.image(0,0,"recyclingCentre","shredder").setDepth(2);this.wheelLeft=this.add.sprite(-50,45,"recyclingCentre","wheel-1").setDepth(2),this.wheelRight=this.add.sprite(50,45,"recyclingCentre","wheel-1").setDepth(2),this.buttonLeftTop=this.add.image(-37,0,"recyclingCentre","button-blue").setDepth(1),this.buttonLeftBottom=this.add.image(-37,22,"recyclingCentre","button-blue").setDepth(1),this.buttonRightTop=this.add.image(37,0,"recyclingCentre","button-blue").setDepth(1),this.buttonRightBottom=this.add.image(37,22,"recyclingCentre","button-blue").setDepth(1),this.currentObject=this.add.image(0,2,"recyclingCentre",this.selectedObject).setDepth(1),this.previousObject=this.add.image(0,-23,"recyclingCentre","phone-little").setAlpha(.4),this.nextObject=this.add.image(0,27,"recyclingCentre","console-little").setAlpha(.4),this.containersObject=this.add.container(200,252,[this.wheelLeft,this.wheelRight,this.shredder,this.buttonLeftTop,this.buttonLeftBottom,this.buttonRightTop,this.buttonRightBottom,e,this.currentObject,this.previousObject,this.nextObject]),this.physics.add.existing(this.containersObject),this.containersObject.setDepth(1);this.containersObject.body.setAllowGravity(!1).setMaxVelocity(200).setDamping(!0).setDrag(.01),a("bypassminigame")?this.endGame():(h.on(w,this.listenDispatchedEvents,this),this.createControls(),this.startGame(),N("sfx_mini-jeu_broyeur",this),N("sfx_mini-jeu_roulement_broyeur",this),N("sfx_mini-jeu_trappe_dechet",this),N("sfx_mini-jeu_reussite",this))}startGame(){a("recyclingCentre")&&A(this),this.moveContainers(0),this.cameras.main.fadeIn(2e3,0,0,0),this.time.delayedCall(1e3,()=>this.startDiscussion("recyclingCentre"))}gameOver(){this.isCinematic=!0,this.isGameOver=!0,this.shredder.anims.stop(),X(["recycling_game_over"]),this.startDiscussion("recyclingCentre")}endGame(){n("recyclingCentre",this.timeStart),super.endGame(["recycling_after"])}listenDispatchedEvents(e){K(e,"recycling_tuto_begin")&&this.tutoBegin()}listenUnlockedEvents(e){super.listenUnlockedEvents(e),K(e,"recycling_after_tuto")&&this.afterTuto(),K(e,"recycling_end")&&this.endGame()}tutoBegin(){console.log("tutoBegin");for(const e of this.objects)this.tweens.add({targets:e,alpha:0,duration:1e3,onComplete:()=>{e.destroy()}});this.objects=[],this.isCinematic=!1,this.firstStep=!0,this.time.delayedCall(1500,()=>this.initObject())}tutoMissed(){X(["recycling_tuto_missed"]),this.isCinematic=!0,this.startDiscussion("recyclingCentre")}tutoEnd(){console.log("tutoEnd"),this.isCinematic=!0,X(["recycling_tuto_end"]),this.startDiscussion("recyclingCentre")}afterTuto(){console.log("afterTuto"),this.isCinematic=!1,this.firstStep=!1,this.time.delayedCall(1500,()=>this.initObject())}getObjectNameByDirection(e){let t=es.indexOf(this.selectedObject)+e;return t=t>es.length-1?0:t,t=t<0?es.length-1:t,es[t]}setSelectedObject(e){this.changeMode||(this.changeMode=!0,this.selectedObject=this.getObjectNameByDirection(e),this.currentObject.setFrame(this.selectedObject),this.previousObject.setFrame(this.getObjectNameByDirection(-1)+"-little"),this.nextObject.setFrame(this.getObjectNameByDirection(1)+"-little"),G("sfx_mini-jeu_reussite",this,!0,.06),this.tweens.add({targets:this.shredder,y:-30,duration:100,onComplete:()=>{this.shredder.anims.play("shredder-"+this.selectedObject),this.tweens.add({targets:this.shredder,y:-65,duration:100,onComplete:()=>this.changeMode=!1})}}))}right(){this.goingRight=!0}left(){this.goingLeft=!0}up(){this.isCinematic||(this.setSelectedObject(-1),this.feedbackButton(this.buttonLeftTop),this.feedbackButton(this.buttonRightTop))}down(){this.isCinematic||(this.setSelectedObject(1),this.feedbackButton(this.buttonLeftBottom),this.feedbackButton(this.buttonRightBottom))}feedbackButton(e){e.setTexture("recyclingCentre","button-red"),this.time.delayedCall(300,()=>{e.setTexture("recyclingCentre","button-blue")})}createDebris(e,t,s){const i=ts[s];Array(Phaser.Math.Between(20,40)).fill(0).forEach(s=>new is(this,e,t,i))}initObject(){if(this.isCinematic)return;this.updateCurrentWarningProgression();const e=(this.objectsMissed.length>ss[0]&&1)+(this.objects.length>ss[1]&&1)+(this.objects.length>ss[2]&&1);if(e>this.warnings&&(this.warnings=e,this.updateWarnings(this.warnings),this.updateMessage(ot("recycling.error"))),3===e)return void this.gameOver();const t=this.firstStep?"console":Phaser.Math.RND.pick(es),s=Phaser.Math.Between(150,400);if(G("sfx_mini-jeu_trappe_dechet",this,!0,1),this.isTrapAnimating||(this.isTrapAnimating=!0,this.objectSource.anims.play("trap-open",!0),this.time.delayedCall(1200,()=>{this.objectSource.anims.play("trap-close",!0),this.isTrapAnimating=!1})),this.tweens.add({ease:"Sine.easeInOut",targets:this.objectSource,x:s,duration:200,onComplete:()=>{const e=this.matter.add.gameObject(this.add.image(s,30,"recyclingCentre",t+"-broken"));e.setData("id",t+Date.now()),this.objects.push(e)}}),this.firstStep)return;this.delayBetweenObjects-=10,this.delayBetweenObjects<100&&(this.delayBetweenObjects=100);const i=this.validatedObjects>10?this.delayBetweenObjects:Phaser.Math.Between(1500,2500);this.time.delayedCall(i,()=>this.initObject()),this.previousValidatedObjects!==this.validatedObjects&&[11,25].includes(this.validatedObjects)&&(this.previousValidatedObjects=this.validatedObjects,this.currentYGravity+=.02,this.matter.world.setGravity(0,this.currentYGravity),this.updateMessage(ot("recycling.faster")))}updateCurrentWarningProgression(){ss[this.warnings]&&(0===this.warnings?this.updateWarningProgression(100*this.objectsMissed.length/ss[this.warnings]+2):this.updateWarningProgression(100*(this.objects.length-ss[this.warnings-1])/(ss[this.warnings]-ss[this.warnings-1]+2)))}updateCable(){const e=this.containersObject.x;this.leftCable.clear(),this.leftCable.lineStyle(10,395793);const t=new Phaser.Math.Vector2(70,250),s=new Phaser.Math.Vector2(e-45,250),i=new Phaser.Math.Vector2((e+20)/2,300);new Phaser.Curves.QuadraticBezier(t,i,s).draw(this.leftCable);const a=this.make.graphics();a.fillRect(70,0,500,300);const n=a.createGeometryMask();this.leftCable.setMask(n),this.rightCable.clear(),this.rightCable.lineStyle(10,395793);const r=new Phaser.Math.Vector2(480,250),o=new Phaser.Math.Vector2(e+45,250),h=new Phaser.Math.Vector2((500+e)/2,300);new Phaser.Curves.QuadraticBezier(r,h,o).draw(this.rightCable);const d=this.make.graphics();d.fillRect(0,0,480,300);const l=d.createGeometryMask();this.rightCable.setMask(l)}updateWaters(){this.waterLevelLeft.y=this.containersObject.x/2+155,this.waterLevelRight.y=-this.containersObject.x/2+420}moveContainers(e){this.containersObject.body.setAccelerationX(100*e),G("sfx_mini-jeu_roulement_broyeur",this,!1,.5)}updateContainers(){const e=this.containersObject.x;if(this.goingRight){const t=e>370?0:5;this.moveContainers(t)}else if(this.goingLeft){const t=e<180?0:5;this.moveContainers(-t)}else this.containersObject.body.setAccelerationX(0)}updateWheels(){if(this.containersObject.body.velocity.x>8||this.containersObject.body.velocity.x<-8)return this.wheelLeft.play("wheel-"+(this.goingLeft?"left":"right"),!0),void this.wheelRight.play("wheel-"+(this.goingLeft?"left":"right"),!0);this.wheelLeft.stop(),this.wheelRight.stop()}updateObjects(){if(!this.isCinematic)for(const e of this.objects){if(e.y>220){e.setTint(7829367);const t=e.getData("id");this.firstStep?this.tutoMissed():this.objectsMissed.includes(t)||(this.objectsMissed.push(t),this.updateCurrentWarningProgression());continue}e.y<190||e.frame.name!==this.selectedObject+"-broken"||(e.x<this.containersObject.x-45||e.x>this.containersObject.x+45||(this.validatedObjects++,this.destroyObject(e),this.firstStep&&this.tutoEnd(),1===this.currentObject.scale&&this.tweens.add({targets:this.currentObject,scale:1.4,yoyo:1,duration:100})))}}destroyObject(e){this.objects=this.objects.filter(t=>t!==e),G("sfx_mini-jeu_broyeur",this,!1,1),this.createDebris(e.x,e.y,this.selectedObject),e.destroy()}update(){this.containersObject.body.setAccelerationX(0),this.updateCable(),this.updateWaters(),this.updateWheels(),this.isCinematic||(this.updateContainers(),this.updateObjects())}createControls(){if(super.createControls(),this.cursors=this.input.keyboard.addKeys({space:"space",up:"up",down:"down",left:"left",right:"right",w:"up",z:"up",q:"left",a:"left",s:"down",d:"right"}),this.input.keyboard.on("keydown",e=>{["ArrowUp","z","w"].includes(e.key)?this.up():["ArrowDown","s"].includes(e.key)?this.down():["ArrowLeft","q","a"].includes(e.key)?this.left():["ArrowRight","d"].includes(e.key)?this.right():32===e.keyCode&&this.handleAction()},this),this.input.keyboard.on("keyup",e=>{["ArrowLeft","q","a"].includes(e.key)?this.goingLeft=!1:["ArrowRight","d"].includes(e.key)&&(this.goingRight=!1)},this),r()){const e=.2,t=16733508,s=e=>{e.alpha=.5,this.tweens.add({targets:e,alpha:.1,duration:500})};this.add.bitmapText(40,210,"FreePixel-16","←",16).setOrigin(.5,.5).setDepth(1e5);const i=this.add.circle(40,210,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.left(),s(i)});this.add.bitmapText(90,160,"FreePixel-16","↑",16).setOrigin(.5,.5).setDepth(1e5);const a=this.add.circle(90,160,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.handleAction(),this.up(),s(a)});this.add.bitmapText(90,260,"FreePixel-16","↓",16).setOrigin(.5,.5).setDepth(1e5);const n=this.add.circle(90,260,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.handleAction(),this.down(),s(n)});this.add.bitmapText(140,210,"FreePixel-16","→",16).setOrigin(.5,.5).setDepth(1e5);const r=this.add.circle(140,210,30,t).setAlpha(e).setDepth(1e5).setInteractive().on("pointerdown",()=>{this.right(),s(r)});this.input.on("pointerup",()=>{this.goingLeft=!1,this.goingRight=!1}),this.input.on("pointerdown",()=>this.handleAction())}}},Wt,class{constructor(){this.currentSprite=null,this.unlockedEvents=[],this.spritePosition={},h.on(c,this.startDiscussion,this),h.on(g,this.continueDiscussion,this),h.on(b,this.unlockMessages,this),h.on(v,this.saveUnlockedEvent,this)}initSpriteThreadIfNeeded(e){this.spritePosition?.[e]||(this.spritePosition[e]={currentThread:0,currentMessagePosition:0,threadRead:[]})}setCurrentThread(e,t){this.initSpriteThreadIfNeeded(e),this.spritePosition[e].currentThread=t}getCurrentThread(e){const t=e||this.currentSprite;return this.initSpriteThreadIfNeeded(t),this.spritePosition[t].currentThread}getCurrentMessage(){const e=this.getCurrentThread(),t=this.spritePosition?.[this.currentSprite]?.currentMessagePosition;if(null==e||null==t)return;const s=nt[this.currentSprite][e]?.dependingOn;if(!this.isValidDependingOn(this.currentSprite,s))return;const i=st();if(this.spritePosition[this.currentSprite].threadRead.includes(e)){const s=nt[this.currentSprite][e]?.repeat?.[i];if(s)return s?.[t]}return nt[this.currentSprite][e]?.messages?.[i]?.[t]}startDiscussion(e){if("screen"===e.substring(0,6))return void h.emit(k,{sprite:e});this.initSpriteThreadIfNeeded(e),this.currentSprite=e;const t=this.getNextAvailableThread(e,this.getCurrentThread());console.log("startDiscussion",e,t),void 0!==t&&(this.setCurrentThread(e,t),this.resetMessagePosition(e)),this.resetMessagePosition(e),this.sendMessage()}resetMessagePosition(e){this.spritePosition[e].currentMessagePosition=0}getNextAvailableThread(e,t){if(!nt[e][t])return;const s=nt[e][t]?.dependingOn;return s&&this.isValidDependingOn(e,s)&&!this.spritePosition[e].threadRead.includes(t)?t:this.getNextAvailableThread(e,t+1)}continueDiscussion(){this.spritePosition[this.currentSprite].currentMessagePosition++,this.sendMessage()}sendMessage(){let e=this.getCurrentMessage();if(!e){this.endThread();const t=this.getNextAvailableThread(this.currentSprite,this.getCurrentThread());if(void 0===t)return void this.endDiscussion();this.setCurrentThread(this.currentSprite,t),this.resetMessagePosition(this.currentSprite),e=this.getCurrentMessage()}h.emit(m),h.emit(f,{sprite:this.currentSprite,message:e})}endThread(){this.spritePosition[this.currentSprite].threadRead.push(this.getCurrentThread()),this.preSaveUnlockedEvent()}endDiscussion(){console.log("endDiscussion",this.currentSprite),h.emit(p,this.currentSprite)}preSaveUnlockedEvent(){const e=this.getCurrentThread(),t=nt[this.currentSprite][e]?.unlockEvents;this.saveUnlockedEvent(t)}saveUnlockedEvent(e){e&&(h.emit(w,{newUnlockedEvents:e}),e.filter(e=>!this.unlockedEvents.includes(e)).length&&h.emit(b,{newUnlockedEvents:e,unlockedEvents:[...e,...this.unlockedEvents]}))}isValidDependingOn(e,t){return!t||t.every(e=>"!"!==e[0]===this.unlockedEvents.includes(e))}unlockMessages(e){for(const t in nt){this.initSpriteThreadIfNeeded(t);for(const s in nt[t]){const i=nt[t][s]?.dependingOn;if(!i)continue;const a=i.filter(e=>!this.unlockedEvents.includes(e));a.length>0&&a.every(t=>e.newUnlockedEvents.includes(t))&&(this.spritePosition[t].currentThread=Number(s),this.spritePosition[t].currentMessagePosition=0,this.spritePosition[this.currentSprite]?.threadRead?.includes(s)||h.emit(y,t))}}this.unlockedEvents.push(...e.newUnlockedEvents)}},hs],scale:{mode:t.Scale.FIT,autoCenter:t.Scale.CENTER_BOTH}};new t.Game(ds);
